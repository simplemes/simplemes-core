<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="doc@simplemes.org">
<title>Guide - EFrame - SimpleMES</title>
<style>
/* Custom for Simplemes. Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {
  display: block
}

audio, canvas, video {
  display: inline-block
}

audio:not([controls]) {
  display: none;
  height: 0
}

[hidden], template {
  display: none
}

script {
  display: none !important
}

html {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%
}

body {
  margin: 0
}

a {
  background: transparent
}

a:focus {
  outline: thin dotted
}

a:active, a:hover {
  outline: 0
}

h1 {
  font-size: 2em;
  margin: .67em 0
}

abbr[title] {
  border-bottom: 1px dotted
}

b, strong {
  font-weight: bold
}

dfn {
  font-style: italic
}

hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0
}

mark {
  background: #ff0;
  color: #000
}

code, kbd, pre, samp {
  font-family: monospace;
  font-size: 1em
}

pre {
  white-space: pre-wrap
}

q {
  quotes: "\201C" "\201D" "\2018" "\2019"
}

small {
  font-size: 80%
}

sub, sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline
}

sup {
  top: -.5em
}

sub {
  bottom: -.25em
}

img {
  border: 0
}

svg:not(:root) {
  overflow: hidden
}

figure {
  margin: 0
}

fieldset {
  border: 1px solid silver;
  margin: 0 2px;
  padding: .35em .625em .75em
}

legend {
  border: 0;
  padding: 0
}

button, input, select, textarea {
  font-family: inherit;
  font-size: 100%;
  margin: 0
}

button, input {
  line-height: normal
}

button, select {
  text-transform: none
}

button, html input[type="button"], input[type="reset"], input[type="submit"] {
  -webkit-appearance: button;
  cursor: pointer
}

button[disabled], html input[disabled] {
  cursor: default
}

input[type="checkbox"], input[type="radio"] {
  box-sizing: border-box;
  padding: 0
}

input[type="search"] {
  -webkit-appearance: textfield;
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box;
  box-sizing: content-box
}

input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none
}

button::-moz-focus-inner, input::-moz-focus-inner {
  border: 0;
  padding: 0
}

textarea {
  overflow: auto;
  vertical-align: top
}

table {
  border-collapse: collapse;
  border-spacing: 0
}

*, *:before, *:after {
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box
}

html, body {
  font-size: 100%
}

body {
  background: #fff;
  color: rgba(0, 0, 0, .8);
  padding: 0;
  margin: 0;
  font-family: "Noto Serif", "DejaVu Serif", serif;
  font-weight: 400;
  font-style: normal;
  line-height: 1;
  position: relative;
  cursor: auto
}

a:hover {
  cursor: pointer
}

img, object, embed {
  max-width: 100%;
  height: auto
}

object, embed {
  height: 100%
}

img {
  -ms-interpolation-mode: bicubic
}

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object {
  max-width: none !important
}

.left {
  float: left !important
}

.right {
  float: right !important
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.hide {
  display: none
}

.antialiased, body {
  -webkit-font-smoothing: antialiased
}

img {
  display: inline-block;
  vertical-align: middle
}

textarea {
  height: auto;
  min-height: 50px
}

select {
  width: 100%
}

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p {
  font-size: 1.21875em;
  line-height: 1.6
}

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title {
  line-height: 1.45;
  color: #7a2518;
  font-weight: 400;
  margin-top: 0;
  margin-bottom: .25em
}

div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td {
  margin: 0;
  padding: 0;
  direction: ltr
}

a {
  color: #2156a5;
  text-decoration: underline;
  line-height: inherit
}

a:hover, a:focus {
  color: #1d4b8f
}

a img {
  border: none
}

p {
  font-family: inherit;
  font-weight: 400;
  font-size: 1em;
  line-height: 1.2;
  margin-bottom: 1.25em;
  text-rendering: optimizeLegibility
}

p aside {
  font-size: .875em;
  line-height: 1.35;
  font-style: italic
}

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 {
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-weight: 300;
  font-style: normal;
  color: #ba3925;
  text-rendering: optimizeLegibility;
  margin-top: 1em;
  margin-bottom: .5em;
  line-height: 1.0125em
}

h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small {
  font-size: 60%;
  color: #e99b8f;
  line-height: 0
}

h1 {
  font-size: 2.125em
}

h2 {
  font-size: 1.6875em
}

h3, #toctitle, .sidebarblock > .content > .title {
  font-size: 1.375em
}

h4, h5 {
  font-size: 1.125em
}

h6 {
  font-size: 1em
}

hr {
  border: solid #ddddd8;
  border-width: 1px 0 0;
  clear: both;
  margin: 1.25em 0 1.1875em;
  height: 0
}

em, i {
  font-style: italic;
  line-height: inherit
}

strong, b {
  font-weight: bold;
  line-height: inherit
}

small {
  font-size: 60%;
  line-height: inherit
}

code {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  font-weight: 400;
  color: rgba(0, 0, 0, .9)
}

ul, ol, dl {
  font-size: 1em;
  line-height: 1.6;
  margin-bottom: 1.25em;
  list-style-position: outside;
  font-family: inherit
}

ul, ol, ul.no-bullet, ol.no-bullet {
  margin-left: 1.5em
}

ul li ul, ul li ol {
  margin-left: 1.25em;
  margin-bottom: 0;
  font-size: 1em
}

ul.square li ul, ul.circle li ul, ul.disc li ul {
  list-style: inherit
}

ul.square {
  list-style-type: square
}

ul.circle {
  list-style-type: circle
}

ul.disc {
  list-style-type: disc
}

ul.no-bullet {
  list-style: none
}

ol li ul, ol li ol {
  margin-left: 1.25em;
  margin-bottom: 0
}

dl dt {
  margin-bottom: .3125em;
  font-weight: bold
}

dl dd {
  margin-bottom: 1.25em
}

abbr, acronym {
  text-transform: uppercase;
  font-size: 90%;
  color: rgba(0, 0, 0, .8);
  border-bottom: 1px dotted #ddd;
  cursor: help
}

abbr {
  text-transform: none
}

blockquote {
  margin: 0 0 1.25em;
  padding: .5625em 1.25em 0 1.1875em;
  border-left: 1px solid #ddd
}

blockquote cite {
  display: block;
  font-size: .9375em;
  color: rgba(0, 0, 0, .6)
}

blockquote cite:before {
  content: "\2014 \0020"
}

blockquote cite a, blockquote cite a:visited {
  color: rgba(0, 0, 0, .6)
}

blockquote, blockquote p {
  line-height: 1.6;
  color: rgba(0, 0, 0, .85)
}

@media only screen and (min-width: 768px) {
  h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 {
    line-height: 1.2
  }

  h1 {
    font-size: 2.75em
  }

  h2 {
    font-size: 2.3125em
  }

  h3, #toctitle, .sidebarblock > .content > .title {
    font-size: 1.6875em
  }

  h4 {
    font-size: 1.4375em
  }
}

table {
  background: #fff;
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead, table tfoot {
  background: #f7f8f7;
  font-weight: bold
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  color: rgba(0, 0, 0, .8);
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit;
  color: rgba(0, 0, 0, .8)
}

table tr.even, table tr.alt, table tr:nth-of-type(even) {
  background: #f8f8f7
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 {
  line-height: 1.2;
  word-spacing: -.05em
}

h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong {
  font-weight: 400
}

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after {
  content: " ";
  display: table
}

.clearfix:after, .float-group:after {
  clear: both
}

*:not(pre) > code {
  font-size: .9375em;
  font-style: normal !important;
  letter-spacing: 0;
  padding: .1em .5ex;
  word-spacing: -.15em;
  background-color: #f7f7f8;
  -webkit-border-radius: 4px;
  border-radius: 4px;
  line-height: 1.45;
  text-rendering: optimizeSpeed
}

pre, pre > code {
  line-height: 1.45;
  color: rgba(0, 0, 0, .9);
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  font-weight: 400;
  text-rendering: optimizeSpeed
}

.keyseq {
  color: rgba(51, 51, 51, .8)
}

kbd {
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .75em;
  line-height: 1.4;
  background-color: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: -.15em .15em 0 .15em;
  padding: .2em .6em .2em .5em;
  vertical-align: middle;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

.menuseq, .menu {
  color: rgba(0, 0, 0, .8)
}

b.button:before, b.button:after {
  position: relative;
  top: -1px;
  font-weight: 400
}

b.button:before {
  content: "[";
  padding: 0 3px 0 2px
}

b.button:after {
  content: "]";
  padding: 0 2px 0 3px
}

p a > code:hover {
  color: rgba(0, 0, 0, .9)
}

#header, #content, #footnotes, #footer {
  width: 100%;
  margin-left: auto;
  margin-right: auto;
  margin-top: 0;
  margin-bottom: 0;
  max-width: 62.5em;
  *zoom: 1;
  position: relative;
  padding-left: .9375em;
  padding-right: .9375em
}

#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after {
  content: " ";
  display: table
}

#header:after, #content:after, #footnotes:after, #footer:after {
  clear: both
}

#content {
  margin-top: 1.25em
}

#content:before {
  content: none
}

#header > h1:first-child {
  color: rgba(0, 0, 0, .85);
  margin-top: 2.25rem;
  margin-bottom: 0
}

#header > h1:first-child + #toc {
  margin-top: 8px;
  border-top: 1px solid #ddddd8
}

#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) {
  border-bottom: 1px solid #ddddd8;
  padding-bottom: 8px
}

#header .details {
  border-bottom: 1px solid #ddddd8;
  line-height: 1.45;
  padding-top: .25em;
  padding-bottom: .25em;
  padding-left: .25em;
  color: rgba(0, 0, 0, .6);
  display: -ms-flexbox;
  display: -webkit-flex;
  display: flex;
  -ms-flex-flow: row wrap;
  -webkit-flex-flow: row wrap;
  flex-flow: row wrap
}

#header .details span:first-child {
  margin-left: -.125em
}

#header .details span.email a {
  color: rgba(0, 0, 0, .85)
}

#header .details br {
  display: none
}

#header .details br + span:before {
  content: "\00a0\2013\00a0"
}

#header .details br + span.author:before {
  content: "\00a0\22c5\00a0";
  color: rgba(0, 0, 0, .85)
}

#header .details br + span#revremark:before {
  content: "\00a0|\00a0"
}

#header #revnumber {
  text-transform: capitalize
}

#header #revnumber:after {
  content: "\00a0"
}

#content > h1:first-child:not([class]) {
  color: rgba(0, 0, 0, .85);
  border-bottom: 1px solid #ddddd8;
  padding-bottom: 8px;
  margin-top: 0;
  padding-top: 1rem;
  margin-bottom: 1.25rem
}

#toc > ul {
  margin-left: .125em
}

#toc ul.sectlevel0 > li > a {
  font-style: italic
}

#toc ul.sectlevel0 ul.sectlevel1 {
  margin: .5em 0
}

#toc ul {
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  list-style-type: none
}

#toc a {
  text-decoration: none
}

#toc a:active {
  text-decoration: underline
}


@media only screen and (min-width: 768px) {
  #toctitle {
    font-size: 1.375em
  }

  body.toc2 {
    padding-left: 16%;
    padding-right: 0
  }

  #toc.toc2 {
    margin-top: 0 !important;
    background-color: #f8f8f7;
    position: fixed;
    width: 15%;
    left: 0;
    top: 0;
    border-right: 1px solid #efefed;
    border-top-width: 0 !important;
    border-bottom-width: 0 !important;
    z-index: 1000;
    padding: 1.25em 1em;
    height: 100%;
    overflow: auto;
    display: none;
  }

  #toc.toc2 #toctitle {
    margin-top: 0;
    font-size: 1.2em
  }

  #toc.toc2 > ul {
    font-size: .9em;
    margin-bottom: 0
  }

  #toc.toc2 ul ul {
    margin-left: 0;
    padding-left: 1em
  }

  #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
    padding-left: 0;
    margin-top: .5em;
    margin-bottom: .5em
  }

  body.toc2.toc-right {
    padding-left: 0;
    padding-right: 16%
  }

  body.toc2.toc-right #toc.toc2 {
    border-right-width: 0;
    border-left: 1px solid #efefed;
    left: auto;
    right: 0
  }
}

@media only screen and (min-width: 1280px) {
  body.toc2 {
    padding-left: 20em;
    padding-right: 0
  }

  #toc.toc2 {
    width: 20em
  }

  #toc.toc2 #toctitle {
    font-size: 1.375em
  }

  #toc.toc2 > ul {
    font-size: .95em
  }

  #toc.toc2 ul ul {
    padding-left: 1.25em
  }

  body.toc2.toc-right {
    padding-left: 0;
    padding-right: 20em
  }
}

#content #toc {
  border-style: solid;
  border-width: 1px;
  border-color: #e0e0dc;
  margin-bottom: 1.25em;
  padding: 1.25em;
  background: #f8f8f7;
  -webkit-border-radius: 4px;
  border-radius: 4px
}

#content #toc > :first-child {
  margin-top: 0
}

#content #toc > :last-child {
  margin-bottom: 0
}

#footer {
  max-width: 100%;
  background-color: rgba(0, 0, 0, .8);
  padding: 1.25em
}

#footer-text {
  color: rgba(255, 255, 255, .8);
  line-height: 1.44
}

.sect1 {
  padding-bottom: .625em
}

@media only screen and (min-width: 768px) {
  .sect1 {
    padding-bottom: 1.25em
  }
}

.sect1 + .sect1 {
  border-top: 1px solid #efefed
}

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor {
  position: absolute;
  z-index: 1001;
  width: 1.5ex;
  margin-left: -1.5ex;
  display: block;
  text-decoration: none !important;
  visibility: hidden;
  text-align: center;
  font-weight: 400
}

#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before {
  content: "\00A7";
  font-size: .85em;
  display: block;
  padding-top: .1em
}

#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover {
  visibility: visible
}

#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link {
  color: #ba3925;
  text-decoration: none
}

#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover {
  color: #a53221
}

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock {
  margin-bottom: 1.25em
}

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title {
  text-rendering: optimizeLegibility;
  text-align: left;
  font-family: "Noto Serif", "DejaVu Serif", serif;
  font-size: 1rem;
  font-style: italic
}

table.tableblock > caption.title {
  white-space: nowrap;
  overflow: visible;
  max-width: 0
}

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p {
  color: rgba(0, 0, 0, .85)
}

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p {
  font-size: inherit
}

.admonitionblock > table {
  border-collapse: separate;
  border: 0;
  background: none;
  width: 100%
}

.admonitionblock > table td.icon {
  text-align: center;
  width: 80px
}

.admonitionblock > table td.icon img {
  max-width: none
}

.admonitionblock > table td.icon .title {
  font-weight: bold;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  text-transform: uppercase
}

.admonitionblock > table td.content {
  padding-left: 1.125em;
  padding-right: 1.25em;
  border-left: 1px solid #ddddd8;
  color: rgba(0, 0, 0, .6)
}

.admonitionblock > table td.content > :last-child > :last-child {
  margin-bottom: 0
}

.exampleblock > .content {
  border-style: solid;
  border-width: 1px;
  border-color: #e6e6e6;
  margin-bottom: 1.25em;
  padding: 1.25em;
  background: #fff;
  -webkit-border-radius: 4px;
  border-radius: 4px
}

.exampleblock > .content > :first-child {
  margin-top: 0
}

.exampleblock > .content > :last-child {
  margin-bottom: 0
}

.sidebarblock {
  border-style: solid;
  border-width: 1px;
  border-color: #e0e0dc;
  margin-bottom: 1.25em;
  padding: 1.25em;
  background: #f8f8f7;
  -webkit-border-radius: 4px;
  border-radius: 4px
}

.sidebarblock > :first-child {
  margin-top: 0
}

.sidebarblock > :last-child {
  margin-bottom: 0
}

.sidebarblock > .content > .title {
  color: #7a2518;
  margin-top: 0;
  text-align: center
}

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child {
  margin-bottom: 0
}

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint {
  background: #f7f7f8
}

.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint {
  background: #f2f1f1
}

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
  -webkit-border-radius: 4px;
  border-radius: 4px;
  word-wrap: break-word;
  padding: 1em;
  font-size: .8125em
}

.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap {
  overflow-x: auto;
  white-space: pre;
  word-wrap: normal
}

@media only screen and (min-width: 768px) {
  .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
    font-size: .90625em
  }
}

@media only screen and (min-width: 1280px) {
  .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
    font-size: 1em
  }
}

.literalblock.output pre {
  color: #f7f7f8;
  background-color: rgba(0, 0, 0, .9)
}

.listingblock pre.highlightjs {
  padding: 0
}

.listingblock pre.highlightjs > code {
  padding: 1em;
  -webkit-border-radius: 4px;
  border-radius: 4px
}

.listingblock pre.prettyprint {
  border-width: 0
}

.listingblock > .content {
  position: relative
}

.listingblock code[data-lang]:before {
  display: none;
  content: attr(data-lang);
  position: absolute;
  font-size: .75em;
  top: .425rem;
  right: .5rem;
  line-height: 1;
  text-transform: uppercase;
  color: #999
}

.listingblock:hover code[data-lang]:before {
  display: block
}

.listingblock.terminal pre .command:before {
  content: attr(data-prompt);
  padding-right: .5em;
  color: #999
}

.listingblock.terminal pre .command:not([data-prompt]):before {
  content: "$"
}

table.pyhltable {
  border-collapse: separate;
  border: 0;
  margin-bottom: 0;
  background: none
}

table.pyhltable td {
  vertical-align: top;
  padding-top: 0;
  padding-bottom: 0
}

table.pyhltable td.code {
  padding-left: .75em;
  padding-right: 0
}

pre.pygments .lineno, table.pyhltable td:not(.code) {
  color: #999;
  padding-left: 0;
  padding-right: .5em;
  border-right: 1px solid #ddddd8
}

pre.pygments .lineno {
  display: inline-block;
  margin-right: .25em
}

table.pyhltable .linenodiv {
  background: none !important;
  padding-right: 0 !important
}

.quoteblock {
  margin: 0 1em 1.25em 1.5em;
  display: table
}

.quoteblock > .title {
  margin-left: -1.5em;
  margin-bottom: .75em
}

.quoteblock blockquote, .quoteblock blockquote p {
  color: rgba(0, 0, 0, .85);
  font-size: 1.15rem;
  line-height: 1.75;
  word-spacing: .1em;
  letter-spacing: 0;
  font-style: italic;
  text-align: justify
}

.quoteblock blockquote {
  margin: 0;
  padding: 0;
  border: 0
}

.quoteblock blockquote:before {
  content: "\201c";
  float: left;
  font-size: 2.75em;
  font-weight: bold;
  line-height: .6em;
  margin-left: -.6em;
  color: #7a2518;
  text-shadow: 0 1px 2px rgba(0, 0, 0, .1)
}

.quoteblock blockquote > .paragraph:last-child p {
  margin-bottom: 0
}

.quoteblock .attribution {
  margin-top: .5em;
  margin-right: .5ex;
  text-align: right
}

.quoteblock .quoteblock {
  margin-left: 0;
  margin-right: 0;
  padding: .5em 0;
  border-left: 3px solid rgba(0, 0, 0, .6)
}

.quoteblock .quoteblock blockquote {
  padding: 0 0 0 .75em
}

.quoteblock .quoteblock blockquote:before {
  display: none
}

.verseblock {
  margin: 0 1em 1.25em 1em
}

.verseblock pre {
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-size: 1.15rem;
  color: rgba(0, 0, 0, .85);
  font-weight: 300;
  text-rendering: optimizeLegibility
}

.verseblock pre strong {
  font-weight: 400
}

.verseblock .attribution {
  margin-top: 1.25rem;
  margin-left: .5ex
}

.quoteblock .attribution, .verseblock .attribution {
  font-size: .9375em;
  line-height: 1.45;
  font-style: italic
}

.quoteblock .attribution br, .verseblock .attribution br {
  display: none
}

.quoteblock .attribution cite, .verseblock .attribution cite {
  display: block;
  letter-spacing: -.05em;
  color: rgba(0, 0, 0, .6)
}

.quoteblock.abstract {
  margin: 0 0 1.25em 0;
  display: block
}

.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p {
  text-align: left;
  word-spacing: 0
}

.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before {
  display: none
}

table.tableblock {
  max-width: 100%;
  border-collapse: separate
}

table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child {
  margin-bottom: 0
}

table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child {
  margin-top: 0
}

table.spread {
  width: 100%
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all th.tableblock, table.grid-all td.tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols th.tableblock, table.grid-cols td.tableblock {
  border-width: 0 1px 0 0
}

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-rows th.tableblock, table.grid-rows td.tableblock {
  border-width: 0 0 1px 0
}

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock {
  border-bottom-width: 0
}

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock {
  border-width: 1px 0 0 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot {
  border-width: 1px 0
}

th.halign-left, td.halign-left {
  text-align: left
}

th.halign-right, td.halign-right {
  text-align: right
}

th.halign-center, td.halign-center {
  text-align: center
}

th.valign-top, td.valign-top {
  vertical-align: top
}

th.valign-bottom, td.valign-bottom {
  vertical-align: bottom
}

th.valign-middle, td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6;
  background: #f7f8f7
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  color: rgba(0, 0, 0, .8);
  font-weight: bold
}

p.tableblock > code:only-child {
  background: none;
  padding: 0
}

p.tableblock {
  font-size: 1em
}

td > div.verse {
  white-space: pre
}

ol {
  margin-left: 1.75em
}

ul li ol {
  margin-left: 1.5em
}

dl dd {
  margin-left: 1.125em
}

dl dd:last-child, dl dd:last-child > :last-child {
  margin-bottom: 0
}

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist {
  margin-top: .15em;
  margin-bottom: .15em
}

ul.unstyled, ol.unnumbered, ul.checklist, ul.none {
  list-style-type: none
}

ul.unstyled, ol.unnumbered, ul.checklist {
  margin-left: .625em
}

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child {
  width: 1em;
  font-size: .85em
}

ul.checklist li > p:first-child > input[type="checkbox"]:first-child {
  width: 1em;
  position: relative;
  top: 1px
}

ul.inline {
  margin: 0 auto .625em auto;
  margin-left: -1.375em;
  margin-right: 0;
  padding: 0;
  list-style: none;
  overflow: hidden
}

ul.inline > li {
  list-style: none;
  float: left;
  margin-left: 1.375em;
  display: block
}

ul.inline > li > * {
  display: block
}

.unstyled dl dt {
  font-weight: 400;
  font-style: normal
}

ol.arabic {
  list-style-type: decimal
}

ol.decimal {
  list-style-type: decimal-leading-zero
}

ol.loweralpha {
  list-style-type: lower-alpha
}

ol.upperalpha {
  list-style-type: upper-alpha
}

ol.lowerroman {
  list-style-type: lower-roman
}

ol.upperroman {
  list-style-type: upper-roman
}

ol.lowergreek {
  list-style-type: lower-greek
}

.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1 {
  padding-right: .75em;
  font-weight: bold
}

td.hdlist1, td.hdlist2 {
  vertical-align: top
}

.literalblock + .colist, .listingblock + .colist {
  margin-top: -.5em
}

.colist > table tr > td:first-of-type {
  padding: 0 .75em;
  line-height: 1
}

.colist > table tr > td:last-of-type {
  padding: .25em 0
}

.thumb, .th {
  line-height: 0;
  display: inline-block;
  border: solid 4px #fff;
  -webkit-box-shadow: 0 0 0 1px #ddd;
  box-shadow: 0 0 0 1px #ddd
}

.imageblock.left, .imageblock[style*="float: left"] {
  margin: .25em .625em 1.25em 0
}

.imageblock.right, .imageblock[style*="float: right"] {
  margin: .25em 0 1.25em .625em
}

.imageblock > .title {
  margin-bottom: 0
}

.imageblock.thumb, .imageblock.th {
  border-width: 6px
}

.imageblock.thumb > .title, .imageblock.th > .title {
  padding: 0 .125em
}

.image.left, .image.right {
  margin-top: .25em;
  margin-bottom: .25em;
  display: inline-block;
  line-height: 0
}

.image.left {
  margin-right: .625em
}

.image.right {
  margin-left: .625em
}

a.image {
  text-decoration: none
}

span.footnote, span.footnoteref {
  vertical-align: super;
  font-size: .875em
}

span.footnote a, span.footnoteref a {
  text-decoration: none
}

span.footnote a:active, span.footnoteref a:active {
  text-decoration: underline
}

#footnotes {
  padding-top: .75em;
  padding-bottom: .75em;
  margin-bottom: .625em
}

#footnotes hr {
  width: 20%;
  min-width: 6.25em;
  margin: -.25em 0 .75em 0;
  border-width: 1px 0 0 0
}

#footnotes .footnote {
  padding: 0 .375em;
  line-height: 1.3;
  font-size: .875em;
  margin-left: 1.2em;
  text-indent: -1.2em;
  margin-bottom: .2em
}

#footnotes .footnote a:first-of-type {
  font-weight: bold;
  text-decoration: none
}

#footnotes .footnote:last-of-type {
  margin-bottom: 0
}

#content #footnotes {
  margin-top: -.625em;
  margin-bottom: 0;
  padding: .75em 0
}

.gist .file-data > table {
  border: 0;
  background: #fff;
  width: 100%;
  margin-bottom: 0
}

.gist .file-data > table td.line-data {
  width: 99%
}

div.unbreakable {
  page-break-inside: avoid
}

.big {
  font-size: larger
}

.small {
  font-size: smaller
}

.underline {
  text-decoration: underline
}

.overline {
  text-decoration: overline
}

.line-through {
  text-decoration: line-through
}

.aqua {
  color: #00bfbf
}

.aqua-background {
  background-color: #00fafa
}

.black {
  color: #000
}

.black-background {
  background-color: #000
}

.blue {
  color: #0000bf
}

.blue-background {
  background-color: #0000fa
}

.fuchsia {
  color: #bf00bf
}

.fuchsia-background {
  background-color: #fa00fa
}

.gray {
  color: #606060
}

.gray-background {
  background-color: #7d7d7d
}

.green {
  color: #006000
}

.green-background {
  background-color: #007d00
}

.lime {
  color: #00bf00
}

.lime-background {
  background-color: #00fa00
}

.maroon {
  color: #600000
}

.maroon-background {
  background-color: #7d0000
}

.navy {
  color: #000060
}

.navy-background {
  background-color: #00007d
}

.olive {
  color: #606000
}

.olive-background {
  background-color: #7d7d00
}

.purple {
  color: #600060
}

.purple-background {
  background-color: #7d007d
}

.red {
  color: #bf0000
}

.red-background {
  background-color: #fa0000
}

.silver {
  color: #909090
}

.silver-background {
  background-color: #bcbcbc
}

.teal {
  color: #006060
}

.teal-background {
  background-color: #007d7d
}

.white {
  color: #bfbfbf
}

.white-background {
  background-color: #fafafa
}

.yellow {
  color: #bfbf00
}

.yellow-background {
  background-color: #fafa00
}

span.icon > .fa {
  cursor: default
}

.admonitionblock td.icon [class^="fa icon-"] {
  font-size: 2.5em;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, .5);
  cursor: default
}

.admonitionblock td.icon .icon-note:before {
  content: "\f05a";
  color: #19407c
}

.admonitionblock td.icon .icon-tip:before {
  content: "\f0eb";
  text-shadow: 1px 1px 2px rgba(155, 155, 0, .8);
  color: #111
}

.admonitionblock td.icon .icon-warning:before {
  content: "\f071";
  color: #bf6900
}

.admonitionblock td.icon .icon-caution:before {
  content: "\f06d";
  color: #bf3400
}

.admonitionblock td.icon .icon-important:before {
  content: "\f06a";
  color: #bf0000
}

.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background-color: rgba(0, 0, 0, .8);
  -webkit-border-radius: 100px;
  border-radius: 100px;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

h1, h2 {
  letter-spacing: -.01em
}

dt, th.tableblock, td.content {
  text-rendering: optimizeLegibility
}

p, td.content {
  letter-spacing: -.01em
}

p strong, td.content strong {
  letter-spacing: -.005em
}

p, blockquote, dt, td.content {
  font-size: 1.0625rem
}

p {
  margin-bottom: 0.5rem;
  margin-top: 1.25rem
}

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock {
  font-size: 1em
}

.exampleblock > .content {
  background-color: #fffef7;
  border-color: #e0e0dc;
  -webkit-box-shadow: 0 1px 4px #e0e0dc;
  box-shadow: 0 1px 4px #e0e0dc
}

.print-only {
  display: none !important
}

@media print {
  @page {
    margin: 1.25cm .75cm
  }

  * {
    -webkit-box-shadow: none !important;
    box-shadow: none !important;
    text-shadow: none !important
  }

  a {
    color: inherit !important;
    text-decoration: underline !important
  }

  a.bare, a[href^="#"], a[href^="mailto:"] {
    text-decoration: none !important
  }

  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after {
    content: "(" attr(href) ")";
    display: inline-block;
    font-size: .875em;
    padding-left: .25em
  }

  abbr[title]:after {
    content: " (" attr(title) ")"
  }

  pre, blockquote, tr, img {
    page-break-inside: avoid
  }

  thead {
    display: table-header-group
  }

  img {
    max-width: 100% !important
  }

  p, blockquote, dt, td.content {
    font-size: 1em;
    orphans: 3;
    widows: 3
  }

  h2, h3, #toctitle, .sidebarblock > .content > .title {
    page-break-after: avoid
  }

  #toc, .sidebarblock, .exampleblock > .content {
    background: none !important
  }

  #toc {
    border-bottom: 1px solid #ddddd8 !important;
    padding-bottom: 0 !important
  }

  .sect1 {
    padding-bottom: 0 !important
  }

  .sect1 + .sect1 {
    border: 0 !important
  }

  #header > h1:first-child {
    margin-top: 1.25rem
  }

  body.book #header {
    text-align: center
  }

  body.book #header > h1:first-child {
    border: 0 !important;
    margin: 2.5em 0 1em 0
  }

  body.book #header .details {
    border: 0 !important;
    display: block;
    padding: 0 !important
  }

  body.book #header .details span:first-child {
    margin-left: 0 !important
  }

  body.book #header .details br {
    display: block
  }

  body.book #header .details br + span:before {
    content: none !important
  }

  body.book #toc {
    border: 0 !important;
    text-align: left !important;
    padding: 0 !important;
    margin: 0 !important
  }

  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 {
    page-break-before: always
  }

  .listingblock code[data-lang]:before {
    display: block
  }

  #footer {
    background: none !important;
    padding: 0 .9375em
  }

  #footer-text {
    color: rgba(0, 0, 0, .6) !important;
    font-size: .9em
  }

  .hide-on-print {
    display: none !important
  }

  .print-only {
    display: block !important
  }

  .hide-for-print {
    display: none !important
  }

  .show-for-print {
    display: inherit !important
  }
}

/* Top table of contents with auto-show/hide handlers. */
body {
  margin-top: 2em;
}

#toc {
  color: white !important;
  border-bottom: 1px solid #efefed;
  padding-bottom: 0;
  padding-top: 6px;
  margin-top: 0;
  background-color: #4176c5;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1;
}

div.ulist .inline-toc {
  background-color: green;
  list-style-type: circle;
}

#toctitle {
  color: white;
  font-size: 1.2em
}

div#toctitle {
  margin-top: 0;
  margin-left: 0.5em;
}

#toc-header {
  padding-bottom: 4px;
}

ul.sectlevel1 {
  background: #F2f2F2;
  border-radius: 5px;
  display: none;
  padding-left: 0.5em;
  position: absolute;
  top: 1.8em;
  left: 0.6em;
  width: 25em;
  z-index: 2;
}

.inline-toc {
  text-decoration: none;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  display: block;
  margin-left: 2.0em;
  margin-top: 3px;
  margin-bottom: 3px;
}

.inline-toc-header {
  text-decoration: none;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: italic;
  display: block;
  color: #7a2518;
  /*margin-left: 2.0em;*/
  margin-top: 3px;
  margin-bottom: 3px;
}

.reference-link {
  text-decoration: none;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  color: white;
  top: 6px;
  right: 0.6em;
  margin-left: 1em;
  padding-left: 1em;
  border-width: 1px;
  border-top-style: none;
  border-right-style: none;
  border-bottom-style: none;
  border-left-style: solid;
}

.link-blue {
  color: #216fc1
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!--
  ~ Copyright (c) Michael Houston 2020. All rights reserved.
  -->

<!-- docinfo.html - Provides the Table of contents hide/display logic. -->
<link rel="shortcut icon" href="images/common/books_favicon.ico" type="image/x-icon">
<a href="https://github.com/simplemes/simplemes-core" class="github-corner" title="View source on GitHub"
   aria-label="View source on GitHub">
  <svg width="80" height="80" viewBox="0 0 250 250"
       style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
    <path
      d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
      fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
    <path
      d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
      fill="currentColor" class="octo-body"></path>
  </svg>
</a>
<style>.github-corner:hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out
}

@keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0)
  }
  20%, 60% {
    transform: rotate(-25deg)
  }
  40%, 80% {
    transform: rotate(10deg)
  }
}

@media (max-width: 500px) {
  .github-corner:hover .octo-arm {
    animation: none
  }

  .github-corner .octo-arm {
    animation: octocat-wave 560ms ease-in-out
  }
}</style>

<script>
  window.onload = _init;

  function _init() {
    var isReference = window.location.href.indexOf('reference') > 0;

    var link = document.createElement("a");
    link.className = "reference-link";
    link.href = isReference ? "guide.html" : "reference.html";
    link.appendChild(document.createTextNode(isReference ? "Open guide" : "Open reference"));

    var tocDiv = document.createElement("span");
    tocDiv.id = "toc-header";
    tocDiv.innerHTML = isReference ? "Reference - Table of Contents" : "Guide - Table of Contents";

    var element = document.getElementById("toctitle");
    if (element) {
      element.innerHTML = "";  // Remove original test content
      element.appendChild(tocDiv);
      element.appendChild(link);

      document.getElementById("toc-header").onmouseover = _mouseOver;
      document.getElementById("toc-header").onmouseout = _mouseOut;
      document.getElementsByClassName("sectlevel1")[0].onmouseover = _mouseOver;
      document.getElementsByClassName("sectlevel1")[0].onmouseout = _mouseOut;
      document.getElementsByClassName("sectlevel1")[0].onclick = _mouseClick;
    }
  }

  function _mouseOver(event) {
    toggleNavSummary(false);
  }

  function _mouseOut(event) {
    toggleNavSummary(true);
  }

  function _mouseClick(event) {
    toggleNavSummary(true);
  }

  function toggleNavSummary(hide) {
    var element = document.getElementsByClassName("sectlevel1")[0];
    //console.log(element);
    element.style.display = !hide ? "block" : "none";
  }

  /* Work around to handle clicking links with a fixed TOC header.*/
  (function (document, history, location) {
    var HISTORY_SUPPORT = !!(history && history.pushState);

    var anchorScrolls = {
      ANCHOR_REGEX: /^#[^ ]+$/,
      OFFSET_HEIGHT_PX: 50,

      /**
       * Establish events, and fix initial scroll position if a hash is provided.
       */
      init: function () {
        this.scrollToCurrent();
        window.addEventListener('hashchange', this.scrollToCurrent.bind(this));
        document.body.addEventListener('click', this.delegateAnchors.bind(this));
      },

      /**
       * Return the offset amount to deduct from the normal scroll position.
       * Modify as appropriate to allow for dynamic calculations
       */
      getFixedOffset: function () {
        return this.OFFSET_HEIGHT_PX;
      },

      /**
       * If the provided href is an anchor which resolves to an element on the
       * page, scroll to it.
       * @param  {String} href
       * @return {Boolean} - Was the href an anchor.
       */
      scrollIfAnchor: function (href, pushToHistory) {
        var match, rect, anchorOffset;

        if (!this.ANCHOR_REGEX.test(href)) {
          return false;
        }

        match = document.getElementById(href.slice(1));

        if (match) {
          rect = match.getBoundingClientRect();
          anchorOffset = window.pageYOffset + rect.top - this.getFixedOffset();
          window.scrollTo(window.pageXOffset, anchorOffset);

          // Add the state to history as-per normal anchor links
          if (HISTORY_SUPPORT && pushToHistory) {
            history.pushState({}, document.title, location.pathname + href);
          }
        }

        return !!match;
      },

      /**
       * Attempt to scroll to the current location's hash.
       */
      scrollToCurrent: function () {
        this.scrollIfAnchor(window.location.hash);
      },

      /**
       * If the click event's target was an anchor, fix the scroll position.
       */
      delegateAnchors: function (e) {
        var elem = e.target;

        if (
          elem.nodeName === 'A' &&
          this.scrollIfAnchor(elem.getAttribute('href'), true)
        ) {
          e.preventDefault();
        }
      }
    };

    window.addEventListener(
      'DOMContentLoaded', anchorScrolls.init.bind(anchorScrolls)
    );
  })(window.document, window.history, window.location);


</script>
</head>
<body class="book">
<div id="header">
<h1>Guide - EFrame - SimpleMES</h1>
<div class="details">
<span id="author" class="author">doc@simplemes.org</span><br>
<span id="revnumber">version 0.5</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#guidelines">Guidelines</a></li>
<li><a href="#setup">Setup</a></li>
<li><a href="#security">Security</a></li>
<li><a href="#domains">Domains</a></li>
<li><a href="#controllers">Controllers</a></li>
<li><a href="#services">Services</a></li>
<li><a href="#guis">GUIs</a></li>
<li><a href="#monitoring">Monitoring</a></li>
<li><a href="#searching">Searching</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#api">API</a></li>
<li><a href="#archiving">Archiving</a></li>
<li><a href="#customizations">Customizations</a></li>
<li><a href="#appendix">Appendix</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="link" href="#introduction">Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#purpose">Purpose</a></span>
<span class="inline-toc"><a href="#enterprise-app">Enterprise App?</a></span>
<span class="inline-toc"><a href="#philosophy">Philosophy</a></span>
<span class="inline-toc"><a href="#architecture">Architecture</a></span>
<span class="inline-toc"><a href="#why-groovy">Why Groovy?</a></span>
<span class="inline-toc"><a href="#document-conventions">Document Conventions</a></span>
<span class="inline-toc"><a href="#folder-conventions">Folder Conventions</a></span>
<span class="inline-toc"><a href="#naming-conventions">Naming Conventions</a></span>
<span class="inline-toc"><a href="#common-notations">Common Notations</a></span>
<span class="inline-toc"><a href="#modules">Modules</a></span></p>
</div>
<div class="paragraph">
<p>This is the high-level User Guide for the Enterprise Framework module.  The goal of this document is to provide
a general introduction to the important features and behaviors of the framework.</p>
</div>
<div class="paragraph">
<p>For a detailed explanation of the many options and features, see the <a href="reference.html#general">Reference</a>.
The Groovydoc (Javadoc) <a href="groovydoc/index.html" target="_blank" rel="noopener">API</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
covers other details of the underlying classes.  The source code is at
<a href="https://github.com/simplemes/simplemes-core" class="bare">https://github.com/simplemes/simplemes-core</a>.</p>
</div>
<div class="sect2">
<h3 id="purpose"><a class="link" href="#purpose">Purpose</a></h3>
<div class="paragraph">
<p>This is the Enterprise Framework module for <a href="#micronaut">Micronaut</a>.
We wrote this framework as we were developing the <a href="../mes-core/guide.html">SimpleMES</a> application.
The main goal was to allow other developers to create enterprise applications using Micronaut as
quickly as possible.</p>
</div>
<div class="paragraph">
<p>Enterprise customers expect a certain level of common features within enterprise applications.
Enterprise applications tend have many domain classes with a lot of business logic.  Creating a
few domain classes in Micronaut is simple, but the boiler-plate code needed for common features
such as JSON import becomes unmanageable quickly.  The goal of this framework is to speed application
developing by letting you concentrate on the business logic and objects that really
matter to your customers.</p>
</div>
<div class="paragraph">
<p>The framework provides many of these features with little or no coding needed in your application.
The goal is to let you, the application developer concentrate on the functionality needed.</p>
</div>
<div class="paragraph">
<p>The (<a href="groovydoc/index.html" target="_blank" rel="noopener">Groovy API</a>) for the framework contains details on
all fields and methods for most objects/services.</p>
</div>
<div class="paragraph">
<p>See <a href="#document-conventions">Document Conventions</a> for document notation conventions.</p>
</div>
</div>
<div class="sect2">
<h3 id="enterprise-app"><a class="link" href="#enterprise-app">Enterprise App?</a></h3>
<div class="paragraph">
<p>The term <em>Enterprise Application</em> is so overused that it has lost much of its meaning.
For the purpose of this framework and documentation, our definition is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">An Enterprise Application is a wide application that has specific feature and
reliability requirements.  The application generally appears <span class="keyword">as</span> one consistent
product to the users.</code></pre>
</div>
</div>
<div class="paragraph">
<p>By wide application, we mean a large number of domain and business classes.  The domain classes
usually have a lot of relationships and business logic that operates on these classes.
The reliability requirements tend to force a good deal of monitoring capability.</p>
</div>
<div class="paragraph">
<p>Micronaut is a great start, but it frequently gives you 90% of what you need.
This framework helps you with the last 10%.  For example, each domain object needs a controller
to expose the basic CRUD/REST actions.  The framework lets you implement this with very little code.</p>
</div>
</div>
<div class="sect2">
<h3 id="philosophy"><a class="link" href="#philosophy">Philosophy</a></h3>
<div class="paragraph">
<p>This framework is a packaged as a big module (.jar file) for Micronaut applications.  Why is this so big?
Because so many of the features work together, it would be difficult to keep all of the dependencies
together.  For example, the custom fields work with the GUI pages to allow the end user to
define and move fields around the GUIs.  Archiving must be able to archive custom fields.
Common features such as JSON support needs to be consistent across all domain classes and needs to
be handled in a central location.</p>
</div>
<div class="sect3">
<h4 id="microservices"><a class="link" href="#microservices">Microservices</a></h4>
<div class="paragraph">
<p>Micronaut is designed to produce microservices that are small and easy to implement.  Why use
a microservice framework for an enterprise application?  Because many of the Micronaut features
are very useful for an enterprise application.  For example, quick startup time is very important
if the app is host on a cloud provider.</p>
</div>
<div class="paragraph">
<p>The application (<a href="../mes-core/guide.html">SimpleMES</a>) is designed as a monolith.
Why use a microservice toolkit for this type of application?  Because we envision the application
starting as monolith and evolving into a microservice app as needed.  To do this, we chose
to build the application in separate modules that work together inside of a single JVM.
As the need arises, we can separate these modules into their own microservice.</p>
</div>
<div class="paragraph">
<p>This is monolith-to-microservice evolution is one reasonable way to build an app quickly
and then evolve when needed.  Not every app needs to start as a microservice-based app.
There is a large cost to starting as a microservice.  Some of the high costs include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Development Time.</p>
</li>
<li>
<p>Testing Complexity.</p>
</li>
<li>
<p>Admin Costs.</p>
</li>
<li>
<p>Lack of Clarity.</p>
</li>
<li>
<p>Distributed Transaction Complexity.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All of these add to the initial development cost.  If the app is a success and needs to evolve, then
we already have clear lines to break the app into microservices.  This evolution is shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/microlith.png" alt="microlith" width="530" height="504">
</div>
<div class="title">Figure 1. Microservices vs. Monolith (or Microlith)</div>
</div>
<div class="paragraph">
<p>The initial release of the application bundles all of the modules into one service.
These all communicate using internal JVM calls.  This allows simple database transaction
control and supports easy rollback.</p>
</div>
<div class="paragraph">
<p>When needed, one of the modules (Track) is moved to its own microservice.  This means we will
develop a distributed transaction mechanism like Saga pattern to keep the data in
synch.</p>
</div>
<div class="paragraph">
<p>This whole approach means the initial release will be simpler and easier to develop.  As the
requirements grow over time, we can decide to pay the extra cost of supporting multiple
microservices.</p>
</div>
<div class="paragraph">
<p>This does force us to keep the modules as separate entities and minimize the the method calls
to other modules.  Micronaut makes this easy, but it does require some discipline.</p>
</div>
</div>
<div class="sect3">
<h4 id="other-key-philosophies"><a class="link" href="#other-key-philosophies">Other Key Philosophies</a></h4>
<div class="paragraph">
<div class="title">Don&#8217;t Repeat Yourself.</div>
<p>Boiler-plate code should be kept to a minimum.
This means <em>anything</em> that you have to do over and over in your application should be handled
by the framework with minimal trouble.</p>
</div>
<div class="paragraph">
<div class="title">Keep It Simple</div>
<p>Complexity kills productivity.  To reduce the complexity, we just implement features/flexibility
as it is needed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="architecture"><a class="link" href="#architecture">Architecture</a></h3>
<div class="paragraph">
<p>The framework supports an the following architecture:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/architectureLayers.png" alt="architectureLayers" width="560" height="406">
</div>
<div class="title">Figure 2. Architecture Layers</div>
</div>
<div class="paragraph">
<p>The goal of this architecture is to allow you (as the application developer) to modularize your
application into multiple modules (Core module, Module1 and Module2 above).
In addition, custom modules can be added to the build to add new features to your applications.
Other organizations (integrators, end-users, etc) may want to mix and match various modules.
These organizations may even remove optional modules of your application.</p>
</div>
<div class="paragraph">
<p>This is made possible with Micronaut&#8217;s bean framework.  New beans are easily added in the modules.
Add-on functional behavior are also possible using Micronaut&#8217;s ability to define multiple
beans for a specific feature.  For example, each module can provide custom fields  on the core
module domains and GUIs by implementing a bean with the AddOnFieldsInterface.  The framework will
use these add-on fields as if they are part of the core module.</p>
</div>
<div class="paragraph">
<p>An example extension module for the OrderService is shown below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/OrderExtensionFlow.png" alt="OrderExtensionFlow" width="577" height="309">
</div>
<div class="title">Figure 3. Extension Example</div>
</div>
<div class="paragraph">
<p>In this example, a core <code>OrderService.release()</code> method will call all registered
beans that implement the <em>OrderReleasedInterface</em>.  This interface has the method
<code>orderReleased()</code>, which notifies the Module (Module1) that an order is released.</p>
</div>
<div class="paragraph">
<p>These extension methods can perform database actions and even rollback the transaction as
needed.</p>
</div>
<div class="sect3">
<h4 id="why-groovy"><a class="link" href="#why-groovy">Why Groovy?</a></h4>
<div class="paragraph">
<p>Why choose Groovy over Java or Kotlin?  One simple reason: clarity.</p>
</div>
<div class="paragraph">
<p>The biggest cost of successful software is the cost of maintaining the code for years or
decades after you have written it.  Clarity becomes critical when looking at code that
was written a long time ago.  For that reason, all decisions on this framework
and application are driven by the need to appear simple to the user and to
minimize the complexity for the application developer.</p>
</div>
<div class="paragraph">
<p>Groovy is clearer because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reduced boiler-plate code.</p>
</li>
<li>
<p>Reduction in if nesting due to the null-safe access to methods/properties.</p>
</li>
<li>
<p>The default value operator ?: .</p>
</li>
<li>
<p>List and Map usage simplifications.</p>
</li>
<li>
<p>The excellent <a href="http://spockframework.org/spock/docs/1.3/index.html" target="_blank" rel="noopener">Spock</a> test system</p>
</li>
<li>
<p>Easy ability to modify the byte-code at compile time to add features
(see <a href="#domain-entities">Domain Entities</a>).</p>
</li>
<li>
<p>Many other features.  See
<a href="https://dev.to/jcoelho/10-reasons-to-use-groovy-in-2019-431f">10 Reasons</a>.</p>
</li>
<li>
<p>Null safe equality.</p>
</li>
<li>
<p>No need for checked exceptions on methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We don&#8217;t want to write a 10 page summary of why Groovy is clearer, but here is a short
example using a pattern often seen in application code.  We need to call methods
on a nested set of objects that may return null.</p>
</div>
<div class="listingblock">
<div class="title">Example - Domain Entity - Groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="keyword">def</span> routing = order?.product?.determineEffectiveRouting() ?: defaultRouting</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example - Domain Entity - Java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  Routing routing = defaultRouting;
  <span class="keyword">if</span> (order != <span class="predefined-constant">null</span>) {
    <span class="keyword">if</span> (order.getProduct() != <span class="predefined-constant">null</span>) {
      <span class="keyword">if</span> (order.getProduct.determineEffectiveRouting() != <span class="predefined-constant">null</span>) {
        routing = order.getProduct.determineEffectiveRouting()
      }
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using just two Groovy features reduces the code complexity significantly.  Later versions
of Java help in some areas (e.g. use of <strong>var</strong>), but the overall code clarity still suffers
in Java (see Streams).</p>
</div>
<div class="paragraph">
<p>One caveat: Groovy has some terse and cryptic syntax.  We have chosen to avoid those
types of features that are not clear to the user.  Features such as method pointers
are wonderfully short, but not very clear.  See <a href="#groovy-features-to-use-or-avoid">Groovy Features to Use or Avoid</a> for
details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions"><a class="link" href="#document-conventions">Document Conventions</a></h3>
<div class="paragraph">
<p>This document follows certain conventions as shown below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Literal values</em></p>
</li>
<li>
<p><em>File/path names</em></p>
</li>
<li>
<p><em>Class names</em></p>
</li>
<li>
<p><code>Variables, fields or parameters</code></p>
</li>
<li>
<p><code>Method names</code></p>
</li>
<li>
<p><code>Groovy or java code</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#naming-conventions">Naming Conventions</a> for details on how elements are named.</p>
</div>
<div class="paragraph">
<p>There are a number of diagrams in these documents.  We follow the given conventions for these diagrams.
Some colors and shapes are used to flag specific types of elements:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/colorShapeConventions.png" alt="colorShapeConventions" width="460" height="364">
</div>
<div class="title">Figure 4. Color and Shape Conventions</div>
</div>
<div class="sect3">
<h4 id="document-layout"><a class="link" href="#document-layout">Document Layout</a></h4>
<div class="paragraph">
<p>Most modules have 3 main sets of documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Guide - General overview and key concepts document.</p>
</li>
<li>
<p>Reference - In depth reference for APIs, Domains, etc.</p>
</li>
<li>
<p>Groovydoc - The generated Groovydoc (Javadoc) from the source code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The intent of the guide is to give you a general overview of feature, but not overwhelm you with details
of the implementation.  The reference documentation will explain most key fields, API calls and options.
The guide generally has many links into the reference documentation.</p>
</div>
<div class="paragraph">
<p>Dashboards are fairly complex.  To manage this in the documents, we use the guide for concept introduction and
sometime simple examples. The reference document will explain all of the activities, events and scan actions
for the dashboard.  Each module will have additional  activities, events and scan actions.  These will be
documented in a similar way:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dashboardDocuments.png" alt="dashboardDocuments" width="460" height="392">
</div>
<div class="title">Figure 5. Dashboard Documents - MES Core Example</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="folder-conventions"><a class="link" href="#folder-conventions">Folder Conventions</a></h3>
<div class="paragraph">
<p>For the most part, your application should be free to use most Micronaut-supported folder
conventions.  This is pretty open, so the framework and application modules that we develop
will follow a specific folder layout for common artifacts.</p>
</div>
<div class="paragraph">
<p>Each major package for an application module should be organized like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>product  (Product Definition package for the MES Core module)</p>
<div class="ulist">
<ul>
<li>
<p>controller</p>
</li>
<li>
<p>domain</p>
</li>
<li>
<p>page (GEB GUI Test Pages - in <em>src/test/groovy</em> folder)</p>
</li>
<li>
<p>service</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The folder layouts we will use are for the <em>src/main/groovy</em> source folder looks something
like this under the org.simplemes.eframe package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>application  (startup and common pages "/")</p>
<div class="ulist">
<ul>
<li>
<p>controller</p>
</li>
<li>
<p>domain</p>
</li>
<li>
<p>service</p>
</li>
</ul>
</div>
</li>
<li>
<p>controller (controller support classes)</p>
</li>
<li>
<p>custom</p>
<div class="ulist">
<ul>
<li>
<p>controller</p>
</li>
<li>
<p>domain</p>
</li>
</ul>
</div>
</li>
<li>
<p>domain (domain support classes)</p>
</li>
<li>
<p>misc</p>
</li>
<li>
<p>security</p>
<div class="ulist">
<ul>
<li>
<p>controller</p>
</li>
<li>
<p>domain</p>
</li>
<li>
<p>service</p>
</li>
</ul>
</div>
</li>
<li>
<p>system</p>
</li>
<li>
<p>test</p>
</li>
<li>
<p>web</p>
<div class="ulist">
<ul>
<li>
<p>request</p>
</li>
<li>
<p>view</p>
</li>
<li>
<p>builder</p>
</li>
<li>
<p>widget</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies"><a class="link" href="#dependencies">Dependencies</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This framework module depends on a number of other modules/libraries/products.
The important dependencies are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#micronaut">Micronaut</a> - <a href="https://docs.micronaut.io/latest/guide/index.html" target="_blank" rel="noopener">documentation</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/" target="_blank" rel="noopener">Micronaut-Data Persistence</a></p>
</li>
<li>
<p><a href="https://v3.vuejs.org/guide/introduction.html#what-is-vue-js/" target="_blank" rel="noopener">Vue</a>.  See <a href="#gui-dependencies">GUI Dependencies</a> for other packages.</p>
</li>
<li>
<p><a href="http://www.gebish.org/" target="_blank" rel="noopener">GEB</a> (GUI Testing)</p>
</li>
<li>
<p><a href="http://js.jsnlog.com/" target="_blank" rel="noopener">JSNLog Client Logger</a></p>
</li>
<li>
<p><a href="https://github.com/FasterXML/jackson-docs" target="_blank" rel="noopener">Jackson</a></p>
</li>
<li>
<p><a href="https://community.jaspersoft.com/" target="_blank" rel="noopener">Jasper Reports</a></p>
</li>
<li>
<p><a href="https://flywaydb.org/" target="_blank" rel="noopener">Flyway Database Migration</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You do not have to include these in your <em>build.gradle</em> file.  This framework depends on these
modules and the build system will include them in your application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you include these in your <em>build.gradle</em> file, then you must make sure the versions are
consistent with the versions this framework requires. The specific versions needed are listed in
the framework&#8217;s <em>build.gradle</em> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#modules">Modules</a> for details on how to design your application&#8217;s module layout.</p>
</div>
<div class="sect2">
<h3 id="micronaut"><a class="link" href="#micronaut">Micronaut</a></h3>
<div class="paragraph">
<p>This framework depends on the bean framework <a href="http://micronaut.io/" target="_blank" rel="noopener">Micronaut</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.
Micronaut provides the basic run-time lookup for beans, HTTP support and general logic for a
normal HTTP server. Various modules provide security, UI views and management features.</p>
</div>
</div>
<div class="sect2">
<h3 id="naming-conventions"><a class="link" href="#naming-conventions">Naming Conventions</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#class-names">Class Names</a></span>
<span class="inline-toc"><a href="#field-naming-conventions">Field Naming Conventions</a></span></p>
</div>
<div class="sect3">
<h4 id="class-names"><a class="link" href="#class-names">Class Names</a></h4>
<div class="paragraph">
<p>These follow the basic Micronaut conventions, but add a few conventions for simplicity.  The common suffixes used are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>*Controller</code> - A controller class.  This is the main entry point for external clients.</p>
</li>
<li>
<p><code>*Service</code> - The business logic service.  These are typically transactional.</p>
</li>
<li>
<p><code>*Interface</code> - A public interface.</p>
</li>
<li>
<p><code>*Marker</code> - The helper implementation for the Freemarker markers (template directive models).</p>
</li>
<li>
<p><code>*Widget</code> - A general GUI widget.</p>
</li>
<li>
<p><code>*FieldBuilder</code> - Creates a GUI field for a specific object type with edit capability.  Example: <a href="groovydoc/org/simplemes/eframe/web/builder/LinkListBuilder.html" target="_blank" rel="noopener">LinkListBuilder</a>.</p>
</li>
<li>
<p><code>*Factory</code> - Abstracts object creation for extension purposes such as <a href="groovydoc/org/simplemes/eframe/web/builder/FieldBuilderFactory.html" target="_blank" rel="noopener">FieldBuilderFactory</a>.</p>
</li>
<li>
<p><code>*Utils</code> - Various utilities packages as static methods on the Utils class. Example: <a href="groovydoc/org/simplemes/eframe/misc/DateUtils.html" target="_blank" rel="noopener">DateUtils</a>.</p>
</li>
<li>
<p><code>*Request</code> - A POGO object that contains the values for a specific request.  Usually used by services to hold all values needed for the request.</p>
</li>
<li>
<p><code>*Response</code> - A POGO object that contains results from a specific request.  Usually used by services to hold the values returned to the caller.</p>
</li>
<li>
<p><code>Abstract*</code> - A prefix for abstract parent classes.</p>
</li>
<li>
<p><code>Base*</code> - A prefix for parent classes that have no abstract methods.</p>
</li>
<li>
<p><code>*Spec</code> - A Spock-based test.</p>
</li>
<li>
<p><code>*GUISpec</code> - A Spock-based test that use a live GUI for testing with GEB/Selenium/Webdriver.</p>
</li>
<li>
<p><code>*APISpec</code> - A Spock-based test that uses an embedded server to test an API feature in a server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are not hard and fast restrictions, since Micronaut typically allows almost any name for
the defined beans.
You can deviate from these conventions if needed in your application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The domain classes typically use the base name alone.  For example <em>Order</em> is the order
      domain class.  These are usually stored in a sub-package domain
      (e.g. <em>order.simplemes.mes.demand.domain</em>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="field-naming-conventions"><a class="link" href="#field-naming-conventions">Field Naming Conventions</a></h4>
<div class="paragraph">
<p>Most standard objects will have these typical fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The internal database record UUID (a unique string).  Usually not visible to the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key(s)/name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more primary key fields for the object.
               These are usually unique and provided by the user.  The user will typically
               retrieve the records by these key fields.  The first key field is usually
               named the same as the object (e.g. <em>Order</em> has a key field of <code>order</code>).
               Sometimes, the word 'id' or 'name' is used in place of key field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The single line title.  This is usually a short description displayed in lists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A multi-line description.  Typically limited to 255 characters to reduce database size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateCreated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date/time this record was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateUpdated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date/time this record was last updated.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Quantity fields typically start with 'qty' and have a <em>BigDecimal</em> type.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common-notations"><a class="link" href="#common-notations">Common Notations</a></h3>
<div class="paragraph">
<p>This is a complex framework.  We want to define specific notations used to indicates issues in the
code and the application behaviors.</p>
</div>
<div class="sect3">
<h4 id="note"><a class="link" href="#note">Note</a></h4>
<div class="paragraph">
<p>This indicates something be beware of.  This is frequently used to flag things that may become an
issue someday.  We want these flagged in a standard way to easily identify possible source of
problems when a library module is upgraded.  This includes some highlighting in the JavaDoc.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Note Example - Groovy Code</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="comment">/**
   * Returns all of the domain classes defined in the system.
   * &lt;p&gt;
   * &lt;b&gt;Note:&lt;/b&gt; This method uses the internal values of the Micronaut.  <i class="conum" data-value="1"></i><b>(1)</b>
                  This may change someday.
   * @return
   */</span>
  <span class="predefined-type">List</span>&lt;<span class="predefined-type">Class</span>&gt; getAllDomains() {
    . . .
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Flags something that may change in future releases of modules this code depends on.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modules"><a class="link" href="#modules">Modules</a></h3>
<div class="paragraph">
<p>This framework is designed to let you build a modular web application.  You should
break your application up into modules that are as independent as possible.  This also
prepares your application for conversion to <a href="#microservices">Microservices</a> when that is supported by
this framework.</p>
</div>
<div class="paragraph">
<p>The Modules currently planned for the SimpleMES application include:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">module</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../mes-core/guide.html">mes-core</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The core module for the SimpleMES application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../mes-assy/guide.html">mes-assy</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The component assembly module for the SimpleMES application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="{mes}/guide.html">mes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SimpleMES application itself.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="dependencies-for-module-development"><a class="link" href="#dependencies-for-module-development">Dependencies for Module Development</a></h4>
<div class="paragraph">
<p>You will be developing modules for this framework to provide application functionality.
To simplify your <em>build.gradle</em> file, the framework lists most development-time
dependencies as <em>compile</em>.  This means the dependencies section of your <em>build.gradle</em>
file can be as simple as:</p>
</div>
<div class="listingblock">
<div class="title">Example - Dependencies for build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
  compile (<span class="string"><span class="delimiter">&quot;</span><span class="content">org.simplemes:eframe:0.5</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b>
  compileOnly <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:micronaut-inject-groovy</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the correct version as needed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is needed to make your controllers and other beans visible to Micronaut.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The final application packaging will need remove development only dependencies.  This
      is done in the MES application.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guidelines"><a class="link" href="#guidelines">Guidelines</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc-header">General</span>
<span class="inline-toc"><a href="#configuration">Configuration</a></span>
<span class="inline-toc"><a href="#naming-conventions">Naming Conventions</a></span>
<span class="inline-toc"><a href="#programming-standards">Programming Standards</a></span>
<span class="inline-toc"><a href="#internationalization">Internationalization</a></span>
<span class="inline-toc"><a href="#application-main">Application.main()</a></span></p>
</div>
<div class="paragraph">
<p><span class="inline-toc"><a href="#domain-controller-or-service">Domain, Controller or Service?</a></span>
<span class="inline-toc"><a href="#domains">Domains</a></span>
<span class="inline-toc"><a href="#controllers">Controllers</a></span>
<span class="inline-toc"><a href="#services">Services</a></span>
<span class="inline-toc"><a href="#gui-guidelines">GUI Guidelines</a></span></p>
</div>
<div class="paragraph">
<p>To take full advantage of the Enterprise Framework, your application must follow some basic
guidelines.  You can sometimes ignore these guidelines, but some features of the framework
may not work as expected or require special coding on your part.
Most of these guidelines will not disrupt your application design too much.</p>
</div>
<div class="sect2">
<h3 id="configuration"><a class="link" href="#configuration">Configuration</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#application-yml">application.yml</a></span>
<span class="inline-toc"><a href="#build-gradle">build.gradle</a></span></p>
</div>
<div class="paragraph">
<p>Micronaut and this framework have many configuration options defined at the application level.
Your application needs to use a number of these settings to take full advantage of the
enterprise framework.</p>
</div>
<div class="sect3">
<h4 id="application-yml"><a class="link" href="#application-yml">application.yml</a></h4>
<div class="paragraph">
<p>The <em>application.yml</em> file controls many of the features of your application.
To avoid issues with the framework, you should use these settings:</p>
</div>
<div class="listingblock">
<div class="title">Example - Application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">micronaut</span>:
  <span class="key">application</span>:
    <span class="key">name</span>: <span class="string"><span class="content">eframe</span></span>
  <span class="key">session</span>:
    <span class="key">http</span>:
      <span class="key">cookiePath</span>: <span class="string"><span class="content">/</span></span>
  <span class="key">security</span>:
    <span class="key">authentication</span>: <span class="string"><span class="content">cookie</span></span>
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">endpoints</span>:
      <span class="key">login</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="key">logout</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">reject-not-found</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">redirect</span>:
      <span class="key">forbidden</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">url</span>: <span class="string"><span class="content">/login/auth</span></span>
      <span class="key">prior-to-login</span>: <span class="string"><span class="content">true</span></span>
      <span class="key">unauthorized</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">url</span>: <span class="string"><span class="content">/login/auth</span></span>
    <span class="key">token</span>:
      <span class="key">jwt</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">bearer</span>:
          <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span>
        <span class="key">cookie</span>:
          <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
          <span class="key">loginFailureTargetUrl</span>: <span class="string"><span class="content">/login/auth?failed=true</span></span>
          <span class="key">cookie-same-site</span>: <span class="string"><span class="content">'Lax'</span></span>
        <span class="key">signatures</span>:
          <span class="key">secret</span>:
            <span class="key">generator</span>:
              <span class="key">secret</span>: <span class="string"><span class="content">${eframe.key}</span></span>
        <span class="key">generator</span>:
          <span class="key">access-token.expiration</span>: <span class="string"><span class="content">1800</span></span>
          <span class="key">refresh-token</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">base64</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">secret</span>: <span class="string"><span class="content">${eframe.key}</span></span>
      <span class="key">refresh</span>:
        <span class="key">cookie</span>:
          <span class="key">cookie-path</span>: <span class="string"><span class="content">'/'</span></span>
          <span class="key">cookie-max-age</span>: <span class="string"><span class="content">'30d'</span></span>
          <span class="key">cookie-same-site</span>: <span class="string"><span class="content">'Lax'</span></span>
    <span class="key">interceptUrlMap</span>:
      - <span class="string"><span class="content">pattern: /assets/**</span></span>
        <span class="key">httpMethod</span>: <span class="string"><span class="content">GET</span></span>
        <span class="key">access</span>:
          - <span class="string"><span class="content">isAnonymous()</span></span>
      - <span class="string"><span class="content">pattern: /favicon.ico</span></span>
        <span class="key">httpMethod</span>: <span class="string"><span class="content">GET</span></span>
        <span class="key">access</span>:
          - <span class="string"><span class="content">isAnonymous()</span></span>
  <span class="key">server.netty.logLevel</span>: <span class="string"><span class="content">DEBUG</span></span>
  <span class="key">server.thread-selection</span>: <span class="string"><span class="content">AUTO</span></span>
  <span class="key">metrics</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">export</span>:
      <span class="key">prometheus</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">step</span>: <span class="string"><span class="content">PT1M</span></span>
        <span class="key">descriptions</span>: <span class="string"><span class="content">false</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">endpoints</span>:
  <span class="key">prometheus</span>:
    <span class="key">sensitive</span>: <span class="string"><span class="content">false</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">datasources</span>:
  <span class="key">default</span>:
    <span class="key">url</span>: <span class="string"><span class="content">${DATABASE_URL}</span></span>
    <span class="key">driverClassName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.postgresql.Driver</span><span class="delimiter">&quot;</span></span>
    <span class="key">dialect</span>: <span class="string"><span class="content">POSTGRES</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">dataSource</span>:
  <span class="key">url</span>: <span class="string"><span class="content">jdbc:h2:mem:devDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE</span></span>
  <span class="key">dbCreate</span>: <span class="string"><span class="content">create-drop</span></span>
  <span class="key">pooled</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">jmxExport</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">driverClassName</span>: <span class="string"><span class="content">org.h2.Driver</span></span>
  <span class="key">username</span>: <span class="string"><span class="content">sa</span></span>
  <span class="key">password</span>: <span class="string"><span class="content">''</span></span>

<span class="head"><span class="head">---</span></span>

<span class="key">flyway</span>:
  <span class="key">datasources</span>:
    <span class="key">default</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="key">locations</span>:
        - <span class="string"><span class="content">classpath:db/migration</span></span>
      <span class="comment">#baseline-on-migrate: true</span>
      <span class="comment">#baseline-version: 0.1</span>
      <span class="comment">#baseline-description: empty</span>
<span class="head"><span class="head">---</span></span>
<span class="key">assets</span>:
  <span class="key">mapping</span>: <span class="string"><span class="content">assets</span></span>

<span class="head"><span class="head">---</span></span>
<span class="key">eframe</span>:
  <span class="key">maxRowLimit</span>: <span class="string"><span class="content">200</span></span>
  <span class="key">archive</span>:
  <span class="comment">#  factory: org.simplemes.eframe.archive.ArchiverFactory</span>
  <span class="comment">#  topFolder: '../archives'</span>
  <span class="comment">#  folderName: '#{year}-#{month}-#{day}'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#security-setup">Security Setup</a> for specifics on the security elements.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-gradle"><a class="link" href="#build-gradle">build.gradle</a></h4>
<div class="paragraph">
<p>See <a href="#dependencies">Dependencies</a> for details on the changes needed in <em>build.gradle</em> for required plugins.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="programming-standards"><a class="link" href="#programming-standards">Programming Standards</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#groovydoc">Groovydoc</a></span>
<span class="inline-toc"><a href="#source-code-format">Source Code Format</a></span>
<span class="inline-toc"><a href="#value-typing">Value Typing</a></span>
<span class="inline-toc"><a href="#enums">ENUMs</a></span>
<span class="inline-toc"><a href="#class-method-design">Class/Method Design (Fluid API)</a></span>
<span class="inline-toc"><a href="#current-user">Current User</a></span>
<span class="inline-toc"><a href="#exceptions">Exceptions</a></span>
<span class="inline-toc"><a href="#infowarning-messages-to-clients">Info/Warning Messages to Clients</a></span>
<span class="inline-toc"><a href="#static-methods">Static Methods</a></span>
<span class="inline-toc"><a href="#multiple-return-values">Multiple Return Values</a></span>
<span class="inline-toc"><a href="#groovy-features-to-use-or-avoid">Groovy Features to Use or Avoid</a></span>
<span class="inline-toc"><a href="#asciidoctor-standards">ASCIIDoctor Standards</a></span></p>
</div>
<div class="paragraph">
<p>There are a number of programming and design standards that the framework follows to give you a consistent
API to work with. These conventions help the framework work with your application with minimal
coding on your part. These standards are described here.</p>
</div>
<div class="sect3">
<h4 id="groovydoc"><a class="link" href="#groovydoc">Groovydoc</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All packages must have package Javadoc (GroovyDoc) comments.  <strong>Mandatory</strong></p>
</li>
<li>
<p>All non-test methods and fields must have Javadoc (GroovyDoc) comments.  All parameters must be described. <strong>Mandatory</strong></p>
</li>
<li>
<p>All non-error handling code must have automated tests.  Code Coverage must be 90+% for all groovy code.  <strong>Mandatory</strong></p>
</li>
<li>
<p>All GUI Text displayed must be looked up in the messages.properties bundle.
This must be tested in unit tests where possible. <strong>Mandatory</strong></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="source-code-format"><a class="link" href="#source-code-format">Source Code Format</a></h4>
<div class="paragraph">
<p>Since the source code is usually re-formatted on check-in (Intellij IDEA option), the source format is important.
Using a consistent format helps identify the 'real' changes between versions.  The standards we follow are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All TAB characters must be converted to spaces. <strong>Mandatory</strong></p>
</li>
<li>
<p>TAB widths must be set to 2 spaces or kept consistent within a single source file. <strong>Mandatory</strong></p>
</li>
<li>
<p>Always use brackets for if/else statements. <strong>Mandatory</strong></p>
</li>
<li>
<p>All <em>messages.properties</em> files must be encoded in UTF-8.  <strong>Mandatory</strong></p>
</li>
<li>
<p>Follow K&amp;R bracket usage (Open bracket on <em>if/for</em> line). Suggested.</p>
</li>
<li>
<p>Use brackets for one line if statements.  Suggested.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="value-typing"><a class="link" href="#value-typing">Value Typing</a></h4>
<div class="paragraph">
<p>Groovy allows untyped fields/variables in your classes.  This is great for internal uses.
However, all APIs should use proper Java-style typing where possible.  This means method
parameters should not use <strong>def</strong> or <strong>Object</strong> when a real type is known.</p>
</div>
<div class="paragraph">
<p>Internal variables in methods can use the <strong>def</strong> syntax.</p>
</div>
</div>
<div class="sect3">
<h4 id="class-method-design"><a class="link" href="#class-method-design">Class/Method Design (Fluid API)</a></h4>
<div class="paragraph">
<p>There is a programming concept called 'Fluid API' that makes a lot of sense.  This approach is needed
when more than 2 values need to be passed to a method/class.  After 2 values, the meaning of each
value is not always obvious without a good IDE.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">new</span> NumberField(<span class="string"><span class="delimiter">'</span><span class="content">lotSize</span><span class="delimiter">'</span></span>, <span class="float">12.3</span>, <span class="float">1.0</span>, <span class="float">45.0</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, it is not clear what each number is doing.
To avoid this problem, the framework generally uses the Groovy map constructor approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">new</span> NumberField(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">lotSize</span><span class="delimiter">'</span></span>,
                <span class="key">defaultValue</span>: <span class="float">12.3</span>,
                <span class="key">minValue</span>: <span class="float">1.0</span>,
                <span class="key">maxValue</span>: <span class="float">45.0</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This make it very clear what each number is and Groovy enforces basic types and naming with the default Map constructor.</p>
</div>
<div class="paragraph">
<p>Groovy generally creates this constructor for you, but you can create your own.
When you need to define your own constructor, you can use this code to emulate the Groovy Map constructor logic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">NumberField(<span class="predefined-type">Map</span> options) {
  <span class="comment">// Copy all options to the right field.</span>
  options?.each { k, v -&gt;
    <span class="local-variable">this</span>[k <span class="keyword">as</span> <span class="predefined-type">String</span>] = v
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="current-user"><a class="link" href="#current-user">Current User</a></h4>
<div class="paragraph">
<p>You will frequently need to log records with the user who performed some action.  The obvious
solution is to add a <code>User</code> to the domain and just store a reference to the user in database.
This is simple, but it does have one big drawback:  The referential integrity constraints
in the database makes it difficult to remove user records.</p>
</div>
<div class="paragraph">
<p>To increase database flexibility, we will use the user name itself for these types of logging actions.
This also reduces the chance of accidentally exporting the user/password info in a generic JSON
export. This is important for archiving since we don&#8217;t want to archive the user
records or force re-creation of deleted user records when un-archiving.</p>
</div>
<div class="paragraph">
<p>An example domain record below will record the user name for a component that has been
assembled:</p>
</div>
<div class="listingblock">
<div class="title">Example User Name Recording</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">OrderComponent</span> {
  . . .

  <span class="annotation">@Column</span>(length = FieldSizes.MAX_CODE_LENGTH, nullable = <span class="predefined-constant">false</span>)
  <span class="predefined-type">String</span> userName = SecurityUtils.currentUserName  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="predefined-type">Date</span> dateTime</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The user who is currently logged into the session for this request.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This reduces the code since the default for the new component is the current user.  No
extra database access is needed.</p>
</div>
<div class="paragraph">
<p>In contrast, the logic needed to store a full reference to the User object would be slower and
more complex.</p>
</div>
</div>
<div class="sect3">
<h4 id="enums"><a class="link" href="#enums">ENUMs</a></h4>
<div class="paragraph">
<p>The normal Java style enums can be used in your application.
These enums are displayed in the
standard GUIs as a drop-down list with the enums <code>toStringLocalized(Locale)</code> text as the displayed
value for each valid value.</p>
</div>
<div class="paragraph">
<p>Your enum should have these fields/methods to support storage in the database and display of human-readable
values for each enum:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code> - The database representation of this enum.  Typically 1 character. <strong>(Required)</strong></p>
</li>
<li>
<p><code>toStringLocalized(Locale)</code> - The display value for this enum.  Optionally localized.  Used
by Jackson for JSON creation.
If not implemented, then normal <code>toString()</code> method will be used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The localization can use any .properties file entry you like, but the standard approach is to use
a naming convention like this (for a time interval enumeration):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">reportTimeInterval.CUSTOM_RANGE.label=Custom Range
reportTimeInterval.LAST_24_HOURS.label=Last <span class="integer">24</span> Hours
reportTimeInterval.LAST_7_DAYS.label=Last <span class="integer">7</span> Days
reportTimeInterval.LAST_30_DAYS.label=Last <span class="integer">30</span> Days
reportTimeInterval.LAST_6_MONTHS.label=Last <span class="integer">6</span> Months
reportTimeInterval.LAST_MONTH.label=Last Month
reportTimeInterval.LAST_YEAR.label=Last Year
reportTimeInterval.THIS_MONTH.label=This Month
reportTimeInterval.THIS_YEAR.label=This Year
reportTimeInterval.TODAY.label=Today
reportTimeInterval.YESTERDAY.label=Yesterday</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example <code>toStringLocalized(Locale)</code> method looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">public</span> <span class="predefined-type">String</span> toStringLocalized(<span class="predefined-type">Locale</span> locale=<span class="predefined-constant">null</span>) {
  <span class="keyword">return</span> GlobalUtils.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">reportTimeInterval.</span><span class="inline"><span class="inline-delimiter">${</span>name()<span class="inline-delimiter">}</span></span><span class="content">.label</span><span class="delimiter">&quot;</span></span>,locale)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the enums list of valid values is shown in list (e.g. a drop-down list in a GUI),
then the list of valid values is displayed in the default Java order.  This is the order
that the enum values are defined in the class.  This means
you should put the most common values first in your enum .groovy file.</p>
</div>
</div>
<div class="sect3">
<h4 id="exceptions"><a class="link" href="#exceptions">Exceptions</a></h4>
<div class="paragraph">
<p>When it is time to throw an exception, you have to decide what type of exception to throw.
In most cases, it comes down to how important the message is when monitoring a live system.
What exceptions should show up in the server log (main log or StackTrace.log)?
The framework follows a simple rule: If an exception is a
<a href="groovydoc/org/simplemes/eframe/exception/BusinessException.html" target="_blank" rel="noopener">BusinessException</a>
<span class="icon link-blue"><i class="fa fa-share-square"></i></span>, then it won&#8217;t show up in the log files.
These type of exceptions are usually returned to the caller or displayed in the GUI.</p>
</div>
<div class="paragraph">
<p>This means most business logic should throw a <em>BusinessException</em> when the problem is not a
system type problem. This means most errors that should be fixed by the caller will be
BusinessExceptions.</p>
</div>
<div class="paragraph">
<p>More critical exceptions are thrown with the
<a href="groovydoc/org/simplemes/eframe/exception/MessageBasedException.html" target="_blank" rel="noopener">MessageBasedException</a>
<span class="icon link-blue"><i class="fa fa-share-square"></i></span>.  These exceptions are logged.</p>
</div>
</div>
<div class="sect3">
<h4 id="error-codes"><a class="link" href="#error-codes">Error Codes</a></h4>
<div class="paragraph">
<p>The <a href="groovydoc/org/simplemes/eframe/exception/BusinessException.html" target="_blank" rel="noopener">BusinessException</a>
<span class="icon link-blue"><i class="fa fa-share-square"></i></span> uses an error code to define specific errors.
The error ranges are allocated to the modules as follows:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Range</th>
<th class="tableblock halign-left valign-top">Use</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0-1999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved codes for framework messages.  Usually MessageBasedException&#8217;s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000-9999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MES Application messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000-10999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assembly module errors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11000-11999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defect Tracking module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">50000-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customization messages.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="infowarning-messages-to-clients"><a class="link" href="#infowarning-messages-to-clients">Info/Warning Messages to Clients</a></h4>
<div class="paragraph">
<p>In enterprise apps, it is quite common to display information and warning messages to the user.
In an HTTP request/response world, it is difficult returning multiple messages from multiple
levels in a method call hierarchy.  We solve this by allowing your code to accumulate
messages in a
<a href="groovydoc/org/simplemes/eframe/exception/MessageHolder.html" target="_blank" rel="noopener">MessageHolder</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> that is shared by all methods in the current thread.
This is done using the ServerRequestContext.currentRequest to store the messages as a request
attribute.</p>
</div>
<div class="paragraph">
<p>The controller will then use these messages in building its response.</p>
</div>
<div class="paragraph">
<p>The MessageHolder supports multiple messages with levels of severity.  It also provides
methods to store the messages in the current HTTP request as an attribute.</p>
</div>
<div class="paragraph">
<p>An example set of messages will look like this in JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>: {
   <span class="key"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">warn</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Order 'M1657334' is not enabled</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">otherMessages</span><span class="delimiter">&quot;</span></span>: [
     <span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">info</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Order 'M1657334' is marked urgent</span><span class="delimiter">&quot;</span></span>,
     }
   ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The standard clients will usually display all of the messages with proper styling (color/icon)
in a standard message area (near the top of the page/panel).</p>
</div>
</div>
<div class="sect3">
<h4 id="static-methods"><a class="link" href="#static-methods">Static Methods</a></h4>
<div class="paragraph">
<p>Many utility classes in the framework are simple calculations that really do not need the
full Micronaut bean support.  Instead, we have built them with a simple static Singleton
instance to access the utility method.
See <a href="groovydoc/org/simplemes/eframe/controller/ControllerUtils.html" target="_blank" rel="noopener">ControllerUtils</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> for an example:</p>
</div>
<div class="listingblock">
<div class="title">Static Instance Method Access</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> (offset, max) = ControllerUtils.instance.calculateSortingForList(params)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This singleton approach allows easier mocking of these methods without the overhead of making
them full-fledged beans.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A few of these utility methods may still use a true static method approach (no need for
      calling them via the <em>.instance</em> variable).  These are done in frequently called
      areas (e.g. <a href="groovydoc/org/simplemes/eframe/misc/ArgumentUtils.html" target="_blank" rel="noopener">ArgumentUtils</a>
      <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>).  There are no plans to convert them to use
      the <em>.instance</em> approach.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The general rule: if any method in the *Utils class needs to be mocked easily, then the whole
class should use the <em>.instance</em> approach.</p>
</div>
</div>
<div class="sect3">
<h4 id="multiple-return-values"><a class="link" href="#multiple-return-values">Multiple Return Values</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Philosophical Discussion Ahead!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is probably a tricky subject that almost everyone will disagree with :).
In most complex programs, you will likely need to return multiple values from a method.
The traditional Java approach to this is to create a new Java class (POJO) and populate
its fields with the values.  Java could also return a Map with the
name/value pairs, but that is frowned upon by some in the Java programming world.</p>
</div>
<div class="paragraph">
<p>Groovy is much more flexible.  It can return multiple values with multiple assignment,
return a Map with the proper elements or return a simple Groovy class (POGO) with the right fields.
Each of these has different pros and cons.</p>
</div>
<div class="sect4">
<h5 id="guideline-for-multiple-returns"><a class="link" href="#guideline-for-multiple-returns">Guideline for Multiple Returns</a></h5>
<div class="paragraph">
<p>Based on the pros and cons below, the framework will generally use the POGO as a return value.
This follows the Micronaut Controller/Command class pattern.
The main drawback is the extra files and classes to manage.</p>
</div>
<div class="paragraph">
<p>One common exception is utility classes that return two or three values.  This is somewhat
common in the places like
<a href="groovydoc/org/simplemes/eframe/controller/ControllerUtils.html" target="_blank" rel="noopener">ControllerUtils</a>
that determine sorting directions.</p>
</div>
<div class="paragraph">
<p>In these cases, we use the Groovy <em>Tuple2</em> return value for simple two-value cases.
Like Map, this should be limited to internal logic that is not frequently used.
The <em>Tuple2</em> method must be specified with valid types (<em>Tuple2&lt;Integer, Integer&gt;</em> below) :</p>
</div>
<div class="listingblock">
<div class="title">Tuple2 Usage - Allowed in Limited Cases</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> Tuple2&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; calculateOverallStatus() {
  ...
  return [<span class="integer">200</span>, <span class="integer">404</span>]
}

<span class="keyword">def</span> (code, fallback) = calculateOverallStatus()
 . . .</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="multiple-return-values-proscons"><a class="link" href="#multiple-return-values-proscons">Multiple Return Values - Pros/Cons</a></h5>
<div class="paragraph">
<p>This uses a List to return the multiple values and assign them to the variables in order:</p>
</div>
<div class="listingblock">
<div class="title">List Return Example - Rarely Allowed</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Not Allowed</span>
<span class="keyword">def</span> <span class="function">calculateOverallStatus</span>() {
  ...
  return [<span class="integer">200</span>, <span class="string"><span class="delimiter">'</span><span class="content">OK</span><span class="delimiter">'</span></span>]
}

<span class="keyword">def</span> (<span class="type">int</span> code, <span class="predefined-type">String</span> text) = calculateOverallStatus()
<span class="keyword">if</span> (code!=<span class="integer">200</span>) {
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>()...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This looks concise, but it is somewhat fragile.  If the order of the return values changes,
then this code can break and will only be detected at runtime.</p>
</div>
</div>
<div class="sect4">
<h5 id="map-for-return-values-proscons"><a class="link" href="#map-for-return-values-proscons">Map for Return Values - Pros/Cons</a></h5>
<div class="paragraph">
<p>This uses a generic Map for the values returned:</p>
</div>
<div class="listingblock">
<div class="title">Map Return Example - Rarely Allowed</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">calculateOverallStatus</span>() {
  ...
  return [<span class="key">code</span>: <span class="integer">200</span>, <span class="key">text</span>:<span class="string"><span class="delimiter">'</span><span class="content">OK</span><span class="delimiter">'</span></span>]
}

<span class="keyword">def</span> status = service.calculateOverallStatus()
<span class="keyword">if</span> (status.code!=<span class="integer">200</span>) {
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>()...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is somewhat less robust than the POGO approach, but due to Groovy&#8217;s dynamic nature, it is
only caught at runtime. This avoids the extra classes and the actual code that uses the value
is almost the same as the POGO approach and no compile time checks are lost.</p>
</div>
<div class="paragraph">
<p>We rarely use this approach.</p>
</div>
</div>
<div class="sect4">
<h5 id="pogo-class-as-return-value-proscons"><a class="link" href="#pogo-class-as-return-value-proscons">POGO Class as Return Value - Pros/Cons</a></h5>
<div class="paragraph">
<p>This creates a specific POGO that defines the fields returned:</p>
</div>
<div class="listingblock">
<div class="title">POGO Return Example - Preferred Approach</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">OverallStatus</span> {
  <span class="type">int</span> code
  <span class="predefined-type">String</span> text
}

<span class="keyword">def</span> <span class="function">calculateOverallStatus</span>() {
  ...
  return <span class="keyword">new</span> OverallStatus(<span class="key">code</span>: <span class="integer">200</span>, <span class="key">text</span>:<span class="string"><span class="delimiter">'</span><span class="content">OK</span><span class="delimiter">'</span></span>)
}

<span class="keyword">def</span> status = service.calculateOverallStatus()
<span class="keyword">if</span> (status.code!=<span class="integer">200</span>) {
  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>()...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is pretty robust, but the extra classes this creates adds to the size of the project in
the programmer&#8217;s head. We&#8217;ve all seen Javadocs with hundreds of POJOs for return and argument classes.</p>
</div>
<div class="paragraph">
<p>Most good IDEs will flag invalid assignments such as assigning a string to <code>code</code> above.
IDEs can also use the type information to help a lot with code completion.</p>
</div>
<div class="paragraph">
<p>One other benefit of this approach:  The JSON rendering/parsing provided by
<a href="groovydoc/org/simplemes/eframe/json/JSONFactory.html" target="_blank" rel="noopener">JSONFactory</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
can handle this reasonable well.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovy-features-to-use-or-avoid"><a class="link" href="#groovy-features-to-use-or-avoid">Groovy Features to Use or Avoid</a></h4>
<div class="paragraph">
<p>Groovy is sometimes called 'a better Java'.  It has a lot of features that we use to enhance
clarity.  It does have some features that we avoid because they are not very clear:</p>
</div>
<div class="ulist">
<div class="title">Groovy Features to Avoid</div>
<ul>
<li>
<p>Method pointers (e.g. <strong>&amp;methodName</strong>).</p>
</li>
<li>
<p>Operator overloading.</p>
</li>
<li>
<p>The optional <strong>return</strong> keyword.  We always use an explicit <strong>return</strong> for clarity.</p>
</li>
<li>
<p>The <strong>with</strong> statement.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are also many features we try to use because they enhance clarity:</p>
</div>
<div class="ulist">
<div class="title">Groovy Features to Use</div>
<ul>
<li>
<p>Automatic getters/setters.</p>
</li>
<li>
<p>Untyped variables (use of <strong>def</strong>).</p>
</li>
<li>
<p>Null-safe dereferences (<strong>object?.method()?.value</strong>).</p>
</li>
<li>
<p>Default operator <strong>?:</strong> (Elvis operator).</p>
</li>
<li>
<p>List/Map syntax, including add to list <strong>&lt;&lt;</strong>.</p>
</li>
<li>
<p>Simple loops (<strong>for value in list {&#8230;&#8203;}</strong>).</p>
</li>
<li>
<p>String index with special case values (<strong>s[5..-1]</strong> to get from character 5 to end of string).</p>
</li>
<li>
<p>Apply method to all elements on a list ( <strong>list</strong>*.method()* )</p>
</li>
<li>
<p>GStrings ("Order: ${order}").</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are just a few of the useful features that make things clear in Groovy.
There is an excellent series of blog posts
<a href="https://blog.mrhaki.com/search/label/Groovy">Groovy Goodness</a> that covers many of
the features of Groovy.</p>
</div>
</div>
<div class="sect3">
<h4 id="asciidoctor-standards"><a class="link" href="#asciidoctor-standards">ASCIIDoctor Standards</a></h4>
<div class="paragraph">
<p>The ASCIIDoctor library is the source for documents such as this Guide.  It has a few quirks that
you need to be aware of when creating <em>.adoc</em> files.</p>
</div>
<div class="sect4">
<h5 id="image-widths"><a class="link" href="#image-widths">Image Widths</a></h5>
<div class="paragraph">
<p>The <code>image</code> tag has a <code>width</code> option.  You should not use a percentage since the PDF images will
will interpret this as pixels, not percent.  This will make a very small image.</p>
</div>
<div class="listingblock">
<div class="title">Example - ASCII Doctor Image Width</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asciidoc">image::guis/DashboardWorkList.png[Dashboard - Work List,align=&quot;center&quot;,width=&quot;600&quot;] <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The width should be in pixels.  600 is typically a good value for 60% of the width.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="internationalization"><a class="link" href="#internationalization">Internationalization</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#default-labels">Default Labels</a></span>
<span class="inline-toc"><a href="#labels-and-tooltips">Specific Label and Tooltip Handling</a></span>
<span class="inline-toc"><a href="#internationalization-naming-conventions">Internationalization Naming Conventions</a></span>
<span class="inline-toc"><a href="#internationalized-database-values">Internationalized Database Values</a></span></p>
</div>
<div class="paragraph">
<p>Internationalization is a critical part of most enterprise applications. Almost all text
displayed to the user should internationalized.  The framework provides mechanisms in most
markers to support this.  Most of this support relies on
naming conventions for default labels.</p>
</div>
<div class="paragraph">
<p>See the <a href="#domains">Domains</a> section for additional <em>messages.properties</em> notes.</p>
</div>
<div class="sect3">
<h4 id="default-labels"><a class="link" href="#default-labels">Default Labels</a></h4>
<div class="paragraph">
<p>Most markers use a default label for most fields.  This means you won&#8217;t need to specify the
label in your HTML pages.  It just requires an entry in your <em>messages.properties</em> file.
For example, the <a href="#efDefinitionList">[efDefinitionList]</a> marker will use the field&#8217;s name to
generate the list column header.  For example, if you display a field <em>order</em>
in your list, then the label for the header will be taken from the <em>messages.properties</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>order.label=Order</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this entry is not in the <em>messages.properties</em> file, then the text <em>order.label</em> will be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="labels-and-tooltips"><a class="link" href="#labels-and-tooltips">Specific Label and Tooltip Handling</a></h4>
<div class="paragraph">
<p>Labels and tooltips are usually automatically determined by the framework for most common scenarios.
Some cases require your application to specify a custom label/tooltip.  For example, adding
buttons to a <a href="reference.html.html#list-with-buttons">standard list</a>.</p>
</div>
<div class="paragraph">
<p>To simplify this, the framework follows a standard way to specify the label and tooltip with one entry.</p>
</div>
<div class="listingblock">
<div class="title">Specifying Label/Tooltip</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;ef:list</span> <span class="attribute-name">controller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Order</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">columns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">order,product,qtyToBuild</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">releaseButtonLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">release.label</span><span class="delimiter">&quot;</span></span>   <i class="conum" data-value="1"></i><b>(1)</b>
         <span class="attribute-name">releaseButtonHandler</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">releaseRow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The label "release.label" and the tooltip "release.tooltip" will be used (if defined in bundle).</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is not yet supported consistently in all markers.  The markers that support this approach
      will be noted in the reference guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This standard labelling logic is provided by
<a href="groovydoc/org/simplemes/eframe/i18n/GlobalUtils.html" target="_blank" rel="noopener">GlobalUtils</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
method <code>lookupLabelAndTooltip()</code>.</p>
</div>
<div class="paragraph">
<p>If a given label is not found in the <em>messages.properties</em> file, then the lookup key is
used instead.</p>
</div>
<div class="sect4">
<h5 id="internationalization-naming-conventions"><a class="link" href="#internationalization-naming-conventions">Internationalization Naming Conventions</a></h5>
<div class="paragraph">
<p>The <em>messages.properties</em> file follows specific naming conventions that makes it easier to
internationalize your application.  Some of the most common patterns are shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>create.title=Create {0} - {1}
customNotAllowed.message=Custom fields not allowed on the {0} domain class.
default.create.tooltip=Create a new record
fieldFormat.DATE_TIME.label=Date/Time
order.label=Order

# Error messages
error.103.message=Error creating directory {0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many of these use replaceable parameters (e.g. {0}) to make it clear what the user is working on.</p>
</div>
</div>
<div class="sect4">
<h5 id="internationalized-database-values"><a class="link" href="#internationalized-database-values">Internationalized Database Values</a></h5>
<div class="paragraph">
<p>As a general rule, a <em>label</em> stored in the database (e.g. for custom field extensions) can be
localized.  The system will attempt to localize the value, but if it is not found in the
<em>messages.properties</em> file(s), it will be displayed as-is. This allows you to use some
non-localized text (e.g. 'Details') or some localized text (e.g. 'details.label').</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="application-main"><a class="link" href="#application-main">Application.main()</a></h3>
<div class="paragraph">
<p>Micronaut requires an <em>Application</em> class that has a <code>main()</code> method to start the application
server.  This enterprise framework has some logic that must be executed before the
<code>Micronaut.run()</code> method is called.</p>
</div>
<div class="paragraph">
<p>For example, the framework stores all date/times in the database with the UTC timezone.
This is done in your <code>Application.main()</code> using the
<a href="groovydoc/org/simplemes/eframe/application/StartupHandler.html" target="_blank" rel="noopener">StartupHandler</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>:</p>
</div>
<div class="listingblock">
<div class="title">Application.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Application</span> {
  <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    StartupHandler.preStart()  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">def</span> applicationContext = Micronaut.run(. . .)  <i class="conum" data-value="2"></i><b>(2)</b>
     . . .
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The preStart logic is run.  This includes setting the default timezone for the JVM to UTC.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The normal Micronaut startup is executed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This preStartup method is also called in the setup logic for the
<a href="groovydoc/org/simplemes/eframe/test/BaseSpecification.html" target="_blank" rel="noopener">BaseSpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> class.</p>
</div>
<div class="paragraph">
<p>See <a href="#dates-and-timezones">Dates and Timezones</a> for details on how timezones are handled.</p>
</div>
</div>
<div class="sect2">
<h3 id="domain-controller-or-service"><a class="link" href="#domain-controller-or-service">Domain, Controller or Service?</a></h3>
<div class="paragraph">
<p>This section describes the standard approach to breaking up your application logic between
domains, controllers and services within an enterprise application.  This framework doesn&#8217;t
force you to use a specific approach, but many of the features will be much easier to use
if you follow these guidelines.</p>
</div>
<div class="paragraph">
<p>The basic responsibilities are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Domain</strong> - Persistence and integrity within the domain and its children.</p>
</li>
<li>
<p><strong>Controller</strong> - API Access from external callers and internal web pages.</p>
</li>
<li>
<p><strong>Service</strong> - Business logic and database transaction control.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basic interaction between the 3 main classes is shown below for the two most common scenarios:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/domainControllerServiceInteraction.png" alt="domainControllerServiceInteraction" width="790" height="490">
</div>
<div class="title">Figure 6. Domain, Controller and Service Interaction Example</div>
</div>
<div class="paragraph">
<p>The CRUD (Create, Read, Update and Delete) actions of domain objects does not involve services.
Micronaut Data with some helpers from this enterprise framework provides a good implementation
of these functions. This framework adds some glue to make the pieces work better together.</p>
</div>
<div class="paragraph">
<p>When you have non-CRUD requests, there is usually some business logic and transaction control needed.
In many scenarios, multiple top-level domains are used by the business logic.  For these reasons,
we typically put this business logic into a service.  This service is accessed by the client through
the controller to enforce security.  This service then typically works with one or more domain
classes which update the database, usually in a single database transaction.</p>
</div>
<div class="paragraph">
<p>See <a href="#controllers">Controllers</a> for an example of how the framework makes these actions simpler.</p>
</div>
<div class="sect3">
<h4 id="what-about-domain-validation"><a class="link" href="#what-about-domain-validation">What about Domain Validation?</a></h4>
<div class="paragraph">
<p>Validation within a domain object and its children is generally handled by the domain class.
This is done to always ensure data integrity of all domain objects.  If the validation spans
multiple top-level domains, then we generally handle this in a service.  One domain should
not know very much about the details of another top-level domain.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="field-definitions"><a class="link" href="#field-definitions">Field Definitions</a></h3>
<div class="paragraph">
<p>This framework operates on a centralized field definition for the domain objects.  This includes
defining the core fields and custom fields for that domain.  This framework allows these features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use of core/custom fields in standard definition <a href="#guis">GUIs</a>.</p>
</li>
<li>
<p>Binding of these fields to complex domain objects, including child records.</p>
</li>
<li>
<p>Saving/retrieving values from storage (e.g. from text files for archive purposes).</p>
</li>
<li>
<p>JSON access from REST clients.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basic object structures for these field definitions looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/fieldDefinitions.png" alt="fieldDefinitions" width="420" height="406">
</div>
<div class="title">Figure 7. Field Definitions</div>
</div>
<div class="paragraph">
<p>The <em>FieldDefinitions</em> contains the fields for a given object.  These are cached in the groovy
meta class for the object.   In this <em>FieldDefinitions</em>  is a list of FieldDefinition objects
which have specific names, types and a <em>FieldFormatEnum</em> element that controls how the value
is convert to/from strings for internal and for GUI use.</p>
</div>
<div class="paragraph">
<p>These field definitions are accessed like this:</p>
</div>
<div class="listingblock">
<div class="title">Example for FieldDefinitions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> fields = DomainUtils.getFields(Order)

<span class="keyword">for</span> (fieldDef <span class="keyword">in</span> fieldDefs) {     <i class="conum" data-value="1"></i><b>(1)</b>
   . . .
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access all fields with a simple loop (non-closure).  Also supports the <code>.each() {}</code> operator.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="gui-guidelines"><a class="link" href="#gui-guidelines">GUI Guidelines</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#standard-header">Standard Header</a></span>
<span class="inline-toc"><a href="#message-display">Message Display</a></span></p>
</div>
<div class="paragraph">
<p>Modern browser-based GUIs can be very complex.  This enterprise framework gives you the tools
to make a consistent user experience with common behaviors throughout your application.
You will need to follow some simple guidelines to keep things consistent and easy for development.</p>
</div>
<div class="sect3">
<h4 id="standard-header"><a class="link" href="#standard-header">Standard Header</a></h4>
<div class="paragraph">
<p>Most GUIs needs some standard Javascript, CSS and assets to work correctly.  To make this simpler,
all of your pages should include the standard header:</p>
</div>
<div class="listingblock">
<div class="title">Standard Page Header Usage of header.ftl</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="error">&lt;</span>#--@formatter:off--<span class="error">&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="error">&lt;</span>#assign title<span class="error">&gt;</span><span class="error">&lt;</span>@efTitle type='list'/<span class="error">&gt;</span><span class="tag">&lt;/</span>#assign<span class="error">&gt;</span>  <i class="conum" data-value="2"></i><b>(2)</b>

<span class="error">&lt;</span>#include &quot;../includes/header.ftl&quot; /<span class="error">&gt;</span>  <i class="conum" data-value="3"></i><b>(3)</b>
<span class="error">&lt;</span>#include &quot;../includes/definition.ftl&quot; /<span class="error">&gt;</span>

<span class="error">&lt;</span>@efDefinitionList/<span class="error">&gt;</span>
<span class="error">&lt;</span>@efPreloadMessages codes=&quot;cancel.label&quot;/<span class="error">&gt;</span>

<span class="error">&lt;</span>#include &quot;../includes/footer.ftl&quot; /<span class="error">&gt;</span>   <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>For Intellij, we recommend you turn off formatting in <em>.ftl</em> files.  The IDE formatting
will really mess up your file.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The title is defined by your page, with use of the <a href="#efTitle">[efTitle]</a> marker.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The standard header.  Brings in the assets for the framework and the <a href="#GUI Toolkit">[GUI Toolkit]</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A standard footer (no visible content).</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This standard header (<em>header.ftl</em>) also includes any <a href="#assets-provided-by-additions">Assets Provided by Additions</a>.
      This is done with the <a href="#efAddition">[efAddition]</a> marker with the 'assets' option.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="message-display"><a class="link" href="#message-display">Message Display</a></h4>
<div class="paragraph">
<p>Most GUIs need to display messages at some time.  We have standardized on showing most error/info
messages at the top of the page.  Most messages will be shown by framework logic in this standard
messages DIV created by the standard <em>header.ftl</em>:</p>
</div>
<div class="listingblock">
<div class="title">Example Messages DIV</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="error">&lt;</span>@efMessages/<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The standard <em>header.ftl</em> above uses the <a href="#efMessages">[efMessages]</a> marker to create the standard <code>&lt;div&gt;</code> marker
to position the messages at the top of the page.</p>
</div>
<div class="paragraph">
<p>For example, server-side errors found by the
javascript Ajax function <a href="reference.html#eframe-get">ef.get</a>
are usually displayed in this standard area with a red highlight:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/errorMessages.png" alt="errorMessages" width="75%">
</div>
<div class="title">Figure 8. messages</div>
</div>
<div class="paragraph">
<p>The standard message area (id='messages') is created by the <em>header.ftl</em> and is located under the
standard header/toolbar.</p>
</div>
<div class="paragraph">
<p>The server-side code can store these messages using the
<a href="groovydoc/org/simplemes/eframe/controller/StandardModelAndView.html" target="_blank" rel="noopener">StandardModelAndView</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>:</p>
</div>
<div class="listingblock">
<div class="title">Messages Response from Controller</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/status</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">StatusController</span> {

  <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/display</span><span class="delimiter">&quot;</span></span>)
  StandardModelAndView show(HttpRequest request,<span class="predefined-type">Principal</span> principal) {    <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">def</span> modelAndView = <span class="keyword">new</span> StandardModelAndView(<span class="string"><span class="delimiter">'</span><span class="content">status/show</span><span class="delimiter">'</span></span>, principal, <span class="local-variable">this</span>)
    <span class="keyword">def</span> messages = <span class="keyword">new</span> MessageHolder(<span class="key">text</span>: <span class="string"><span class="delimiter">'</span><span class="content">a bad message</span><span class="delimiter">'</span></span>, <span class="key">code</span>: <span class="integer">103</span>)    <i class="conum" data-value="2"></i><b>(2)</b>
    modelAndView[StandardModelAndView.MESSAGES] = messages  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">return</span>
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The show method returns a StandardModelAndView, which Freemarker will use to render the page.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An error message is created for the display.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The message holder is stored in the model for the view, under the key <em>'_messages'</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These messages will be displayed by the <a href="#efMessages">[efMessages]</a> marker in the <a href="#standard-header">Standard Header</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dialogs can also be configured to display messages if needed.
       See <a href="reference.html#display-dialog" target="_blank" rel="noopener">displayDialog</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
       for details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="message-access-from-ftl-files"><a class="link" href="#message-access-from-ftl-files">Message Access from .ftl Files</a></h4>
<div class="paragraph">
<p>The standard <a href="#message-display">Message Display</a> logic relies on the messages being stored in a common place
in the Freemarker data model. The messages are accessible like this:</p>
</div>
<div class="listingblock">
<div class="title">Example Messages DIV</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">${messageHolder.text}  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Displays the primary message.  See
<a href="groovydoc/org/simplemes/eframe/exception/MessageHolder.html" target="_blank" rel="noopener">MessageHolder</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> for details on methods available.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup"><a class="link" href="#setup">Setup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#initial-data-load">Initial Data Load</a></span>
<span class="inline-toc"><a href="#configuration">Configuration</a></span></p>
</div>
<div class="paragraph">
<p>Enterprise applications frequently need extensive setup.  To make this simpler for your customers, the framework provides
some utilities to make setup easier.</p>
</div>
<div class="paragraph">
<p>For security setup, see <a href="#security">Security</a>.</p>
</div>
<div class="sect2">
<h3 id="initial-data-load"><a class="link" href="#initial-data-load">Initial Data Load</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#domain-method-initialdataload">Domain Method initialDataLoad</a></span>
<span class="inline-toc"><a href="#initialdataloadbefore-and-initialdataloadafter">initialDataLoadBefore and initialDataLoadAfter</a></span>
<span class="inline-toc"><a href="#loading-from-non-domains">Loading from Non-Domains</a></span>
<span class="inline-toc"><a href="#initial-data-loading-and-tests">Initial Data Loading and Tests</a></span></p>
</div>
<div class="paragraph">
<p>Initial data loading is one of the common setup needs for large applications.  These applications usually have
a number of status codes or numbering sequences that need some sort of initial values.  If you don&#8217;t have some
reasonable defaults, then your first-time customers may spend hours trying to configure your product.  This will
discourage most normal customers.</p>
</div>
<div class="sect3">
<h4 id="domain-method-initialdataload"><a class="link" href="#domain-method-initialdataload">Domain Method initialDataLoad</a></h4>
<div class="paragraph">
<p>To trigger the initial data load on startup, you will need to add a method to your domain class.
This method will be executed on application startup.  The method should check for the existence
of the record before attempting to create it.  You should also minimize the logic to reduce
startup time.  Don&#8217;t add extensive or slow logic if you can avoid it.</p>
</div>
<div class="paragraph">
<p>An example is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Example Domain Initial Data Load</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> initialDataRecords = [<span class="string"><span class="delimiter">'</span><span class="content">User</span><span class="delimiter">'</span></span>: [<span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>]]

<span class="directive">static</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt;&gt; initialDataLoad() {
  <span class="keyword">if</span> (!findByUserName(<span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>)) {  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">def</span> adminUser = <span class="keyword">new</span> User(<span class="key">userName</span>: <span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="content">****</span><span class="delimiter">'</span></span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Admin User</span><span class="delimiter">'</span></span>).save()
    log.debug(<span class="string"><span class="delimiter">'</span><span class="content">Created initial admin user {}</span><span class="delimiter">'</span></span>, adminUser)
  }

  <span class="keyword">return</span> initialDataRecords  <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create the admin user, only if it does not exist already.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Always return the records that are provided by the initial data load process, even if
they already exist. This lets you specify which records to leave in the database
after a test is run. This helps with the issue of <a href="#test-data-pollution">Test Data Pollution</a>.
The format of these strings is important.  These strings
should match the format of the <a href="#toshortstring">toShortString()</a> on the domain record.
See <a href="#initial-data-loading-and-tests">Initial Data Loading and Tests</a> for more details
on the format of these Lists of Strings.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keep this <code>initialDataLoad()</code> method simple.  Any errors could affect startup, which will frustrate your users.
If you want to avoid this problem, then you can write code to handle exceptions and allow the startup.  In most
cases, this would not be wise. Your application may not run properly without these records.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most applications will allow the users to modify the defaults using normal GUIs or APIs.  It is important that your
<code>initialDataLoad()</code> method never alter existing records.  If the user deletes your records, then the record(s) will
probably be re-created on the next application startup.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need to load data for domains that are in a module (e.g. new User Roles for the module),
then look at <a href="#loading-from-non-domains">Loading from Non-Domains</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="initialdataloadbefore-and-initialdataloadafter"><a class="link" href="#initialdataloadbefore-and-initialdataloadafter">initialDataLoadBefore and initialDataLoadAfter</a></h4>
<div class="paragraph">
<p>The order these initial data records are loaded is sometimes important.  Validation of references to
other records can fail if the records are loaded in the wrong order.  To solve simple precedence
problems, we support simple 'load after' and 'load before' features.</p>
</div>
<div class="paragraph">
<p>These 'load after' and 'load before' are defined in the domain that needs the precedence.
These are lists that define which other domains should be loaded before or after the domain.
The list can contain full class names (including packages) or the Class object itself.</p>
</div>
<div class="paragraph">
<p>Below are two examples of their use:</p>
</div>
<div class="listingblock">
<div class="title">Example - initialDataLoadAfter</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@MappedEntity</span>
<span class="type">class</span> <span class="class">User</span> {
  <span class="directive">static</span> initialDataLoadAfter = [<span class="predefined-type">Role</span>]  <i class="conum" data-value="1"></i><b>(1)</b>
  . . .
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>User</em> domain&#8217;s initial data should be loaded after the <em>Role</em> domain.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example - initialDataLoadBefore</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> initialDataLoadBefore = [<span class="string"><span class="delimiter">'</span><span class="content">org.simplemes.eframe.security.domain.User</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example - initialDataLoadBefore</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@MappedEntity</span>
<span class="type">class</span> <span class="class">Role</span> {
  <span class="directive">static</span> initialDataLoadBefore = [User]  <i class="conum" data-value="1"></i><b>(1)</b>
  . . .
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>Role</em> domain&#8217;s initial data should be loaded before the <em>User</em> domain.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the 'before' and 'after' lists are both specified in one domain, then the before takes
      precedence. You should use only one for clarity.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="loading-from-non-domains"><a class="link" href="#loading-from-non-domains">Loading from Non-Domains</a></h4>
<div class="paragraph">
<p>Sometimes, a module will need to add records to a core module&#8217;s database.  This is common with
user <a href="#roles">Roles</a>.  To avoid creating dummy domain classes for this, we suggest you use
a feature for <a href="#addition">Addition</a>.  See <a href="#initial-data-loaders-and-additions">Initial Data Loaders and Additions</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="initial-data-loading-and-tests"><a class="link" href="#initial-data-loading-and-tests">Initial Data Loading and Tests</a></h4>
<div class="paragraph">
<p>Functional tests that use the embedded test server will use an in-memory database.
This database is active for the entire test suite, so each test needs to clean up it test
data as described in <a href="#test-data-pollution">Test Data Pollution</a>.</p>
</div>
<div class="paragraph">
<p>The problem is with the data loaded by initial data loaders.  This data should be left alone
since later tests may need it.</p>
</div>
<div class="paragraph">
<p>For example, a module adds some roles to the database for its security checks.  We don&#8217;t
want those records to be considered <a href="#test-data-pollution">Test Data Pollution</a>.  This would cause every test
to fail.  We want those records left in the database after every test.</p>
</div>
<div class="paragraph">
<p>To avoid this, your initial data load method should return a list of values that will be ignored
by the test data pollution check.</p>
</div>
<div class="listingblock">
<div class="title">Example Initial Data Load - Test Data Pollution</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> initialDataRecords = [<span class="string"><span class="delimiter">'</span><span class="content">User</span><span class="delimiter">'</span></span>: [<span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>]] <i class="conum" data-value="1"></i><b>(1)</b>

<span class="directive">static</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt;&gt; initialDataLoad() {
  <span class="keyword">if</span> (!findByUserName(<span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>)) {  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">def</span> adminUser = <span class="keyword">new</span> User(<span class="key">userName</span>: <span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="content">****</span><span class="delimiter">'</span></span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Admin User</span><span class="delimiter">'</span></span>).save()
    log.debug(<span class="string"><span class="delimiter">'</span><span class="content">Created initial admin user {}</span><span class="delimiter">'</span></span>, adminUser)
  }

  <span class="keyword">return</span> initialDataRecords  <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The static list of records created for the 'User' object. The strings here (e.g. 'admin')
will be the record&#8217;s <code>TypeUtils.toShortString(record)</code>.  This should be safe for most
scenarios used in tests.  The Map key is the domain class&#8217;s <code>simpleName</code> (e.g. 'User' above).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create the admin user, only if it does not exist already.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Always return the records that are provided by the initial data load process, even if
they already exist.  These values returned will be ignored when checking for
<a href="#test-data-pollution">Test Data Pollution</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example will create a record for the admin user.  The returned map is used
by <a href="groovydoc/org/simplemes/eframe/test/BaseSpecification.html" target="_blank" rel="noopener">BaseSpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> to know which records to ignore for each domain
class.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security"><a class="link" href="#security">Security</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#security-design">Security Design</a></span>
<span class="inline-toc"><a href="#security-setup">Security Setup</a></span>
<span class="inline-toc"><a href="#important-security-options">Important Security Options</a></span>
<span class="inline-toc"><a href="#roles">Roles</a></span>
<span class="inline-toc"><a href="#security-guis">Security GUIs</a></span></p>
</div>
<div class="paragraph">
<p>Security is critical in enterprise applications.  This framework depends on
<a href="https://micronaut-projects.github.io/micronaut-security/latest/guide/" target="_blank" rel="noopener">Micronaut Security - JWT Cookies</a>
for the bulk of the security features.</p>
</div>
<div class="paragraph">
<p>If you need to know the current user, see <a href="#current-user">Current User</a>.</p>
</div>
<div class="sect2">
<h3 id="security-design"><a class="link" href="#security-design">Security Design</a></h3>
<div class="paragraph">
<p>This enterprise framework needs to support a few key configurable scenarios:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User browser session timeout of short duration (e.g 30 minutes or less).</p>
</li>
<li>
<p>Longer user browser session timeout (14+ days).</p>
</li>
<li>
<p>JWT support for security on the <a href="#api">API</a> calls.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To support all of these cases, we chose to use JWT (Json Web Tokens) via browser cookies.
This allows a short JWT lifetime, with a long (configurable) automatic refresh mechanism for
browser-based clients.</p>
</div>
<div class="paragraph">
<p>One other important point:  Most requests should be authenticated with a stateless
mechanism.  This means the JWT is used to authenticate most requests since
it does not use the DB or a session state to authenticate the request.  Instead, it
simply checks for validity.</p>
</div>
<div class="paragraph">
<p>Once the JWT expires (e.g. after 15 minutes), the token refresh is triggered that
checks for a valid refresh token (in the DB) from the original login.  It also checks the
User record in the DB for the user&#8217;s status.</p>
</div>
<div class="sect3">
<h4 id="token-timeouts"><a class="link" href="#token-timeouts">Token Timeouts</a></h4>
<div class="paragraph">
<p>With this approach, the timeouts for the JWT and JWT_REFRESH_TOKEN are important.
If the values are too small or too large, then performance may suffer or your exposure
to security lapses may be too large.</p>
</div>
<div class="paragraph">
<p>See <a href="#security-setup">Security Setup</a> for details on setting these timeouts.</p>
</div>
</div>
<div class="sect3">
<h4 id="refresh-token-flow"><a class="link" href="#refresh-token-flow">Refresh Token Flow</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section assumes the access token timeout is set to the default 15 minutes and
      the refresh token timeout is set to the default 24 hours.  These numbers will
      used below without noting that they are the configurable values.
      See <a href="#security-setup">Security Setup</a> for example settings.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic refresh flow is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Successful login sends access token (<em>JWT</em>) and refresh token (<em>JWT_REFRESH_TOKEN</em>)
cookies (15min and 24 hours).</p>
</li>
<li>
<p>All requests are checked for expired JWT.  If the JWT is expired, then the
auto refresh of the token is attempted. The response will include the new JWT.</p>
</li>
<li>
<p>If any of these refreshes fail, then the user will be forced to login at the next
user request to the sever (e.g. on the nest page load or save).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The browser client-side logic requires no changes.  The normal browser cookie
handling logic should cover mode cases.</p>
</div>
<div class="paragraph">
<p>Any non-browser clients can request a refresh using a process similar to
<a href="#oauth-refresh">OAuth /oauth/access_token Endpoint Use</a> mechanism.</p>
</div>
</div>
<div class="sect3">
<h4 id="refresh-token-details"><a class="link" href="#refresh-token-details">Refresh Token Details</a></h4>
<div class="paragraph">
<p>Internally, the logic is a little more complex.  There are two Micronaut beans involved
in this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="groovydoc/org/simplemes/eframe/security/AutoRefreshAuthenticationFetcher.html" target="_blank" rel="noopener">AutoRefreshAuthenticationFetcher</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
This detects the expired JWT and triggers
 an auto token refresh for the request.  This class stores the new cookies in
 a request attribute for use by the other object.</p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/security/AutoRefreshTokenFilter.html" target="_blank" rel="noopener">AutoRefreshTokenFilter</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
This gets the cookies from the request and puts them
 in the response.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two beans, along with the
<a href="groovydoc/org/simplemes/eframe/security/service/RefreshTokenService.html" target="_blank" rel="noopener">RefreshTokenService</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
will only allow the refresh token to be used a limited number of times.
If used too many times, then the
existing refresh tokens for the user will be disabled and force a new login.</p>
</div>
</div>
<div class="sect3">
<h4 id="oauth-refresh"><a class="link" href="#oauth-refresh">OAuth /oauth/access_token Endpoint Use</a></h4>
<div class="paragraph">
<p>This endpoint is intentionally broken.  The replacement <em>/login/access_token</em>
provides a limited-use replacement refresh token cookie when used.  The
<em>RefreshTokenService.getUserDetails()</em> RefreshTokenPersistence implementation
intentionally prevents use of the tokens via the OAuth <em>/oauth/access_token</em> endpoint.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-setup"><a class="link" href="#security-setup">Security Setup</a></h3>
<div class="paragraph">
<p>Setting up security is not too tedious.  By default, a single user <em>admin</em> is created with all
roles available.   The password defaults to <em>admin</em> and must be changed on the first login.</p>
</div>
<div class="paragraph">
<p>This <em>admin</em> user can be deleted, but should only be deleted after another user record is created.
This user will be created on startup if there are no users in the database.
You should make sure there is at least one user with the <em>ADMIN</em> role in the system.</p>
</div>
<div class="sect3">
<h4 id="application-yml-2"><a class="link" href="#application-yml-2">application.yml</a></h4>
<div class="paragraph">
<p>Your application&#8217;s <em>application.yml</em> needs a few entries for security to work as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">application</span>:
    <span class="key">name</span>: <span class="string"><span class="content">???</span></span>
  <span class="key">session</span>:
    <span class="key">http</span>:
      <span class="key">cookiePath</span>: <span class="string"><span class="content">/</span></span>
  <span class="key">security</span>:
    <span class="key">authentication</span>: <span class="string"><span class="content">cookie</span></span>
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">endpoints</span>:
      <span class="key">login</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="key">logout</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">reject-not-found</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">redirect</span>:
      <span class="key">forbidden</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">url</span>: <span class="string"><span class="content">/login/auth</span></span>
      <span class="key">prior-to-login</span>: <span class="string"><span class="content">true</span></span>
      <span class="key">unauthorized</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">url</span>: <span class="string"><span class="content">/login/auth</span></span>
    <span class="key">token</span>:
      <span class="key">jwt</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">bearer</span>:
          <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span>
        <span class="key">cookie</span>:
          <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
          <span class="key">loginFailureTargetUrl</span>: <span class="string"><span class="content">/login/auth?failed=true</span></span>
          <span class="key">cookie-same-site</span>: <span class="string"><span class="content">'Lax'</span></span>
        <span class="key">signatures</span>:
          <span class="key">secret</span>:
            <span class="key">generator</span>:
              <span class="key">secret</span>: <span class="string"><span class="content">${EFRAME_KEY}  </span></span><i class="conum" data-value="1"></i><b>(1)</b>
        <span class="key">generator</span>:
          <span class="key">access-token.expiration</span>: <span class="string"><span class="content">1800</span></span>  <span class="comment"># 30 minutes  </span><i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">refresh-token</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">base64</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">secret</span>: <span class="string"><span class="content">${EFRAME_KEY}</span></span>
      <span class="key">refresh</span>:
        <span class="key">cookie</span>:
          <span class="key">cookie-path</span>: <span class="string"><span class="content">'/'</span></span>
          <span class="key">cookie-max-age</span>: <span class="string"><span class="content">'30d'  </span></span><i class="conum" data-value="3"></i><b>(3)</b>
          <span class="key">cookie-same-site</span>: <span class="string"><span class="content">'Lax'</span></span>
    <span class="key">interceptUrlMap</span>:
      - <span class="string"><span class="content">pattern: /assets/**</span></span>
        <span class="key">httpMethod</span>: <span class="string"><span class="content">GET</span></span>
        <span class="key">access</span>:
          - <span class="string"><span class="content">isAnonymous()</span></span>
      - <span class="string"><span class="content">pattern: /favicon.ico</span></span>
        <span class="key">httpMethod</span>: <span class="string"><span class="content">GET</span></span>
        <span class="key">access</span>:
          - <span class="string"><span class="content">isAnonymous()</span></span>
  <span class="key">server.netty.logLevel</span>: <span class="string"><span class="content">DEBUG</span></span>
  <span class="key">server.thread-selection</span>: <span class="string"><span class="content">AUTO</span></span>
  <span class="key">metrics</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">export</span>:
      <span class="key">prometheus</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">step</span>: <span class="string"><span class="content">PT1M</span></span>
        <span class="key">descriptions</span>: <span class="string"><span class="content">false</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">endpoints</span>:
  <span class="key">prometheus</span>:
    <span class="key">sensitive</span>: <span class="string"><span class="content">false</span></span>

<span class="head"><span class="head">---</span></span>
<span class="key">eframe</span>:
  <span class="key">security</span>:
    <span class="key">jwtRefreshUseMax</span>: <span class="string"><span class="content">100  </span></span><i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This value comes from the environment variable 'EFRAME_KEY'.  The JWT encryption
provider requires a 256 bit or longer key (32+ characters).
See <a href="https://docs.micronaut.io/latest/guide/index.html#_included_propertysource_loaders">Micronaut Configuration</a>
for more details.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The access token timeout.  Suggest value between 15-30 minutes.  Too small, and the
token refresh mechanism will be invoked too often.  Too large and the
JWT token will be valid for too long.  This means disabling a user account will not
take effect until the JWT token has expired.  See <a href="#security-design">Security Design</a> for details
on these trade-offs.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The expiration time for the refresh token (seconds).  Defaults to 30 days ('30d').</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The number of times a refresh token can be used by the user.  (Default: 100).
Set this to 1 for strictest security.  1 means that each refresh token can only
be used once. This might be useful in detecting IP address forgery in your network.
This will generate more <em>REFRESH_TOKEN</em> database records,
but they are cleaned up after they have reached their expiration date.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This configures JWT Security to force all controller requests to be authenticated.
It also allows access to some pages/assets without a login.
(See Roles below for details).</p>
</div>
</div>
<div class="sect3">
<h4 id="security-setup-for-controllers"><a class="link" href="#security-setup-for-controllers">Security Setup for Controllers</a></h4>
<div class="paragraph">
<p>By default all controller methods must be secured.  See <a href="#controller-security">Controller Security</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="important-security-options"><a class="link" href="#important-security-options">Important Security Options</a></h4>
<div class="sect4">
<h5 id="access-token-expiration-micronaut-security"><a class="link" href="#access-token-expiration-micronaut-security">access-token-expiration (micronaut.security&#8230;&#8203;)</a></h5>
<div class="paragraph">
<p>Suggested value: 1800 (30 minutes).</p>
</div>
<div class="paragraph">
<p>This setting defines the number of seconds for the JWT token will live after it is
created.  This means that any request with this token during that lifetime will
be allowed.  There will be no check for the User&#8217;s status or for any other validations.</p>
</div>
<div class="paragraph">
<p>Making this value larger than 30 minutes means your exposure to security lapses will
last 30+ minutes.  If someone compromises your network and gets the JWT token,
they can make requests on the system.  If your JWT tokens expire quickly, then
the exposure is short.</p>
</div>
<div class="paragraph">
<p>Making this value less than 5 minutes will force too many expensive refresh requests
that access the database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your network or devices are badly compromised, then there is little that
      the framework can do to prevent issues.  We can detect certain issues such as
      two users using the same refresh token.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="micronaut-security-token-refresh-cookie-cookie-max-age"><a class="link" href="#micronaut-security-token-refresh-cookie-cookie-max-age">micronaut.security.token.refresh.cookie.cookie-max-age</a></h5>
<div class="paragraph">
<p>micronaut.security.token.refresh.cookie.cookie-max-age': '10m'</p>
</div>
<div class="paragraph">
<p>refresh:
        cookie:
          cookie-path: '/'
          cookie-max-age: '13m'
          cookie-same-site: 'Lax'</p>
</div>
<div class="paragraph">
<p>Suggested value: 1-14 days.  Defaults to 20days.</p>
</div>
<div class="paragraph">
<p>This age defines how long a refresh token can be used.  This is similar to the
traditional session timeout used by older web applications.  This is the time
when the framework will force the user to login again.</p>
</div>
<div class="paragraph">
<p>Every time a JWT token expires, the refresh mechanism will usually be triggered.
This refresh checks the database for the token.  It must be enabled, un-expired
and never used before.
The User&#8217;s setting in the database is also checked.</p>
</div>
<div class="paragraph">
<p>Setting this value too large means the refresh token can be used a long time.  If
the refresh token is leaked, then it can be used to provide access to the system for
longer period of time.</p>
</div>
<div class="paragraph">
<p>This is mitigated by the fact that the token can only be used once.  The second attempt
to use the refresh token will disable all tokens for the user.
This will force the user to re-authenticate by logging in again.
A message is logged indicating a re-use was attempted.</p>
</div>
<div class="paragraph">
<p>Setting this value too small means your users will have to login more frequently.
There is no real downside to this beyond user expectations.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="roles"><a class="link" href="#roles">Roles</a></h3>
<div class="paragraph">
<p>The roles created automatically by the framework form the basis for your application&#8217;s roles.
These roles are the ones used by the framework setup and administration pages and are required
for most actions.   If these roles are deleted from the database, then they will be re-created
on the next startup.</p>
</div>
<div class="paragraph">
<p>The roles provided by the framework are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#admin">ADMIN</a> - General Administration actions.</p>
</li>
<li>
<p><a href="#customizer">CUSTOMIZER</a> -Views/Updates non-GUI customization features.</p>
</li>
<li>
<p><a href="#designer">DESIGNER</a> - Views/Updates framework display features (e.g. List columns, Custom Definition features, etc).</p>
</li>
<li>
<p><a href="#manager">MANAGER</a> - Views/Updates most framework manager features (User Definition).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Each roles do not have built-in hierarchy.  For example, the ADMIN role does not automatically
      give MANAGER roles.   See the
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some of the pages available to each role is shown below (not an full list):</p>
</div>
<div class="sect3">
<h4 id="no-role-or-anonymous"><a class="link" href="#no-role-or-anonymous">(No Role or Anonymous)</a></h4>
<div class="ulist">
<ul>
<li>
<p>Login Pages.</p>
</li>
<li>
<p>Overall System Status Pages.</p>
</li>
<li>
<p>Assets (images, javascript, etc).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="admin"><a class="link" href="#admin">ADMIN</a></h4>
<div class="ulist">
<ul>
<li>
<p>Clear Statistics action on Overall System Status Pages.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="manager"><a class="link" href="#manager">MANAGER</a></h4>
<div class="paragraph">
<p>Users with this role manage day-to-day operations of the system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User Definition (Create new User, reset password, assign role (permission),  etc)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="customizer"><a class="link" href="#customizer">CUSTOMIZER</a></h4>
<div class="paragraph">
<p>Users with this role create non-GUI extensions to the system.  These include new fields and
logic that can have far-reaching impact on performance, behavior and data integrity.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Field Extension Definition</p>
</li>
<li>
<p>Flex Type creations</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="designer"><a class="link" href="#designer">DESIGNER</a></h4>
<div class="paragraph">
<p>Users with this role can make GUI-level changes to the system.  This generally has a smaller
impact on the system, but still has the potential to impact large number of users but not as
big an impact on data integrity.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure Default list layout</p>
</li>
<li>
<p>Configure Custom GUI features (e.g. dashboards, definition GUIs, etc).</p>
</li>
<li>
<p>Define named list definitions for other users</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="combines-role-lists"><a class="link" href="#combines-role-lists">Combines Role Lists</a></h4>
<div class="paragraph">
<p>Frequently, you will want to specify a controller is accessible for multiple roles.  For
example, you might want to allow ADMIN and MANAGER roles.  To make this simpler, some
combine role arrays are defined in the
<a href="groovydoc/org/simplemes/eframe/security/Roles.html" target="_blank" rel="noopener">Roles</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
class:</p>
</div>
<div class="listingblock">
<div class="title">Example ADMIN and MANAGER roles</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(Roles.MANAGER_AND_MANAGER)
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/somePath</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">SomeController</span> <span class="directive">extends</span> BaseCrudRestController {

  . . .

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-guis"><a class="link" href="#security-guis">Security GUIs</a></h3>
<div class="paragraph">
<p>The framework comes with basic GUIs for creating/maintaining users and roles.  It also provides
standard login/logout mechanisms.   The login page is automatically displayed by the Micronaut
Security module.  The logout action is added
to all GUIs in your by code in the <em>views/includes/header.ftl</em> include file.</p>
</div>
<div class="listingblock">
<div class="title">Example use of header.ftl</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="error">&lt;</span>#assign title<span class="error">&gt;</span>Home Title<span class="tag">&lt;/</span>#assign<span class="error">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>

<span class="error">&lt;</span>#include &quot;../includes/header.ftl&quot; /<span class="error">&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>

 . . .

<span class="error">&lt;</span>#include &quot;../includes/footer.ftl&quot; /<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets the title for the header to use.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Starts the HTML page, including <em>&lt;head&gt;</em> and <em>&lt;body&gt;</em> blocks.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This adds a form that submits the logout request with the POST method.  The logout link is only
shown if a user is currently logged in.</p>
</div>
<div class="paragraph">
<p>This POST/Form mechanism is needed for the default configuration for the
security module.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="domains"><a class="link" href="#domains">Domains</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc-header">General</span>
<span class="inline-toc"><a href="#micronaut-data">Micronaut Data</a></span>
<span class="inline-toc"><a href="#domain-entities">Domain Entities</a></span>
<span class="inline-toc"><a href="#reserved-domain-names">Reserved Domain Names</a></span>
<span class="inline-toc"><a href="#domain-requirements">Domain Requirements</a></span>
<span class="inline-toc"><a href="#duplicate-data-sub-classes">Duplicate Data (Sub-Classes)</a></span></p>
</div>
<div class="paragraph">
<p><span class="inline-toc-header">Fields</span>
<span class="inline-toc"><a href="#field-types">Field Types</a></span>
<span class="inline-toc"><a href="#field-names">Field Names</a></span>
<span class="inline-toc"><a href="#reserved-field-names">Reserved Field Names</a></span>
<span class="inline-toc"><a href="#key-fields">Key Fields</a></span>
<span class="inline-toc"><a href="#unlimited-length-string-fields">Unlimited Length String Fields</a></span>
<span class="inline-toc"><a href="#field-ordering">Field Ordering</a></span>
<span class="inline-toc"><a href="#supported-annotations">Supported Annotations</a></span></p>
</div>
<div class="paragraph">
<p><span class="inline-toc-header">Persistence</span>
<span class="inline-toc"><a href="#repository-requirements">Repository Requirements</a></span>
<span class="inline-toc"><a href="#event-methods">Event Methods</a></span>
<span class="inline-toc"><a href="#transactions">Transactions</a></span>
<span class="inline-toc"><a href="#initial-data-load">Initial Data Load</a></span>
<span class="inline-toc"><a href="#locking">Locking</a></span>
<span class="inline-toc"><a href="#sql-database-definition">SQL Database Definition</a></span></p>
</div>
<div class="paragraph">
<p><span class="inline-toc-header">Relationships/Encoding</span>
<span class="inline-toc"><a href="#relationships">Relationships</a></span>
<span class="inline-toc"><a href="#encoded-types">Encoded Types</a></span>
<span class="inline-toc"><a href="#choice-list">Choice List</a></span>
<span class="inline-toc"><a href="#dates-and-timezones">Dates and Timezones</a></span>
<span class="inline-toc"><a href="#configurable-types">Configurable Types</a></span></p>
</div>
<div class="paragraph">
<p><span class="inline-toc-header">Others</span>
<span class="inline-toc"><a href="#field-definitions">Field Definitions</a></span>
<span class="inline-toc"><a href="#toshortstring">toShortString()</a></span>
<span class="inline-toc"><a href="#tostringlocalized">toStringLocalized()</a></span>
<span class="inline-toc"><a href="#dynamic-sql-preparedstatement">Dynamic SQL - PreparedStatement</a></span></p>
</div>
<div class="sect2">
<h3 id="domain-introduction"><a class="link" href="#domain-introduction">Domain Introduction</a></h3>
<div class="paragraph">
<p>Your domain classes have a few requirements to be easily used by various pieces of the framework.
Your domain classes should be in proper packages, but that is not required.
See <a href="#domain-testing">Domain Testing</a> for details on testing.</p>
</div>
<div class="sect3">
<h4 id="micronaut-data"><a class="link" href="#micronaut-data">Micronaut Data</a></h4>
<div class="paragraph">
<p>The <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/" target="_blank" rel="noopener">Micronaut Data</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
persistence module is used by this framework to help you persist your data.
We use the <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/#jdbc" target="_blank" rel="noopener">Micronaut Data JDBC</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
approach to avoid bringing in Hibernate or too many JPA modules.</p>
</div>
<div class="paragraph">
<p>Why Micronaut Data?  Simply, the GORM/Hibernate approach is very complex and brings in many
dependencies.  The most important problems include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Sessions</strong> - Hibernate sessions are needed to access the database.  Micronaut/Jackson tends to
access the fields/proxies in other threads, outside of sessions.  This triggers the
common 'no session for current thread' exceptions.  This problem forced us to add many
work-arounds to add sessions to many locations.</p>
</li>
<li>
<p><strong>Interceptor</strong> Issues - GORM/Hibernate supports a save interceptor.  The problem is that it was
not very reliable.</p>
</li>
<li>
<p><strong>Session Cache</strong> - The session cache is awesome and painful. Just search the web for
"why I hate Hibernate".  We don&#8217;t hate hibernate, but the session cache can easily
get out of synch with reality.  That causes data corruption issues or bewildering
exceptions. <em>NonUniqueObjectException</em>, <em>DuplicateKeyException</em> and
<em>HibernateSystemException</em> are just a few of the hard-to-debug issues.</p>
</li>
<li>
<p><strong>Unsaved Data</strong> - Hibernate has a great feature that skips updates if no columns are changed.
This causes problems when the changes are made that Hibernate is not aware of.
This forced us to change fields, just to trigger the update and the event interceptor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because of these fragility issues, we decided to move closer to JDBC/SQL by using Micronaut Data.
This means we had to add some usability features (e.g. <code>save()</code> methods on <em>@DomainEntity</em>, etc).
But, the odd and bewildering exceptions for Hibernate are gone.</p>
</div>
<div class="paragraph">
<p>We found that very few of the Hibernate features were very important.  This includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lazy Loading or Proxying of Associations - Important, but we added work-arounds for
the key cases (<a href="#simple-foreign-reference">Simple Foreign Reference</a> and <a href="#parent-child-one-to-many">Parent/Child Relationships (One-To-Many)</a>.</p>
</li>
<li>
<p>Optimistic <a href="#locking">Locking</a> - We implemented a work-around for this too.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The features we did not really need include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dirty Checking - Not important for most application scenarios.</p>
</li>
<li>
<p>Persistence Contexts / Sessions - More of a problem than a feature.</p>
</li>
<li>
<p>First Level Caching - Useful, but not as critical as originally thought.
This lack makes the application code a little more complex to pass around the values.</p>
</li>
<li>
<p>Second Level Caching - Only used in a few places, so we decided to implement in those places
specifically (e.g. UserPreference).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The drawbacks for Hibernate out-weighed the benefits, so we migrated to a simpler solution.</p>
</div>
</div>
<div class="sect3">
<h4 id="domain-entities"><a class="link" href="#domain-entities">Domain Entities</a></h4>
<div class="paragraph">
<p>You define domain entities using annotations from <a href="#micronaut-data">Micronaut Data</a> and this enterprise framework.
These annotations, along with repositories (see <a href="#repository-requirements">Repository Requirements</a>), provide a simplified
API on the domain to process domain records.  It adds methods such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>save()</p>
</li>
<li>
<p>delete()</p>
</li>
<li>
<p>withTransaction()</p>
</li>
<li>
<p>Lazy loaders for <a href="#simple-foreign-reference">Simple Foreign Reference</a> and <a href="#parent-child-one-to-many">Parent/Child Relationships (One-To-Many)</a></p>
</li>
<li>
<p>Access to all repository interface methods (e.g. list(), findBy&#8230;&#8203;()  and others))</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not call the repository <code>save()</code>, <code>update()</code> or <code>delete()</code> methods directly.  There
      are a number of features such as <a href="#searching">Searching</a> that will not work when the repository methods
      are called directly.  You should use the convenience methods on the domain.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A short example is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Example - Simple Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@MappedEntity</span>
<span class="annotation">@DomainEntity</span>
<span class="type">class</span> <span class="class">Order</span> {
  <span class="predefined-type">String</span> order
  Product product
  <span class="annotation">@Id</span> <span class="annotation">@AutoPopulated</span> <span class="predefined-type">UUID</span> uuid  <i class="conum" data-value="1"></i><b>(1)</b>
}

<span class="type">interface</span> OrderRepository <span class="directive">extends</span> BaseRepository, CrudRepository&lt;Order, <span class="predefined-type">UUID</span>&gt; {
  Optional&lt;Order&gt; findByOrder(<span class="predefined-type">String</span> order)  <i class="conum" data-value="2"></i><b>(2)</b>
  Optional&lt;Order&gt; findByUuid(<span class="predefined-type">UUID</span> uuid)
  <span class="predefined-type">List</span>&lt;Order&gt; list()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Required for all domains.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Exposed in the domain as <code>Order.findByOrder()</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="reserved-domain-names"><a class="link" href="#reserved-domain-names">Reserved Domain Names</a></h4>
<div class="paragraph">
<p>This framework has features that slightly restrict the name of the domain classes you can created.
This is mainly because of the way <a href="#Markers and Models">[Markers and Models]</a> work.  A few names are used
to store elements in the marker model (a Map).  You should avoid the names
used by the <a href="#StandardModelAndView">[StandardModelAndView]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="domain-requirements"><a class="link" href="#domain-requirements">Domain Requirements</a></h4>
<div class="paragraph">
<p>There are a few requirements needed to implement domains in this framework:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A UUID identifier with the name <em>'uuid'</em>.  DB column type is <em>uuid</em>.</p>
</li>
<li>
<p>A version field (integer) for optimistic <a href="#locking">Locking</a>.</p>
</li>
<li>
<p>See <a href="#repository-requirements">Repository Requirements</a> for more requirements on the domain&#8217;s repository.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="duplicate-data-sub-classes"><a class="link" href="#duplicate-data-sub-classes">Duplicate Data (Sub-Classes)</a></h4>
<div class="paragraph">
<p>Sometimes, you have common features that have the same fields in two or more related domains.
Normally, you could use inheritance to define a common base class with the common fields.
This would reduce the duplicate code to define the fields in multiple places.
The enterprise framework could use this with the common fields used by the
<a href="groovydoc/org/simplemes/eframe/custom/domain/FlexField.html" target="_blank" rel="noopener">FlexField</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
and
<a href="groovydoc/org/simplemes/eframe/custom/domain/FieldExtension.html" target="_blank" rel="noopener">FieldExtension</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.</p>
</div>
<div class="paragraph">
<p>Micronaut-data currently does not really support use of sub-classes as domain classes.
This means you will have to duplicate the fields in both domains.</p>
</div>
<div class="paragraph">
<p>This duplication is not as bad as it seems.  Domains are usually simple data objects
with no real behavior.  Any common logic should be placed in a common service that can act
on the related domains.   You should use a normal interface to define the getters/setters for
the common fields. This will let the service work with all of the related domains.</p>
</div>
<div class="paragraph">
<p>This also has one other side-effect: the domains will be stored in separate tables.  This could be
avoided with some annotations, if needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="field-names"><a class="link" href="#field-names">Field Names</a></h4>
<div class="paragraph">
<p>Almost every piece of text displayed in a web-based GUI should be translatable to the user&#8217;s language.
Since most of the fields in your domain classes will be displayed somewhere, the framework uses
some labelling conventions to reduce the boiler-plate code in your application.</p>
</div>
<div class="paragraph">
<p>Most of the GUI markers will determine the right label needed for a domain field based on the field&#8217;s
name.  For example, if you want to display a list of orders, you would use the
<a href="#efDefinitionList">[efDefinitionList]</a> marker in your pages like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="error">&lt;</span>@efDefinitionList columns=&quot;order,product,status,qtyToBuild&quot;/<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>messages.properties</em> file for you application would include these entries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">order.label=Order
orders.label=Orders
product.label=Product
status.label=Status
qtyToBuild.label=Quantity To Build</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the plural form of <em>"Order"</em> that is used for fields that show multiples
(e.g. for the list&#8217;s message <em>'1 to 8 of 200 Orders'</em>).  Most fields will not use a plural,
but they are used frequently for the top-level domain elements in GUI lists.</p>
</div>
<div class="paragraph">
<p>If you have not defined the entry in the <em>messages.properties</em> file, then the framework will
show the key (<em>'order.label'</em>, etc).</p>
</div>
</div>
<div class="sect3">
<h4 id="reserved-field-names"><a class="link" href="#reserved-field-names">Reserved Field Names</a></h4>
<div class="paragraph">
<p><a href="#micronaut-data">Micronaut Data</a> and this framework use several domain field names for internal use and
your domains must have them:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The internal database UUID field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of the record in the DB.  Used for optimistic locking.  Automatically maintained by the framework.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="key-fields"><a class="link" href="#key-fields">Key Fields</a></h4>
<div class="paragraph">
<p>All domain objects in most enterprise applications need some sort of key field definitions.
These are the specific key(s) needed to find and uniquely identify the object.  A common
example is an order object.  It will have a unique order name (ID) that
customers will reference when creating or working with the order.</p>
</div>
<div class="paragraph">
<p>A number of the framework features rely on this key field definition to make your application
coding simpler.  For example, the <a href="#efDefinitionList">[efDefinitionList]</a> marker relies on the key field
to implement the standard filter/search feature and
the hyper-links in lists.</p>
</div>
<div class="sect4">
<h5 id="identifying-key-fields-in-your-domain-classes"><a class="link" href="#identifying-key-fields-in-your-domain-classes">Identifying Key Fields in Your Domain Classes</a></h5>
<div class="paragraph">
<p>In all domains, you usually have one or more key fields.
This framework uses the <a href="#field-ordering">Field Ordering</a> mechanism and optional <code>keys</code> definitions to flag the right
key fields. For example, a work center domain might look like this:</p>
</div>
<div class="listingblock">
<div class="title">Example - Key Fields from fieldOrder</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">WorkCenter</span> {
  <span class="predefined-type">String</span> workCenter
  <span class="predefined-type">String</span> title

  <span class="directive">static</span> fieldOrder = [<span class="string"><span class="delimiter">'</span><span class="content">workCenter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the key field is assumed to be the <code>workCenter</code> field.</p>
</div>
<div class="paragraph">
<p>Sometimes, your <code>fieldOrder</code> list does not start with the key field, or you have two key fields.
This can be done with the <code>keys</code> static field:</p>
</div>
<div class="listingblock">
<div class="title">Example - Key Fields from keys static field</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Order</span> {
  <span class="predefined-type">String</span> order
  Customer customer
  <span class="predefined-type">BigDecimal</span> qtyToBuild = <span class="float">1.0</span>

  <span class="directive">static</span> fieldOrder = [<span class="string"><span class="delimiter">'</span><span class="content">customer</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">qtyToBuild</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">status</span><span class="delimiter">'</span></span>]

  <span class="directive">static</span> keys = [<span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>]  <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>keys</code> values are used to find the key field.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="primary-key-field"><a class="link" href="#primary-key-field">Primary Key Field</a></h5>
<div class="paragraph">
<p>Many of this module&#8217;s features require a single primary key field to reduce boiler-plate code.
For example, the <a href="#json-by-key">@JSONByKey</a> mechanism uses the primary key field to find other domain objects
when creating a foreign reference.  This is much simpler when you have a single key field.</p>
</div>
<div class="paragraph">
<p>To find this primary key field, the framework assumes the first key field is the primary
key field.</p>
</div>
<div class="paragraph">
<p>If you have domains with multiple key fields, then you should avoid using features like
<a href="#json-by-key">@JSONByKey</a>.  You will most likely get a domain record not found if you try to de-serialize
using <a href="#json-by-key">@JSONByKey</a> with multiple key fields.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unlimited-length-string-fields"><a class="link" href="#unlimited-length-string-fields">Unlimited Length String Fields</a></h4>
<div class="paragraph">
<p>Sometimes, you need an unlimited length text field in your domains.  To do this, you will need
to specify the column type for the DB:</p>
</div>
<div class="listingblock">
<div class="title">Example - Unlimited Length Field</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="annotation">@Column</span>(nullable = <span class="predefined-constant">true</span>)
  <span class="annotation">@MappedProperty</span>(type = DataType.STRING, definition = <span class="string"><span class="delimiter">'</span><span class="content">TEXT</span><span class="delimiter">'</span></span>)
  <span class="predefined-type">String</span> preferencesText</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="field-ordering"><a class="link" href="#field-ordering">Field Ordering</a></h4>
<div class="paragraph">
<p>Frequently, the framework features will need to list or display your domain fields in a logical order.
Framework markers such as <a href="#efShow">[efShow]</a> will show the fields in any order you like, but you would have to
update the <code>&lt;@efShow/&gt;</code> marker for every new field added to the domain class.
To simplify this maintenance task, the framework supports an optional
<a href="reference.html#field-order" target="_blank" rel="noopener">fieldOrder</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
static variable in domain classes.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Philosophical Discussion Ahead!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Field ordering is not traditionally part of a domain class&#8217;s definition.  Following the
'Don&#8217;t Repeat Yourself' philosophy, a central place to store the field ordering
'hints' is needed.  We chose the domain class. This is optional. If you don&#8217;t want to embed field
ordering in your domain classes, then you can specify the field ordering on the respective
<a href="reference.html#efshow">efShow</a> markers in your HTML files.  This means updating 3  files
whenever you add a new field to a domain class.  This is your choice.</p>
</div>
<div class="paragraph">
<p>See <a href="reference.html#field-order" target="_blank" rel="noopener">fieldOrder</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="clientdefaults"><a class="link" href="#clientdefaults">clientDefaults</a></h4>
<div class="paragraph">
<p>To make life easier for the end users, we provide several mechanisms for default values.
The simplest is the default value in the domain fields (e.g. <em>String title="ABC"</em>).
This works well for most cases, but fails for some client-side use cases.  In particular,
the adding of new rows in inline grids on the client requires some special client-side
processing.</p>
</div>
<div class="paragraph">
<p>To support this client-side default mechanism, you can add a static property to your domain
to provide the default values.  For example, the fields for <a href="#flex-types">Flex Types</a> uses as sequence
default to reduce the user input on the client.  This is defined in the FlexField using
this definition:</p>
</div>
<div class="listingblock">
<div class="title">Example - clientDefaults</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">FlexField</span> {
  BasicFieldFormat fieldFormat = StringFieldFormat.instance  <i class="conum" data-value="1"></i><b>(1)</b>
  HistoryTracking historyTracking = HistoryTracking.NONE

  <span class="directive">static</span> clientDefaults = [<span class="key">sequence</span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">_max('sequence')+10</span><span class="delimiter">&quot;</span></span>,  <i class="conum" data-value="2"></i><b>(2)</b>
                           <span class="key">fieldName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">'field'+(_max('sequence')+10)</span><span class="delimiter">&quot;</span></span>] <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Normal server-side default value for two enum fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the current max 'sequence' from the inline grid rows and adds 10.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creates a string <code>fieldName</code> using like <em>'field20'</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>_max()</code> method is defined for the inline grid client-side element.  The default
string is javascript than is executed on the client when the user clicks the 'Add'
row button.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The clientDefaults will override the normal field default values when
      both are defined for the domain class.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="supported-annotations"><a class="link" href="#supported-annotations">Supported Annotations</a></h4>
<div class="paragraph">
<p>There are many annotations that the enterprise framework has been tested with <a href="#micronaut-data">Micronaut Data</a>.
This includes:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 95%;">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@MappedEntity</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micronaut</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a domain object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Transactional</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA/Jakarta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a method (or all methods) are transactional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Column</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA/Jakarta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the column name, length and nullable flag (<strong>nullable default</strong>: true).
                         <strong>Note:</strong> If this is used with <em>@Nullable</em>, then the <em>@Column</em> setting takes precedence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Nullable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marks a field as nullable.  <em>@Column</em> is a better choice.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@ManyToMany</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA/Jakarta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a link between two domains in a many-to-many relationship.  Uses a join table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@ManyToOne</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA/Jakarta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the child side of a <a href="#parent-child-one-to-many">Parent/Child Relationships (One-To-Many)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@OneToMany</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA/Jakarta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the parent side of a <a href="#parent-child-one-to-many">Parent/Child Relationships (One-To-Many)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@Join</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micronaut</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the join logic for a query.  Suggested to only use on required foreign reference fields.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@ID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micronaut</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marks a field as the ID field.  Only UUID is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@GeneratedValue</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micronaut</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marks the field as auto-generated by the <a href="#micronaut-data">Micronaut Data</a> layer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@DateCreated</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micronaut</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the date/time the record was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@DateUpdated</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micronaut</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the date/time the record was last updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>@MappedProperty</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Micronaut</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the SQL type for the column.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="repository-requirements"><a class="link" href="#repository-requirements">Repository Requirements</a></h4>
<div class="paragraph">
<p><span class="inline-toc"><a href="#standard-repository-methods">Standard Repository Methods</a></span></p>
</div>
<div class="paragraph">
<p>A repository is a <a href="#micronaut-data">Micronaut Data</a> mechanism to access your data.  These repositories follow a
number common patterns such as extending specific interfaces and implementing specific methods.
Most methods in the repository are automatically added to your domain class, so you rarely need
to use the repository directly.</p>
</div>
<div class="paragraph">
<p>Base interfaces include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BaseRepository</p>
</li>
<li>
<p>CrudRepository&lt;<em>Domain</em>, UUID&gt;</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not call the repository <code>save()</code>, <code>update()</code> or <code>delete()</code> methods directly.  There
      are a number of features such as <a href="#searching">Searching</a> that will not work when the repository methods
      are called directly.  You should use the convenience methods on the domain.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="standard-repository-methods"><a class="link" href="#standard-repository-methods">Standard Repository Methods</a></h5>
<div class="paragraph">
<p><a href="#micronaut-data">Micronaut Data</a> provides access to the database records using a number of naming patterns.
If your repository interface has a method that matches one of these patterns, then the SQL
will be generated automatically.</p>
</div>
<div class="paragraph">
<p>Some of the standard methods expected are:</p>
</div>
<div class="listingblock">
<div class="title">Example - Methods for most top-level domain repositories</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> OrderRepository <span class="directive">extends</span> BaseRepository, CrudRepository&lt;Order, <span class="predefined-type">UUID</span>&gt; {
  Optional&lt;Order&gt; findByUuid(<span class="predefined-type">UUID</span> uuid)  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="predefined-type">List</span>&lt;Order&gt; list(<span class="predefined-type">Pageable</span> pageable) <i class="conum" data-value="2"></i><b>(2)</b>

  Optional&lt;Order&gt; findByOrder(<span class="predefined-type">String</span> name) <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="predefined-type">List</span>&lt;Order&gt; list()  <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Reads a single record for the given ID. Used by many framework functions to find related records.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Finds all records (with paging/sorting support).  Used by <a href="#basecrudcontroller">BaseCrudController</a> to find records
for the List <a href="#Definition Pages">[Definition Pages]</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Find by primary key.  Not used in framework, but useful for some application logic.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Lists all records. Not used in framework, but useful for some application logic and debugging.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Most top-level domains that have List <a href="#Definition Pages">[Definition Pages]</a> should provide the <code>list(Pageable)</code> and
<code>count()</code> methods.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="event-methods"><a class="link" href="#event-methods">Event Methods</a></h4>
<div class="paragraph">
<p>The object life-cycle events methods are called when certain events take place:</p>
</div>
<div class="paragraph">
<p><span class="inline-toc"><a href="#validate-method">validate Method</a></span>
<span class="inline-toc"><a href="#beforevalidate-method">beforeValidate Method</a></span>
<span class="inline-toc"><a href="#beforesave-method">beforeSave Method</a></span>
<span class="inline-toc"><a href="#beforedelete-method">beforeDelete Method</a></span></p>
</div>
</div>
<div class="sect3">
<h4 id="validate-method"><a class="link" href="#validate-method">validate Method</a></h4>
<div class="paragraph">
<p>You can add domain-specific validations to your domains with the <code>validate()</code> method:</p>
</div>
<div class="listingblock">
<div class="title">Example - validate Method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">validate</span>() {
  <span class="keyword">if</span> (fieldName &amp;&amp; !NameUtils.isLegalIdentifier(fieldName)) {
    <span class="comment">//error.201.message=&quot;{1}&quot; is not a legal custom field name.  Must be a legal Java variable name.</span>
    <span class="keyword">return</span> <span class="keyword">new</span> ValidationError(<span class="integer">201</span>, <span class="string"><span class="delimiter">'</span><span class="content">fieldName</span><span class="delimiter">'</span></span>, fieldName)  <i class="conum" data-value="1"></i><b>(1)</b>
  }
  <span class="keyword">return</span> <span class="predefined-constant">null</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Validation failures can return a ValidationError or a List&lt;ValidationError&gt;.  Returning
<strong>null</strong> means no errors were found.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beforevalidate-method"><a class="link" href="#beforevalidate-method">beforeValidate Method</a></h4>
<div class="paragraph">
<p>Sometimes you need to execute some logic in your domain class before <code>validate()</code> is called.
For example, you need to encrypt a password on save/validate.  If you define a <code>beforeValidate()</code>
method on your domain, then it will be executed by the helper&#8217;s <code>validate()</code> method.  For example:</p>
</div>
<div class="listingblock">
<div class="title">Example - beforeValidate Method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">beforeValidate</span>() {
  encryptPassword()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will call the <code>encryptPassword()</code> before the validation is performed on the domain.</p>
</div>
</div>
<div class="sect3">
<h4 id="beforesave-method"><a class="link" href="#beforesave-method">beforeSave Method</a></h4>
<div class="paragraph">
<p>Sometimes you need to execute some logic in your domain class before every <code>save()</code>.  For example,
you need to encrypt a password on save.  If you define a <code>beforeSave()</code> method on your
domain, then it will be executed by the domain&#8217;s <code>save()</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="beforedelete-method"><a class="link" href="#beforedelete-method">beforeDelete Method</a></h4>
<div class="paragraph">
<p>Sometimes you need to execute some logic in your domain class before every <code>delete()</code>.
For example, you need to remove related records from other domains.</p>
</div>
<div class="listingblock">
<div class="title">Example - beforeDelete Method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">beforeDelete</span>() {
  FieldGUIExtension.removeReferencesToField(domainClassName, fieldName)
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transactions"><a class="link" href="#transactions">Transactions</a></h4>
<div class="paragraph">
<p>Database transactions are critical to enterprise applications.  The data must be saved in a
consistent state across several domains.  To support this, the framework uses <a href="#micronaut-data">Micronaut Data</a>
for database access and forces transactions around all database updates/insert/deletes.</p>
</div>
<div class="paragraph">
<p>Most transactions are initiated at the <a href="#services">Services</a> layer, but also sometimes in the controllers.
You can use the <em>@Transactional</em> annotation in beans or the <code>withTransaction()</code> method.</p>
</div>
<div class="listingblock">
<div class="title">Example withTransaction Usage</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Order.withTransaction {  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="keyword">def</span> order = Order.findByOrder(<span class="string"><span class="delimiter">'</span><span class="content">1234</span><span class="delimiter">'</span></span>)
  ResolveWorkableRequest req = <span class="keyword">new</span> ResolveWorkableRequest(<span class="key">lsn</span>: order.lsns[<span class="integer">0</span>], <span class="key">order</span>: order)
  <span class="keyword">def</span> workable = resolveService.resolveWorkable(req)[<span class="integer">0</span>]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Starts the transaction, if not already in a DB transaction.  This reads a domain that is passed
to the service method.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The framework checks for an active transaction on every insert/update/delete SQL statement.
      You will need to wrap those database method calls with <em>@Transactional, @Rollback</em> or
      withTransaction.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>@Transactional</em> annotation only works in classes that are processed as beans in Micronaut.
This means you can&#8217;t use this annotation in most test classes or in POGO/POJO logic.</p>
</div>
<div class="sect4">
<h5 id="transactions-and-prepared-statements"><a class="link" href="#transactions-and-prepared-statements">Transactions and Prepared Statements</a></h5>
<div class="paragraph">
<p>Some internal logic in the framework needs to be executed in a transaction.  This is done
to avoid a DB connection leak that happens with PreparedStatements.  This means sometimes you
may need to wrap some logic with a transaction.  If you find an IllegalStateException
with the note: <em>'No active transaction for SQL statement'</em>, then you may need to wrap the logic
with a transaction.</p>
</div>
<div class="paragraph">
<p>The most common cases are automatically wrapped when needed in the framework.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="locking"><a class="link" href="#locking">Locking</a></h4>
<div class="paragraph">
<p>Database locking is a tricky subject.  We take a very simplistic approach to locking:
Most updates take place using optimistic locking with a <code>version</code> field.
Pessimistic locking is possible with a specific query annotation.</p>
</div>
<div class="paragraph">
<p>Also, we enforce that all UPDATE/INSERT SQL requests must be in a database transaction.</p>
</div>
<div class="sect4">
<h5 id="optimistic-locking"><a class="link" href="#optimistic-locking">Optimistic Locking</a></h5>
<div class="paragraph">
<p>Optimistic locking is handled by altering the update queries to add <em>'and version = :version'</em> and
to increment the version during the update.  This means an exception will be thrown if a
version field is not given or the record was updated by another user.</p>
</div>
<div class="paragraph">
<p>This optimistic locking check is done on every update of a single record that has a
<code>version</code> field.  An exception will be thrown if another user has updated the record.</p>
</div>
</div>
<div class="sect4">
<h5 id="pessimistic-locking"><a class="link" href="#pessimistic-locking">Pessimistic Locking</a></h5>
<div class="paragraph">
<p>Pessimistic locking is handled by using an explicit SQL query in your repository.
You must handle this in your application code. For example:</p>
</div>
<div class="listingblock">
<div class="title">Example - Pessimistic Locking</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> LSNSequenceRepository <span class="directive">extends</span> BaseRepository, CrudRepository&lt;LSNSequence, <span class="predefined-type">UUID</span>&gt; {
  <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from lsn_sequence o where o.uuid = :uuid for update </span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b>
  Optional&lt;LSNSequence&gt; findByUuidWithLock(<span class="predefined-type">UUID</span> uuid)  <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Forces a lock on the record when read.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We recommend that you add <em>'withLock'</em> on the method name.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will place the lock on the record when the query is executed.  It also means the lock
record values are returned with the <code>find()</code> method.  This prevents all other users from
changing this record until you commit/rollback the transaction.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sql-database-definition"><a class="link" href="#sql-database-definition">SQL Database Definition</a></h4>
<div class="paragraph">
<p><span class="inline-toc"><a href="#db-creation-scripts">DB Creation Scripts</a></span>
<span class="inline-toc"><a href="#indexes-and-constraints">Indexes and Constraints</a></span></p>
</div>
<div class="sect4">
<h5 id="db-creation-scripts"><a class="link" href="#db-creation-scripts">DB Creation Scripts</a></h5>
<div class="paragraph">
<p>The database for production/development/test is Postgres SQL.  This framework uses the
<a href="https://flywaydb.org/" target="_blank" rel="noopener">Flyway Database Migration</a> for creation and migration of the SQL schema
used in Postgres.  The DDL scripts are stored in these directories.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>src/main/resources/db/migration</strong> - The production tables.</p>
</li>
<li>
<p><strong>src/main/resources/db/sampleMigration</strong> - Scripts for creation of sample/test tables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inside of these folders are files such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>V1_0_0__CreateTables.sql</strong> - The base scripts to create the tables for the 1.0 release.</p>
</li>
<li>
<p><strong>V2_0_0__CreateTables.sql</strong> - The base scripts to create the tables for the 2.0 release.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Flyway will only run a given SQL file against the schema one time.  If you later change the file,
then it will log an error.  To avoid this, we use the last digit as a counter to allow multiple
files to be created over time within a single release.
The last digit of the release (e.g. 0 in V1_2_0) is an incremental counter used to make sure the
files are unique.  This allows developers to add new tables during development of the 1.2 release.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use the Flyway <code>repair</code> command to help with this issue.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="indexes-and-constraints"><a class="link" href="#indexes-and-constraints">Indexes and Constraints</a></h5>
<div class="paragraph">
<p>SQL databases use indexes and constraints to help control relationships between tables.
For the framework and application modules, we try to use these base rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>PRIMARY KEY</strong> - This is the UUID for the record.  Every record has one (except for many-to-many
join tables).</p>
</li>
<li>
<p><strong>FOREIGN KEY</strong> - A UUID field that references a record in another table.  This key almost
always has an index created for it.  This is usually implemented as a <strong>REFERENCES</strong>
option in the .sql file. These generally have indexes created in the .sql
for speed.</p>
</li>
<li>
<p><strong>UNIQUE</strong>      - A unique constraint.  This is usually done on the natural key for the table.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="relationships"><a class="link" href="#relationships">Relationships</a></h4>
<div class="paragraph">
<p><span class="inline-toc"><a href="#simple-foreign-reference">Simple Foreign Reference</a></span>
<span class="inline-toc"><a href="#parent-child-one-to-many">Parent/Child Relationships (One-To-Many)</a></span>
<span class="inline-toc"><a href="#many-to-many-relationships">Many-to-Many Relationships</a></span></p>
</div>
<div class="paragraph">
<p>Domain relationships are generally defined in the domain classes and handled with the
<em>@DomainEntity</em> annotation.  This annotation adds the correct save(), delete and lazy loader
methods for some of the more common relationships.</p>
</div>
</div>
<div class="sect3">
<h4 id="simple-foreign-reference"><a class="link" href="#simple-foreign-reference">Simple Foreign Reference</a></h4>
<div class="paragraph">
<p>Simple foreign references are supported by the framework.  This means your domains can refer
to other domains and access the other domain&#8217;s members as needed.  To do this, you have
to define your domain in a very specific way:</p>
</div>
<div class="listingblock">
<div class="title">Example - Simple Foreign Reference</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@MappedEntity</span>
<span class="annotation">@DomainEntity</span>
<span class="type">class</span> <span class="class">Order</span> {
  <span class="annotation">@ManyToOne</span>(targetEntity=Product)  <i class="conum" data-value="1"></i><b>(1)</b>
  Product product
}

<span class="type">class</span> <span class="class">OrderService</span> {
  <span class="type">void</span> validate(Order order) {
    <span class="keyword">if</span> (order.product.lotSize&gt; <span class="float">1.0</span>) {  <i class="conum" data-value="2"></i><b>(2)</b>
      thrown <span class="keyword">new</span> <span class="exception">Exception</span>(...)
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines the reference as a simple foreign reference.  The targetEntity is required  for simple
foreign references.   This distinguishes it from a <a href="#parent-child-one-to-many">Parent/Child Relationships (One-To-Many)</a>
relationship.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Reads the product record on first access.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This adds a lazy loader mechanism in the <code>getProduct()</code> method.  On first access, this will read
the Product (if not-null).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This <em>targetEntity</em> is used as a marker for a simple foreign reference.  Do not use
      the <em>targetEntity</em> option for <a href="#parent-child-one-to-many">Parent/Child Relationships (One-To-Many)</a> relationships.
      This is the mechanism for distinguishing between simple references and the
      parent side in parent/child relations.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="join-and-nullable-references"><a class="link" href="#join-and-nullable-references">Join and Nullable References</a></h5>
<div class="paragraph">
<p>A simple foreign reference is handled by Micronaut-Data in different ways depending on whether
the reference is nullable.  Nullable references require the use of the SQL OUTER <em>@Join</em> option.
Non-nullable references can use the LEFT join logic:</p>
</div>
<div class="listingblock">
<div class="title">Example - Non-nullable Foreign Reference</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> OrderRepository <span class="directive">extends</span> BaseRepository, CrudRepository&lt;Order, <span class="predefined-type">UUID</span>&gt; {
  <span class="annotation">@Join</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>, type = Join.Type.LEFT)  <i class="conum" data-value="1"></i><b>(1)</b>
  Optional&lt;Order&gt; findByUuid(<span class="predefined-type">UUID</span> uuid)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This will read the Product record using an SQL join.  It can be accessed with <em>order.product&#8230;&#8203;</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This works fine for non-nullable fields.  To make it work for nullable fields, we need
to use the OUTER join mechanism.  To access
the Product record in that case, you would need to add <code>findByUuid()</code> calls in your code.</p>
</div>
<div class="paragraph">
<p>To avoid this extra code, the enterprise framework will add a simple lazy-loading
getter method to your domain class. This will load the foreign reference on its first access.</p>
</div>
<div class="paragraph">
<p>If you do use <em>@Join</em> with your finders, then this lazy loading will avoid an extra DB read
as long as you have a <code>dateCreated</code> property in your domain class.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parent-child-one-to-many"><a class="link" href="#parent-child-one-to-many">Parent/Child Relationships (One-To-Many)</a></h4>
<div class="paragraph">
<p>Parent/Child relationships are quite common in enterprise applications.  The children are
fully-owned by the parent.  Updates and deleting on the parent should update/delete the children.</p>
</div>
<div class="paragraph">
<p>The <em>@DomainEntity</em> annotation will add a lazy loader method (e.g. <code>getChildren()</code> in the example
below).  This loader uses the <code>findAllByParent()</code> method in the repository.</p>
</div>
<div class="listingblock">
<div class="title">Example - Parent/Child Relationships (One-to-Many)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@MappedEntity</span>
<span class="annotation">@DomainEntity</span>
<span class="type">class</span> <span class="class">Parent</span> {
  <span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">parent</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">List</span>&lt;Child&gt; children  <i class="conum" data-value="1"></i><b>(1)</b>
}

<span class="annotation">@MappedEntity</span>
<span class="annotation">@DomainEntity</span>
<span class="type">class</span> <span class="class">Child</span> {
  <span class="annotation">@ManyToOne</span>
  Parent parent  <i class="conum" data-value="2"></i><b>(2)</b>
}

<span class="type">interface</span> ChildRepository <span class="directive">extends</span> BaseRepository, CrudRepository&lt;Child, <span class="predefined-type">UUID</span>&gt; {
  <span class="predefined-type">List</span>&lt;Child&gt; findAllByParent(Parent parent) <i class="conum" data-value="3"></i><b>(3)</b>
  Optional&lt;Child&gt; findById(<span class="predefined-type">UUID</span> uuid)
  <span class="predefined-type">List</span>&lt;Child&gt; list()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The child list must default to null, not an empty list. The lazy loader sets the field
to an empty list when no records are found in the DB.
This reference either needs a parameterized <em>List&lt;&gt;</em> type or the <em>@OneToMany</em> needs to
specify a <code>targetEntity</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The reference to the parent record is one of the primary keys in the child record.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The finder <code>findByXYZ()</code> must be defined to find the child records.  This is used by the lazy
loader.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On the @<em>ManyToOne</em> annotation, do not use <em>targetEntity</em>.  It is used as a marker for a
      <a href="#simple-foreign-reference">Simple Foreign Reference</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also, if the child class implements the Java Comparable interface, then the list will be sorted
before it is saved and after it is loaded.  Do not implement this interface if the list is likely
to be huge (&gt;1000 records).</p>
</div>
</div>
<div class="sect3">
<h4 id="many-to-many-relationships"><a class="link" href="#many-to-many-relationships">Many-to-Many Relationships</a></h4>
<div class="paragraph">
<p>Many-to-Many relationships are implemented using a join table that contains a reference
to the parent and to the related record. This is sometimes referred to as a list of foreign
references. You can implement them in two different ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#many-to-many-join">Many-to-Many - Join</a> from a <code>find()</code> method.</p>
</li>
<li>
<p><a href="#many-to-many-lazy-loader">Many-to-Many - Lazy Loader</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can use either approach or a combination of the two.  If you don&#8217;t define a JOIN option
on the <code>find()</code> method, then you can still rely on the lazy loader to load the list on demand.
The <em>@DomainEntity</em> annotation adds the <code>save()</code> and <code>delete()</code> logic to handle this join table.</p>
</div>
<div class="paragraph">
<p>Both approaches require a <em>@ManyToMany</em> annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="many-to-many-join"><a class="link" href="#many-to-many-join">Many-to-Many - Join</a></h4>
<div class="paragraph">
<p>The Join approach requires the finders be defined with a <em>@Join</em> annotation to join the values from
the DB.  This uses the <em>@ManyToMany</em> annotation (from Jakarta) and a <em>@Join</em> annotation to
the <code>findBy&#8230;&#8203;()</code> method in your repository.</p>
</div>
<div class="paragraph">
<p>An example is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Example - User Many-to-Many Relationship</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">User</span> {
  <span class="annotation">@ManyToMany</span>(mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="content">userRole</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">List</span>&lt;<span class="predefined-type">Role</span>&gt; userRoles <i class="conum" data-value="1"></i><b>(1)</b>
}

<span class="type">interface</span> UserRepository <span class="directive">extends</span> BaseRepository, CrudRepository&lt;User, <span class="predefined-type">UUID</span>&gt; {
  <span class="annotation">@Join</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">userRoles</span><span class="delimiter">&quot;</span></span>, type = Join.Type.LEFT_FETCH)
  Optional&lt;User&gt; findByUserName(<span class="predefined-type">String</span> userName)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A null list allows the lazy loader logic to be used too.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will create a <code>user_role</code> table with a <code>user_id</code> and <code>role_id</code> field to link the two records.</p>
</div>
</div>
<div class="sect3">
<h4 id="many-to-many-lazy-loader"><a class="link" href="#many-to-many-lazy-loader">Many-to-Many - Lazy Loader</a></h4>
<div class="paragraph">
<p>The lazy loader approach is simpler.  It just requires the <em>@ManyToMany</em> annotation (from Jakarta).
On first access, the list of references will be loaded and the foreign domain will be populated.</p>
</div>
<div class="paragraph">
<p>An example is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Example - User Many-to-Many Relationship - No Join</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">User</span> {
  <span class="annotation">@ManyToMany</span>(cascade = CascadeType.ALL, mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="content">userRole</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">List</span>&lt;<span class="predefined-type">Role</span>&gt; userRoles <i class="conum" data-value="1"></i><b>(1)</b>
}

<span class="type">interface</span> UserRepository <span class="directive">extends</span> BaseRepository, CrudRepository&lt;User, <span class="predefined-type">UUID</span>&gt; {
  Optional&lt;User&gt; findByUserName(<span class="predefined-type">String</span> userName)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A null list allows the lazy loader logic to be used too.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will create a <code>users_role</code> table with a <code>user_id</code> and <code>role_id</code> field to link the two records.</p>
</div>
</div>
<div class="sect3">
<h4 id="choice-list"><a class="link" href="#choice-list">Choice List</a></h4>
<div class="paragraph">
<p>You will frequently need to present your user with a drop-down list of options to choose
from. This list can be fairly static, expandable or database-driven.</p>
</div>
<div class="paragraph">
<p>You can create these list in several ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#enumerations">Enumerations</a> (static list).</p>
</li>
<li>
<p><a href="#encoded-types">Encoded Types</a> - Expandable List - Code-Based (expandable in add-on modules).</p>
</li>
<li>
<p><a href="#database-values">Database Values</a>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="enumerations"><a class="link" href="#enumerations">Enumerations</a></h5>
<div class="paragraph">
<p>If you have a very static list of valid values, you can use an
enumeration.  Your enumeration should provide a <code>toStringLocalized()</code> method to help
generate the drop-down list.</p>
</div>
<div class="paragraph">
<p>The normal <a href="#Definition Pages">[Definition Pages]</a> support this type of field.</p>
</div>
<div class="paragraph">
<p>A simple example is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Example Enumeration - Enum Definition</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">enum</span> ReportTimeIntervalEnum <span class="directive">implements</span> <span class="predefined-type">Comparable</span> {
  TODAY( . . .),    <i class="conum" data-value="1"></i><b>(1)</b>
  YESTERDAY(. . .})
    . . .
  String toStringLocalized(<span class="predefined-type">Locale</span> locale = <span class="predefined-constant">null</span>) {    <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">return</span> GlobalUtils.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">reportTimeInterval.</span><span class="inline"><span class="inline-delimiter">${</span>name()<span class="inline-delimiter">}</span></span><span class="content">.label</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>, locale)
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The list of valid values.  These are displayed in the order they are defined here.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method that will generate a human-readable form of the enumeration for the drop-down list.
Typically based on a <code>lookup()</code> in the <em>messages.properties</em> file.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Enumeration - Domain Field</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Product</span> {
  ReportTimeIntervalEnum reportTimeInterval <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This creates a single column (normally 255 chars wide) to hold the enumeration&#8217;s <code>toString()</code> value.
For example <em>'LAST_24_HOURS'</em>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Enumeration - <em>messages.properties</em> File</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">reportTimeInterval.LAST_24_HOURS.label=Last <span class="integer">24</span> Hours
reportTimeInterval.LAST_7_DAYS.label=Last <span class="integer">7</span> Days
reportTimeInterval.LAST_30_DAYS.label=Last <span class="integer">30</span> Days
 . . .</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="encoded-types"><a class="link" href="#encoded-types">Encoded Types</a></h5>
<div class="paragraph">
<p>This is a list of values defined in your code, but it can be expanded by other modules.
This is commonly used for status codes that can be applied to a domain object.
Instead of using a separate domain class with a new database table, you define a class hierarchy
that defines all of the available status codes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Each module can define additional encoded types. See <a href="#encoded-types-provided-by-additions">Encoded Types Provided By Additions</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, you might have a <em>BasicStatus</em> that can be <em>EnabledStatus</em> or <em>DisabledStatus</em>.
You want these to be stored in an <em>Order</em> domain field like this:</p>
</div>
<div class="listingblock">
<div class="title">Example - BasicStatus Use</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Order</span> {
  <span class="predefined-type">String</span> key

  <span class="annotation">@Column</span>(length = <span class="integer">12</span>, nullable = <span class="predefined-constant">true</span>)
  <span class="annotation">@Nullable</span> BasicStatus status = EnabledStatus.instance <i class="conum" data-value="1"></i><b>(1)</b>
  BasicStatus status = EnabledStatus.instance

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A simple reference to the BasicStatus, with a default value.
The status database column will be a small length (12 chars in the example).
If not specified, then the column will default to 255 characters.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The mapping of the BasicStatus to a database column is handled automatically by the
custom <a href="groovydoc/org/simplemes/eframe/data/EncodedType.html" target="_blank" rel="noopener">EncodedType</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.</p>
</div>
<div class="paragraph">
<p>If you create custom EncodedTypes, then you will need to register the base class
(like BasicStatus above) in an <a href="#addition">Addition</a></p>
</div>
<div class="paragraph">
<p>Then your code that checks the status can be simple and clear:</p>
</div>
<div class="listingblock">
<div class="title">Example - BasicStatus Use</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> order = . . .
if (!order.status.enable) {
  <span class="keyword">throw</span> <span class="keyword">new</span> SomeException(<span class="string"><span class="delimiter">'</span><span class="content">Order is not enabled</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The GUI <a href="#Definition Pages">[Definition Pages]</a> will show these two options in a drop-down list with localized text (e.g. 'Enabled'
and 'Disabled').  When saved, the selected status is stored in an encoded column in the database
automatically.</p>
</div>
<div class="paragraph">
<p>This all works by defining your types correctly.   See
<a href="groovydoc/org/simplemes/eframe/system/BasicStatus.html" target="_blank" rel="noopener">BasicStatus</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> for an example.</p>
</div>
<div class="paragraph">
<p>The parent class for the encoded/choice list provides the main contact point for most of the GUI
and database features.  The sub-classes provide the individual choices in the list.  The parent
class must provide a list of valid values for the sub-classes defined in the core code.</p>
</div>
<div class="paragraph">
<p>The basic class structure is shown below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/encodedTypeExample.png" alt="encodedTypeExample" width="635" height="371">
</div>
<div class="title">Figure 9. EncodedTypeList and EncodedType Classes</div>
</div>
<div class="paragraph">
<p>This <a href="groovydoc/org/simplemes/eframe/system/BasicStatus.html" target="_blank" rel="noopener">BasicStatus</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> is used in the core framework and most
application modules.  These application modules define their own status codes (e.g.
<em>OrderStatus</em>) that are used throughout the application.  These include more states
such as <code>isDone()</code> and <code>isHold()</code>.   See the source code for details on
how to implement these types of statuses.</p>
</div>
<div class="paragraph">
<p>The <a href="groovydoc/org/simplemes/eframe/data/EncodedTypeListInterface.html" target="_blank" rel="noopener">EncodedTypeListInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> and
<a href="groovydoc/org/simplemes/eframe/data/EncodedTypeInterface.html" target="_blank" rel="noopener">EncodedTypeInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> are used to provide the valid choices and to store/retrieve
the value from the database.</p>
</div>
</div>
<div class="sect4">
<h5 id="database-values"><a class="link" href="#database-values">Database Values</a></h5>
<div class="paragraph">
<p>The most flexible approach to lists of valid values is to use a database reference.  This allows
your users to (normally) create new values of the records.  This is usually more work since
a new set of <a href="#Definition Pages">[Definition Pages]</a> must be built and tested.</p>
</div>
<div class="paragraph">
<p>In the example below, we will reference a <em>Product</em> from an <em>Order</em> record.</p>
</div>
<div class="listingblock">
<div class="title">Example Database Values - Product Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Product</span> {
  <span class="predefined-type">String</span> product
  <span class="predefined-type">String</span> title
   . . .
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Database Values - Order Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Order</span> {
  <span class="predefined-type">String</span> order
  <span class="predefined-type">BigDecimal</span> qty
  Product product  <i class="conum" data-value="1"></i><b>(1)</b>
   . . .
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The order is defined to build a certain qty of a <em>Product</em>.  This is the reference to
an existing domain object.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This <em>Product</em> is not a direct child of the <em>Order</em>.  The <em>Order</em> can be deleted and
      the <em>Product</em> will still be in the database.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This type of relationship will usually be displayed as a single-selection combobox in
the normal edit/create pages.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dates-and-timezones"><a class="link" href="#dates-and-timezones">Dates and Timezones</a></h4>
<div class="paragraph">
<p>Dates and timezones are a common problems with enterprise systems.  Most common SQL databases
don&#8217;t support timezones for values stored in the original SQL date/time columns.  Also, the GUI
toolkit doesn&#8217;t support timezones.  The toolkit doesn&#8217;t need to know the timezone since
the GUI elements don&#8217;t need it.</p>
</div>
<div class="paragraph">
<p>To keep the date/times consistent
in the database, we always force the time to be stored in the UTC timezone.  Then, when the date/time
is displayed to the user, a global UI timezone is used.
This global UI default timezone is set to eastern US timezone by default.</p>
</div>
<div class="paragraph">
<p>To make this work, the JVM&#8217;s default timezone is set to UTC by the StartupHandler.
This means the JDBC drivers and
the data layer will store the time in UTC.  Then, when the value is retrieved from the database and
sent to a client using JSON, the ISO date is sent with the timezone offset.  Then on the client,
the Javascript time is created by discarding the timezone offset.  This means the time will be
displayed by the toolkit with no adjustments.</p>
</div>
</div>
<div class="sect3">
<h4 id="toshortstring"><a class="link" href="#toshortstring">toShortString()</a></h4>
<div class="paragraph">
<p>Many GUI-related parts of the framework need a short, human-readable format of your domain objects.
For example, you want to display the Order ID in drop-down, but the <code>toString()</code> method
returns all of the order&#8217;s fields.  The framework supports a standardized <code>toShortString()</code>
method on most domains for this display.  This is normally a short string for the given object
(e.g. its primary key).</p>
</div>
<div class="paragraph">
<p>By default, this short string is usually just the first key field (as a string).
The <a href="groovydoc/org/simplemes/eframe/misc/TypeUtils.html" target="_blank" rel="noopener">TypeUtils</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> utility class provides an easy way to get this short string.</p>
</div>
<div class="paragraph">
<p>If the first key field is not suitable, then you can implement a <code>toShortString()</code> method.  This
is useful when the first key is another domain object.</p>
</div>
<div class="listingblock">
<div class="title">Example - toShortString()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Order</span> {
  <span class="predefined-type">String</span> toShortString() {
    <span class="keyword">return</span> order
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This mechanism allows you to use the normal <code>toString()</code> methods to display detailed information
for use in log messages.  The <code>TypeUtils.toShortString(object)</code> utility will use your
<code>toShortString()</code> method, if defined.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using a domain as a reference in a grid, then you should also implement
      <a href="#tostringlocalized">toStringLocalized()</a>.  This <code>toStringLocalized()</code> methoud could just call <code>toShortString()</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="tostringlocalized"><a class="link" href="#tostringlocalized">toStringLocalized()</a></h4>
<div class="paragraph">
<p>A number of places in the framework rely on the <code>toStringLocalized()</code> in the
<a href="groovydoc/org/simplemes/eframe/i18n/GlobalUtils.html" target="_blank" rel="noopener">GlobalUtils</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> utility class.
This allows the framework to provide a human-readable representation of your domain record for display.
For example, this is used in the <a href="#efDefinitionList">[efDefinitionList]</a> marker to build the
hyper-link text for the links generated.  Also, drop-down lists and archiving use this short
string format.</p>
</div>
<div class="paragraph">
<p>Most domains will not need to implement this method.  You won&#8217;t need to implement this methods
if your domain has a single key and it is the first field in the <a href="#field-ordering">fieldOrder</a>
static value.</p>
</div>
</div>
<div class="sect3">
<h4 id="dynamic-sql-preparedstatement"><a class="link" href="#dynamic-sql-preparedstatement">Dynamic SQL - PreparedStatement</a></h4>
<div class="paragraph">
<p>Sometimes, you just have to use SQL directly in your application code.  This is needed when
the <em>where</em> clause criteria is flexible and changes based on user input.  You will need to use
the SQL directly.  This framework provides some helper classes to make this easier.
It also tries to make sure you use safe and portable SQL capabilities.</p>
</div>
<div class="paragraph">
<p>If you need dynamic sorting, then we recommend you the <em>Pageable</em> support on most <code>list()</code>
repository methods.  See <a href="#standard-repository-methods">Standard Repository Methods</a> for an example.</p>
</div>
<div class="paragraph">
<p>The most common scenario is to use a dynamically-generated SQL statement to find domain records.
The framework provides a simplified way to handle the most common case:</p>
</div>
<div class="listingblock">
<div class="title">Example - PreparedStatement - Query with limits</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM LSN where order=?</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">def</span> list = SQLUtils.instance.executeQuery(sql,                   <i class="conum" data-value="2"></i><b>(2)</b>
                                          LSN,                   <i class="conum" data-value="3"></i><b>(3)</b>
                                          <span class="predefined-type">Pageable</span>.from(<span class="integer">0</span>, <span class="integer">20</span>),  <i class="conum" data-value="4"></i><b>(4)</b>
                                          order.uuid.toString()) <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We want to find a list of LSN records for the given Order (using UUID).
This SQL could be created based on dynamic needs.
See <a href="#sql-injection">SQL Injection</a> below for restrictions on this SQL query.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>execute()</code> method will execute the SQL, and return a list objects from the result set.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Domain object return (in a list).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The results are limited to the first 20 rows.  Default: Page 0, page size 100.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The parameters used in the SQL.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will return a list of objects that match the selection criteria.  You need to make sure
the SQL includes at least one replaceable parameter.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
To avoid SQL Inject attacks on your application, always use static SQL queries.
         Never build the SQL directly from user inputs.  This method will reject
         queries that look like they might be used for injection attacks.  See <a href="#sql-injection">SQL Injection</a>
         below for details.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To avoid connection leaks, the SQL must be executed in a transaction.
      This is enforced by the framework.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use <em>Map</em> as the result class in the query.  This makes simple SQL <em>COUNT(*)</em> cases
easier to use:</p>
</div>
<div class="listingblock">
<div class="title">Example - PreparedStatement - Simple Count Scenario</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> tableName = DomainEntityHelper.instance.getTableName(Order)  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">def</span> list = SQLUtils.instance.executeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT COUNT(*) as count FROM </span><span class="inline"><span class="inline-delimiter">${</span>tableName<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>) <i class="conum" data-value="2"></i><b>(2)</b>

<span class="keyword">def</span> count = list[<span class="integer">0</span>].count  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>Order</em> table name is <em>ordr</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We want to count the total number of records in the table.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The count is saved in a map in row 0, with a name of <em>'count'</em>.  The column name
is shifted to lowercase.  This handles databases that always return column names in upper case.
(e.g. Postgres).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an alternative, you can process the result set yourself if the normal binding mechanism
doesn&#8217;t handle the cases you need (complex joins, etc).</p>
</div>
<div class="listingblock">
<div class="title">Example - PreparedStatement - Use ResultSet Directly</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> list = <span class="type">[]</span>
<span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM LSN where order=?</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="predefined-type">PreparedStatement</span> ps
<span class="predefined-type">ResultSet</span> rs
<span class="keyword">try</span> {
  ps = SQLUtils.instance.getPreparedStatement(sql)
  ps.setString(<span class="integer">1</span>, order.getUuid().toString())
  ps.execute()
  rs = ps.getResultSet()
  <span class="keyword">while</span> (rs.next()) {  <i class="conum" data-value="2"></i><b>(2)</b>
    list &lt;&lt; SQLUtils.instance.bindResultSet(rs, LSN)  <i class="conum" data-value="3"></i><b>(3)</b>
  }
} <span class="keyword">finally</span> {  <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="keyword">try</span> {
    rs?.close()
  } <span class="keyword">catch</span> (<span class="exception">Exception</span> ignored) {  <i class="conum" data-value="5"></i><b>(5)</b>
  }
  ps?.close()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We want to find a list of LSN records for the given Order (using UUID).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Loop on the result set to build the domain object(s) (without saving).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Will bind the columns from the result set, where possible. Ignored columns will be
logged as warning messages.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Must always close the prepared statement and result set.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Need to make sure the prepared statement is closed, even if the result set close fails.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sql-injection"><a class="link" href="#sql-injection">SQL Injection</a></h5>
<div class="paragraph">
<p>SQL Injection is a serious security threat to all web-applications that use SQL.
The simplest way to avoid this is to never use any sort of dynamic SQL.  Chances are,
your application will require some sort of dynamic capability.</p>
</div>
<div class="paragraph">
<p>The framework provides this SQL access with some limitations.  These limitations reduce
the chance that an SQL injection attack will work on the query.</p>
</div>
<div class="paragraph">
<p>The limitations include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All dynamic SQL features will use the JDBC PreparedStatement approach.  PreparedStatement
prevents most forms of SQL injection attacks using the values.  It does not prevent
attacks if you build the SQL in an unsafe manner.</p>
</li>
<li>
<p>Quotes (single or double) not allowed. For example,  <em>WHERE column='READY'</em> is not allowed.
You will need to use a parameter for cases like this.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The execute methods will fail if your SQL violates these rules.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurable-types"><a class="link" href="#configurable-types">Configurable Types</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#configurable-type-persistent-storage">Configurable Type Persistent Storage</a></span>
<span class="inline-toc"><a href="#domain-validation">Domain Validation</a></span>
<span class="inline-toc"><a href="#gui-marker-support">GUI Marker Support</a></span>
<span class="inline-toc"><a href="#controller-support">Controller Support</a></span>
<span class="inline-toc"><a href="#configurable-type-api-access">Configurable Type API Access</a></span>
<span class="inline-toc"><a href="#configurable-types-and-pogos">Configurable Types and POGOs</a></span></p>
</div>
<div class="paragraph">
<p>Enterprise applications need to support user-configurable elements.  This allows your users to
tailor the behavior to suite their needs.</p>
</div>
<div class="paragraph">
<p>How do you provide an open-ended list of options configured by the user?
Use <strong>Configurable Types</strong>.</p>
</div>
<div class="paragraph">
<p>For example, the RMA (Return Material Authorization) information for consumers is different
from the information provided by retailers. In addition to other data, the consumers might be
required to enter this information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Last Name</p>
</li>
<li>
<p>First Name</p>
</li>
<li>
<p>Address</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A retailer might need to enter this information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retailer ID</p>
</li>
<li>
<p>Location ID</p>
</li>
<li>
<p>Return Code (Defective, etc.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You could add all of these fields to the RMA object and expect the user to decide which fields
are important.  Or, you could use some sort of configurable mechanism to decide which
fields are valid.</p>
</div>
<div class="paragraph">
<p>When creating the RMA record, the user will choose the RMA Type and the input fields for the
user will be configured based on that type.  This will look something like this:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/RMACreate.png" alt="RMA Creation" width="75%">
</div>
</div>
<div class="paragraph">
<p>When the user selects 'Consumer' as the type, then the consumer fields will be displayed.
When the user selects 'Retailer' as the type, then the retailer fields will be displayed.</p>
</div>
<div class="paragraph">
<p>The <a href="#Definition Pages">[Definition Pages]</a> and the <a href="#efField">[efField]</a> marker support this type of configurable field
when you use a <a href="#flex-types">Flex Types</a> field or any field with a
<a href="groovydoc/org/simplemes/eframe/data/ConfigurableTypeInterface.html" target="_blank" rel="noopener">ConfigurableTypeInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.  This allows you to simply use the core <em>FlexType</em>
class in a domain and the data is automatically displayed and saved in the definition pages:</p>
</div>
<div class="listingblock">
<div class="title">Example Flex Type Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">RMA</span> {
  <span class="predefined-type">String</span> rma
  <span class="predefined-type">String</span> product
  <span class="predefined-type">BigDecimal</span> qty
  <span class="predefined-type">Date</span> returnDate

  <span class="annotation">@ManyToOne</span>(targetEntity=FlexType) <i class="conum" data-value="1"></i><b>(1)</b>
  FlexType rmaType

  <span class="annotation">@Nullable</span>
  <span class="annotation">@ExtensibleFieldHolder</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="annotation">@MappedProperty</span>(type = DataType.JSON)
  <span class="predefined-type">String</span> fields

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The field <code>rmaType</code> will hold the reference to the appropriate flex type.  The actual
values will be stored in the <code>fields</code> field as described
in <a href="#configurable-type-persistent-storage">Configurable Type Persistent Storage</a>.
Note the <em>@ManyToOne</em> usage is needed for this <a href="#simple-foreign-reference">Simple Foreign Reference</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The FlexType requires a place to store the values for RMA records created.
This is done in the normal location for <a href="#field-extensions">Field Extensions</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to define configurable types that are not based on <a href="#flex-types">Flex Types</a>.
This requires more programming to provide the information needed. One example is
in the display/editing of the <a href="#Report Filter Panel">[Report Filter Panel]</a> mechanism.</p>
</div>
<div class="paragraph">
<p>The flex type definition will look something like this:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/flexTypeCreate.png" alt="flexTypeCreate" width="75%">
</div>
<div class="title">Figure 10. flexTypeCreate</div>
</div>
<div class="sect3">
<h4 id="domain-validation"><a class="link" href="#domain-validation">Domain Validation</a></h4>
<div class="paragraph">
<p>Your domain will need to handle most validations on the values entered for the configurable
type.  For enforcement of the simple <code>required</code> flag on the field, you can use the
<a href="groovydoc/org/simplemes/eframe/custom/ExtensibleFieldHelper.html" target="_blank" rel="noopener">ExtensibleFieldHelper</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> method <code>validateConfigurableTypes()</code> to validate the added field(s).
For example:</p>
</div>
<div class="listingblock">
<div class="title">Configurable Type - Validation in Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@MappedEntity</span>
<span class="annotation">@DomainEntity</span>
<span class="type">class</span> <span class="class">RMA</span> {
  <span class="predefined-type">String</span> rma

  <span class="annotation">@Nullable</span>
  <span class="annotation">@ManyToOne</span>(targetEntity = FlexType)
  <span class="annotation">@MappedProperty</span>(type = DataType.UUID)
  FlexType rmaType                       <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="annotation">@Nullable</span>
  <span class="annotation">@ExtensibleFieldHolder</span>
  <span class="annotation">@MappedProperty</span>(type = DataType.JSON)
  <span class="predefined-type">String</span> fields                          <i class="conum" data-value="2"></i><b>(2)</b>

  . . .

  void validate() {   <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">return</span> ExtensibleFieldHelper.instance.validateConfigurableTypes(<span class="local-variable">this</span>,<span class="string"><span class="delimiter">'</span><span class="content">rmaType</span><span class="delimiter">'</span></span>)  <i class="conum" data-value="4"></i><b>(4)</b>
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Configurable type (Flex Type) that user may select in a GUI.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The field that custom fields are stored (as JSON).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The standard domain validate method.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The helper method that validates required configurable type fields.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configurable-type-persistent-storage"><a class="link" href="#configurable-type-persistent-storage">Configurable Type Persistent Storage</a></h4>
<div class="paragraph">
<p>The current 'type' is typically stored in the domain record field (e.g. the <code>FlexType</code> <code>rmaType</code> field above).
The actual values are stored in the normal custom field location for <a href="#field-extensions">Field Extensions</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="#extensiblefieldholder-annotation">ExtensibleFieldHolder Annotation</a> for details on the storage and internal format.
An example of the raw data stored in the database column is shown below.</p>
</div>
<div class="listingblock">
<div class="title">JSON Format Configurable Type Storage</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_fields</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">retailerID</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ACME-101</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">returnCode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DEFECTIVE</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#configurable-type-api-access">Configurable Type API Access</a> for details on accessing these fields.</p>
</div>
</div>
<div class="sect3">
<h4 id="gui-marker-support"><a class="link" href="#gui-marker-support">GUI Marker Support</a></h4>
<div class="paragraph">
<p>The framework markers that support these configurable types include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#efEdit">[efEdit]</a></p>
</li>
<li>
<p><a href="#efCreate">[efCreate]</a></p>
</li>
<li>
<p><a href="#efShow">[efShow]</a></p>
</li>
<li>
<p><a href="#efDefinitionList">[efDefinitionList]</a></p>
</li>
<li>
<p><a href="#efField">[efField]</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="controller-support"><a class="link" href="#controller-support">Controller Support</a></h4>
<div class="paragraph">
<p>The above markers use Javascript to dynamically build the input fields for a given configurable
type.  The
<a href="groovydoc/org/simplemes/eframe/controller/BaseCrudController.html" target="_blank" rel="noopener">BaseCrudController</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> provides support for this.</p>
</div>
</div>
<div class="sect3">
<h4 id="configurable-type-api-access"><a class="link" href="#configurable-type-api-access">Configurable Type API Access</a></h4>
<div class="paragraph">
<p>Programmatic access to these values is provided by accessor methods based on the
<code>FlexType</code> field name (first letter uppercase shifted):</p>
</div>
<div class="listingblock">
<div class="title">Example Access to Configurable Type Values</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="keyword">def</span> rma = <span class="keyword">new</span> RMA()
  rma.setFieldValue(<span class="string"><span class="delimiter">'</span><span class="content">address</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">P.O. Box 8675309</span><span class="delimiter">'</span></span>)

  . . .

  def lastName = rma.getFieldValue(<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The access to the configurable types via the <a href="#api-formats">API Formats</a> is similar.
The field names are the same as described in <a href="#configurable-type-persistent-storage">Configurable Type Persistent Storage</a> above.
An example of the JSON format for an RMA is shown below:</p>
</div>
<div class="listingblock">
<div class="title">JSON Format for Configurable Type Fields</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">rma</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">R10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">12.2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_fields</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">retailerID</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ACME-101</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">returnCode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DEFECTIVE</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configurable-types-and-pogos"><a class="link" href="#configurable-types-and-pogos">Configurable Types and POGOs</a></h4>
<div class="paragraph">
<p>Configurable types such as <a href="#flex-types">Flex Types</a> are normally used with domain classes, but they
can also be used with POGO classes.  This limits the <a href="#configurable-type-api-access">Configurable Type API Access</a> to
just these features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>setFieldValue()</code></p>
</li>
<li>
<p><code>getFieldValue()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is designed to work with transfer objects that copy values between POGOs and domain objects.</p>
</div>
<div class="paragraph">
<p>For example, you might use this transfer POGO with the above RMA examples:</p>
</div>
<div class="listingblock">
<div class="title">Example - Flex Type With POGO</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">RMAResponse</span> {
  <span class="predefined-type">String</span> rma
   . . .

  FlexType rmaType  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="annotation">@Nullable</span>
  <span class="annotation">@ExtensibleFieldHolder</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="annotation">@MappedProperty</span>(type = DataType.JSON)
  <span class="predefined-type">String</span> fields
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The field <code>rmaType</code> will hold the reference to the appropriate flex type.  The actual
values will be stored in the <code>fields</code> field as described
in <a href="#configurable-type-persistent-storage">Configurable Type Persistent Storage</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The FlexType requires a place to store the values for this POGO.
This is done in the normal location for <a href="#field-extensions">Field Extensions</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you need to copy the values between this POGO and the domain, you will need to copy
both fields:</p>
</div>
<div class="listingblock">
<div class="title">Example - Copying Data - Flex Type With POGO</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> rma = RMA.findByRma(<span class="string"><span class="delimiter">'</span><span class="content">RMA1</span><span class="delimiter">'</span></span>)

<span class="keyword">def</span> response = <span class="keyword">new</span> RMAResponse()

response.qty = rma.qty
response.rmaType = rma.rmaType  <i class="conum" data-value="1"></i><b>(1)</b>
response.fields = rma.fields</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You need to copy the flex type field and the values holder (typically <code>fields</code>).</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controllers"><a class="link" href="#controllers">Controllers</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#controller-names">Controller Names</a></span>
<span class="inline-toc"><a href="#controller-method-names">Controller Method Names</a></span>
<span class="inline-toc"><a href="#controller-security">Controller Security</a></span>
<span class="inline-toc"><a href="#controller-base-classes">Controller Base Classes</a></span>
<span class="inline-toc"><a href="#logging">Logging</a></span>
<span class="inline-toc"><a href="#controller-task-menus">Controller Task Menus</a></span>
<span class="inline-toc"><a href="#standard-domain-model-and-markers">Standard Domain Model and Markers</a></span>
<span class="inline-toc"><a href="#controller-method-for-page-display">Controller Method for Page Display</a></span></p>
</div>
<div class="paragraph">
<p>Your controller classes have a few requirements to be easily used by various pieces of the
framework. Your controller classes should be in proper packages, but that is not required.
See <a href="#controller-testing">Controller Testing</a> for details on testing.</p>
</div>
<div class="sect2">
<h3 id="controller-names"><a class="link" href="#controller-names">Controller Names</a></h3>
<div class="paragraph">
<p>Your controller class provide the main access to your application for GUIs and JSON access.
In general, you should follow the normal Micronaut standard: domainName plus  <em>'Controller'</em>.
For example, the domain class <em>Order</em> should
have a corresponding controller named <em>OrderController</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="controller-method-names"><a class="link" href="#controller-method-names">Controller Method Names</a></h3>
<div class="paragraph">
<p>To make the application and framework simpler, the framework assumes some specific naming
conventions.  This is part of the 'coding by conventions' that we try to apply to the
framework.  It makes your application-level code simpler.</p>
</div>
<div class="sect3">
<h4 id="controller-name-uri-and-view-path-are-the-same"><a class="link" href="#controller-name-uri-and-view-path-are-the-same">Controller name, URI and View path are the same</a></h4>
<div class="paragraph">
<p>The controller name is the same as the page.  For example, controller Order has these views:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>views/order/index.ftl
views/order/show.ftl
 . . .</pre>
</div>
</div>
<div class="paragraph">
<p>In the controller, you have these methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/order</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">OrderController</span> {

  <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
  StandardModelAndView index(<span class="annotation">@Nullable</span> <span class="predefined-type">Principal</span> principal)  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/show/{i}</span><span class="delimiter">&quot;</span></span>)
  StandardModelAndView show(<span class="predefined-type">String</span> i, <span class="annotation">@Nullable</span> <span class="predefined-type">Principal</span> principal)  <i class="conum" data-value="2"></i><b>(2)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Usually provided by <a href="#basecrudcontroller">BaseCrudController</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Usually provided by <a href="#basecrudcontroller">BaseCrudController</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This allows some underlying code (such as <a href="#basecrudcontroller">BaseCrudController</a>) to handle a lot of the basic
features of the show and index pages.  This reduces the amount of code you have to write.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controller-security"><a class="link" href="#controller-security">Controller Security</a></h3>
<div class="paragraph">
<p>See <a href="#security">Security</a> for details on securing your controllers.  By default all controller
methods must be secured.  See <a href="#controller-testing">Controller Testing</a> for details on testing these security
requirements.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To enable access, all controller methods should have a <em>Principal</em> argument:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/path</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">AController</span> {

  <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/list</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">Map</span> list(HttpRequest request, <span class="annotation">@Nullable</span> <span class="predefined-type">Principal</span> principal) {
    . . .
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <em>Principal</em> argument is not an argument to your methods, then you will get an access denied
response (<strong>HTTP Status 403-Forbidden</strong>).</p>
</div>
</div>
<div class="sect2">
<h3 id="controller-base-classes"><a class="link" href="#controller-base-classes">Controller Base Classes</a></h3>
<div class="paragraph">
<p>Most of your controllers that support CRUD and API access can use common implementations of those
functions.  For example, a CRUD controller can implement the
<a href="groovydoc/org/simplemes/eframe/controller/BaseCrudController.html" target="_blank" rel="noopener">BaseCrudController</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.  This will provide common methods for CRUD actions
that the standard <a href="#guis">GUIs</a> will use.  This will reduce your code considerably.</p>
</div>
<div class="paragraph">
<p>You can override these methods with your own implementation.</p>
</div>
<div class="paragraph">
<p>Your controller will define the HTTP path your controller handles and the overall security
requirements for methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>)    <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/user</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="type">class</span> <span class="class">UserController</span> <span class="directive">extends</span> BaseCrudController {
  . . .
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All methods require the <em>ADMIN</em> role.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This controller handles request on the <em>/user</em> path (e.g. <em>/user/list</em>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The common controller base classes include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#basecontroller">BaseController</a> - Provides standard error handler.</p>
</li>
<li>
<p><a href="#basecrudcontroller">BaseCrudController</a> - Provides standard CRUD actions.</p>
</li>
<li>
<p><a href="#basecrudrestcontroller">BaseCrudRestController</a> - Provides standard REST/JSON API actions.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="basecrudcontroller"><a class="link" href="#basecrudcontroller">BaseCrudController</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#domainclass">domainClass</a></span>
<span class="inline-toc"><a href="#getview-method">getView Method</a></span>
<span class="inline-toc"><a href="#bindevent-method">bindEvent Method</a></span>
<span class="inline-toc"><a href="#delete-actions">Delete Actions</a></span></p>
</div>
<div class="paragraph">
<p>The <a href="groovydoc/org/simplemes/eframe/controller/BaseCrudController.html" target="_blank" rel="noopener">BaseCrudController</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> base class provides many of the common controller methods
used in standard CRUD pages. This includes methods like <em>list(), create(), edit()</em> etc.</p>
</div>
<div class="paragraph">
<p>GUI <a href="#Markers">[Markers]</a> such as <a href="#efDefinitionList">[efDefinitionList]</a> rely on methods in this base class to display data for the domain.</p>
</div>
<div class="sect3">
<h4 id="basecrudcontroller-options"><a class="link" href="#basecrudcontroller-options">BaseCrudController Options</a></h4>
<div class="paragraph">
<p>The <em>BaseCrudController</em> has a few optional fields/methods you can use to adjust the behavior
of the standard methods.  For example, you can specify a different domain class than the default name.</p>
</div>
<div class="sect4">
<h5 id="domainclass"><a class="link" href="#domainclass">domainClass</a></h5>
<div class="paragraph">
<p>Sometimes, you will need to associate a controller with a different domain class than the default
name.  You can do this with the static field:</p>
</div>
<div class="listingblock">
<div class="title">Example Domain Class Override</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/somePath</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">SomeController</span> <span class="directive">extends</span> BaseCrudController {

   <span class="directive">static</span> domainClass = Order

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This affects the <a href="#basecrudcontroller">BaseCrudController</a>.</p>
</div>
<div class="paragraph">
<p>Also, you should implement a number of methods as described in <a href="#repository-requirements">Repository Requirements</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="getview-method"><a class="link" href="#getview-method">getView Method</a></h5>
<div class="paragraph">
<p>The view page file names are usually derived from the controller&#8217;s domain class.
The default behavior may be wrong for your situation.  You can override the <code>getView()</code>
method in your controller class to use any path needed.  Keep in mind that the view system
adds <em>'views/'</em> to the view to find the real view path.</p>
</div>
<div class="listingblock">
<div class="title">Example View Path Override</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/somePath</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">SomeController</span> <span class="directive">extends</span> BaseCrudController {

  <span class="predefined-type">String</span> getView(<span class="predefined-type">String</span> methodName) {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">someOtherPath/forViews/</span><span class="inline"><span class="inline-delimiter">$</span>methodName</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An alternate path is generated, using the basic method name.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="bindevent-method"><a class="link" href="#bindevent-method">bindEvent Method</a></h5>
<div class="paragraph">
<p>If you use the <a href="#basecrudcontroller">BaseCrudController</a>, then you may need to do additional binding of HTTP parameters
to the domain object upon save.  When the <code>editPost/createPost</code> methods are called, then they
will call your <code>bindEvent()</code> method to do the additional binding/validations.</p>
</div>
<div class="paragraph">
<p>You can also trigger a validation error as shown below.  This example shows how a user&#8217;s password
can be changed by entering the value twice in a GUI (<code>_pwNew</code> and <code>_pwConfirm</code> fields).
This <code>bindEvent()</code> method makes sure the two values are the same.</p>
</div>
<div class="listingblock">
<div class="title">Example - bindEvent() - Password Confirm Validation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> bindEvent(<span class="predefined-type">Object</span> record, <span class="predefined-type">Object</span> params) {
  <span class="keyword">if</span> (params._pwNew) {
    <span class="keyword">if</span> (params._pwNew != params._pwConfirm) {   <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">Exception</span>(...)
    } <span class="keyword">else</span> {
      record.password = params._pwNew  <i class="conum" data-value="2"></i><b>(2)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Compares the new password and the confirmation password.  If different, then an error
is triggered.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If valid, then the password is stored in the User record for later encryption upon save.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="delete-actions"><a class="link" href="#delete-actions">Delete Actions</a></h5>
<div class="paragraph">
<p>The <a href="#basecrudcontroller">BaseCrudController</a> and <a href="#basecrudrestcontroller">BaseCrudRestController</a> <code>delete()</code> methods will delete the given
domain record and all of its children.  This method
will also delete any related records that are not true child records.  This uses the same
<code>findRelatedRecords()</code> mechanism used by <a href="#archiving-related-records">Archiving Related Records</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The related records are deleted before the main record is deleted.  This means you have
      take care of referential integrity issues.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="basecrudrestcontroller"><a class="link" href="#basecrudrestcontroller">BaseCrudRestController</a></h3>
<div class="paragraph">
<p>The <a href="groovydoc/org/simplemes/eframe/controller/BaseCrudRestController.html" target="_blank" rel="noopener">BaseCrudRestController</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> base class provides many of the common controller methods
used in standard CRUD <a href="#rest-api">Rest API</a> methods. This includes the HTTP methods <em>GET, PUT, POST and DELETE</em>.</p>
</div>
<div class="sect3">
<h4 id="endpoints"><a class="link" href="#endpoints">Endpoints</a></h4>
<div class="paragraph">
<p>The <em>BaseCrudRestController</em> has a the normal Rest-style API endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{domain}/crud/uuid <strong>(GET)</strong> - Read a single record by UUID or primary key.</p>
</li>
<li>
<p>{domain}/crud (<strong>POST)</strong> - Create single record.</p>
</li>
<li>
<p>{domain}/crud/uuid <strong>(PUT)</strong> - Update a single record.</p>
</li>
<li>
<p>{domain}/crud/uuid <strong>(DELETE)</strong> - Delete a single record.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The ID-based methods use the URL to define the UUID or primary key for the the record being processed.
See <a href="#rest-api">Rest API</a> for details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="basecontroller"><a class="link" href="#basecontroller">BaseController</a></h3>
<div class="paragraph">
<p>The <a href="groovydoc/org/simplemes/eframe/controller/BaseController.html" target="_blank" rel="noopener">BaseController</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> base class provides the single <em>error()</em> handler method.
This returns an exception in a standard format for display to the user.  This is a local error handler.
Currently, no global error handler is provided for controllers.</p>
</div>
<div class="paragraph">
<p>The standard error response JSON look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>: {
   <span class="key"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="integer">1003</span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Order 'M1657334' is not enabled</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#infowarning-messages-to-clients">Info/Warning Messages to Clients</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="controller-task-menus"><a class="link" href="#controller-task-menus">Controller Task Menus</a></h3>
<div class="paragraph">
<p>Controllers are the main way users will access your application from a browser.
The framework provides a way to define <a href="#Task Menu">[Task Menu]</a> from your controller.  These usually
refer to the main (root or index) page of your controller.</p>
</div>
<div class="paragraph">
<p>Also, you can mark these tasks as a <code>clientRootActivity</code>.  This means the the javascript
methods for this page will be able to write log messages using a standardized logger naming
convention.
To support <a href="#javascript-client-logging">Javascript Client Logging</a>, you should indicate what pages (URIs) that
a given controller provides.  This is done with the variable <code>taskMenuItems</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">'</span><span class="content">/order</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">OrderController</span> {

  <span class="keyword">def</span> taskMenuItems = [<span class="keyword">new</span> TaskMenuItem(<span class="key">folder</span>: <span class="string"><span class="delimiter">'</span><span class="content">demand:50.order:100</span><span class="delimiter">'</span></span>,
                                        <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>,
                                        <span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">/order</span><span class="delimiter">'</span></span>,
                                        <span class="key">clientRootActivity</span>: <span class="predefined-constant">true</span>,       <i class="conum" data-value="1"></i><b>(1)</b>
                                        <span class="key">displayOrder</span>: <span class="integer">101</span>)]

  <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)
  <span class="annotation">@Produces</span>(MediaType.TEXT_HTML)        <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="predefined-type">String</span> index() {
   . . .
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This URL is the client logger root for this controller.  This means the logger
<em>'client.order'</em> logger will be used to control the logging level on the client
for this controller&#8217;s pages.  (<strong>Default</strong>: is true, so this value is normally not needed).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An index page handler.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can test your settings in the <a href="#controller-test-helper">Controller Test Helper</a>.  You will need to specify
the details on the Task Menu Item expected in the controller.</p>
</div>
</div>
<div class="sect2">
<h3 id="standard-domain-model-and-markers"><a class="link" href="#standard-domain-model-and-markers">Standard Domain Model and Markers</a></h3>
<div class="paragraph">
<p>This <a href="#basecrudcontroller">BaseCrudController</a> stores the domain object being displayed/edited in the standard location
for your .ftl/HTML pages to display.  The domain object is stored in the <a href="#Markers">[Markers]</a> context data
as described in <a href="#Markers and Models">[Markers and Models]</a> under the domain name (e.g. <em>'order'</em>).</p>
</div>
<div class="paragraph">
<p>If you have your own controller methods that create a StandardModelAndView, then you should make sure
your domain object is stored with this same naming convention.</p>
</div>
<div class="paragraph">
<p>You can access this in your .ftl/HTML files:</p>
</div>
<div class="listingblock">
<div class="title">Use of the Domain Model</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">Order: ${order.order}  <i class="conum" data-value="1"></i><b>(1)</b>
Qty to Build: ${order.qtyToBuild}
Due Date: ${order.dueDate}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The fields from the <em>Order</em> record are displayed in the page.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="controller-method-for-page-display"><a class="link" href="#controller-method-for-page-display">Controller Method for Page Display</a></h3>
<div class="paragraph">
<p>Most pages will be served up by some controller method.  This is usually very simple, but
needs some specific annotations to work with the browsers:</p>
</div>
<div class="listingblock">
<div class="title">Example - Controller Support for Page Display</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">'</span><span class="content">OPERATOR</span><span class="delimiter">'</span></span>)
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/work</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">WorkController</span> <span class="directive">extends</span> BaseController {

  <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/startActivity</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="annotation">@Produces</span>(MediaType.TEXT_HTML) <i class="conum" data-value="2"></i><b>(2)</b>
  StandardModelAndView startActivity(HttpRequest request, <span class="annotation">@Nullable</span> <span class="predefined-type">Principal</span> principal) {
    <span class="keyword">return</span> <span class="keyword">new</span> StandardModelAndView(<span class="string"><span class="delimiter">&quot;</span><span class="content">demand/work/start</span><span class="delimiter">&quot;</span></span>, principal, <span class="local-variable">this</span>)  <i class="conum" data-value="3"></i><b>(3)</b>
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines the controller endpoint to render this page (e.g. <em>'/work/startActivity'</em>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This tells the browser the type of data to expect (an HTML page).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Generates a page (<em>'main/resources/views/demand/work/start.ftl'</em>) using the normal
<a href="#StandardModelAndView">[StandardModelAndView]</a> to provide access to common settings such as the logged in state.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="services"><a class="link" href="#services">Services</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#service-transactions">Service Transactions</a></span>
<span class="inline-toc"><a href="#arguments-and-return-values">Arguments and Return Values</a></span></p>
</div>
<div class="paragraph">
<p>Services are where much of your business logic will be implemented.
Your service classes have a few requirements to be easily used within the framework.
Your services should be in proper packages, but that is not required.</p>
</div>
<div class="sect2">
<h3 id="service-transactions"><a class="link" href="#service-transactions">Service Transactions</a></h3>
<div class="paragraph">
<p>All services that perform database changes should be marked as transactional:</p>
</div>
<div class="listingblock">
<div class="title">Transactional Service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td>
  <td class="code"><pre><span class="keyword">package</span> org.simplemes.mes.assy.floor

<span class="keyword">import</span> <span class="include">javax.transaction.Transactional</span>

<span class="annotation">@Transactional</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">WorkCenterAssyService</span> {

  <span class="type">void</span> someMethod() {
   . . .
  }
}
</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Makes all public methods as transactional.  Can be called from within an existing transaction
without creating a new session/transaction.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="arguments-and-return-values"><a class="link" href="#arguments-and-return-values">Arguments and Return Values</a></h3>
<div class="paragraph">
<p>Most services will need arguments passed in and will return values.  These values should be
Java/Groovy objects (e.g. Domains, POJOs or POGOs).  Passing and returning JSON should be
handled by the controllers.</p>
</div>
<div class="paragraph">
<p>In addition, most services that need multiple inputs should use a POGO to make a more readable API.
This makes it much easier to pass a large number of objects in a clear way.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most service methods should be designed to take domain objects as inputs, when possible.
      This is done instead of passing key field (e.g. Strings) as parameters.
      This reduces the amount of database access, but also forces you to manage <a href="#transactions">Transactions</a> in
      the calling code.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Service Arguments</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td>
  <td class="code"><pre><span class="annotation">@Transactional</span>
<span class="type">class</span> <span class="class">WorkCenterAssyService</span> {

  <span class="comment">/**
   * This method adds a component...
   */</span>
  WorkCenterComponent addComponent(AddComponentRequest addComponentRequest) {  <i class="conum" data-value="1"></i><b>(1)</b>
   . . .
  }
}

<span class="comment">/**
 * This class is the request to add a component to a work center's current setup.
 */</span>
<span class="type">class</span> <span class="class">AddComponentRequest</span> {
  WorkCenter workCenter   <i class="conum" data-value="2"></i><b>(2)</b>
  Product component
  <span class="predefined-type">String</span> location
  <span class="predefined-type">BigDecimal</span> qty
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A POGO is passed in and a domain object is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The fields can be domain objects.  This means the caller will populate this POGO
within its own transaction.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example uses POGO to receive a large number of arguments.  It then returns a domain object
(WorkCenterComponent) that was created by this request.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guis"><a class="link" href="#guis">GUIs</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#gui-dependencies">GUI Dependencies</a></span>
<span class="inline-toc"><a href="#gui-philosophy-and-decisions">GUI Philosophy and Decisions</a></span>
<span class="inline-toc"><a href="#gui-development">GUI Development</a></span>
<span class="inline-toc"><a href="#gui-development-setup">GUI Development Setup</a></span>
<span class="inline-toc"><a href="#gui-i18n">GUI I18n</a></span></p>
</div>
<div class="paragraph">
<p>Standardized GUIs are a key part of the user experience in enterprise applications.
Customers expect your GUIs to work the same way across the entire application.  To keep the
GUIs consistent, the framework provides a set of common GUI components and support objects
to reduce the developer complexity.</p>
</div>
<div class="sect2">
<h3 id="gui-dependencies"><a class="link" href="#gui-dependencies">GUI Dependencies</a></h3>
<div class="paragraph">
<p>The following client modules are used by the clients sub-modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://v3.vuejs.org/guide/introduction.html#what-is-vue-js/" target="_blank" rel="noopener">Vue</a> - The main reactive client system.</p>
</li>
<li>
<p><a href="https://cli.vuejs.org/guide/" target="_blank" rel="noopener">VueCLI</a> - The command line tool for creating/managing the client sub-module.
Includes Webpack for packaging the client assets for production.</p>
</li>
<li>
<p><a href="https://primefaces.org/primevue/" target="_blank" rel="noopener">PrimeVue</a> - Component library.</p>
</li>
<li>
<p><a href="https://next.vuex.vuejs.org/" target="_blank" rel="noopener">VueX</a> - Global state management for the client.</p>
</li>
<li>
<p><a href="https://github.com/axios/axios" target="_blank" rel="noopener">Axios</a> - Client/Server requests (AJAX).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="gui-philosophy-and-decisions"><a class="link" href="#gui-philosophy-and-decisions">GUI Philosophy and Decisions</a></h3>
<div class="paragraph">
<p>Clean, functional GUIs are critical to any web application&#8217;s success.
SimpleMES is no different.
Since GUIs are so important to your application&#8217;s success, we made some key decisions
on how to define the GUIs and how they work with the server-side.</p>
</div>
<div class="paragraph">
<p><a href="https://v3.vuejs.org/guide/introduction.html#what-is-vue-js/" target="_blank" rel="noopener">Vue</a> was chosen for the
client-side display because of its support for multiple-page apps and for its reactive
support.  This makes for a very rich client-side experience.</p>
</div>
<div class="paragraph">
<p>Vue does complicate the developer process and makes for more complex GUI code.
Because of this, we use a hybrid Gradle/Groovy and
<a href="https://nodejs.org/" target="_blank" rel="noopener">Node</a> / <a href="https://docs.npmjs.com/" target="_blank" rel="noopener">npm</a> development environment.</p>
</div>
<div class="paragraph">
<p>These decisions are based on some simple GUI philosophies:</p>
</div>
<div class="paragraph">
<p>None of these decisions are perfect.  They all involve trade-offs.  We tried to make sure
the end result is a smooth operating application, even in slow environments.
There are scenarios where the framework supports a more interactive approach such
as <a href="#Dashboards">[Dashboards]</a>.</p>
</div>
<div class="paragraph">
<p>You can do things differently if you prefer.  It just means the framework won&#8217;t be helping
as much as it could.</p>
</div>
<div class="sect3">
<h4 id="solution"><a class="link" href="#solution">Solution</a></h4>
<div class="paragraph">
<p>To overcome these issues, we decided to use Vue with PrimeVue components. This provides the best user experience with a
larger developer base than the other choices.</p>
</div>
<div class="sect4">
<h5 id="pros"><a class="link" href="#pros">Pros</a></h5>
<div class="paragraph">
<p>The main benefits of this solution include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Large developer base.</p>
</li>
<li>
<p>Extensive tutorials available.</p>
</li>
<li>
<p>Responsive UI easily implemented.</p>
</li>
<li>
<p>Modern look/feel.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cons"><a class="link" href="#cons">Cons</a></h5>
<div class="paragraph">
<p>The main drawbacks of this solution include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client development is different from the server-side.  (Javascript/node vs. Java/Groovy).</p>
</li>
<li>
<p>Integrating the two environments causes issues.</p>
</li>
<li>
<p>Vue makes dynamic, end-user GUIs more difficult.</p>
</li>
<li>
<p>Vue makes re-use of code more difficult. Inheritance is discouraged. This means some common features (like
localization) is copied to each page manually.</p>
</li>
<li>
<p>The Javascript Node/npm world is much more fragmented than the Java/Groovy world.
For example, there are 6+ ways to handle localization.</p>
</li>
<li>
<p>Module loading in a browser is simply a mess.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guidelines-2"><a class="link" href="#guidelines-2">Guidelines</a></h4>
<div class="paragraph">
<p>To work around the drawbacks of this approach, some conventions will be followed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Client Sub-Modules</strong> - Each module of your application should have a client sub-module.</p>
</li>
<li>
<p><strong>Use eframe-lib</strong> - Your module will (should) use the <a href="#eframe-lib">eframe-lib</a> for common
features such as CRUD, server interaction and localization (<a href="#gui-i18n">GUI I18n</a>).</p>
</li>
<li>
<p><strong>GUI Testing</strong> - You should follow the general <a href="#gui-testing">GUI Testing</a> approach used by the
framework.  This means GUI testing is done in Geb/Groovy instead of
in the node/npm world.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="development-process"><a class="link" href="#development-process">Development Process</a></h4>
<div class="paragraph">
<p>In particular, all pages will be generated with the Vue/JS world. This means all UI
features are built/configured in the node/JS world. The node/npm world will generate
the client assets which will be served up by the server-side.</p>
</div>
<div class="paragraph">
<p>This means most development will be done while running the npm/VueCLI in development mode,
then doing a build to create the assets for the server-side core to serve.</p>
</div>
</div>
<div class="sect3">
<h4 id="integration-during-development"><a class="link" href="#integration-during-development">Integration During Development</a></h4>
<div class="paragraph">
<p>The npm/VueCLI will run the app in developer mode. The access to the server-side will
be to another process on a different port. This is done to keep the development mode
code the same as the production as much as possible.</p>
</div>
<div class="paragraph">
<p>The axios module use a proxy for development mode to access <em><a href="http://localhost:8080/" class="bare">http://localhost:8080/</a></em>
while the client code is run on <em><a href="http://localhost:8081/" class="bare">http://localhost:8081/</a></em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gui-development"><a class="link" href="#gui-development">GUI Development</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#gui-module-structure">GUI Module Structure</a></span>
<span class="inline-toc"><a href="#gui-development-tasks">GUI Development Tasks</a></span>
<span class="inline-toc"><a href="#gui-development-cycle">GUI Development Cycle</a></span>
<span class="inline-toc"><a href="#gui-entry-page">GUI Entry Page</a></span>
<span class="inline-toc"><a href="#controller-for-gui-entry-page">Controller for GUI Entry Page</a></span>
<span class="inline-toc"><a href="#crudtable-service-requirements">CrudTable Service Requirements</a></span>
<span class="inline-toc"><a href="#eframe-lib">eframe-lib</a></span>
<span class="inline-toc"><a href="#gui-related-gradlenpm-tasks">GUI Related Gradle/NPM Tasks</a></span></p>
</div>
<div class="paragraph">
<p>The GUI development environment is somewhat complex due to the hybrid nature.
We use Groovy/Java on the server-side and Vue on the client-side.
This forces us to develop the client-side GUIs in isolation from the server-side.
The client is then served up by the server-side.</p>
</div>
<div class="sect3">
<h4 id="gui-module-structure"><a class="link" href="#gui-module-structure">GUI Module Structure</a></h4>
<div class="paragraph">
<p>The basic structure for the modular application will look
something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/clientModulesExample.png" alt="clientModulesExample" width="530" height="210">
</div>
</div>
<div class="paragraph">
<p>Each module can supply a client one or more sub-modules with the assets needed for
the clients.  These client sub-modules will be built using the <strong>npm</strong> processes typically
used for Vue applications.</p>
</div>
<div class="paragraph">
<p>The application pages will be organized like this during the production deployment:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/clientPages.png" alt="clientPages" width="1240" height="348">
</div>
<div class="title">Figure 11. Production Deployment - URL Locations</div>
</div>
<div class="paragraph">
<p>Each of these URIs is called a <a href="#gui-entry-page">GUI Entry Page</a>.  It is an HTML page that is
accessible directly from within the browser.  Typically, these pages all show up
in the <a href="#Task Menu">[Task Menu]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="gui-development-tasks"><a class="link" href="#gui-development-tasks">GUI Development Tasks</a></h4>
<div class="paragraph">
<p>GUI development involves working with the client sub-module and then moving it to the
production server for deployment.  The basic flow is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a client module (if not done already for your module).  See
<a href="#gui-setup-new-client-module">GUI Setup - New Client Module</a> for details on creating the module from
the <em>templates</em> folder.  You will use the gradle <em>npmInit</em> task to install
the vue and related client libraries.</p>
</li>
<li>
<p>Create a <a href="#gui-entry-page">GUI Entry Page</a> - Create/edit the client-side components code.
This includes .vue and .js files.  See the <a href="#gui-development-cycle">GUI Development Cycle</a> for suggestions
on how to edit/test your GUIs.</p>
</li>
<li>
<p>When you are ready to deploy to a server, you will use the gradle <em>npmBuild</em> to
create the assets for production (runs <em>npm run build</em> command).
This copies the client run-time files to the <em>src/main/resources/client</em> folder
for the IDEA <em>localhost</em> process to use.</p>
</li>
<li>
<p>Then, you will need a controller that serves up these client assets from the server.
See <a href="#controller-for-gui-entry-page">Controller for GUI Entry Page</a> for details.</p>
</li>
<li>
<p><em>Build .jar</em> - When ready to publish the module, the run-time .jar file is built
and the assets are included in the .jar file.  This is done by the Gradle
task <em>publishToMavenLocal</em> task.</p>
<div class="literalblock">
<div class="content">
<pre>NOTE: You can use the _npm run server_ task to allow hot-updates to the running client-side
      application while you make changes.  *Highly recommended*.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="gui-development-cycle"><a class="link" href="#gui-development-cycle">GUI Development Cycle</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start localhost (server-side).</p>
</li>
<li>
<p>Start client side development mode: <em>npm run server</em>.  Starting this after
the localhost (server-side, port 8080) will force the client-side 'server' to
run on port 8081.</p>
</li>
<li>
<p>Edit .js/.vue files.</p>
</li>
<li>
<p>Try in browser (on port 8081).</p>
</li>
<li>
<p>Repeat from  #4 until satisfied.</p>
</li>
<li>
<p>Build using gradle <em>npmBuild</em> for use in production.  Restart localhost (server-side)
to use use the client module in 'production'.  You may need to force a refresh
of the IDEA out folder for the new client files (Gradle refresh seems to work).</p>
</li>
<li>
<p>Write GEB/Spock tests of the GUI (no javascript-based tests).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
After running the gradle task <em>npmBuild</em>, you may need to refresh the server-side
      with the new lib.  This can be done manually of by simply using Intellij&#8217;s
      'Reload All Gradle Projects' (refresh symbol in the 'Gradle' sidebar).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="gui-entry-page"><a class="link" href="#gui-entry-page">GUI Entry Page</a></h4>
<div class="paragraph">
<p>Vue supports multi-page applications.  These are web applications that allow display of
multiple pages at different URLs.  This fits well with enterprise apps.</p>
</div>
<div class="paragraph">
<p>To make this work, you will need to define each entry page.  For the most part, each domain
object definition page is an entry page (e.g. Flex Type definition is page, User
definition is a page, etc).  Other complex pages (such as a dashboard) are also entry points.
This framework does not directly support the Vue router concept for single page applications.</p>
</div>
<div class="paragraph">
<p>See <a href="#gui-module-structure">GUI Module Structure</a> for an overview of the client
module layout and <a href="#entry-page-structure">Entry Page Structure</a> for details.</p>
</div>
<div class="paragraph">
<p>You will need to create some files for each page.  The <em>templates</em> folder contains
a sample GUI page and related files.  See <a href="#gui-setup-new-client-module">GUI Setup - New Client Module</a> for details.</p>
</div>
<div class="paragraph">
<p>You will need to edit the <em>vue.config.js</em> for your module.  It should have
an entry like this (for the FlexType example):</p>
</div>
<div class="listingblock">
<div class="title">Example - vue.config.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"> . . .

module.exports = {
  <span class="key">publicPath</span>: process.env.NODE_ENV === <span class="string"><span class="delimiter">'</span><span class="content">production</span><span class="delimiter">'</span></span> ? <span class="string"><span class="delimiter">'</span><span class="content">/client/sample</span><span class="delimiter">'</span></span> : <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>,  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key">pages</span>: {
    <span class="key">index</span>: {  <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="key">entry</span>: <span class="string"><span class="delimiter">'</span><span class="content">src/entry/index.js</span><span class="delimiter">'</span></span>,
      <span class="key">template</span>: <span class="string"><span class="delimiter">'</span><span class="content">public/index.html</span><span class="delimiter">'</span></span>,
      <span class="key">filename</span>: <span class="string"><span class="delimiter">'</span><span class="content">index.html</span><span class="delimiter">'</span></span>,
      <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Index Page</span><span class="delimiter">'</span></span>,
      <span class="key">chunks</span>: [<span class="string"><span class="delimiter">'</span><span class="content">chunk-vendors</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">chunk-common</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>]
    },
    <span class="key"><span class="delimiter">'</span><span class="content">flexType</span><span class="delimiter">'</span></span>: {  <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">entry</span>: <span class="string"><span class="delimiter">'</span><span class="content">src/entry/custom/flexType/flexType.js</span><span class="delimiter">'</span></span>,
      <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Flex Type</span><span class="delimiter">'</span></span>,
    },
  },
  . . .
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>publicPath</code> is where the generated client module is served-up by the server side
in production.  The 'sample' in <em>'/client/sample'</em> should be changed to your module name.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The index page is usually only used for development mode (e.g. when run using
<em>'npm run server'</em> for hot-reloading during client development).  This <em>index.js</em> will
usually have simple HTML links to your pages for development uses.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This where your client page(s) will go.  Each top-level entry page should
be listed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You will need to change the <em>publicPath</em> and the <em>'flexType'</em> entry above for your
entry page(s).</p>
</div>
<div class="paragraph">
<p>Each entry page is made up of two main elements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>.js</em> file - This file creates the page and displays it using the template
<em>public/index.html</em>.  This code links the <em>.vue</em> component with the HTML tag
<em>'&lt;div id="app"&gt;'</em>.</p>
</li>
<li>
<p><em>.vue</em> file - This file defines what is displayed on the page.
For simple CRUD definition pages, this usually just refers to <a href="#CrudTable">[CrudTable]</a> component
with some configuration options.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The files for the Flex Type definition page is shown below.</p>
</div>
<div class="sect4">
<h5 id="entry-page-structure"><a class="link" href="#entry-page-structure">Entry Page Structure</a></h5>
<div class="paragraph">
<p>The client page defines a single endpoint (URL) for the application.  For example,
the CRUD page for the Flex Type records is at <em>'/client/eframe/flexType'</em>.  It is made
up of these elements:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/clientElements.png" alt="clientElements" width="765" height="250">
</div>
<div class="title">Figure 12. Client Elements</div>
</div>
<div class="paragraph">
<p>The <em>.js</em> file is fairly simple.  Most of the common logic is provided by the PageApp:</p>
</div>
<div class="listingblock">
<div class="title">Example - flexType.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> FlexTypeCrud from <span class="string"><span class="delimiter">'</span><span class="content">@/components/eframe/custom/flexType/FlexTypeCrud.vue</span><span class="delimiter">'</span></span>
<span class="reserved">import</span> PageApp from <span class="string"><span class="delimiter">'</span><span class="content">@/eframe-lib/web/PageApp.js</span><span class="delimiter">'</span></span>
<span class="reserved">import</span> <span class="string"><span class="delimiter">'</span><span class="content">@/eframe-lib/assets/styles/global.css</span><span class="delimiter">'</span></span>

<span class="reserved">import</span> Locales from <span class="string"><span class="delimiter">&quot;</span><span class="content">@/locales/Locales</span><span class="delimiter">&quot;</span></span>               <i class="conum" data-value="1"></i><b>(1)</b>


const app = PageApp.createApp(FlexTypeCrud, Locales)  <i class="conum" data-value="2"></i><b>(2)</b>
app.mount(<span class="string"><span class="delimiter">'</span><span class="content">#app</span><span class="delimiter">'</span></span>)                                     <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provides the locale-specific labels/etc for this module.  See <a href="#gui-i18n">GUI I18n</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses standard features such as Toast, Axios and <a href="#gui-i18n">GUI I18n</a> support.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Mounts the FlexType crud table in the standard page using the <em>'app'</em> HTML ID.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>.vue</em> file for most Crud pages is also fairly simple.
This uses the <a href="#CrudTable">[CrudTable]</a> component:</p>
</div>
<div class="listingblock">
<div class="title">Example - FlexTypeCrud.vue</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="tag">&lt;template&gt;</span>
  <span class="tag">&lt;CrudTable</span> <span class="attribute-name">:columns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">columns</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">:service</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
             <span class="attribute-name">:domainClassName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">domainClassName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/template&gt;</span>

<span class="tag">&lt;script&gt;</span>
<span class="inline">
<span class="reserved">import</span> CrudTable from <span class="string"><span class="delimiter">'</span><span class="content">@/eframe-lib/web/CrudTable</span><span class="delimiter">'</span></span>
<span class="reserved">import</span> FlexTypeService from <span class="string"><span class="delimiter">'</span><span class="content">@/components/eframe/custom/flexType/FlexTypeService</span><span class="delimiter">'</span></span>

<span class="reserved">export</span> <span class="keyword">default</span> {
  <span class="key">components</span>: {
    CrudTable
  },
  data() {
    <span class="keyword">return</span> {
      <span class="key">columns</span>: [  <i class="conum" data-value="2"></i><b>(2)</b>
        {<span class="key">field</span>: <span class="string"><span class="delimiter">'</span><span class="content">flexType</span><span class="delimiter">'</span></span>, <span class="key">header</span>: <span class="local-variable">this</span>.<span class="predefined">$t</span>(<span class="string"><span class="delimiter">'</span><span class="content">label.flexType</span><span class="delimiter">'</span></span>), <span class="key">sort</span>: <span class="predefined-constant">true</span>},
        {<span class="key">field</span>: <span class="string"><span class="delimiter">'</span><span class="content">category</span><span class="delimiter">'</span></span>, <span class="key">header</span>: <span class="local-variable">this</span>.<span class="predefined">$t</span>(<span class="string"><span class="delimiter">'</span><span class="content">label.category</span><span class="delimiter">'</span></span>), <span class="key">sort</span>: <span class="predefined-constant">true</span>},
        {<span class="key">field</span>: <span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>, <span class="key">header</span>: <span class="local-variable">this</span>.<span class="predefined">$t</span>(<span class="string"><span class="delimiter">'</span><span class="content">label.title</span><span class="delimiter">'</span></span>), <span class="key">sort</span>: <span class="predefined-constant">true</span>},
        {<span class="key">field</span>: <span class="string"><span class="delimiter">'</span><span class="content">fieldSummary</span><span class="delimiter">'</span></span>, <span class="key">header</span>: <span class="local-variable">this</span>.<span class="predefined">$t</span>(<span class="string"><span class="delimiter">'</span><span class="content">label.fields</span><span class="delimiter">'</span></span>)},
      ],
      <span class="key">service</span>: FlexTypeService,   <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">domainClassName</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.simplemes.eframe.custom.domain.FlexType</span><span class="delimiter">'</span></span>,  <i class="conum" data-value="4"></i><b>(4)</b>
    }
  },
}</span>

<span class="tag">&lt;/script&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines the standard CRUD page with a header.  This links the data elements below with
the CrudTable component.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The columns displayed are listed with localized headers and related options.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The client-side (javascript) service that implements the <code>list()</code> and other CRUD-related methods.
See <a href="#GUI - CRUD Requirements">[GUI - CRUD Requirements]</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The domain class that is being maintained by this CRUD page.  This is the
class name from the server-side.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="controller-for-gui-entry-page"><a class="link" href="#controller-for-gui-entry-page">Controller for GUI Entry Page</a></h4>
<div class="paragraph">
<p>The <a href="#gui-entry-page">GUI Entry Page</a> needs to be served up by the server.  The entry page assets are
packaged by the Gradle command <code>npmBuild</code>.  See <a href="#gui-related-gradlenpm-tasks">GUI Related Gradle/NPM Tasks</a>
for more details on these tasks.</p>
</div>
<div class="paragraph">
<p>The controller is usually a sub-class of
<a href="groovydoc/org/simplemes/eframe/controller/BaseController.html" target="_blank" rel="noopener">BaseController</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.
This provide the standard <code>index()</code> method to serve-up the normal client assets.
The controller will look something like this:</p>
</div>
<div class="listingblock">
<div class="title">Example -</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">CUSTOMIZER</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/flexType</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">FlexTypeController</span> <span class="directive">extends</span> BaseCrudController {
  <span class="keyword">def</span> taskMenuItems = [<span class="keyword">new</span> TaskMenuItem(<span class="key">folder</span>: <span class="string"><span class="delimiter">'</span><span class="content">custom:100</span><span class="delimiter">'</span></span>,     <i class="conum" data-value="1"></i><b>(1)</b>
                                        <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">flexType</span><span class="delimiter">'</span></span>,
                                        <span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">/flexType</span><span class="delimiter">'</span></span>,
                                        <span class="key">displayOrder</span>: <span class="integer">110</span>,
                                        <span class="key">clientRootActivity</span>: <span class="predefined-constant">true</span>)]

  <span class="predefined-type">String</span> indexView = <span class="string"><span class="delimiter">'</span><span class="content">client/eframe/flexType</span><span class="delimiter">'</span></span>  <i class="conum" data-value="2"></i><b>(2)</b>


}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The CRUD page is added to the standard <a href="#Task Menu">[Task Menu]</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The URI location of the index page.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You will need to change the value for the <code>indexView</code> to match where your entry page is
located.  See <a href="#gui-entry-page">GUI Entry Page</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>BaseCrudController</em> class also provides the normal REST API methods needed
      for the crud pages.  These are accessed using the method from your client-side
      service object.  See <a href="#crudtable-service-requirements">CrudTable Service Requirements</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="crudtable-service-requirements"><a class="link" href="#crudtable-service-requirements">CrudTable Service Requirements</a></h4>
<div class="paragraph">
<p>The service for FlexType CRUD pages is shown below.  This particular service is needed
for the CrudTable component.  Other components may need other services.  It is
recommended that all interaction between the client and server be handled by a
service-style script.</p>
</div>
<div class="listingblock">
<div class="title">Example - SampleParentService.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> ServiceUtils from <span class="string"><span class="delimiter">'</span><span class="content">@/eframe-lib/domain/ServiceUtils</span><span class="delimiter">'</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>

<span class="reserved">export</span> <span class="keyword">default</span> {
  buildLabel(record, includeType = <span class="predefined-constant">false</span>) {  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">return</span> ServiceUtils.buildLabel(record.name, includeType ? <span class="string"><span class="delimiter">'</span><span class="content">label.sampleParent</span><span class="delimiter">'</span></span> : <span class="predefined-constant">undefined</span>)
  },
  find(uuid, successFunction, errorFunction) { <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">return</span> ServiceUtils.find(<span class="string"><span class="delimiter">'</span><span class="content">/sampleParent</span><span class="delimiter">'</span></span>, uuid, successFunction, errorFunction)
  },
  list(options, successFunction, errorFunction) { <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="keyword">return</span> ServiceUtils.list(<span class="string"><span class="delimiter">'</span><span class="content">/sampleParent</span><span class="delimiter">'</span></span>, options, successFunction, errorFunction)
  },
  <span class="keyword">delete</span>(object, successFunction, errorFunction) { <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="keyword">return</span> ServiceUtils.<span class="keyword">delete</span>(<span class="string"><span class="delimiter">'</span><span class="content">/sampleParent</span><span class="delimiter">'</span></span>, object, successFunction, errorFunction)
  },
  save(object, fields, successFunction, errorFunction) { <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="keyword">return</span> ServiceUtils.save(<span class="string"><span class="delimiter">'</span><span class="content">/sampleParent</span><span class="delimiter">'</span></span>, object, fields, successFunction, errorFunction)
  },
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The standard <em>ServiceUtils</em> for the client-side access to CRUD methods for domain objects.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Builds the label/key value suitable for use in confirmation dialogs and similar uses.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Retrieves a record from the server.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Retrieves a list of matching records for the domain object.  Supports
paging/sorting/filtering.   This is usually provided by
the <a href="#basecrudcontroller">BaseCrudController</a> class.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Deletes a single domain object.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Saves (create/update) a single domain object.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic methods needed include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>list()</code></p>
</li>
<li>
<p><code>buildLabel()</code></p>
</li>
<li>
<p><code>find()</code></p>
</li>
<li>
<p><code>save()</code></p>
</li>
<li>
<p><code>delete()</code></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="client-service-requirements"><a class="link" href="#client-service-requirements">Client Service Requirements</a></h5>
<div class="sect5">
<h6 id="client-service-list-parameters"><a class="link" href="#client-service-list-parameters">list() Parameters</a></h6>
<div class="paragraph">
<p>The parameters for the list are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Parameters</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Argument/Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>options</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A javascript object with the supported options listed here (<strong>Required</strong>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>count</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of records (page size).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>start</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first record in the page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>search</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The search filter (optional).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sort[fieldName]=asc</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines sorting on the given field name with (asc)ending or
                          (des)cending.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>successFunction</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The function called when the list returns values.
                      The object passed to this function is result of the
                      list() request (converted from JSON).  Values include:
                      <code>total_count</code> and <code>data</code> (the records) (<strong>Required</strong>).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="eframe-lib"><a class="link" href="#eframe-lib">eframe-lib</a></h4>
<div class="paragraph">
<p>The common components provided by the framework are provided in the eframe-lib pseudo-module.
This is copied from the eframe source tree to the client module&#8217;s <em>src</em> folder
using the gradle command <code>copyEframeLib</code>.  This does a simple copy to avoid the whole
npm package creation logic.</p>
</div>
<div class="paragraph">
<p>Normal client module developers will only need to run this gradle command when the eframe-lib
changes.  If you are developing inside of the eframe-lib, you will need to run this command
more frequently.</p>
</div>
<div class="sect4">
<h5 id="why-copy-the-eframe-lib"><a class="link" href="#why-copy-the-eframe-lib">Why Copy the eframe-lib?</a></h5>
<div class="paragraph">
<p>Node/npm supports a quirky module system that is used to provide libraries for client
applications.  This seems to work well for other systems, but has proven to be a
nightmare for this enterprise framework.</p>
</div>
<div class="paragraph">
<p>To avoid this nightmare, we chose to simply copy the library (eframe-lib) to the <em>src</em> tree
of each client module.  Since you would need to run some sort of gradle task to update
the library for each client module, we decided to just use a simple copy.</p>
</div>
<div class="paragraph">
<p>Why not use the node/npm mechanisms?</p>
</div>
<div class="paragraph">
<p>Well, after losing a month of development time, we chose the simplest solution that worked.
The biggest problem we had was that using Vue 3.0, Vue-CLI and Primevue together seems to
cause problems with the production run-time.  When using a normal npm library publishing
mechanism, the rendered page was blank.</p>
</div>
<div class="paragraph">
<p>There seems to be some issue with getting those 3 libraries to work together in a production
build.  Why is that?  We have no idea.  There seem to be almost no examples of working
with this combination in a published library or on Github.</p>
</div>
<div class="paragraph">
<p>So, rather than to continue spending time on this, we chose the simplest approach that worked
in all scenarios/modules: copy the source to each client.  The node/npm library world
is simply too fragmented.  For example, there are 6+ ways to publish a library.  We tried most
of them and could not find a way to get Primevue to work with any of them.</p>
</div>
<div class="paragraph">
<p>Someday, if we ever solve this, we will convert to a published library mechanism.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gui-related-gradlenpm-tasks"><a class="link" href="#gui-related-gradlenpm-tasks">GUI Related Gradle/NPM Tasks</a></h4>
<div class="paragraph">
<p>There are a number of <em>npm</em> and Gradle tasks used to run/build the client GUI pages.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>npm run serve</strong> - Starts a local server for the client that allows hot-redeploy of the
client code.  Used for most client-side development.</p>
</li>
<li>
<p><strong>npmBuild</strong> (Gradle) - Builds the client assets needed for the production application
server.  This is done to allow the Micronaut application server to provide the
client GUI to the browser.  See <a href="#controller-for-gui-entry-page">Controller for GUI Entry Page</a> for more details
on how this is served up by the application server.</p>
</li>
<li>
<p><strong>copyEframeLib</strong> (Gradle) - Copies the <a href="#eframe-lib">eframe-lib</a> source to the client module&#8217;s
<em>src</em> folder.  This makes it easier to re-use the library features such as <a href="#CrudTable">[CrudTable]</a>.</p>
</li>
<li>
<p><strong>npmInit</strong> (Gradle) - Runs the <code>npm install</code> command on a client module.  Typically only
needed once on creation of cloning of the repository fro Git.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gui-development-setup"><a class="link" href="#gui-development-setup">GUI Development Setup</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#gui-setup-new-client-module">GUI Setup - New Client Module</a></span>
<span class="inline-toc"><a href="#gui-setup-existing-client-module">GUI Setup - Existing Client Module</a></span>
<span class="inline-toc"><a href="#gui-setup-common-setup">GUI Setup - Common Setup</a></span>
<span class="inline-toc"><a href="#gui-setup-idea">GUI Setup - IDEA</a></span>
<span class="inline-toc"><a href="#GUI Setup - Build Eframe Library">[GUI Setup - Build Eframe Library]</a></span>
<span class="inline-toc"><a href="#client-module-version-dependencies">Client Module Version Dependencies</a></span></p>
</div>
<div class="paragraph">
<p>If you have cloned the GIT repository for an existing client sub-module, then follow the
<a href="#gui-setup-existing-client-module">GUI Setup - Existing Client Module</a> instructions.  For new client sub-modules,
follow the <a href="#gui-setup-new-client-module">GUI Setup - New Client Module</a> instructions.</p>
</div>
<div class="paragraph">
<p>Some important notes about client development:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>npm</em> will install most modules in the sub-folder (<em>node_modules</em>).  This tends to be
a huge directory.  You will want to make sure it is in the git
<a href="#idea-and-the-client-folder">exclude</a> file.</p>
</li>
<li>
<p>Each client sub-module will use its own set of modules/versions.  These will be
packaged for each module separately.</p>
</li>
<li>
<p>Some packages are installed globally.  This means they are not in the (<em>node_modules</em>)
folder.  You can see which ones are global with the command <em>npm list -g --depth=0</em>  .</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="gui-setup-install-node-and-npm"><a class="link" href="#gui-setup-install-node-and-npm">GUI Setup - Install Node and npm</a></h4>
<div class="paragraph">
<p>Install <a href="https://nodejs.org/en/" target="_blank" rel="noopener">node and npm</a>.  This provides the npm tool, which is
used to install all of the javascript modules such as Vue and related modules.</p>
</div>
</div>
<div class="sect3">
<h4 id="gui-setup-new-client-module"><a class="link" href="#gui-setup-new-client-module">GUI Setup - New Client Module</a></h4>
<div class="paragraph">
<p>Creating a new client module is somewhat complex.  The easiest solution is to copy the
<em>eframe/src/templates/client/sample</em> folder to a new client folder in your module.
It should be copied to the <em>module/src/client/module</em> folder (replace <em>module</em> with your
ne module&#8217;s name).</p>
</div>
<div class="listingblock">
<div class="title">New Client Sub-Module Creation - Linux Commands</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="script">  cd src/client
  mkdir quality <i class="conum" data-value="1"></i><b>(1)</b>
  cd quality
  cp -r ../../../../templates/client/sample .  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates a sub-module named <em>'quality'</em>.  Use the sub-module name for your new client
sub-module.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the correct source path for the eframe templates folder here.
Linux command shown.  Use drag/drop on Windows.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="edit-copied-files"><a class="link" href="#edit-copied-files">Edit Copied Files</a></h5>
<div class="paragraph">
<p>Some of the files created above will need to be changed for your new client module.
The notes below assume the new client module name is <em>'quality'</em>.
Use your module name instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While editing in Intellij, you will receive requests to run 'npm install'.  Ignore
      these requests until you have finished editing the files below.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><em>package.json</em> - Need to change the top-level name/version.  You may need to
adjust versions to match the current eframe <em>package.json</em> file.</p>
</li>
<li>
<p><em>vue.config.js</em> - Change the '<em>/client/sample</em>' path to <em>'/client/sample'</em>.</p>
</li>
<li>
<p><em>vue.config.js</em> - Change the '<em>GUIPage</em>' section to the name of your page(s).</p>
</li>
<li>
<p><em>gradle.properties</em> - Set the <code>clientModules</code>=quality</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>gradle.properties</em> file should have an element like this:</p>
</div>
<div class="listingblock">
<div class="title">Adding clientModules to gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">clientModules=quality <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The list of client modules to init/build.  This can be a comma-delimited list for multiple
modules.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#entry-page-structure">Entry Page Structure</a> for more details on how the client pages are defined.</p>
</div>
</div>
<div class="sect4">
<h5 id="run-npm-init"><a class="link" href="#run-npm-init">Run npm Init</a></h5>
<div class="paragraph">
<p>Next, you will need to initialize the npm module system with this gradle option or
let Intellij run it for you when prompted.  The gradle commands are:</p>
</div>
<div class="listingblock">
<div class="title">New Client Sub-Module Creation - Linux Commands</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="script">  cd quality <i class="conum" data-value="1"></i><b>(1)</b>
  ./gradlew npmInit
  ./gradlew copyEframeLib</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The new client modiel created above.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gui-setup-new-client-module-without-template"><a class="link" href="#gui-setup-new-client-module-without-template">GUI Setup - New Client Module without Template</a></h4>
<div class="paragraph">
<p>Creating a new client module without the template is a complex task.  Don&#8217;t attempt this
without a good reason.</p>
</div>
<div class="listingblock">
<div class="title">Client First Time Setup</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="script">  cd src/client
  npm install -g @vue/cli <i class="conum" data-value="1"></i><b>(1)</b>
  vue create moduleName <i class="conum" data-value="2"></i><b>(2)</b>
  cd moduleName
  npm install vue@next --save <i class="conum" data-value="3"></i><b>(3)</b>
  npm install primevue --save  <i class="conum" data-value="4"></i><b>(4)</b>
  npm install primeicons --save
  npm install primeflex --save
  npm install vue-i18n@next --save
  npm install axios vue-axios --save
  npm install vuex@next --save
  npm install in-memoriam --save
  npm install compression-webpack-plugin@6.0.5 --save-dev
  npm install webpack-bundle-analyzer --save <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Installs the command line tool as a global utility.
<strong>This only needs to be done once for a given development system.</strong>
This provides the <em>vue</em> command used next.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Select the Vue3 option if prompted.
Creates a new module folder with an empty project structure.
The <em>moduleName</em> should match the module name used for the server-side.  See
<a href="#idea-and-the-client-folder">IDEA and the Client Folder</a> if you see the error that vue.ps1 is disabled (on windows
powershell).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Should install latest Vue 3.x.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The rest of the locally installed modules for use in your client module.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Analysis tool for exploring your package assets for production.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run your client project, you can run the local development server that was
created by the <em>vue create</em> command above:</p>
</div>
<div class="listingblock">
<div class="title">Run Empty Client Module</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="script">  cd quality
  npm run serve</code></pre>
</div>
</div>
<div class="paragraph">
<p>This runs the template client for testing purposes.  You will replace most of the
template html, javascript and Vue files for your module.</p>
</div>
</div>
<div class="sect3">
<h4 id="gui-setup-existing-client-module"><a class="link" href="#gui-setup-existing-client-module">GUI Setup - Existing Client Module</a></h4>
<div class="paragraph">
<p>Once you have cloned the GIT repository, you will need to run these Gradle tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(once) <strong>npmInit</strong> or <strong>npmInitAll</strong> - Runs the <em>npm install</em> command in the client module(s).
This downloads the npm libraries used by the client.</p>
</li>
<li>
<p>(after updates) <strong>npmBuild</strong> or <strong>npmBuildAll</strong> - Runs the <em>npm build</em> command in the
client module(s). This builds the production assets.  Typically, this is run after
client module code changes.</p>
</li>
<li>
<p>(after updates) <strong>copyEframeLib</strong> or <strong>copyEframeLibAll</strong> - Copies the current <a href="#eframe-lib">eframe-lib</a>
files to your module.   This is needed whenever the source for the <a href="#eframe-lib">eframe-lib</a>
changes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="gui-setup-common-setup"><a class="link" href="#gui-setup-common-setup">GUI Setup - Common Setup</a></h4>
<div class="paragraph">
<p>These setup actions apply to new and existing installations.</p>
</div>
<div class="sect4">
<h5 id="powershell-on-windows"><a class="link" href="#powershell-on-windows">Powershell on Windows</a></h5>
<div class="paragraph">
<p>Many Vue/npm commands are shipped as powershell commands (*.ps1).  By default, these are
restricted in powershell.  You will get an error like this:</p>
</div>
<div class="listingblock">
<div class="title">Client First Time Setup</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="script">vue --version <i class="conum" data-value="1"></i><b>(1)</b>


vue : File ..\vue.ps1 cannot be loaded because running scripts is disabled on this
system. For more information, see about_Execution_Policies at https:/go.microsoft.com/...
At line:1 char:1
+ vue --version
+ ~~~
    + CategoryInfo          : SecurityError: (:) [], PSSecurityException
    + FullyQualifiedErrorId : UnauthorizedAccess</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Command to print current version of vue in the client folder.  Will fail on
systems with Windows Powershell.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To avoid this, you should add <em>.cmd</em> to the end of the command:</p>
</div>
<div class="listingblock">
<div class="title">Client First Time Setup</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="script">  vue.cmd --version</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also just remove the <em>.ps1</em> file from the global npm folder (<em>C:\Users\XYZ\AppData\Roaming\npm</em>)
or enable execution of .ps1 files are described by Microsoft.</p>
</div>
</div>
<div class="sect4">
<h5 id="git-exclude-file"><a class="link" href="#git-exclude-file">GIT Exclude File</a></h5>
<div class="paragraph">
<p>Node/npm has a lot of files copied to your development folder.  These should be excluded
from the IDEA and GIT since they are generated files or open source libraries.
This means you should have these lines in your project&#8217;s GIT exclude file:</p>
</div>
<div class="listingblock">
<div class="title">.git/info/exclude</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="script">/eframe/src/main/resources/client/         <i class="conum" data-value="1"></i><b>(1)</b>
/eframe/src/client/eframe/node_modules/    <i class="conum" data-value="2"></i><b>(2)</b>
/eframe/src/client/sample/src/eframe-lib/  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The production files created by the <code>npmBuildLib</code> task.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The client module&#8217;s dependencies (huge).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The copied <a href="#eframe-lib">eframe-lib</a> source for support code for each client module.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gui-setup-idea"><a class="link" href="#gui-setup-idea">GUI Setup - IDEA</a></h4>
<div class="paragraph">
<p>The IDEA setup for npm development is fairly simple.  There are two basic run
configurations.</p>
</div>
<div class="paragraph">
<div class="title">Localhost (Dev)</div>
<p>The first is to run the development server as localhost:8081.  This lets you change your
client code and the server will update with those changes without restarting.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">npm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task is created from the npm template (Add New Configuration).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>package.json</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">package.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The package-json for the client module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>command</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">run</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scripts</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serve</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starts the dev server with hot-updates for your changes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Build</div>
<p>The second is the task to build the production assets for the client pages.
You will run this and then start/restart the micronaut application server to test
your client in a live server.  This will build the assets and store them in the
<em>src/main/resources/client</em> so the development server will have access to them for use
in the live server.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">npm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task is created from the npm template (Add New Configuration).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>package.json</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">package.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The package-json for the client module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>command</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">run</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scripts</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Builds the production assets for a live micronaut server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;--dest ../../main/resources/client/eframe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is where the assets
                                          will be created.
                                          This folder is the normal resource folder so that
                                          IDEA will copy them for use in the running development
                                          server.  (The <strong>arguments</strong> starts with two hyphens).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Intellij doesn&#8217;t always copy the <em>main/resources/client/</em> files to the <em>out</em>
      folder after a re-build.  We found that a Gradle 'Reload all Gradle Projects' in the
      Gradle window works.  After the reload, you will need to restart the localhost
      process.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="excluding-the-client-folder-from-searches"><a class="link" href="#excluding-the-client-folder-from-searches">Excluding the Client Folder from Searches</a></h5>
<div class="paragraph">
<p>Since the client assets are copied to the <em>main/resources/client</em> folder, the contents
will show up by default in the IDEA searches.  This is inconvenient. In the IDEA
Project Structure dialog (module <em>eframe/main</em>) you can 'exclude' the
<em>resources/client/eframe</em> folder.  (Replace <em>eframe</em> with the client sub-module name).</p>
</div>
</div>
<div class="sect4">
<h5 id="idea-and-the-client-folder"><a class="link" href="#idea-and-the-client-folder">IDEA and the Client Folder</a></h5>
<div class="paragraph">
<div class="title">node_modules</div>
<p>After installing these packages, the IDEA <em>Commit</em> tab will contain thousands of files
from the <em>node_modules</em> folder.  You should exclude this folder.  Select the folder
in the <em>Project</em> tab and choose the <em>Git</em> &#8594; <em>.git/info/exclude</em> option to exclude these
from the Git logic.</p>
</div>
<div class="paragraph">
<p>This will add it to the <em>.git/info/exclude</em> folder.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="client-module-version-dependencies"><a class="link" href="#client-module-version-dependencies">Client Module Version Dependencies</a></h4>
<div class="paragraph">
<p>npm uses two files for version control:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>package-lock.json</em> - The main module version listing for all modules.
This includes the exact version installed for all modules.
This file supercedes the <em>package.json</em> when the <em>npm install</em> command is used.</p>
</li>
<li>
<p><em>package.json</em> - The top-level modules used.  Contains the general versions for the
modules.  This is usually something like '^3.0.7' which means any 3.x version.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>package.json</em> and <em>package-lock.json</em> files are updated when you install a new
module as we did above with the tasks in <a href="#gui-setup-new-client-module">GUI Setup - New Client Module</a>.</p>
</div>
<div class="paragraph">
<p>When building the client modules on other systems from the git source, we use the command
<em>npm install</em>.  This installs all of the dependencies specified in the <em>package-lock.json</em>
file.  This uses the exact version from the <em>package-lock.json</em> file.  The version from
the <em>package.json</em> is not used for this scenario.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>package-lock.json</em> is the primary source of the versioning for npm.
      Unfortunately, this is independent of the <em>build.gradle</em> files.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gui-i18n"><a class="link" href="#gui-i18n">GUI I18n</a></h3>
<div class="paragraph">
<p>All GUIs must be localized.  The client sub-module supports multiple locales, with varying
support for languages.  The fallback language (English) is fully supported.
All text used on all display elements should be localized.</p>
</div>
<div class="paragraph">
<p>To support this localization, the client side of the framework supports locale files
for each supported language.  A typical set of files for a client module will include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>src/locales/en.js</strong> - The English language values.  The fallback language.</p>
</li>
<li>
<p><strong>src/locales/de.js</strong> - The German language values (Optional).  Other languages can be used too.</p>
</li>
<li>
<p><strong>src/locales/Locales.js</strong> - The combined language locales for the module.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the English file will look something like this:</p>
</div>
<div class="listingblock">
<div class="title">Locale JS File - src/locales/en.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">export</span> <span class="keyword">default</span> {
  getLocale() {  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">en</span><span class="delimiter">'</span></span>
  },
  getMessages() {  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">return</span> {
      <span class="key">label</span>: {     <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="key">category</span>: <span class="string"><span class="delimiter">'</span><span class="content">Category</span><span class="delimiter">'</span></span>,
        <span class="key">fields</span>: <span class="string"><span class="delimiter">'</span><span class="content">Fields</span><span class="delimiter">'</span></span>,
        <span class="key">flexType</span>: <span class="string"><span class="delimiter">'</span><span class="content">Flex Type</span><span class="delimiter">'</span></span>,
        <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Title</span><span class="delimiter">'</span></span>,
        <span class="key">searchStatusGreen</span>: <span class="string"><span class="delimiter">'</span><span class="content">Green</span><span class="delimiter">'</span></span>,
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provides the locale (language only supported).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Provides the localized text.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The basic types include (e.g. 'label', 'title', etc.).  The lookup key will be something
like <em>'label.title'</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These en.js, de.js, etc files are references in a single file for your module:</p>
</div>
<div class="listingblock">
<div class="title">Locale JS File - src/locales/Locales.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="reserved">import</span> en from <span class="string"><span class="delimiter">'</span><span class="content">./en.js</span><span class="delimiter">'</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="reserved">import</span> de from <span class="string"><span class="delimiter">'</span><span class="content">./de.js</span><span class="delimiter">'</span></span>

<span class="reserved">export</span> <span class="keyword">default</span> {
  getLocales() {  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">return</span> {<span class="key">en</span>: en.getMessages(), <span class="key">de</span>: de.getMessages()}
  },
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Loads the specific locale files for each language.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Provides the locales to the I18n system.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the Locales in your client app is farily simple.  There are two approaches allowed:</p>
</div>
<div class="listingblock">
<div class="title">Example - Locale Usage in Vue File</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="tag">&lt;template&gt;</span>
  <span class="tag">&lt;Button&gt;</span>{{ $t('label.flexType')  }}<span class="tag">&lt;/Button&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tag">&lt;Button</span> <span class="attribute-name">:label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$t('label.cancel')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>         <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tag">&lt;/template&gt;</span>


<span class="reserved">export</span> <span class="keyword">default</span> {
  <span class="key">methods</span>: {
    getLabel() {
      <span class="keyword">return</span> <span class="local-variable">this</span>.<span class="predefined">$t</span>(<span class="string"><span class="delimiter">'</span><span class="content">label.flexType</span><span class="delimiter">'</span></span>)}  <i class="conum" data-value="3"></i><b>(3)</b>
    },
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the 'mustache' syntax in the template/HTML section.  The localized text can&#8217;t
be used as the content of an attribute.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Used as a property/data element on the component.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Used as a method call with the global <em>$t()</em> syntax within Javascript.</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The 'mustache' syntax can&#8217;t be used in an HTML attribute.  For example this won&#8217;t
      work:  <em>&lt;Button label="{{ $t('label.flexType')  }}"/&gt;</em>.  You will need to
      use option 2 above (e.g. <em>:label="$t('label.cancel')"</em>).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="lookup-in-gui-tests"><a class="link" href="#lookup-in-gui-tests">Lookup in GUI Tests</a></h4>
<div class="paragraph">
<p>The <a href="groovydoc/org/simplemes/eframe/test/BaseGUISpecification.html" target="_blank" rel="noopener">BaseGUISpecification</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
tests will need to verify that labels are looked up correctly from the <em>en/de.js</em> files.
This is done with the utility
<a href="groovydoc/org/simplemes/eframe/test/WebClientLookup.html" target="_blank" rel="noopener">WebClientLookup</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.
The <em>WebClientLookup</em> class parses the <em>en/de.js</em> file(s) and uses the values from the .js
files for the lookup.</p>
</div>
<div class="paragraph">
<p>This avoids two mechanisms for localization (.js and .properties).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring"><a class="link" href="#monitoring">Monitoring</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#logging">Logging</a></span></p>
</div>
<div class="paragraph">
<p>This section covers general-purpose monitoring of your enterprise application.
Some of the information here is useful for your users.  You should document the specific areas
monitored in your application.</p>
</div>
<div class="sect2">
<h3 id="logging"><a class="link" href="#logging">Logging</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#levels">Levels</a></span>
<span class="inline-toc"><a href="#logging-guidelines">Logging Guidelines</a></span>
<span class="inline-toc"><a href="#micronaut-logback-groovy">Micronaut logback.groovy</a></span>
<span class="inline-toc"><a href="#dynamic-logging-configuration">Dynamic Logging Configuration</a></span>
<span class="inline-toc"><a href="#stack-trace-logging">Stack Trace Logging</a></span>
<span class="inline-toc"><a href="#javascript-client-logging">Javascript Client Logging</a></span>
<span class="inline-toc"><a href="#useful-logging-settings">Useful Logging Settings</a></span></p>
</div>
<div class="paragraph">
<p>Logging is a key part of monitoring and diagnosing enterprise applications.
You should monitor the logs to find problems before your users do.
This framework relies on the logging provided by <a href="https://www.slf4j.org/" target="_blank" rel="noopener">Slf4j</a> and
<a href="http://js.jsnlog.com/" target="_blank" rel="noopener">JSNLog</a>.</p>
</div>
<div class="paragraph">
<p>This logging is configured from <a href="#micronaut-logback-groovy">Micronaut logback.groovy</a> or from the
<a href="#dynamic-logging-configuration">Dynamic Logging Configuration</a> page.</p>
</div>
<div class="sect3">
<h4 id="levels"><a class="link" href="#levels">Levels</a></h4>
<div class="paragraph">
<p>The framework uses the standard Log4j logging levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Fatal</strong> - A system-wide fatal error has occurred.</p>
</li>
<li>
<p><strong>Error</strong> - A non-fatal error.</p>
</li>
<li>
<p><strong>Warn</strong> - A warning.  Something that should be investigated, but is not critical.</p>
</li>
<li>
<p><strong>Info</strong> - Information on the execution of the application.  Typically, performance timings are used here.</p>
</li>
<li>
<p><strong>Debug</strong> - Debugging information.  Depends on the class logging the information. Typically includes inputs, outputs and
possible work arounds for bugs.</p>
</li>
<li>
<p><strong>Trace</strong> - Detailed debugging information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, Error and Fatal messages are logged.  You can configure the system to log other messages for all classes
or for specific classes.</p>
</div>
<div class="paragraph">
<p>The Info, Debug and Trace levels are normally documented in the Javadoc for the class that issues the log message.</p>
</div>
</div>
<div class="sect3">
<h4 id="logging-guidelines"><a class="link" href="#logging-guidelines">Logging Guidelines</a></h4>
<div class="paragraph">
<p>Logging can be a big performance drain if done incorrectly.  The framework uses the simplest
<a href="http://www.slf4j.org/" target="_blank" rel="noopener">Slf4j</a> approach for best performance and clarity:</p>
</div>
<div class="listingblock">
<div class="title">Logging for Performance (Preferred Approach)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.util.logging.Slf4j</span>

<span class="annotation">@Slf4j</span>

   . . .

  log.trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">Summarizing Metric {}</span><span class="delimiter">&quot;</span></span>, metric) <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Uses replaceable parameter to avoid expensive <code>toString()</code> call if logging is not enabled.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This also helps with code coverage metrics.</p>
</div>
<div class="paragraph">
<p>It is best to avoid using these approaches:</p>
</div>
<div class="listingblock">
<div class="title">Logging - NOT Preferred</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">log.trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">Summarizing Metric </span><span class="inline"><span class="inline-delimiter">$</span>metric</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">if</span> (log.traceEnabled) {
  log.trace(<span class="string"><span class="delimiter">&quot;</span><span class="content">Summarizing Metric </span><span class="inline"><span class="inline-delimiter">$</span>metric</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works fine, but can hurt performance even if the log message is not written to the log.
The second option is more verbose.</p>
</div>
</div>
<div class="sect3">
<h4 id="micronaut-logback-groovy"><a class="link" href="#micronaut-logback-groovy">Micronaut logback.groovy</a></h4>
<div class="paragraph">
<p>The framework uses the normal logging mechanism from Micronaut (<em>logback.groovy</em>).
See <a href="http://logback.qos.ch/" target="_blank" rel="noopener">Logback</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="dynamic-logging-configuration"><a class="link" href="#dynamic-logging-configuration">Dynamic Logging Configuration</a></h4>
<div class="paragraph">
<p>The framework provides a GUI to display and temporarily adjust the logging levels for
many elements. This allows you to set the logging levels for controllers, domains and services.
It also provides other logger settings such as SQL tracing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Many loggers can produce a huge amount of data and can slow down your application.
      Please be careful when enabling logging on production servers.
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/logging.png" alt="logging">
</div>
</div>
<div class="paragraph">
<p>Logging changes made in this GUI are not persistent.  You will need to use the
<a href="#micronaut-logback-groovy">Micronaut logback.groovy</a> approach for persistent changes.</p>
</div>
<div class="paragraph">
<p>This dynamic logging page shows all possible domains, controllers,services and client pages
that <em>might</em> have logging available.  Not all entries listed have logging messages in their
code.</p>
</div>
</div>
<div class="sect3">
<h4 id="stack-trace-logging"><a class="link" href="#stack-trace-logging">Stack Trace Logging</a></h4>
<div class="paragraph">
<p>During development and testing, you generally want stack trace logged.    You can do this on
specific controllers (or the BaseController) as needed.</p>
</div>
<div class="paragraph">
<p>If you want to see some exception stack traces, then you can set the logging level for
'StackTrace' to debug.  This will make sure the stack trace is printed out in a number of cases
(e.g. from BaseController).</p>
</div>
</div>
<div class="sect3">
<h4 id="javascript-client-logging"><a class="link" href="#javascript-client-logging">Javascript Client Logging</a></h4>
<div class="paragraph">
<p>Many of the framework&#8217;s javascript libraries and UIs use the <a href="http://jsnlog.com/" target="_blank" rel="noopener">JSNLog</a>
logging framework for this client-side logging.  The messages are logged to the javascript
console in the browser and optionally to the application server logs.  The JSNLog library is
part of the normal assets loaded into all pages by the <em>header.ftl</em> include file.</p>
</div>
<div class="paragraph">
<p>This <a href="#efGUISetup">[efGUISetup]</a> will check the systems logging level for the given page and set it when
the page is displayed.  If the logging level is changed on the server, the page must be refreshed
to use the new logging level.</p>
</div>
<div class="paragraph">
<p>The logging levels can also be configured from the standard <a href="#micronaut-logback-groovy">Micronaut logback.groovy</a>
file or from <a href="#dynamic-logging-configuration">Dynamic Logging Configuration</a> page.  There is a section that lists all
of the views and their current levels.  There are also two important entries at the top:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>client</strong> - The default level for all clients.  This is the parent
logger for all client views.  This works the same as the package-level
logger setting for Java classes.</p>
</li>
<li>
<p><strong>client.to-server</strong> - The logging level that means: send the client log message
to the server log.  This will echo the message in the server log.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
These two levels affect all clients.  These two
           settings can generate a huge amount of log data on the server. <strong>Use Carefully</strong>!.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example use of the logging framework is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Example Javascript - Info Logging</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">JL().info(<span class="string"><span class="delimiter">&quot;</span><span class="content">log message</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default behavior of the client side logging is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logging is written to the browser&#8217;s javascript console.</p>
</li>
<li>
<p>Important messages are sent to the server (along with recent lower-level messages).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="searching"><a class="link" href="#searching">Searching</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc-header">Design</span>
<span class="inline-toc"><a href="#search-overview">Search Overview</a></span>
<span class="inline-toc"><a href="#search-layers">Search Layers</a></span>
<span class="inline-toc"><a href="#search-paging">Search Paging</a></span>
<span class="inline-toc"><a href="#search-id">Search ID</a></span></p>
</div>
<div class="paragraph">
<p><span class="inline-toc-header">Details</span>
<span class="inline-toc"><a href="#search-configuration">Search Configuration</a></span>
<span class="inline-toc"><a href="#searchable-domains">Searchable Domains</a></span>
<span class="inline-toc"><a href="#query-string-adjustments">Query String Adjustments</a></span>
<span class="inline-toc"><a href="#search-admin">Search Admin</a></span>
<span class="inline-toc"><a href="#search-engine-request-queue">Search Engine Request Queue</a></span>
<span class="inline-toc"><a href="#troubleshooting-search-issues">Troubleshooting Search Issues</a></span></p>
</div>
<div class="sect2">
<h3 id="search-overview"><a class="link" href="#search-overview">Search Overview</a></h3>
<div class="paragraph">
<p>Search is an important part of any modern web-based application.  This framework provides
built-in tools to index your domain classes and provide searching capabilities. The search
feature has these key requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Search all fields in a domain (used to find records in the standard list pages).</p>
</li>
<li>
<p>Global text search of all fields on all domains.</p>
</li>
<li>
<p>Search custom fields.</p>
</li>
<li>
<p>Search archived records for long-term traceability features.</p>
</li>
<li>
<p>An external search engine to allow scaling.</p>
</li>
<li>
<p>No significant impact on application startup or test startup.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because of these requirements, we decided to implement a custom integration with the
<a href="http://www.elastic.co/">Elastic Search</a> engine.  The framework uses the
<a href="http://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html">Elastic low-level Java API</a>
to reduce dependencies.  This should not cause problems with your application code
since this is hidden from the application level code.</p>
</div>
<div class="paragraph">
<p>The main features involved in search are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="groovydoc/org/simplemes/eframe/search/service/SearchService.html" target="_blank" rel="noopener">SearchService</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> -
Provides ability to search one or more domains.  This is the main API access for most
application code.</p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/search/controller/SearchController.html" target="_blank" rel="noopener">SearchController</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> -
Provides a GUI for these features and access to admin actions such as re-index all.</p>
</li>
<li>
<p>Domain search definitions - Defines how to index a domain.</p>
</li>
<li>
<p>Automatic indexing of domains on update/create.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The basic index updates are made by background threads to reduce the affect on the run-time
application code. This background mechanism uses queues to allow multiple threads to request
index updates as needed.</p>
</div>
<div class="sect3">
<h4 id="search-layers"><a class="link" href="#search-layers">Search Layers</a></h4>
<div class="paragraph">
<p>The search logic is broken into layers.  Generally, most application code should start at
the service/helper layers and let the lower layers handle the details.  The layers and important
objects involved are:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/searchLayers.png" alt="searchLayers" width="630" height="294">
</div>
<div class="title">Figure 13. Search Layers</div>
</div>
<div class="paragraph">
<p>The <a href="groovydoc/org/simplemes/eframe/search/service/SearchService.html" target="_blank" rel="noopener">SearchService</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> provide the important search method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>globalSearch()</code> - Searches all domains for the given string.  Structured Elastic Search
formats are supported.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you need to unit test your application code, then refer to the existing search tests such as
<em>SearchHelperSpec</em>.  These tests use the <em>MockSearchEngineClient</em> to simulate most search engine
actions.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-indexing"><a class="link" href="#search-indexing">Search Indexing</a></h4>
<div class="paragraph">
<p>This framework&#8217;s use of Elasticsearch is designed around a single index for each domain class and an
archive index for each archived domain class.  This provides a structured way to search for data
and still allows for a global search capability.</p>
</div>
<div class="paragraph">
<p>The search index name is the domain&#8217;s class name (minus package), in lower-case with a hyphen
for a delimiter between words.  For example, the index for <em>FlexType</em> is <em>'flex-type'</em>.</p>
</div>
<div class="paragraph">
<p>The archive index has <em>'-arc'</em> added to it.  Also, archived domains have a special field added:
<em>'_archiveReference'</em> that stores the archive file reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-paging"><a class="link" href="#search-paging">Search Paging</a></h4>
<div class="paragraph">
<p>The paging mechanism for searches is slightly different from the normal Toolkit and database
paging mechanisms. This makes for confusing overlaps with the other paging values.
The paging names and meanings are shown below:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Search</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>from</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The index of the first result to show.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>size</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of results to show.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">GUI Toolkit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>start</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The index of the first result to show.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>count</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of results to show.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Micronaut Data (DB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>from</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>page</em> number of the first result to show.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>size</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of results to show.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="search-id"><a class="link" href="#search-id">Search ID</a></h3>
<div class="paragraph">
<p>Elastic search uses a unique ID for all objects indexed.  The enterprise framework uses the
domain class&#8217;s UUID as this ID.  It is stored internally in the search engined as <em>_id</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="search-configuration"><a class="link" href="#search-configuration">Search Configuration</a></h3>
<div class="paragraph">
<p>Your search configuration is set in the <em>application.yml</em> file as normal.
The default settings are shown below:</p>
</div>
<div class="listingblock">
<div class="title">application.yml - Default Settings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eframe</span>:
  <span class="key">search</span>:
    <span class="key">threadInitSize</span>:  <span class="string"><span class="content">4    </span></span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">threadMaxSize</span>: <span class="string"><span class="content">10     </span></span><i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key">bulkBatchSize</span>: <span class="string"><span class="content">50     </span></span><i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key">hosts</span>:
      - <span class="string"><span class="content">{host: localhost, port: 9200, protocol: http} </span></span><i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>threadInitSize</strong> - The initial thread pool size for the background tasks.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><strong>threadMaxSize</strong> - The maximum thread pool size for the background tasks.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><strong>bulkBatchSize</strong> - The size of the batch for bulk index requests.  Used when rebuilding all indices.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><strong>hosts</strong>  - A list of search engine hosts that can process requests.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="threadinitsize"><a class="link" href="#threadinitsize">threadInitSize</a></h4>
<div class="paragraph">
<p>The <code>threadInitSize</code> value is the initial number of threads created to handle background search
indexing requests. This should be fairly small for most cases.  (<strong>Default:</strong> 4).</p>
</div>
</div>
<div class="sect3">
<h4 id="threadmaxsize"><a class="link" href="#threadmaxsize">threadMaxSize</a></h4>
<div class="paragraph">
<p>The <code>threadMaxSize</code> value is the maximum number of threads created to handle background search
indexing requests. This should be no larger than your search engine server can handle.  If it
is too small, then request may back up in the queue and indexing will lag.  If it is too big,
then the search engine may slow down significantly. (<strong>Default:</strong> 10).</p>
</div>
</div>
<div class="sect3">
<h4 id="bulkbatchsize"><a class="link" href="#bulkbatchsize">bulkBatchSize</a></h4>
<div class="paragraph">
<p>The <code>bulkBatchSize</code> value max batch bulk re-index requests.  Used when rebuilding all indices.
This helps reduce the load on the search engine server when forcing a full index rebuild.
A larger value may be needed with extremely big databases, but it will increase the load on the
the search engine server.  (<strong>Default:</strong> 50).</p>
</div>
<div class="paragraph">
<p>If you set this to a very large value, then the each request will be large and may consume
too much memory. If too small, then this will generate a huge number of small requests to
process. The default is a good compromise.</p>
</div>
</div>
<div class="sect3">
<h4 id="hosts"><a class="link" href="#hosts">hosts</a></h4>
<div class="paragraph">
<p>These are the search engine servers that you will use. Only one is required for the search feature to work
correctly.  Multiples are supported.  No default is provided. (<strong>Required</strong>).</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eframe</span>:
  <span class="key">search</span>:
    <span class="key">hosts</span>:
      - <span class="string"><span class="content">{host: localhost, port: 9200, protocol: http} </span></span><i class="conum" data-value="1"></i><b>(1)</b>
      - <span class="string"><span class="content">{host: elastic, port: 9200, protocol: http}</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Multiple hosts can be defined.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This defines the servers to connect to for the external search engine.</p>
</div>
</div>
<div class="sect3">
<h4 id="fallback"><a class="link" href="#fallback">Fallback</a></h4>
<div class="paragraph">
<p>To speed testing and reduce setup time, you don&#8217;t have to use a search engine.  Instead,
the places where the search engine is used will either be disabled or will fall back to
simpler SQL-based searches.</p>
</div>
<div class="paragraph">
<p>The standard definition List pages will use SQL searches on the primary key field.
Most other search features will be disabled.</p>
</div>
<div class="paragraph">
<p>The goal of the fallback is not to provide the entire set of search features. The goal is to
make sure you can test other aspects of your application without the overhead of an external
search engine. To make this even easier on you, the initial connection to the external search
engine is only made when it is first used.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="searchable-domains"><a class="link" href="#searchable-domains">Searchable Domains</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#index-domain-requirements">Index Domain Requirements</a></span>
<span class="inline-toc"><a href="#index-options">Index Options</a></span>
<span class="inline-toc"><a href="#excluded-fields">Excluded Fields</a></span>
<span class="inline-toc"><a href="#indices-created">Indices Created</a></span>
<span class="inline-toc"><a href="#default-mapping">Default Mapping</a></span>
<span class="inline-toc"><a href="#search-and-child-record-updates">Search and Child Record Updates</a></span></p>
</div>
<div class="sect3">
<h4 id="index-example"><a class="link" href="#index-example">Index Example</a></h4>
<div class="paragraph">
<p>By default, domains are not searchable.  You will need to add a static field to the domain class
to tell the framework that the domain is searchable.  The simplest approach is:</p>
</div>
<div class="listingblock">
<div class="title">Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@MappedEntity</span>
<span class="annotation">@DomainEntity</span>
<span class="annotation">@JsonFilter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">searchableFilter</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">Order</span> {
    . . .
  static searchable = <span class="predefined-constant">true</span>       <i class="conum" data-value="2"></i><b>(2)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>@JsonFilter</em> defines the <em>'searchableFilter'</em> for this domain when generating the
JSON document for the search engine.  This is needed if you use the <code>excludes</code>
<a href="#index-options">Index Options</a>.
This will also filter out some un-searchable elements to reduce the size of the search
engine documents.  This removes fields such as <code>dateCreated</code>, <code>uuid</code> and numerics.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The domain is marked as a top-level searchable domain.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In general, you should make the important top-level objects searchable.  You should not mark
child elements of these top-level domains.  They will be part of the nested JSON document
sent to the search engine. This allows you to
search for nested values more easily.  It does have the drawback of using larger documents
in the index.  Of course, it means fewer documents in the index too.</p>
</div>
</div>
<div class="sect3">
<h4 id="index-domain-requirements"><a class="link" href="#index-domain-requirements">Index Domain Requirements</a></h4>
<div class="paragraph">
<p>The domains have some requirements to make indexing work:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@JsonFilter("searchableFilter")</strong> - Indicates the JSON filter used for the search content.
See <a href="#index-example">Index Example</a>.</p>
</li>
<li>
<p><strong>version</strong> - A version field in the domain.  Must default to 0 for new records.</p>
</li>
<li>
<p><strong>static searchable field</strong> - The domain must be flagged as searchable.  See <a href="#index-options">Index Options</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="index-options"><a class="link" href="#index-options">Index Options</a></h4>
<div class="paragraph">
<p>When the domain object is indexed, there are other options.</p>
</div>
<div class="listingblock">
<div class="title">Searchable Options</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> searchable = [<span class="key">searchable</span>: <span class="predefined-constant">false</span>, <span class="key">exclude</span>: [<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">releaseDate</span><span class="delimiter">'</span></span>], <span class="key">parent</span>: Order]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following options are allowed in the searchable value:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>exclude</strong> - The field(s) to exclude.  These fields are excluded at this level of the index.
The value can be a single string or a list of strings.
This option requires the use of the <em>@JsonFilter("searchableFilter")</em> on the
domain class, as mentioned above. <strong>(Optional)</strong></p>
</li>
<li>
<p><strong>parent</strong> -  The immediate parent domain object that is searchable.  This means that changes
to this domain will trigger a re-index on the parent (or grand-parent, etc).
The value is a Class. <strong>(Optional)</strong></p>
</li>
<li>
<p><strong>searchable</strong> - If <strong>true</strong>, then this is the top-level of the search document.
This is the same as '<em>static searchable=true</em>'.
If <strong>false</strong>, then it will not be sent to the search engine, unless it is a child of
another top-level document.  You may need to set this to <strong>false</strong> to exclude fields
from a child record (<strong>Default</strong>: true).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="groovydoc/org/simplemes/eframe/search/SearchDomainSettings.html" target="_blank" rel="noopener">SearchDomainSettings</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> for the specific settings that can be defined
for a domain.</p>
</div>
</div>
<div class="sect3">
<h4 id="excluded-fields"><a class="link" href="#excluded-fields">Excluded Fields</a></h4>
<div class="paragraph">
<p>As shown in <a href="#index-options">Index Options</a>, you can excluded specific fields from indexing in the
search engine.  This is done to speed up searches and to reduce the database size in
the search server.</p>
</div>
<div class="paragraph">
<p>Some additional fields are automatically removed from the index:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>uuid</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The UUID is already the unique ID used by the search engine.
          There is no real need to search on this.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version is a simple integer, so searches are not useful.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dateCreated</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dates are difficult to search on.  This is better done in SQL.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dateUpdated</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dates are difficult to search on.  This is better done in SQL.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>all fields that start with</strong> _</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Most of these fields do not contain user-defined values for search.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="indices-created"><a class="link" href="#indices-created">Indices Created</a></h4>
<div class="paragraph">
<p>Elastic Search 6.x and above have deprecated the use of an index type.  This means each domain
will be indexed into its own index with a type set to <em>doc</em>.  The name is the same as the domain
class (hyphenated with all lower case letters).  The domain <em>Order</em> will be indexed under
the index <em>order</em>.</p>
</div>
<div class="paragraph">
<p>This means you need to never have domains that only differ in class case (e.g. two domains
<em>'RMA'</em> and <em>'Rma'</em> is not allowed).</p>
</div>
</div>
<div class="sect3">
<h4 id="default-mapping"><a class="link" href="#default-mapping">Default Mapping</a></h4>
<div class="paragraph">
<p>The default mapping is the same as for the <a href="#api-formats">API Formats</a>.  This means child records will be indexed fully.
Foreign references to other domains will be indexed with only their key fields.  This means you can search for
domains that have a foreign reference to the FlexType <em>'SERIAL'</em> and the global search will find them.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-and-child-record-updates"><a class="link" href="#search-and-child-record-updates">Search and Child Record Updates</a></h4>
<div class="paragraph">
<p>It is very common for the application to update a child record without updating the parent
record.  For example, an Order might have some order line item records.  If one of those
child records is updated without updating the parent, then the search engine logic
won&#8217;t be automatically called.</p>
</div>
<div class="paragraph">
<p>Instead, you should explicitly let the framework know that you updated the child record.
This is done for assembly records using logic like this:</p>
</div>
<div class="listingblock">
<div class="title">Example - Update Child Record without Parent Update</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  OrderAssembledComponent addComponent(AddOrderAssembledComponentRequest request) {

    . . .    <i class="conum" data-value="1"></i><b>(1)</b>

    def orderAssembledComponent = <span class="keyword">new</span> OrderAssembledComponent()
    orderAssembledComponent.save()                                <i class="conum" data-value="2"></i><b>(2)</b>
    DomainEntityHelper.instance.childRecordUpdated(order, orderAssembledComponent)  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">return</span> orderAssembledComponent
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Application logic to allow building the child OrderAssembledComponent record.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The child record is saved without saving the parent order for performance reasons.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Notify the framework and search engine that the order has changed.  This normally
triggers a re-indexing of the parent record.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-string-adjustments"><a class="link" href="#query-string-adjustments">Query String Adjustments</a></h3>
<div class="paragraph">
<p>The search engine is very versatile in finding data.  However, some of the query strings the user
must build can be very complex.  For example, the search term must match the entire term that
is indexed by the search engine.  This means if the object contains <em>'Monitor'</em>, then the search
string <em>'Mon'</em> will not find the object.</p>
</div>
<div class="paragraph">
<p>Another more complex issue is when the data is deeply nested. To find a custom <code>LOT</code> value of
<em>'87929459'</em> in an assembled order (the MES-Assembly module) the user needs to use the
query string:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>assembledComponents.assemblyData_LOT:87929459</pre>
</div>
</div>
<div class="paragraph">
<p>We want to use a simpler format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>assy.lot:87929459</pre>
</div>
</div>
<div class="paragraph">
<p>To make this possible, the MES-Assembly module will adjust the query string under the right
scenarios to find the data the user wants.</p>
</div>
<div class="paragraph">
<p>The framework adjusts the query string using the method
<a href="groovydoc/org/simplemes/eframe/search/SearchService.html" target="_blank" rel="noopener">SearchService.adjustQuery()</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.
This allows each module (see <a href="#module-additions">Module Additions</a>) to adjust the string for its
own data structures.</p>
</div>
<div class="paragraph">
<p>Most adjustments happen only on simple query strings.  If the string contains a quote, then the
string is usually not adjusted.</p>
</div>
<div class="paragraph">
<p>The framework performs a simple adjustment that adds '*' to the string if it does not have
a '*' in the string.  This allows partial searches to work easier.  This is only done if the
query string is simple.  If the string has a space, parentheses or other query logic then
the adjustment is not made.</p>
</div>
</div>
<div class="sect2">
<h3 id="search-admin"><a class="link" href="#search-admin">Search Admin</a></h3>
<div class="paragraph">
<p>The search admin page shows the current status of the external search engine and any background
tasks that pending (including a background index rebuild tasks).</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/searchAdmin.png" alt="searchAdmin" width="750">
</div>
<div class="title">Figure 14. Search Admin</div>
</div>
<div class="sect3">
<h4 id="rebuild-search-indices"><a class="link" href="#rebuild-search-indices">Rebuild Search Indices</a></h4>
<div class="paragraph">
<p>The admin page displays a button to rebuild all search indices for the system.  This will:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ask the user: <em>Are you sure?</em></p>
</li>
<li>
<p>Delete all indices in the external search engine.</p>
</li>
<li>
<p>Start rebuilding the indices for all searchable domain objects.</p>
</li>
<li>
<p>Start rebuilding the indices for any archive files found in the file system.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since these tasks can take a long time, they are executed in the background.  This admin page
will show the current status of the rebuild tasks.</p>
</div>
<div class="paragraph">
<p>The <a href="#bulkbatchsize">bulkBatchSize</a> setting is used to build the bulk index requests.
Each request will contain this number of records (<code>batchSize</code>).  If you set this to a very large
value, then the each request will be large and may consume too much memory.  If too small,
then this will generate a huge number of small requests to process.  The default is a good
compromise.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-engine-request-queue"><a class="link" href="#search-engine-request-queue">Search Engine Request Queue</a></h3>
<div class="paragraph">
<p>Whenever a searchable domain object is updated, a request is created to create/update the index
in the external search engine.  This can generate a huge amount of request on a heavily loaded
system. To avoid application slow-down, the framework implements a thread pool executor
<a href="groovydoc/org/simplemes/eframe/search/SearchEnginePoolExecutor.html" target="_blank" rel="noopener">SearchEnginePoolExecutor</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> to handle these requests.  This executor also handles bulk
index requests and index delete requests.</p>
</div>
<div class="paragraph">
<p>This executor has an unlimited request queue and a finite number of threads to process these
requests. In practice, this means you should not need to worry too much about the queue.
The search admin page can give details on its status.
The number of threads to handle these requests is configurable in the application.yml.
See <a href="#search-configuration">Search Configuration</a> for details.</p>
</div>
<div class="paragraph">
<p>One of the drawbacks of using a queue is that it may take awhile for an updated record to be
indexed. This is not a big problem, but you should be aware of it.  In extreme cases when the
external search engine is not available, then errors will be logged and the indexing will not
take place.  A re-index all action is available.</p>
</div>
<div class="paragraph">
<p>As an application developer, the executor is mostly hidden from you. Most of the application
level actions should be triggered using the
<a href="groovydoc/org/simplemes/eframe/search/SearchService.html" target="_blank" rel="noopener">SearchService</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.
Behind the scenes, a <em>SearchHelper</em> and a <em>SearchEngineClient</em> class handles the actual interface
work.  You should not need to use those levels of access.</p>
</div>
</div>
<div class="sect2">
<h3 id="troubleshooting-search-issues"><a class="link" href="#troubleshooting-search-issues">Troubleshooting Search Issues</a></h3>
<div class="paragraph">
<p>Search is a complex subject.  Adding in the external search engine server makes troubleshooting
a difficult task.  To determine what is happening inside of the search logic, you can enable
TRACE logging on the package <em>org.simplemes.eframe.search</em>.  This will print performance data
and all inputs and outputs used when talking to the search engine server.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing"><a class="link" href="#testing">Testing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#testing-philosophy">Testing Philosophy</a></span>
<span class="inline-toc"><a href="#testing-overview">Testing Overview</a></span>
<span class="inline-toc"><a href="#testing-guidelines">Testing Guidelines</a></span>
<span class="inline-toc"><a href="#basespecification">BaseSpecification</a></span>
<span class="inline-toc"><a href="#detecting-test-mode">Detecting Test Mode</a></span>
<span class="inline-toc"><a href="#test-helpers">Test Helpers</a></span>
<span class="inline-toc"><a href="#mocking-beans">Mocking Beans</a></span>
<span class="inline-toc"><a href="#creating-test-data">Creating Test Data</a></span>
<span class="inline-toc"><a href="#test-data-pollution">Test Data Pollution</a></span>
<span class="inline-toc"><a href="#controller-testing">Controller Testing</a></span>
<span class="inline-toc"><a href="#domain-testing">Domains</a></span>
<span class="inline-toc"><a href="#gui-testing">GUI Testing</a></span>
<span class="inline-toc"><a href="#api-testing">API Testing</a></span>
<span class="inline-toc"><a href="#dashboard-activity-testing">Dashboard Activity Testing</a></span></p>
</div>
<div class="paragraph">
<p>Automated testing of your application is critical to your success.
The Enterprise Framework module helps you test your application with test support helpers.</p>
</div>
<div class="sect2">
<h3 id="testing-philosophy"><a class="link" href="#testing-philosophy">Testing Philosophy</a></h3>
<div class="paragraph">
<p>Our applications use the unit tests to test as much code as possible.
These can be 'true' unit tests or more like integration tests.
This is done for speed purposes.</p>
</div>
<div class="paragraph">
<p>GUI tests end with '<em>GUISpec</em>'.  These typically trigger an embedded server startup.
Some tests will test domains, which will start the data store for testing the full
domain stack.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-type-of-test"><a class="link" href="#what-type-of-test">What Type of Test</a></h3>
<div class="paragraph">
<p>The automated tests for SimpleMES come in two flavors: unit/API and GUI tests.
Since they are faster, unit tests are used whenever possible. GUI tests are run within a
simple application server and will exercise the database and internal workings of the full
application.</p>
</div>
<div class="paragraph">
<p>Here is a summary of when and where to use the types of testing:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Objects</th>
<th class="tableblock halign-left valign-top">Unit/API Testing</th>
<th class="tableblock halign-left valign-top">GUI Testing</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constraints, Validations, Basic Persistence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rarely</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param Mapping, JSON Conversion, Results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rarely - API Access Testing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Logic, Error Conditions
               Tests for all (most) supported scenarios.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">End-To-End Scenarios</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GUIs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rarely</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Most GUI Testing</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In general, any test is designed to cover just the code in one class (code under test).
Some API and GUI tests cover many objects and their orchestration of complex business logic.
These are usually noted as end-to-end (E2E) or GUI tests.  These typically
cover code that has already been tested in unit tests, but ensures that the end-to-end
scenarios work as expected.</p>
</div>
<div class="paragraph">
<p>Most controller tests will test the logic using full API calls via an HTTPClient (e.g using
<a href="groovydoc/org/simplemes/eframe/test/BaseAPISpecification.html" target="_blank" rel="noopener">BaseAPISpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>).  Since most controllers have little business
logic, then only limited testing is needed (e.g. type conversions, error handling,
response codes).</p>
</div>
</div>
<div class="sect2">
<h3 id="testing-overview"><a class="link" href="#testing-overview">Testing Overview</a></h3>
<div class="paragraph">
<p>The framework has a lot of support utilities to reduce your test code.  In general, we want
your tests to be as concise as your application code.  For example, imagine you have a simple
domain class:</p>
</div>
<div class="listingblock">
<div class="title">Example Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@MappedEntity</span>
<span class="type">class</span> <span class="class">Order</span> {
  <span class="annotation">@Column</span>(length = FieldSizes.MAX_CODE_LENGTH, nullable = <span class="predefined-constant">false</span>)
  <span class="predefined-type">String</span> order
  <span class="predefined-type">BigDecimal</span> qty = <span class="float">1.0</span>
  <span class="annotation">@Nullable</span> Product product  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="predefined-type">BigDecimal</span> qtyScrapped = <span class="float">0.0</span>

  <span class="directive">static</span> fieldOrder = [<span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">qty</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">product</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optional</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can test this very concisely with this domain unit test DSL (Domain Specific Language):</p>
</div>
<div class="listingblock">
<div class="title">Example Domain Test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">UserSpec</span> <span class="directive">extends</span> BaseSpecification {  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="directive">static</span> dirtyDomains = [User, <span class="predefined-type">Role</span>]  <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that user domain enforces constraints</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the constraints are enforced</span><span class="delimiter">'</span></span>
    DomainTester.test {                             <i class="conum" data-value="3"></i><b>(3)</b>
      domain Order
      requiredValues <span class="key">order</span>: <span class="string"><span class="delimiter">'</span><span class="content">M1003</span><span class="delimiter">'</span></span>, <span class="key">qty</span>: <span class="float">2.0</span>
      maxSize <span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>, FieldSizes.MAX_CODE_LENGTH
      notNullCheck <span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>
      notInFieldOrder ([<span class="string"><span class="delimiter">'</span><span class="content">qtyScrapped</span><span class="delimiter">'</span></span>])
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Uses the common Spock <a href="groovydoc/org/simplemes/eframe/test/BaseSpecification.html" target="_blank" rel="noopener">BaseSpecification</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicates that the embedded server and database are needed and that the User and Role
objects will need to be cleaned up when the test finishes.  See <a href="#test-data-pollution">Test Data Pollution</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A Domain test helper to simplify testing.  See <a href="#domain-testing">Domains</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is much shorter than the equivalent unit test without the
<a href="groovydoc/org/simplemes/eframe/test/DomainTester.html" target="_blank" rel="noopener">DomainTester</a>.</p>
</div>
<div class="sect3">
<h4 id="testing-guidelines"><a class="link" href="#testing-guidelines">Testing Guidelines</a></h4>
<div class="paragraph">
<p>Tests are critical to complex enterprise applications.  This means you will have many thousands
of tests to maintain.  These tests must be reliable and easily survive changes to the core
classes.</p>
</div>
<div class="paragraph">
<p>To keep these classes in good shape, we follow these guidelines:</p>
</div>
<div class="sect4">
<h5 id="treat-tests-as-if-they-are-production-code"><a class="link" href="#treat-tests-as-if-they-are-production-code">Treat tests as if they are production code</a></h5>
<div class="paragraph">
<p>Tests will make up at least 50% of your code base.  It is critical that the test code be of the
same quality as the production code.   This means following the same naming, commenting and coding
guidelines as the production code.</p>
</div>
</div>
<div class="sect4">
<h5 id="test-organization"><a class="link" href="#test-organization">Test organization</a></h5>
<div class="paragraph">
<p>The main goal here is to keep all tests in obvious places.  When a developer needs to add a test,
the specification it belongs in should be obvious.</p>
</div>
<div class="paragraph">
<p>Some naming conventions for a <em>SomeWidget</em> test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>SomeWidgetSpec</em> - Basic tests.  Some may need real database for tests using domain objects.</p>
</li>
<li>
<p><em>SomeWidgetAPISpec</em> - Non-GUI tests that need a live embedded server.  Typically tests REST API via an HTTP client. See <a href="#api-testing">API Testing</a>.</p>
</li>
<li>
<p><em>SomeWidgetGUISpec</em> - The GUI tests for the widget.  Runs a live embedded server and tests via GEB. See <a href="#gui-testing">GUI Testing</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So basically, all <em>SomeWidget</em> tests should be in specifications that start with <em>SomeWidget</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="use-of-core-domain-objects"><a class="link" href="#use-of-core-domain-objects">Use of core domain objects</a></h5>
<div class="paragraph">
<p>It is tempting to use core domain objects such as <em>User</em> or <em>FlexType</em> as test classes.
For example, when testing the <em>SomeWidget</em>, it was tempting to use the <em>User</em> domain as a test subject.
Instead, we chose to use domains for the <em>sample.domain</em> package.</p>
</div>
<div class="paragraph">
<p>This allows us more flexibility to change the core classes without breaking dozens of tests.</p>
</div>
<div class="paragraph">
<p>During early development, we found that the same core classes were being used in un-related tests
because the domain classes had the right fields we needed to test.  Then, we could not easily change
the core domain class because of dependencies in the test suite.  These dependencies were
unnecessary, so we decided to avoid them in the future.</p>
</div>
<div class="paragraph">
<p>We still have tests that exercise the core classes, but those are directly related to those
classes behaviors.</p>
</div>
</div>
<div class="sect4">
<h5 id="no-test-spec-for-a-single-specific-issue"><a class="link" href="#no-test-spec-for-a-single-specific-issue">No test spec for a single specific issue</a></h5>
<div class="paragraph">
<p>We will not create a new test specification for a specific issue. Instead, we will find the
correct test specification and add a new method.  It is ok to use the Spock <em>@Issue()</em> annotation
to document what issue the test verifies.</p>
</div>
<div class="paragraph">
<p>For example, we have a bug in <em>SomeWidget</em> with the localization of the column header.
We would add a new test method to the <em>SomeWidgetSpec</em> such as:</p>
</div>
<div class="listingblock">
<div class="title">Example Issue Verification Test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="annotation">@Issue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.simplemes.org/issues/3482</span><span class="delimiter">&quot;</span></span>)
  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the primary column label is localized</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">some test records</span><span class="delimiter">'</span></span>
    <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">some stuff</span><span class="delimiter">'</span></span>
     . . .
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main goal here is to keep all tests in obvious places.  All <em>SomeWidget</em> tests should be in
specifications that start with <em>SomeWidget</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basespecification"><a class="link" href="#basespecification">BaseSpecification</a></h4>
<div class="paragraph">
<p>There is a common Spock specification class
<a href="groovydoc/org/simplemes/eframe/test/BaseSpecification.html" target="_blank" rel="noopener">BaseSpecification</a>
that most tests should inherit from.  This base class
provides simple startup and mocking features to make your tests as simple as possible.  It
also performs checks after cleanup to make sure that your tests did not leave too much bad data
around.</p>
</div>
<div class="paragraph">
<p>Some of the cleanup checks performed include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check for records in all domains.</p>
</li>
<li>
<p>Reset any utility instance variables.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="baseguispecification"><a class="link" href="#baseguispecification">BaseGUISpecification</a></h4>
<div class="paragraph">
<p>There is a common Spock specification class
<a href="groovydoc/org/simplemes/eframe/test/BaseGUISpecification.html" target="_blank" rel="noopener">BaseGUISpecification</a>
that provides support for GUI/GEB tests.  This includes login/out and debug functions for
GEB elements.</p>
</div>
</div>
<div class="sect3">
<h4 id="detecting-test-mode"><a class="link" href="#detecting-test-mode">Detecting Test Mode</a></h4>
<div class="paragraph">
<p>Sometimes, you need to detect when some piece of code is running in test or development mode.
This should be rare, but you can use the <em>Holders</em> class:</p>
</div>
<div class="listingblock">
<div class="title">Example - Detecting Test Mode</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// For unit tests without server active, we will not force a change to the admin user password.</span>
<span class="keyword">if</span> (Holders.environmentDev || Holders.environmentTest) {
  adminUser.passwordExpired = <span class="predefined-constant">false</span>  <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This logic is not triggered in production mode.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="test-helpers"><a class="link" href="#test-helpers">Test Helpers</a></h4>
<div class="paragraph">
<p>There are many helper classes that make your testing easier.  The helper classes used
to make testing easier include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#domain-testing">DomainTester</a> - Tests Constraints and FieldOrder</p>
</li>
<li>
<p><a href="#gui-test-helpers">GUI Test Helpers</a> - Tests CRUD GUI pages for a domain class.</p>
</li>
<li>
<p><a href="#controller-test-helper">Controller Test Helper</a> - Controller Test Utilities.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, there is a series of base classes used in Spock tests that simplifies testing of common features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#basespecification">BaseSpecification</a> - Base class for non-GUI testing.  Includes support for a database and Embedded servers test.</p>
</li>
<li>
<p><a href="#baseguispecification">BaseGUISpecification</a> - Base class for GUI testing or non-GUI testing.  Includes GUI login/logout and other common functions.</p>
</li>
<li>
<p><a href="#baseapispecification">BaseAPISpecification</a> - Non-GUI access to controller actions in integration tests.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="mocking-beans"><a class="link" href="#mocking-beans">Mocking Beans</a></h4>
<div class="paragraph">
<p>Quite often, you will need to mock a bean for use in your tests.  The framework provides a simple
way to mock the bean.</p>
</div>
<div class="listingblock">
<div class="title">Example - Mocking a Singleton Bean</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">a mock object mapper</span><span class="delimiter">'</span></span>
<span class="keyword">new</span> MockBean(<span class="local-variable">this</span>, ObjectMapper, <span class="keyword">new</span> ObjectMapper()).install() <i class="conum" data-value="1"></i><b>(1)</b>

<span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the bean is found in the context</span><span class="delimiter">'</span></span>
<span class="keyword">def</span> bean = Holders.applicationContext.getBean(ObjectMapper)  <i class="conum" data-value="2"></i><b>(2)</b>
bean  <span class="keyword">instanceof</span> ObjectMapper</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The mock ObjectMapper instance is added to the context.  This can be a real instance
or a normal Spock Mock() class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bean is found the normal way from the Micronaut application context.
This is normally done by collaborating code to find the desired singleton ObjectMapper.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will create a mocked bean instance from the concrete class for use in your tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-test-data"><a class="link" href="#creating-test-data">Creating Test Data</a></h4>
<div class="paragraph">
<p>Many tests rely on domain data to properly test your code.  Creating this test data is a tedious
process that can be simplified with this DSL (Domain Specific Language):</p>
</div>
<div class="listingblock">
<div class="title">Example Test Data Creation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">UserSpec</span> <span class="directive">extends</span> BaseSpecification {  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="directive">static</span> specNeeds = SERVER <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="directive">static</span> dirtyDomains = [Order]

  <span class="annotation">@Rollback</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the order controller list method works</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">some test records</span><span class="delimiter">'</span></span>
    DataGenerator.generate { <i class="conum" data-value="4"></i><b>(4)</b>
      domain Order
      count <span class="integer">10</span>
      values <span class="key">qtyToBuild</span>: <span class="float">12.2</span>, <span class="key">customer</span>: <span class="string"><span class="delimiter">'</span><span class="content">CUSTOMER-$i</span><span class="delimiter">'</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
    }
    <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">some stuff</span><span class="delimiter">'</span></span>
     . . .
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Uses the common Spock <a href="#basespecification">BaseSpecification</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicates that the Micronaut Data system needs to be started and that the Order
objects will need to be cleaned up when the test finishes.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Rollback is supported, but not required.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The data generator.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Other values to populate the record(s).  Supports G-String like replacements inside
single quoted strings.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will generate 10 records like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>order: ABC001
title: abc010</pre>
</div>
</div>
<div class="paragraph">
<p>The primary key (if a string) will be loaded with a sequential value from 1..count.
The title (if in the object) will be set to a similar value, but decreasing number will be
used (e.g. count..1). This will be done in a transaction automatically, so no need to use
<em>Order.withTransaction</em> in your
test code.</p>
</div>
<div class="paragraph">
<p>See the <a href="groovydoc/org/simplemes/eframe/test/DataGenerator.html" target="_blank" rel="noopener">DataGenerator</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
for details.</p>
</div>
<div class="paragraph">
<p>To reduce the boiler-plate code in your tests, you can generate a single record with the same utility:</p>
</div>
<div class="listingblock">
<div class="title">Example Test Data Creation - Single Record</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="keyword">def</span> (Order order) = DataGenerator.generate { <i class="conum" data-value="1"></i><b>(1)</b>
    domain Order
    values <span class="key">qtyToBuild</span>: <span class="float">12.2</span>, <span class="key">customer</span>: <span class="string"><span class="delimiter">'</span><span class="content">CUSTOMER-$i</span><span class="delimiter">'</span></span>
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This generates a list with one element.  The first record is stored in the variable
<code>order</code> with a type of <em>Order</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This relies on the ability to return multiple values from a method in Groovy.</p>
</div>
</div>
<div class="sect3">
<h4 id="test-data-pollution"><a class="link" href="#test-data-pollution">Test Data Pollution</a></h4>
<div class="paragraph">
<p>Test data pollution in the in-memory database can be a big problem in making tests reliable.
This pollution happens when domain records are left over from earlier tests.  These records can
cause problems with the other tests that expect an empty database.  This biggest problem is
finding the test that left the data.</p>
</div>
<div class="paragraph">
<p>Most non-GUI tests can avoid this problem by using the <em>@Rollback</em> annotation for the test method.
This works great for simple tests, but GUI tests must commit the data to the database to work.</p>
</div>
<div class="paragraph">
<p>All sub-classes of
<a href="groovydoc/org/simplemes/eframe/test/BaseSpecification.html" target="_blank" rel="noopener">BaseSpecification</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
will check for left over records.  This checks every domain after every test and will cause the
test to fail if any left over records are found.</p>
</div>
<div class="paragraph">
<p>To help you remove these records, most tests can use the simple <code>dirtyDomains</code>
static list of classes.  After the test finishes, all records in those domains will be deleted.
Some core records such as the <em>admin</em> user and roles will be left in the database.</p>
</div>
<div class="listingblock">
<div class="title">Example Test Data Creation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">UserSpec</span> <span class="directive">extends</span> BaseSpecification {

  <span class="directive">static</span> dirtyDomains = [Order]  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the order controller list method works</span><span class="delimiter">&quot;</span></span>() {
     . . .
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Indicates that the Micronaut Data system needs to be started and that the Order
objects will need to be cleaned up when the test finishes.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your domains support <a href="#initial-data-load">Initial Data Load</a>, then your load method should return the list
of records created as described in <a href="#initial-data-loading-and-tests">Initial Data Loading and Tests</a>.
This will be used to ignore those records during the test cleanup.</p>
</div>
</div>
<div class="sect3">
<h4 id="multiple-record-references"><a class="link" href="#multiple-record-references">Multiple Record References</a></h4>
<div class="paragraph">
<p>The <code>dirtyDomains</code> static value in most tests will clean up any records created in those tables.
This simplifies the cleanup process, but has some issues with complex cases.
For example, you might have a foreign key reference like this Product/Component relationship:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Product CPU</p>
</li>
<li>
<p>Product BOARD</p>
</li>
<li>
<p>Product DISK</p>
</li>
<li>
<p>Product PC - Has references to these components:</p>
<div class="ulist">
<ul>
<li>
<p>Product CPU</p>
</li>
<li>
<p>Product BOARD</p>
</li>
<li>
<p>Product DISK</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you delete all <em>Product</em> records, it might delete them in the wrong order.
The delete will fail with an error like:</p>
</div>
<div class="listingblock">
<div class="title">Example - Error with Reference Error from Database</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">io.micronaut.data.exceptions.DataAccessException: Error executing SQL UPDATE: ERROR: update or
  delete on table &quot;product&quot; violates foreign key constraint &quot;product_component_component_id_fkey&quot;
  on table &quot;product_component&quot;
    Detail: Key (uuid)=(2e9aecd6-ab7b-4b7b-8281-dd9dec9eae84) is still referenced from table
    &quot;product_component&quot;.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="groovydoc/org/simplemes/eframe/test/BaseSpecification.html" target="_blank" rel="noopener">BaseSpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> <code>cleanup()</code> method will try to delete the Product records.
It may delete the <em>CPU</em> record first, which has a reference under the <em>PC</em> product, so the delete
will fail.</p>
</div>
<div class="paragraph">
<p>Sometimes this will work if the records are delete in the correct order (PC first, followed by the
component records).  Most of the time, it will fail.</p>
</div>
<div class="paragraph">
<p>How can you avoid this?  You just need to force the <code>cleanup()</code> code to delete the child
records first.</p>
</div>
<div class="listingblock">
<div class="title">Example - dirtDomains for Complex Reference Scenarios</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> dirtyDomains = [ProductComponent,  Product, MasterRouting]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ideally, the use of <em>ProductComponent</em> should not be needed, but it simplifies the <code>cleanup()</code>
logic.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controller-testing"><a class="link" href="#controller-testing">Controller Testing</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#controller-test-helper">Controller Test Helper</a></span>
<span class="inline-toc"><a href="#mock-controller-classes">Mock Controller Classes</a></span></p>
</div>
<div class="paragraph">
<p>Controllers are the main entry point into your application from the outside world. These
must be secured and rigorously tested.  Test helpers are provided to make your life easier.
The general philosophy of controller testing is to use real domain objects
and test with a real (in memory) database.  In general, most controller testing does not
use the embedded server support provided by Micronaut.</p>
</div>
<div class="paragraph">
<p>Controller class testing can be tedious when you have a lot of controllers and fields to test.</p>
</div>
<div class="sect3">
<h4 id="controller-test-helper"><a class="link" href="#controller-test-helper">Controller Test Helper</a></h4>
<div class="paragraph">
<p>To reduce testing efforts for controllers, the framework provides a simple test helper
(<a href="groovydoc/org/simplemes/eframe/test/ControllerTester.html" target="_blank" rel="noopener">ControllerTester</a>
 <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>)
with a DSL suited for common controller testing actions.</p>
</div>
<div class="paragraph">
<p>The ControllerTester checks these features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All methods are secured (with optional role).</p>
</li>
<li>
<p>Specific method requires a specific role.</p>
</li>
<li>
<p>Proper use of the <a href="#Task Menu">[Task Menu]</a> for the controller.</p>
</li>
<li>
<p>Error handling (TBD).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example Controller Tester Use</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that controller has secured methods and meets standard requirements</span><span class="delimiter">&quot;</span></span>() {
  <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the controller follows the standard requirements</span><span class="delimiter">'</span></span>
  ControllerTester.test {
    controller OrderController
    role <span class="string"><span class="delimiter">'</span><span class="content">MANAGER</span><span class="delimiter">'</span></span>                 <i class="conum" data-value="1"></i><b>(1)</b>
    secured <span class="string"><span class="delimiter">'</span><span class="content">release</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ADMIN</span><span class="delimiter">'</span></span>     <i class="conum" data-value="2"></i><b>(2)</b>
    taskMenu <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">user</span><span class="delimiter">'</span></span>, <span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">/user</span><span class="delimiter">'</span></span>, <span class="key">clientRootActivity</span>: <span class="predefined-constant">false</span> <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The role required for all methods.  Defaults to any annotation (even anonymous or not logged in).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The release method must require the ADMIN role using the Micronaut <em>@Secured()</em> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The task menu expected in the controller.  The task menu 'user' must be defined with a
URI of '/user'. The URI must also not be flagged as the root URI for the logger for
the controller (default true). Other supported options include <code>folder</code> and <code>displayOrder</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, all public methods must be secured.  If the controller is secured at the class level,
then all methods are assumed to be secured.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no <code>role</code> is specified for the test() method, then the test will make sure
      all methods are covered by a role other than 'isAnonymous()'.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The most common options are shown below:</p>
</div>
<div class="listingblock">
<div class="title">Example Controller Tester Use</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that controller has secured methods and meets standard requirements</span><span class="delimiter">&quot;</span></span>() {
  <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the controller follows the standard requirements</span><span class="delimiter">'</span></span>
  ControllerTester.test {
    controller OrderController
    role <span class="string"><span class="delimiter">'</span><span class="content">MANAGER</span><span class="delimiter">'</span></span>              <i class="conum" data-value="1"></i><b>(1)</b>
    secured <span class="string"><span class="delimiter">'</span><span class="content">release</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ADMIN</span><span class="delimiter">'</span></span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="comment">//securityCheck false       </span><i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The role required for all methods.  Defaults to any annotation (even anonymous or not logged in).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The release method must require the ADMIN role using the Micronaut <em>@Secured()</em> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Completely disables the security check.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="mock-controller-classes"><a class="link" href="#mock-controller-classes">Mock Controller Classes</a></h4>
<div class="paragraph">
<p>To reduce coupling with the real controllers, the framework provides a way to create
dynamic controllers quickly.  These are compiled from source during the test and
are not part of the shipped classes.</p>
</div>
<div class="paragraph">
<p>This relies on simple compilation into a local class that can be used like normal controller
classes.</p>
</div>
<div class="paragraph">
<p>See
<a href="groovydoc/org/simplemes/eframe/test/CompilerTestUtils.html" target="_blank" rel="noopener">CompilerTestUtils</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> for details.</p>
</div>
<div class="listingblock">
<div class="title">Example Controller with Dynamic Class Compilation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that findDomainClass supports static domainClass value is supported</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">a mock controller</span><span class="delimiter">'</span></span>
    <span class="keyword">def</span> src = <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
      package sample

      import sample.domain.SampleParent

      class NotSampleParentController {
        static domainClass = SampleParent   <i class="conum" data-value="1"></i><b>(1)</b>
      }
    </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    <span class="keyword">def</span> clazz = CompilerTestUtils.compileSource(src)    <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the correct domain class is found</span><span class="delimiter">'</span></span>
    ControllerUtils.instance.getDomainClass(clazz.newInstance()) == SampleParent  <i class="conum" data-value="3"></i><b>(3)</b>
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This temporary class must refer to a real domain class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creates a temporary class from the given source.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The temporary class can be used in most places a real controller can be used.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One of the big drawbacks of this approach is that the temporary class can&#8217;t refer to other
temporary classes created this way.  This means you will probably have to use real
domain classes like <em>SampleParent</em> above.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domain-testing"><a class="link" href="#domain-testing">Domain Testing</a></h3>
<div class="paragraph">
<p>Domain class testing can be tedious when you have a lot of domain classes and fields to test.
The framework provides a helper class
(<a href="groovydoc/org/simplemes/eframe/test/DomainTester.html" target="_blank" rel="noopener">DomainTester</a>)
to make testing a little simpler.</p>
</div>
<div class="paragraph">
<p>For example, the <em>ArchiveLog</em> unit tests below will verify the string field max size limits
and the non-nullable fields:</p>
</div>
<div class="listingblock">
<div class="title">Example Domain Test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that user domain enforces constraints</span><span class="delimiter">&quot;</span></span>() {
  <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the constraints are enforced</span><span class="delimiter">'</span></span>
  DomainTester.test {
    domain Order
    requiredValues <span class="key">order</span>: <span class="string"><span class="delimiter">'</span><span class="content">M1003</span><span class="delimiter">'</span></span>, <span class="key">qty</span>: <span class="float">2.0</span>       <i class="conum" data-value="1"></i><b>(1)</b>
    maxSize <span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>, FieldSizes.MAX_CODE_LENGTH   <i class="conum" data-value="2"></i><b>(2)</b>
    maxSize <span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>, <span class="integer">128</span>
    notNullCheck <span class="string"><span class="delimiter">'</span><span class="content">userName</span><span class="delimiter">'</span></span>                       <i class="conum" data-value="3"></i><b>(3)</b>
    notNullCheck <span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>
    notInFieldOrder ([<span class="string"><span class="delimiter">'</span><span class="content">authorities</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>]) <i class="conum" data-value="4"></i><b>(4)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines the required values for the domain record.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Verifies that the max length is enforced.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Verifies that null values are prevented.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Make sure the <a href="reference.html#field-order">fieldOrder</a> is defined for the domain class.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These 9 lines of code replace about 60 lines of test code.  You just have to define some values
for the required (non-nullable) fields in your domain class and then create a sample domain object.
Then you specify which fields sizes to check and which not-null constraints to check.</p>
</div>
<div class="paragraph">
<p>You will need to write any other tests for more complex constraints (such as unique value tests).</p>
</div>
</div>
<div class="sect2">
<h3 id="gui-testing"><a class="link" href="#gui-testing">GUI Testing</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#testing-and-logging-in">Testing and Logging in</a></span>
<span class="inline-toc"><a href="#gui-test-helpers">GUI Test Helpers</a></span>
<span class="inline-toc"><a href="#gui-language-testing">GUI Language Testing</a></span>
<span class="inline-toc"><a href="#testing-lookup">Testing lookup()</a></span>
<span class="inline-toc"><a href="#geb-page-modules">GEB Page Modules</a></span>
<span class="inline-toc"><a href="#deleting-records-after-tests">Deleting Records After Tests</a></span>
<span class="inline-toc"><a href="#slowing-down-gui-tests">Slowing Down GUI Tests</a></span></p>
</div>
<div class="paragraph">
<p>Integration testing is used to test the GUI-level functionality of your application in a live
running system (embedded).
A GUI test should exercise the features of one GUI or related GUIs.  For example, testing the
create/update/read/delete actions for the User domain/controller can be considered one GUI test.
Most GUI tests that cover multiple domains, services or controllers should be considered an
End-to-End Test.</p>
</div>
<div class="paragraph">
<p>You can use whatever functional/GUI testing framework that you prefer, but the framework and
Micronaut support GEB. The <a href="http://www.gebish.org/" target="_blank" rel="noopener">GEB</a> module is the easiest
GUI testing framework to get up and running with your application.</p>
</div>
<div class="paragraph">
<p>The GEB framework uses the <a href="http://www.seleniumhq.org/" target="_blank" rel="noopener">Selenium</a> framework to work with the browser
GUIs.  This means you will need these dependencies in your <em>build.gradle</em> file.  The framework uses
these dependencies (version numbers will change):</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
  testCompile(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.gebish:geb-spock:2.1</span><span class="delimiter">&quot;</span></span>) {
    exclude <span class="key">group</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.codehaus.groovy</span><span class="delimiter">&quot;</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">groovy-all</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
  }
  testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">cglib:cglib-nodep:3.2.9</span><span class="delimiter">&quot;</span></span>
  testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">org.objenesis:objenesis:3.0.1</span><span class="delimiter">&quot;</span></span>
  testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">net.bytebuddy:byte-buddy:1.9.5</span><span class="delimiter">&quot;</span></span>

  testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-chrome-driver:3.6.0</span><span class="delimiter">&quot;</span></span>
  testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-firefox-driver:3.6.0</span><span class="delimiter">&quot;</span></span>
  testCompile(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-support:3.6.0</span><span class="delimiter">&quot;</span></span>) {
    exclude <span class="key">group</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">net.bytebuddy</span><span class="delimiter">&quot;</span></span>, <span class="key">module</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">byte-buddy</span><span class="delimiter">&quot;</span></span>
  }
  testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-api:3.6.0</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The geb-spock module pulls in the wrong version of Groovy, so this exclude is needed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The framework also uses some <em>compileOnly</em> dependencies to allow us to build some of the
test utilities and base specification classes for other module&#8217;s use.</p>
</div>
<div class="paragraph">
<p>GEB provides support for the <a href="http://www.gebish.org/" target="_blank" rel="noopener">Page Objects</a>.
The built-in test support classes make use of the Page concept and provides content references
that GEB uses. A base page class
<a href="groovydoc/org/simplemes/eframe/test/page/AbstractPage.html" target="_blank" rel="noopener">AbstractPage</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
is provided to make it easier to work with common framework elements. This includes methods to
wait for all Ajax requests to finish when a page loads.</p>
</div>
<div class="sect3">
<h4 id="gui-test-helpers"><a class="link" href="#gui-test-helpers">GUI Test Helpers</a></h4>
<div class="paragraph">
<p><span class="inline-toc-header">CRUDGUITester</span>
<span class="inline-toc"><a href="#crudguitester">CRUDGUITester</a></span>
<span class="inline-toc"><a href="#disabling-test-phases">Disabling Test Phases</a></span>
<span class="inline-toc"><a href="#testing-domains-with-initial-data-loaded">Testing Domains with Initial Data Loaded</a></span>
<span class="inline-toc"><a href="#read-only-fields">Read-Only Fields</a></span>
<span class="inline-toc"><a href="#testing-inline-grids">Testing Inline Grids</a></span></p>
</div>
</div>
<div class="sect3">
<h4 id="crudguitester"><a class="link" href="#crudguitester">CRUDGUITester</a></h4>
<div class="paragraph">
<p>Most definition GUIs provide the common CRUD actions in your application.  These are fairly
standardized and follow a consistent pattern that uses the common GUI markers such as
<a href="#efDefinitionList">[efDefinitionList]</a>.  GUI testing is where you test how your controller,
views and domains work together.  These pieces are usually tested separately in a unit
test, so most of the GUI testing is done to test the mapping of your domain classes to the
GUI and to verify end-to-end functionality.</p>
</div>
<div class="paragraph">
<p>To make automated GUI testing of these features simpler, the framework provides the test helper class
(<a href="groovydoc/org/simplemes/eframe/test/CRUDGUITester.html" target="_blank" rel="noopener">CRUDGUITester</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>)
that greatly simplifies GUI testing of these pages.</p>
</div>
<div class="paragraph">
<p>The helper performs these basic tests on the GUIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List Page</p>
<div class="ulist">
<ul>
<li>
<p>All simple fields (string, date, boolean, number, enum)</p>
</li>
<li>
<p>Complex fields (hyperlinks, domain references)</p>
</li>
<li>
<p>Inline Grids</p>
</li>
<li>
<p>Search Ability</p>
</li>
</ul>
</div>
</li>
<li>
<p>Show Page</p>
<div class="ulist">
<ul>
<li>
<p>Delete Action</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create Page</p>
<div class="ulist">
<ul>
<li>
<p>Save</p>
</li>
</ul>
</div>
</li>
<li>
<p>Edit Page</p>
<div class="ulist">
<ul>
<li>
<p>Save</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The helper will exercise these basic features to make sure the controller, views and domains all
work together correctly.  You will need to run the GUI tests with a command-line option to specify
the language to be tested.
See <a href="#gui-language-testing">GUI Language Testing</a> for details on testing in multiple languages.</p>
</div>
<div class="paragraph">
<p>For example, this can be used to test a simple set of definition GUIs that use the
framework scaffolding:</p>
</div>
<div class="listingblock">
<div class="title">Example GUI Test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ProductGUITests</span> <span class="directive">extends</span> BaseGUISpecification {
  <span class="directive">static</span> dirtyDomains = [Product] <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the standard pages work</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the pages work</span><span class="delimiter">'</span></span>
    CRUDGUITester.test {
      tester <span class="local-variable">this</span>
      domain Product
      htmlIDBase <span class="string"><span class="delimiter">'</span><span class="content">Product</span><span class="delimiter">'</span></span>
      recordParams <span class="key">product</span>: <span class="string"><span class="delimiter">'</span><span class="content">PRODUCT1</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">First product</span><span class="delimiter">'</span></span>, <span class="key">lotSize</span>: <span class="float">27.3</span> <i class="conum" data-value="2"></i><b>(2)</b>
      minimalParams <span class="key">product</span>: <span class="string"><span class="delimiter">'</span><span class="content">X</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Records to be cleaned up when each test is done.  <em>UserPreference</em> records are always deleted.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines the field values for a valid record.  Most of your fields should be listed here.
All fields listed here will be tested for creation/update.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>minimalParams</code> defines the minimal required field values for a record.  These will be
used to create a record for update testing.  This record should show up after the
recordParams record.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example replaces 200+ lines of code in a normal GEB test.
This example will test the list, show, create and edit pages for the <em>Product</em> domain class.</p>
</div>
<div class="paragraph">
<p>The test helper needs two sets of values for the domain record:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>recordParams</code> - Used to test the show, create and edit pages.</p>
</li>
<li>
<p><code>minimalParams</code> - Used to test the edit page and search action.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The top-level parameters listed in the <code>recordParams</code> or <code>minimalParams</code> are tested
      in the GUI.  Any fields not listed in these two parameter lists are ignored for the test.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The test helper uses the <a href="reference.html#field-order">fieldOrder</a> static list from your domain
object to determine which fields should be tested in the GUI.  The display markers allow you work
on a different set of fields in your pages. If your field list is different from the
<a href="reference.html#field-order">fieldOrder</a> in some of the pages, then you can specify additional
fields to test with options in the
<a href="groovydoc/org/simplemes/eframe/test/CRUDGUITester.html" target="_blank" rel="noopener">CRUDGUITester</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
using the <code>readOnlyFields</code> option.</p>
</div>
<div class="paragraph">
<p>Some other features of the tester allow you to tailor the test to your domain.
See the
<a href="groovydoc/org/simplemes/eframe/test/CRUDGUITester.html" target="_blank" rel="noopener">CRUDGUITester</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
for details.  These includes options for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for Dynamic Fields (using closures for the edit/create tests).</p>
</li>
<li>
<p>Ability to disable specific tests.</p>
</li>
<li>
<p>Tests for inline grids.</p>
</li>
<li>
<p>Multiple language support (see <a href="#gui-language-testing">GUI Language Testing</a>).</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="disabling-test-phases"><a class="link" href="#disabling-test-phases">Disabling Test Phases</a></h5>
<div class="paragraph">
<p>The
<a href="groovydoc/org/simplemes/eframe/test/CRUDGUITester.html" target="_blank" rel="noopener">CRUDGUITester</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
tests all of the main CRUD definition pages: List, Show, Create and Edit.
You can disable specific phases if there is a good reason.  For example, to disable the Create
and Edit page tests:</p>
</div>
<div class="listingblock">
<div class="title">Disabling Test Phases - Programmatically</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ProductGUITests</span> <span class="directive">extends</span> BaseGUISpecification {
  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the standard pages work</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the pages work</span><span class="delimiter">'</span></span>
    CRUDGUITester.test {
      tester <span class="local-variable">this</span>
      domain Product
      recordParams <span class="key">product</span>: <span class="string"><span class="delimiter">'</span><span class="content">PRODUCT1</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">First product</span><span class="delimiter">'</span></span>, <span class="key">lotSize</span>: <span class="float">27.3</span>
      minimalParams <span class="key">product</span>: <span class="string"><span class="delimiter">'</span><span class="content">X</span><span class="delimiter">'</span></span>
      enableEditTests <span class="predefined-constant">false</span>,    <i class="conum" data-value="1"></i><b>(1)</b>
      enableCreateTests <span class="predefined-constant">false</span>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The two phases are disabled.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The enable flags include (all default to <em>true</em>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>enableListTests</strong></p>
</li>
<li>
<p><strong>enableShowTests</strong></p>
</li>
<li>
<p><strong>enableEditTests</strong></p>
</li>
<li>
<p><strong>enableCreateTests</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to temporarily to run just a single test phase, you can use the
<em>-DtestOnly</em> option:</p>
</div>
<div class="listingblock">
<div class="title">Disabling Test Phases - Command Line</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">   -Dgeb.env=firefox -DtestOnly=show</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="testing-domains-with-initial-data-loaded"><a class="link" href="#testing-domains-with-initial-data-loaded">Testing Domains with Initial Data Loaded</a></h5>
<div class="paragraph">
<p>The <a href="#initial-data-load">Initial Data Load</a> feature will affect some CRUD GUI tests.  These records will show up
in the main list page and in drop-down lists.   For this reason, it is best to make sure that
your test data records show up before records loaded by the initial data loading.</p>
</div>
<div class="paragraph">
<p>For example, if the User object creates a user <em>'admin'</em>, then you should make sure that your
tester data shows up before the admin record:</p>
</div>
<div class="listingblock">
<div class="title">Ordering of records with Initial Data Loaded</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ProductGUITests</span> <span class="directive">extends</span> BaseGUISpecification {

  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the standard pages work</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the pages work</span><span class="delimiter">'</span></span>
    CRUDGUITester.test {
      tester <span class="local-variable">this</span>
      domain User
      recordParams <span class="key">user</span>: <span class="string"><span class="delimiter">'</span><span class="content">ABC</span><span class="delimiter">'</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="content">secret</span><span class="delimiter">'</span></span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">abc001</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
      minimalParams <span class="key">user</span>: <span class="string"><span class="delimiter">'</span><span class="content">ABD</span><span class="delimiter">'</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="content">secret</span><span class="delimiter">'</span></span><i class="conum" data-value="2"></i><b>(2)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This record will show up at the top of the list in the default short order.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This record will show up above the <em>'admin'</em> user.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="read-only-fields"><a class="link" href="#read-only-fields">Read-Only Fields</a></h5>
<div class="paragraph">
<p>Some fields are defined as read-only (see <a href="#efCreate">[efCreate]</a> and <a href="#efEdit">[efEdit]</a>) in the page definitions.
This means the
<a href="groovydoc/org/simplemes/eframe/test/CRUDGUITester.html" target="_blank" rel="noopener">CRUDGUITester</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
needs to know that those fields are read-only.  This is done with the <code>readOnlyFields</code> option:</p>
</div>
<div class="listingblock">
<div class="title">Read-Only Fields</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ProductGUITests</span> <span class="directive">extends</span> BaseGUISpecification {
  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the standard pages work</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the pages work</span><span class="delimiter">'</span></span>
    CRUDGUITester.test {
      tester <span class="local-variable">this</span>
      domain Product
      recordParams <span class="key">product</span>: <span class="string"><span class="delimiter">'</span><span class="content">PRODUCT1</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">First product</span><span class="delimiter">'</span></span>, <span class="key">lotSize</span>: <span class="float">27.3</span>
      minimalParams <span class="key">product</span>: <span class="string"><span class="delimiter">'</span><span class="content">X</span><span class="delimiter">'</span></span>
      readOnlyFields <span class="string"><span class="delimiter">'</span><span class="content">qtyReleased,qtyDone</span><span class="delimiter">'</span></span>    <i class="conum" data-value="1"></i><b>(1)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines the fields to be tested as read-only fields.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you forget to note the read-only fields, then you will see an error similar to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>java.lang.AssertionError: Field Value for qtyReleased is not correct. Found '', expected '0'.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="testing-inline-grids"><a class="link" href="#testing-inline-grids">Testing Inline Grids</a></h5>
<div class="paragraph">
<p>Inline grids can be tested using the
<a href="groovydoc/org/simplemes/eframe/test/CRUDGUITester.html" target="_blank" rel="noopener">CRUDGUITester</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.</p>
</div>
<div class="listingblock">
<div class="title">Example - Inline Grid Testing</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@IgnoreIf</span>({ !sys[<span class="string"><span class="delimiter">'</span><span class="content">geb.env</span><span class="delimiter">'</span></span>] })
<span class="type">class</span> <span class="class">FlexTypeGUISpec</span> <span class="directive">extends</span> BaseGUISpecification {

  <span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">unused</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">static</span> dirtyDomains = [FlexType]

  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the standard GUI definition pages work</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the constraints are enforced</span><span class="delimiter">'</span></span>
    CRUDGUITester.test {
      tester <span class="local-variable">this</span>
      domain FlexType
      recordParams <span class="key">flexType</span>: <span class="string"><span class="delimiter">'</span><span class="content">ABC</span><span class="delimiter">'</span></span>,  <i class="conum" data-value="1"></i><b>(1)</b>
                   <span class="key">fields</span>: [[<span class="key">fieldName</span>: <span class="string"><span class="delimiter">'</span><span class="content">F1</span><span class="delimiter">'</span></span>, <span class="key">fieldLabel</span>: <span class="string"><span class="delimiter">'</span><span class="content">f1</span><span class="delimiter">'</span></span>, <span class="key">maxLength</span>: <span class="integer">23</span>, <span class="key">sequence</span>: <span class="integer">20</span>]]
      minimalParams <span class="key">flexType</span>: <span class="string"><span class="delimiter">'</span><span class="content">XYZ</span><span class="delimiter">'</span></span>, <i class="conum" data-value="2"></i><b>(2)</b>
                    <span class="key">fields</span>: [[<span class="key">fieldName</span>: <span class="string"><span class="delimiter">'</span><span class="content">F2</span><span class="delimiter">'</span></span>, <span class="key">fieldLabel</span>: <span class="string"><span class="delimiter">'</span><span class="content">f2</span><span class="delimiter">'</span></span>, <span class="key">maxLength</span>: <span class="integer">33</span>, <span class="key">sequence</span>: <span class="integer">30</span>]]
      listColumns <span class="string"><span class="delimiter">'</span><span class="content">flexType,category,title,defaultFlexType,fieldSummary</span><span class="delimiter">'</span></span>
      unlabeledFields <span class="string"><span class="delimiter">'</span><span class="content">fields</span><span class="delimiter">'</span></span>
    }
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines the fields (rows) added during the edit/create phases.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines the fields that will be in the initial value used during the edit.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At the start of the edit phase, the rows from the <code>minimalParams</code> will be added to the
<code>fields</code> list above.  Then record will be changed in the edit page by adding
the rows from the <code>recordParams</code> to the grid.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gui-language-testing"><a class="link" href="#gui-language-testing">GUI Language Testing</a></h4>
<div class="paragraph">
<p>Non-GUI tests frequently mock specific languages for testing the internal support for localization.
For example, date input fields are tested for proper date formats in the various widget tests.
This level of testing should cover most localization needs for a lot of your application.</p>
</div>
<div class="paragraph">
<p>Unfortunately, that type of widget-level testing does not verify that your app will be localized
in a real browser.  To verify this, the framework supports testing with multiple languages
as sent by the browser to the server (using the header 'Accept-Languages').  This is done in
<em>GebConfig.groovy</em> when creating the browser instance and in the some core classes to help you verify
the localization.</p>
</div>
<div class="paragraph">
<p>This is done by re-running the GUI tests with the -Dgeb.lang option.  For example, when
run from the gradle command line:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./gradlew -Dgeb.lang=de-DE -Dgeb.env=firefox test</pre>
</div>
</div>
<div class="paragraph">
<p>This language is used to create the browser instance.  It is also used in the test helpers
<a href="#gui-test-helpers">GUI Test Helpers</a> and the base GUI specification class
<a href="groovydoc/org/simplemes/eframe/test/BaseGUISpecification.html" target="_blank" rel="noopener">BaseGUISpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.</p>
</div>
<div class="paragraph">
<p>Your test class can access this locale with the <code>currentLocale</code> property:</p>
</div>
<div class="listingblock">
<div class="title">Example GUI Test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ProductGUITests</span> <span class="directive">extends</span> BaseGUISpecification {

  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify . . .</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">the date format to expect in the GUI</span><span class="delimiter">'</span></span>
      <span class="keyword">def</span> format = DateUtils.getDateFormat(currentLocale)   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">expect</span>:
      . . .
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The current locale for the test from the <em>-Dgeb.lang</em> argument. Defaults to en-US.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also change the JVM default locale using the -D option <em>'-Duser.language=de'</em>
      instead of the <code>currentLocale</code> variable above.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="testing-lookup"><a class="link" href="#testing-lookup">Testing lookup()</a></h4>
<div class="paragraph">
<p>The base specifications (
<a href="groovydoc/org/simplemes/eframe/test/BaseSpecification.html" target="_blank" rel="noopener">BaseSpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> and
<a href="groovydoc/org/simplemes/eframe/test/BaseGUISpecification.html" target="_blank" rel="noopener">BaseGUISpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>)
are used in tests to compare values against the <em>messages.properties</em> values.</p>
</div>
<div class="paragraph">
<p>To make it clear when a looked up value is not in the .properties value, the base specifications
<code>lookup()</code> method will append <em>'-missing.in.properties'</em> to the result.  This means
the test will fail until the entry is added to the .properties file.</p>
</div>
</div>
<div class="sect3">
<h4 id="geb-page-modules"><a class="link" href="#geb-page-modules">GEB Page Modules</a></h4>
<div class="paragraph">
<p>The framework supports many types of common GUI elements such as grids, input fields, buttons and
drop-down lists.  Interacting with them in GEB tests can be tedious.  The <a href="#GUI Toolkit">[GUI Toolkit]</a>
has complex HTML structures for even simple elements like input fields.</p>
</div>
<div class="paragraph">
<p>To make working with these elements easier, we provide some GEB Modules to access them easier.
For example, the Page content section for a grid looks something like this:</p>
</div>
<div class="listingblock">
<div class="title">Example Page content</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> content = {
  routingSteps { module(<span class="keyword">new</span> GridModule(<span class="key">field</span>: <span class="string"><span class="delimiter">'</span><span class="content">routingSteps</span><span class="delimiter">'</span></span>)) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In your test spec, you would access the routingSteps cells as:</p>
</div>
<div class="listingblock">
<div class="title">Example Cell Access</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">routingSteps.cell(<span class="integer">2</span>,<span class="integer">3</span>).text() == <span class="string"><span class="delimiter">'</span><span class="content">M1001</span><span class="delimiter">'</span></span>  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access the cell&#8217;s text at row 2, column 3.  (0,0) is the first cell in the first row.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This cell can support the <code>text()</code> and <code>click()</code> methods.  The GridModule also has other content
elements that might be useful, such as <code>headers</code> and <code>rows</code>.</p>
</div>
<div class="paragraph">
<p>Some of the supported modules include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/ButtonModule.html" target="_blank" rel="noopener">ButtonModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/BooleanFieldModule.html" target="_blank" rel="noopener">BooleanFieldModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/ComboboxModule.html" target="_blank" rel="noopener">ComboboxModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/DateFieldModule.html" target="_blank" rel="noopener">DateFieldModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/DefinitionListModule.html" target="_blank" rel="noopener">DefinitionListModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/DialogModule.html" target="_blank" rel="noopener">DialogModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/GridModule.html" target="_blank" rel="noopener">GridModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/MessagesModule.html" target="_blank" rel="noopener">MessagesModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/ReadOnlyFieldModule.html" target="_blank" rel="noopener">ReadOnlyFieldModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
<li>
<p><a href="groovydoc/org/simplemes/eframe/test/page/TextFieldModule.html" target="_blank" rel="noopener">TextFieldModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="testing-messages-area-using-geb"><a class="link" href="#testing-messages-area-using-geb">Testing Messages Area using GEB</a></h5>
<div class="paragraph">
<p>Many pages will display some sort of message using the Javascript function
<a href="reference.html#eframe-display-message" target="_blank" rel="noopener">displayMessage</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.
This is displayed in a standard <code>&lt;div id="messages""&gt;</code> section at the top of the page.
To make testing easier, the standard
<a href="groovydoc/org/simplemes/eframe/test/page/AbstractPage.html" target="_blank" rel="noopener">AbstractPage</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
defines a <code>messages</code> content element as a
<a href="groovydoc/org/simplemes/eframe/test/page/MessagesModule.html" target="_blank" rel="noopener">MessagesModule</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.</p>
</div>
<div class="paragraph">
<p>This <code>messages</code> content element can be used to test the content of the message and type:</p>
</div>
<div class="listingblock">
<div class="title">Example - Checking GUI Messages</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">to SomePage    <i class="conum" data-value="1"></i><b>(1)</b>

<span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the error messages are displayed</span><span class="delimiter">'</span></span>
messages.text() == lookup(<span class="string"><span class="delimiter">'</span><span class="content">error.message</span><span class="delimiter">'</span></span>)
messages.isEerror()                         <i class="conum" data-value="2"></i><b>(2)</b>
messages.error                              <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Some page is displayed that is a sub-class of AbstractPage.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returns true if any message displayed is an error.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Alternate groovy property syntax.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should not use the <code>messages.error</code> (<code>info</code> or <code>warn</code>) checks when multiple messages
      are displayed. The check will return true if any message is flagged as an error
      (info or warning).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="using-geb-page-modules-outside-of-pages"><a class="link" href="#using-geb-page-modules-outside-of-pages">Using GEB Page Modules Outside of Pages</a></h5>
<div class="paragraph">
<p>Most of the time, you will use GEB modules in a Page content section.  Sometimes, you will need to
use them in test code for dynamic fields.  To do this, you create one like this:</p>
</div>
<div class="listingblock">
<div class="title">Example - Direct GEB Module Use</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> workList = <span class="error">$</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>).module(<span class="keyword">new</span> GridModule(<span class="key">field</span>: <span class="string"><span class="delimiter">'</span><span class="content">theOrderListA</span><span class="delimiter">'</span></span>))  <i class="conum" data-value="1"></i><b>(1)</b>
workList.cell(<span class="integer">0</span>, <span class="integer">0</span>).text() == <span class="string"><span class="delimiter">'</span><span class="content">M1001</span><span class="delimiter">'</span></span>  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create the workList GEB navigator object directly.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the cell&#8217;s text at row 2, column 'order'.  (0,0) is the first cell in the first row.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="testing-and-logging-in"><a class="link" href="#testing-and-logging-in">Testing and Logging in</a></h4>
<div class="paragraph">
<p>The
<a href="groovydoc/org/simplemes/eframe/test/BaseGUISpecification.html" target="_blank" rel="noopener">BaseGUISpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
base class is designed to use a single login
and never log out during the tests.  This speeds up tests significantly.  This is accomplished by
setting a configuration flag to NOT clear the cookies automatically.</p>
</div>
<div class="paragraph">
<p>Logging out is not needed for most tests.  Your test should just call the <code>login()</code> function
(with or without a user argument).  The method will automatically log out if you need a different
user/locale.</p>
</div>
<div class="paragraph">
<p>Since the framework uses cookies for JWT security, the
<a href="groovydoc/org/simplemes/eframe/test/BaseGUISpecification.html" target="_blank" rel="noopener">BaseGUISpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
base class used for GUI testing is set to retain the cookies between tests.</p>
</div>
<div class="paragraph">
<p>To re-enable the clearing of cookies between tests, you may need to use this in your test
<code>setup()</code> method:</p>
</div>
<div class="listingblock">
<div class="title">Clearing Cookies</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">browser.config.autoClearCookies = <span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This should only be used in special cases.  Most security checks will fail without cookies.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="deleting-records-after-tests"><a class="link" href="#deleting-records-after-tests">Deleting Records After Tests</a></h4>
<div class="paragraph">
<p>Test data pollution can be a big problem in making tests reliable.  This pollution happens when
domain records are left over from earlier tests.  These records can cause problems with the other tests
that expect an empty database.  This biggest problem is finding the test that actually left the data.</p>
</div>
<div class="paragraph">
<p>Most non-GUI tests can avoid this problem by using the <em>@Rollback</em> annotation for the test method.
This works great for simple tests, but GUI tests must commit the data to the database to work.</p>
</div>
<div class="paragraph">
<p>See <a href="#test-data-pollution">Test Data Pollution</a> for details on simple ways to clean up these left over records.</p>
</div>
</div>
<div class="sect3">
<h4 id="slowing-down-gui-tests"><a class="link" href="#slowing-down-gui-tests">Slowing Down GUI Tests</a></h4>
<div class="paragraph">
<p>Sometimes, it is useful slow down GUI tests with strategic pauses.  You can insert pauses in your
test code but sometimes you need the server to simulate a slow execution.</p>
</div>
<div class="paragraph">
<p>A framework configuration setting is available for use in key places in the framework.  For example,
the <a href="#basecrudcontroller">BaseCrudController</a> <code>list()</code> method can wait for given number of milliseconds to simulate
a slow server response.</p>
</div>
<div class="paragraph">
<p>This setting is most easily set from the environment/command line with the given variable:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">EFRAME_TEST_DELAY=1000</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a global setting and will affect all uses of the delay function.
See the <code>delayForTesting()</code> method in
<a href="groovydoc/org/simplemes/eframe/controller/ControllerUtils.html" target="_blank" rel="noopener">ControllerUtils</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
for details.</p>
</div>
<div class="paragraph">
<p>You can also set the delay temporarily in a single test.  This is done as below:</p>
</div>
<div class="listingblock">
<div class="title">Temporarily Setting Server Delay</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that . . .</span><span class="delimiter">&quot;</span></span>() {
  <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">simulate a slow server</span><span class="delimiter">'</span></span>
  Holders.configuration.testDelay = <span class="integer">500</span>     <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">some stuff</span><span class="delimiter">'</span></span>
  . . .

  cleanup:
  Holders.configuration.testDelay = <span class="predefined-constant">null</span>    <i class="conum" data-value="2"></i><b>(2)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets the delay to 500ms.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Resets the delay to none.  You should normally save the original setting and
restore it in a <code>cleanup()</code> method.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="api-testing"><a class="link" href="#api-testing">API Testing</a></h3>
<div class="paragraph">
<p>Complex enterprise applications have many API entry points to test.
Much of the API testing can be done by calling your controller methods directly from the
test code.  But you DO need to verify that these methods work in a real HTTP server environment.
That testing should focus on handling of the inputs from the request and formatting the response.</p>
</div>
<div class="paragraph">
<p>You should not test every business scenario in an API test.  The API tests mainly are used to
verify that the controller is mapped with the correct URI and inputs/outputs.
Your unit test (non-API test) should test the fringe cases and all business logic/paths.</p>
</div>
<div class="paragraph">
<p>This framework makes it easier to test the APIs by using the base specification
<a href="groovydoc/org/simplemes/eframe/test/BaseAPISpecification.html" target="_blank" rel="noopener">BaseAPISpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.
This class provides some key features for testing real HTTP requests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>login()</code> - Logs a user in for later API/REST test calls.</p>
</li>
<li>
<p><code>sendRequest()</code> - Sends a request to the server via HTTP.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These provide the ability to login to a running test  server (embedded) and send requests
to the server.</p>
</div>
<div class="sect3">
<h4 id="baseapispecification"><a class="link" href="#baseapispecification">BaseAPISpecification</a></h4>
<div class="listingblock">
<div class="title">Example API Testing</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">UserPreferenceControllerAPISpec</span> <span class="directive">extends</span> BaseAPISpecification {

  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that findPreference works with real HTTP requests</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">a dialog state is saved</span><span class="delimiter">'</span></span>
    UserPreference.withTransaction {
      PreferenceHolder preference = PreferenceHolder.find {
        page <span class="string"><span class="delimiter">'</span><span class="content">/app/test</span><span class="delimiter">'</span></span>
        user SecurityUtils.API_TEST_USER
        element <span class="string"><span class="delimiter">'</span><span class="content">_dialogX</span><span class="delimiter">'</span></span>
      }
      <span class="keyword">def</span> dialogPreference = <span class="keyword">new</span> DialogPreference(<span class="key">width</span>: <span class="float">23.4</span>, <span class="key">height</span>: <span class="float">24.5</span>, <span class="key">left</span>: <span class="float">25.6</span>, <span class="key">top</span>: <span class="float">26.7</span>)
      preference.setPreference(dialogPreference).save()
    }

    <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the request is made for a logged in user</span><span class="delimiter">'</span></span>
    login()
    <span class="keyword">def</span> res = sendRequest(<span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">/userPreference/findPreferences?pageURI=/app/test&amp;element=_dialogX</span><span class="delimiter">'</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">the response contains the right data</span><span class="delimiter">'</span></span>
    . . .
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The request is sent and the response should be Ok (200).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>sendRequest()</code> method has several options.  See the Javadoc for
<a href="groovydoc/org/simplemes/eframe/test/BaseAPISpecification.html" target="_blank" rel="noopener">BaseAPISpecification</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="api-security-testing"><a class="link" href="#api-security-testing">API Security Testing</a></h4>
<div class="paragraph">
<p>All APIs are accessed via a controller.  Each controller should have security defined for each
public method.  The <a href="#controller-test-helper">Controller Test Helper</a> provides a simple way to verify that each method
has the right declarative security annotation (<em>@Secured</em>).</p>
</div>
<div class="paragraph">
<p>In general, you should not need to test these annotations in your controller API testing.</p>
</div>
</div>
<div class="sect3">
<h4 id="dashboard-activity-testing"><a class="link" href="#dashboard-activity-testing">Dashboard Activity Testing</a></h4>
<div class="paragraph">
<p>Dashboard activities can be complex and require some extensive testing.  In particular,
event handling is important to these activities.  To make this testing easier,
the framework provides a
<a href="groovydoc/org/simplemes/eframe/dashboard/controller/DashboardTestController.html" target="_blank" rel="noopener">DashboardTestController</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> that gives you some helpful activities for testing.
These include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dashboard-event-display-helper">Dashboard Event Display Helper</a> - Displays the events triggered by an activity.</p>
</li>
<li>
<p><a href="#dashboard-event-trigger-helper">Dashboard Event Trigger Helper</a> - Allows the test spec to publish any dashboard event.</p>
</li>
<li>
<p>DISPLAY_PARAMETERS_ACTIVITY - Displays the parameters passed to the activity.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="dashboard-event-display-helper"><a class="link" href="#dashboard-event-display-helper">Dashboard Event Display Helper</a></h5>
<div class="paragraph">
<p>This helper displays any events triggered by the dashboard activities.</p>
</div>
<div class="listingblock">
<div class="title">Example - Dashboard Event Display Helper</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the selection activity sends the ORDER_LSN_CHANGED event</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">a dashboard with the activity</span><span class="delimiter">'</span></span>
    buildDashboard(<span class="key">defaults</span>: [<span class="string"><span class="delimiter">'</span><span class="content">/selection/workCenterSelection</span><span class="delimiter">'</span></span>,                 <i class="conum" data-value="1"></i><b>(1)</b>
                              DashboardTestController.DISPLAY_EVENT_ACTIVITY])  <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the dashboard is displayed</span><span class="delimiter">'</span></span>
    displayDashboard([<span class="key">workCenter</span>: <span class="string"><span class="delimiter">'</span><span class="content">WC137</span><span class="delimiter">'</span></span>])

    <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the order is changed</span><span class="delimiter">'</span></span>               <i class="conum" data-value="3"></i><b>(3)</b>
    textField(<span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>).input.value(<span class="string"><span class="delimiter">'</span><span class="content">ORDER1</span><span class="delimiter">'</span></span>)
    sendKey(Keys.TAB)
    waitForDashboardEvent(<span class="string"><span class="delimiter">'</span><span class="content">ORDER_LSN_CHANGED</span><span class="delimiter">'</span></span>)

    <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">the event is triggered</span><span class="delimiter">'</span></span>   <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="keyword">def</span> json = getDashboardEvent(<span class="string"><span class="delimiter">'</span><span class="content">ORDER_LSN_CHANGED</span><span class="delimiter">'</span></span>)
    json.type == <span class="string"><span class="delimiter">'</span><span class="content">ORDER_LSN_CHANGED</span><span class="delimiter">'</span></span>
    json.source == <span class="string"><span class="delimiter">'</span><span class="content">/selection/workCenterSelection</span><span class="delimiter">'</span></span>
    json.list.size() == <span class="integer">1</span>
    json.list[<span class="integer">0</span>].order == <span class="string"><span class="delimiter">'</span><span class="content">ORDER1</span><span class="delimiter">'</span></span>
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The activity under test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the <em>DISPLAY_EVENT_ACTIVITY</em> in the second panel of the dashboard.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Some user action triggers an event.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The event text is retrieved from the page, parsed and validated.  The `getDashboardEvent()1
method parses the event display line with the given event type.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This <em>DISPLAY_EVENT_ACTIVITY</em> will display the dashboard events in a <code>&lt;div&gt;</code> in the page
for easy access by the test spec.  The UI will look something like this:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/dashboardEventHelperActivity.png" alt="dashboardEventHelperActivity" width="800">
</div>
<div class="title">Figure 15. dashboardEventHelperActivity</div>
</div>
<div class="paragraph">
<p>The event is rendered as JSON text that can be accessed by the test for verification.</p>
</div>
</div>
<div class="sect4">
<h5 id="dashboard-event-trigger-helper"><a class="link" href="#dashboard-event-trigger-helper">Dashboard Event Trigger Helper</a></h5>
<div class="paragraph">
<p>This helper lets your test trigger a dashboard activity.</p>
</div>
<div class="listingblock">
<div class="title">Example - Dashboard Event Trigger Helper</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the selection activity handles the WORK_LIST_SELECTED event</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">a dashboard with the activity</span><span class="delimiter">'</span></span>
    buildDashboard(<span class="key">defaults</span>: [<span class="string"><span class="delimiter">'</span><span class="content">/selection/workCenterSelection</span><span class="delimiter">'</span></span>,                <i class="conum" data-value="1"></i><b>(1)</b>
                              DashboardTestController.TRIGGER_EVENT_ACTIVITY]) <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the dashboard is displayed</span><span class="delimiter">'</span></span>
    displayDashboard()

    <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">the event is triggered</span><span class="delimiter">'</span></span>
    <span class="keyword">def</span> event = [<span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">WORK_LIST_SELECTED</span><span class="delimiter">'</span></span>, <span class="key">source</span>: <span class="string"><span class="delimiter">'</span><span class="content">abc</span><span class="delimiter">'</span></span>, <span class="key">list</span>: [[<span class="key">order</span>: <span class="string"><span class="delimiter">'</span><span class="content">ORDER1</span><span class="delimiter">'</span></span>]]] <i class="conum" data-value="3"></i><b>(3)</b>
    textField(<span class="string"><span class="delimiter">&quot;</span><span class="content">eventSource</span><span class="delimiter">&quot;</span></span>).input.value(JsonOutput.toJson(event))
    clickButton(<span class="string"><span class="delimiter">'</span><span class="content">triggerEvent</span><span class="delimiter">'</span></span>)  <i class="conum" data-value="4"></i><b>(4)</b>
    waitFor {
      textField(<span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>).input.value() == <span class="string"><span class="delimiter">'</span><span class="content">ORDER1</span><span class="delimiter">'</span></span>  <i class="conum" data-value="5"></i><b>(5)</b>
    }

    <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the field is correct</span><span class="delimiter">'</span></span>
    textField(<span class="string"><span class="delimiter">'</span><span class="content">order</span><span class="delimiter">'</span></span>).input.value() == <span class="string"><span class="delimiter">'</span><span class="content">ORDER1</span><span class="delimiter">'</span></span>
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The activity under test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the <em>TRIGGER_EVENT_ACTIVITY</em> in the second panel of the dashboard.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The JSON for the event <em>'WORK_LIST_SELECTED'</em> is placed in the input field.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The event is triggered with the button in the helper activity.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The test waits for the activity being tested to handle the event.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This <em>TRIGGER_EVENT_ACTIVITY</em> will provide an input field to enter the JSON for the event
to be triggered. The UI will look something like this:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/dashboardEventTriggerHelperActivity.png" alt="dashboardEventTriggerHelperActivity" width="800">
</div>
<div class="title">Figure 16. dashboardEventTriggerHelperActivity</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api"><a class="link" href="#api">API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#json">JSON</a></span>
<span class="inline-toc"><a href="#rest-api">Rest API</a></span>
<span class="inline-toc"><a href="#api-formats">API Formats</a></span>
<span class="inline-toc"><a href="#custom-fields">API Formats - Custom Fields</a></span>
<span class="inline-toc"><a href="#api-actions-non-crud">API Actions - Non-CRUD</a></span>
<span class="inline-toc"><a href="#api-error-handling">API Error Handling</a></span></p>
</div>
<div class="paragraph">
<p>This section describes how you can create consistent and easy to use APIs for your application.
The goal is to provide you with tools to create the APIs and avoid repeating yourself too much
in the process.</p>
</div>
<div class="paragraph">
<p>Many of the default Micronaut/Jackson features come close to the proper enterprise approach,
but they miss out in key areas.  This includes dealing with domain references and other
related issues.  These issues are mostly hidden from you when you use the built-in <a href="#rest-api">Rest API</a>
support for this framework.  It handles most of the strange database issues and supports the
right formats (e.g. ISO Date formats, etc).</p>
</div>
<div class="paragraph">
<p>If you do not use the built-in <a href="#rest-api">Rest API</a>, then you will need to handle these types of issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create/Read/Update/Delete (CRUD).</p>
</li>
<li>
<p>Child records.</p>
</li>
<li>
<p>Date/time encoding (ISO).</p>
</li>
<li>
<p>Child record removal.</p>
</li>
<li>
<p>Clean key field handling (no database UUIDs needed).</p>
</li>
<li>
<p>Support for optional database UUID in references to other objects.</p>
</li>
<li>
<p>One-to-one relationship handling.</p>
</li>
<li>
<p>One-to-many relationship handling (children).</p>
</li>
<li>
<p>Standardized Controller/Service use for APIs.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="json"><a class="link" href="#json">JSON</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#persistence-aware-module-for-jackson">Persistence Aware Module for Jackson</a></span>
<span class="inline-toc"><a href="#uuid-support">UUID Support</a></span>
<span class="inline-toc"><a href="#json-by-key">@JSONByKey</a></span>
<span class="inline-toc"><a href="#json-by-id">@JSONByID</a></span>
<span class="inline-toc"><a href="#typeablemapper">Mapping Generic Objects to JSON (TypeableMapper)</a></span></p>
</div>
<div class="paragraph">
<p>The enterprise framework uses JSON for external API access over HTTP.  We use the
<a href="https://github.com/FasterXML/jackson-docs" target="_blank" rel="noopener">Jackson</a> library for creating and reading JSON data.</p>
</div>
<div class="sect3">
<h4 id="persistence-aware-module-for-jackson"><a class="link" href="#persistence-aware-module-for-jackson">Persistence Aware Module for Jackson</a></h4>
<div class="paragraph">
<p>The
<a href="groovydoc/org/simplemes/eframe/json/EFrameJacksonModule.html" target="_blank" rel="noopener">EFrameJacksonModule</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> provides a number of features that your application will
use automatically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reduce chances of infinite recursion when serializing parent/child relationships.</p>
</li>
<li>
<p>Reduce JSON size for foreign references.</p>
</li>
<li>
<p>Support for <a href="#encoded-types">Encoded Types</a></p>
</li>
<li>
<p><a href="#uuid-support">UUID Support</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This means you will rarely need to add Jackson annotations to your code to handle JSON issues.
There are a special cases you may need to use below:</p>
</div>
</div>
<div class="sect3">
<h4 id="uuid-support"><a class="link" href="#uuid-support">UUID Support</a></h4>
<div class="paragraph">
<p>The primary ID for most domain entities is a UUID.  This is generated by the <a href="#micronaut-data">Micronaut Data</a>
layer when a record is created.  The UUID is always stored in a field name <code>uuid</code>.
This allows special-case handling that reduces the application level code.</p>
</div>
<div class="paragraph">
<p>One key area is in the JSON <a href="#rest-api">Rest API</a>.  The support classes will handle UUID in special cases
to avoid creation of duplicate UUID&#8217;s.  In particular, the <a href="#basecrudrestcontroller">BaseCrudRestController</a> will
ignore the <code>uuid</code> field when creating new records.  This will force the persistence layer
to generate new UUID&#8217;s on creation.</p>
</div>
</div>
<div class="sect3">
<h4 id="json-by-key"><a class="link" href="#json-by-key">@JSONByKey</a></h4>
<div class="paragraph">
<p>In some cases, you may need to serialize/deserialize a POGO that contains domain objects.
To make this JSON smaller, we provide an annotation that will use a single key field for the
serialization/deserialization process.  This makes things like the dashboard <a href="#Undo">[Undo]</a> capability
more smaller/simpler for the client.
The Undo feature use a JSON serialized POGO to define what needs to be done to undo an action.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature currently only works with the first primary key that is a string value.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example - @JSONByKey</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">StartRequest</span> {
  <span class="predefined-type">String</span> barcode

  <span class="annotation">@JSONByKey</span>
  Order order  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="annotation">@JSONByKey</span>
  WorkCenter workCenter

  <span class="predefined-type">BigDecimal</span> qty

  <span class="predefined-type">Date</span> dateTime
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Will serialize this as <em>"order": "ORDER_123"</em>.  Just the primary key field will be used
to access the database record for the <code>Order</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This produces JSON similar to this:</p>
</div>
<div class="listingblock">
<div class="title">Example - JSON for @JSONByKey</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">barcode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">M1001</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER_123</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">workCenter</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ASSEMBLY007</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">1.2</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deserialized (in a transaction), this will find the Order and WorkCenter object and populate
them in POGO.</p>
</div>
<div class="paragraph">
<p>Some notes on error conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the record can&#8217;t be found in the database, then an exception is thrown at run time (deserialize).</p>
</li>
<li>
<p>If the annotation <em>@JSONByKey</em> is used on a non-domain field (e.g. a String or other field),
then an exception will be triggered at run-time (serialize and deserialize).</p>
</li>
<li>
<p>If the annotation <em>@JSONByKey</em> is used on a field with a name that can&#8217;t be converted to
a domain class, then an exception will be triggered at run time (deserialize).
(e.g. an <code>Order</code> field with a name 'theOrder'),</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These errors are not detected at compile time.</p>
</div>
</div>
<div class="sect3">
<h4 id="json-by-id"><a class="link" href="#json-by-id">@JSONByID</a></h4>
<div class="paragraph">
<p>In some rare cases, you may need to serialize/deserialize a POGO that contains domain objects.
This is similar to <a href="#json-by-key">@JSONByKey</a>, but you need to use a record UUID instead of the key
field. To make this JSON smaller, we provide an annotation that will use the UUID only for the
serialization/deserialization process.  This makes things like the JSON processing
for other systems simpler.</p>
</div>
<div class="listingblock">
<div class="title">Example - @JSONByID</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">StartRequest</span> {
  <span class="predefined-type">String</span> barcode
  <span class="annotation">@JSONByID</span> Order order  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="annotation">@JSONByID</span> WorkCenter workCenter
  <span class="predefined-type">BigDecimal</span> qty
  <span class="predefined-type">Date</span> dateTime
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Will serialize this as <em>"order": "dbb0c868-3ae5-4fd1-a0a4-e0ddda375e2b"</em>.
Just the database record UUID will be used from the domain <code>Order</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This produces JSON similar to this:</p>
</div>
<div class="listingblock">
<div class="title">Example - JSON for @JSONByID</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">barcode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">M1001</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dbb0c868-3ae5-4fd1-a0a4-e0ddda375e2b</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">workCenter</span><span class="delimiter">&quot;</span></span>: <span class="integer">4567</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">1.2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">dateTime</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deserialized (in a transaction), this will find the Order and WorkCenter object and populate
them in POGO.</p>
</div>
<div class="paragraph">
<p>Some notes on error conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the record can&#8217;t be found in the database, then an exception is thrown at run time (deserialize).</p>
</li>
<li>
<p>If the annotation <em>@JSONByID</em> is used on a non-domain field (e.g. a String or other field),
then an exception will be triggered at run-time (serialize and deserialize).</p>
</li>
<li>
<p>If the annotation <em>@JSONByID</em> is used on a field with a name that can&#8217;t be converted to
a domain class, then an exception will be triggered at run time (deserialize).
(e.g. an <code>Order</code> field with a name 'theOrder'),</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These errors are not detected at compile time.</p>
</div>
</div>
<div class="sect3">
<h4 id="typeablemapper"><a class="link" href="#typeablemapper">TypeableMapper</a></h4>
<div class="paragraph">
<p>The Jackson JSON mapper is very flexible, when the Class of the object being
de-serialized is know ahead of time. It does not easily handle reading
generic object when the Class is not known by the caller.
To work around this, the framework provides a
<a href="groovydoc/org/simplemes/eframe/json/TypeableMapper.html" target="_blank" rel="noopener">TypeableMapper</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
that will handle these scenarios.</p>
</div>
<div class="paragraph">
<p>To avoid security issues, this mapper will only read objects that are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Domain Entities - Must have the @MappedEntity annotation.</p>
</li>
<li>
<p>Implements <a href="groovydoc/org/simplemes/eframe/json/TypeableJSONInterface.html" target="_blank" rel="noopener">TypeableJSONInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> - Specific classes marked with this interface</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These objects can be in a list or a map.  To handle these scenarios, the mapper
creates/reads a JSON array with pairs of elements that specify the class name
and the value.  Maps also use a third element for the map entry name.</p>
</div>
<div class="paragraph">
<p>For lists, the array looks something like this:</p>
</div>
<div class="listingblock">
<div class="title">Example - TypeableMapper JSON Format</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[ <span class="string"><span class="delimiter">&quot;</span><span class="content">org.simplemes.mes.demand.Order</span><span class="delimiter">&quot;</span></span>,  <i class="conum" data-value="1"></i><b>(1)</b>
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">SC1</span><span class="delimiter">&quot;</span></span>,                  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">dateCompleted</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2013-05-11T18:29:50.307Z</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">lsnTrackingOption</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER_ONLY</span><span class="delimiter">&quot;</span></span>
  },
  <span class="string"><span class="delimiter">&quot;</span><span class="content">org.simplemes.mes.action.ActionLog</span><span class="delimiter">&quot;</span></span>,  <i class="conum" data-value="3"></i><b>(3)</b>
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">action</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">RELEASE</span><span class="delimiter">&quot;</span></span>
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class name for the first element.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The value for the first element.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Other class/value pairs.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example that writes and reads the objects from a JSON file is shown below.</p>
</div>
<div class="listingblock">
<div class="title">Example - Using TypeableMapper for Write</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> writer = <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">out.json</span><span class="delimiter">&quot;</span></span>).newWriter()
TypeableMapper.instance.start(writer)
TypeableMapper.instance.writeOne(writer, object1, <span class="predefined-constant">true</span>) <i class="conum" data-value="1"></i><b>(1)</b>
TypeableMapper.instance.writeOne(writer, object2, <span class="predefined-constant">false</span>)
TypeableMapper.instance.finish(writer)
writer.close()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First object is written.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example - Using TypeableMapper for Read</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> reader = <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">in.json</span><span class="delimiter">&quot;</span></span>).newReader()
<span class="keyword">def</span> list = TypeableMapper.instance.read(reader)  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of the objects is de-serialized from the file.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api"><a class="link" href="#rest-api">Rest API</a></h3>
<div class="paragraph">
<p><span class="inline-toc-header">CRUD</span>
<span class="inline-toc"><a href="#get-read">GET (read)</a></span>
<span class="inline-toc"><a href="#post-create">POST (create)</a></span>
<span class="inline-toc"><a href="#put-update">PUT (update)</a></span>
<span class="inline-toc"><a href="#delete-delete">DELETE (delete)</a></span></p>
</div>
<div class="paragraph">
<p>The enterprise framework supports a standard
<a href="http://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noopener">REST</a>
(Representational state transfer) API where appropriate.  The domain objects are exposed
by controllers for CRUD actions.  <a href="#api-actions-non-crud">API Actions - Non-CRUD</a> are implemented as services that are also
exposed by controllers, but with specific URL endpoints.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only <a href="#json">JSON</a> is supported in these Rest API methods.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The authentication is handled by logging in to the <em>'/login'</em> page and then use the response
cookies (<em>JWT</em> and <em>JWT_REFRESH_TOKEN</em>) in the REST requests for authentication.
See <a href="#security">Security</a> for details.</p>
</div>
<div class="sect3">
<h4 id="crud"><a class="link" href="#crud">CRUD</a></h4>
<div class="paragraph">
<p>In general, Create, Read, Update, Delete (CRUD) actions are handled by REST-style URLs and
HTTP methods on the object&#8217;s controller page. Most of the time, you will use the
<a href="groovydoc/org/simplemes/eframe/controller/BaseCrudRestController.html" target="_blank" rel="noopener">BaseCrudRestController</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
in your controller to support REST-style JSON API for your domain classes.  An example is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Example Rest API Controller</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MANAGER</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/somePath</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">SomeController</span> <span class="directive">extends</span> BaseCrudRestController { <i class="conum" data-value="1"></i><b>(1)</b>

  . . .

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Handles standard Rest CRUD API actions (GET, POST, PUT and DELETE).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An HTTP GET request on the URI <em>/product/crud/BIKE27</em>  will read a <em>Product</em> and return the
given JSON response:</p>
</div>
<div class="listingblock">
<div class="title">JSON Response</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">dbb0c868-3ae5-4fd1-a0a4-e0ddda375e2b</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">PRODUCT_XYZ</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Standard 27-inch Bicycle</span><span class="delimiter">&quot;</span></span>
   <span class="error">.</span> <span class="error">.</span> <span class="error">.</span>
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="get-read"><a class="link" href="#get-read">GET (read)</a></h5>
<div class="paragraph">
<p>A <code>GET</code> is used to read data for a specific record.  The record to read is identified by the URL.
For example, to read a <em>Product</em>, use a an HTTP request like this below:</p>
</div>
<div class="paragraph">
<p><strong>uri:</strong> <code>/product/crud/PRODUCT_XYZ</code>  <em>(GET)</em></p>
</div>
<div class="paragraph">
<p>The record&#8217;s JSON is returned as the response content.  It is also possible to perform a get with
the record&#8217;s internal ID with a URI:</p>
</div>
<div class="paragraph">
<p><strong>uri:</strong> <code>/product/crud/dbb0c868-3ae5-4fd1-a0a4-e0ddda375e2b</code> <em>(GET)</em></p>
</div>
<div class="paragraph">
<p>The response is shown below:</p>
</div>
<div class="listingblock">
<div class="title">JSON Response</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">dbb0c868-3ae5-4fd1-a0a4-e0ddda375e2b</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">PRODUCT_XYZ</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Standard 27-inch Bicycle</span><span class="delimiter">&quot;</span></span>
   <span class="error">.</span> <span class="error">.</span> <span class="error">.</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="post-create"><a class="link" href="#post-create">POST (create)</a></h5>
<div class="paragraph">
<p>A POST request is used to create a record in your application.  An example creation is shown below:</p>
</div>
<div class="paragraph">
<p><strong>uri:</strong> <code>/product/crud</code>  <em>(POST)</em></p>
</div>
<div class="listingblock">
<div class="title">JSON Request Content</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">PRODUCT_XYZ</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Standard 27-inch Bicycle</span><span class="delimiter">&quot;</span></span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span> : [
    <span class="key"><span class="delimiter">&quot;</span><span class="content">sequence</span><span class="delimiter">&quot;</span></span>: <span class="integer">10</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Install Wheels</span><span class="delimiter">&quot;</span></span>,
      <span class="error">.</span> <span class="error">.</span> <span class="error">.</span>
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="put-update"><a class="link" href="#put-update">PUT (update)</a></h5>
<div class="paragraph">
<p><span class="inline-toc"><a href="#child-updates">Child Updates</a></span>
<span class="inline-toc"><a href="#removing-child-elements-with-one-to-one-relation">Removing Child Elements with One-To-One Relation</a></span></p>
</div>
<div class="paragraph">
<p>A PUT is used to update the data for a specific record.  The record to read is identified by the URL.
For example, to update a <em>Product</em>, perform a PUT with this URL:</p>
</div>
<div class="paragraph">
<p><strong>uri:</strong> <code>/product/crud/PRODUCT_XYZ</code> <em>(PUT)</em></p>
</div>
<div class="paragraph">
<p>The record&#8217;s JSON is passed in as the content.  A sparse update is performed on each record,
but all child records must be present. This sparse update means only fields provided in the JSON
content are updated.  The updated record is returned in the response in JSON format.</p>
</div>
<div class="paragraph">
<p>You can also perform a get with the record&#8217;s internal ID with a URI similar to:</p>
</div>
<div class="paragraph">
<p><strong>uri:</strong> <code>/product/crud/dbb0c868-3ae5-4fd1-a0a4-e0ddda375e2b</code> <em>(PUT)</em></p>
</div>
<div class="paragraph">
<p>A sample request is shown below:</p>
</div>
<div class="paragraph">
<p><strong>uri:</strong> <code>/product/crud/PRODUCT_XYZ</code>  <em>(PUT)</em></p>
</div>
<div class="listingblock">
<div class="title">JSON Request Content</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">PRODUCT_XYZ</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Standard 27-inch Bicycle</span><span class="delimiter">&quot;</span></span>
   <span class="error">.</span> <span class="error">.</span> <span class="error">.</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may update the key field(s) of an object but this is not recommended in most scenarios.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="child-updates"><a class="link" href="#child-updates">Child Updates</a></h6>
<div class="paragraph">
<p>Many domain classes have child records that belong to a parent.  These can be created and updated
with the REST API in a single request. It is important that these child records have a <em>belongsTo</em>
relationship to the parent. See <a href="#parent-child-one-to-many">Parent/Child Relationships (One-To-Many)</a> for more details.</p>
</div>
<div class="paragraph">
<p>When you send a PUT request to a domain object, the child records are
updated with a 'flush and fill' approach.  This means all of the child records are deleted
and the replaced with the records from the input JSON.</p>
</div>
<div class="paragraph">
<p>Also, if the children element is not mentioned in the input JSON, then the child records
will be left untouched.</p>
</div>
</div>
<div class="sect5">
<h6 id="removing-child-elements-with-one-to-one-relation"><a class="link" href="#removing-child-elements-with-one-to-one-relation">Removing Child Elements with One-To-One Relation</a></h6>
<div class="paragraph">
<p>If a domain object has a single child element, you can clear this child element with JSON as in
this example below:</p>
</div>
<div class="listingblock">
<div class="title">JSON Clear Reference</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">orderCode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>: {}  <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Clears the customer.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This assumes the customer is part of the order with a <em>hasOne</em> relationship.  This will
remove the customer from the order and delete it from the database.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="delete-delete"><a class="link" href="#delete-delete">DELETE (delete)</a></h5>
<div class="paragraph">
<p>A <code>DELETE</code> HTTP method is used to remove entire records from the database.  The record to delete
is identified by the URL. An example delete is shown below:</p>
</div>
<div class="paragraph">
<p><strong>uri:</strong> <code>/product/crud/PRODUCT_XYZ</code> <em>(DELETE)</em></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The response code for a successful delete is 204 (successful, no content).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="api-formats"><a class="link" href="#api-formats">API Formats</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#common-element-formats">Common Element Formats</a></span>
<span class="inline-toc"><a href="#iso-8601-datetime-formats">ISO 8601 Date/Time Formats</a></span>
<span class="inline-toc"><a href="#enumerations">Enumerations</a></span>
<span class="inline-toc"><a href="#references-to-domain-objects">References to Domain Objects</a></span>
<span class="inline-toc"><a href="#custom-fields">Custom Fields</a></span></p>
</div>
<div class="paragraph">
<p>The REST APIs support JSON for the objects processed.  The formatting and parsing is handled by
Jackson, with some help from framework logic. This section covers the common text formats supported
for things like dates and numbers.  It also covers how references to
domain objects are handled and specific limitations of various formats.</p>
</div>
<div class="sect3">
<h4 id="common-element-formats"><a class="link" href="#common-element-formats">Common Element Formats</a></h4>
<div class="paragraph">
<p>Since JSON is a text-based format, you must follow specific formats for some internal data types.
A short example is shown below:</p>
</div>
<div class="listingblock">
<div class="title">JSON Format for Example Order Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">orderCode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">12.2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">dateOrdered</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2009-02-13T18:31:30.000-05:00</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">dateToBeDelivered</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2013-08-04</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The normal JSON primitive field formats allowed are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numbers with fractions must use the decimal point as the decimal separator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Booleans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Booleans are encoded as <em>true</em> or <em>false</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dates are in ISO date format: yyyy-mm-dd.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DateTimes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date/Times are in ISO date/time format: yyyy-mm-ddThh:mm:ss.sssZZZZZ.  (The Z is the timezone offset).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="iso-8601-datetime-formats"><a class="link" href="#iso-8601-datetime-formats">ISO 8601 Date/Time Formats</a></h4>
<div class="paragraph">
<p>The framework can read and write ISO date/time formats.  There are a few variations supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yyyy-mm-ddThh:mm:ss.sssZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-02-13T23:31:30.000Z  (Always in UTC Timezone)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yyyy-mm-ddThh:mm:ssZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-02-13T23:31:30Z  (Always in UTC Timezone)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yyyy-mm-ddThh:mm:ss.ssszzzzzz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-02-13T18:31:30.000-05:00 (Format used when writing a date/time).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yyyy-mm-ddThh:mm:sszzzzzz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-02-13T18:31:30-05:00</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first format is used when writing date/times for JSON.</p>
</div>
</div>
<div class="sect3">
<h4 id="enumerations-2"><a class="link" href="#enumerations-2">Enumerations</a></h4>
<div class="paragraph">
<p>The Java Enums typically have an internal ID that is stored in the database and a <code>toString()</code>
representation that is more human-readable.
The framework expects both values to be unique within the enumeration.</p>
</div>
<div class="paragraph">
<p>For JSON, the output is the human-readable format (not localized):</p>
</div>
<div class="listingblock">
<div class="title">JSON Format</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="key"><span class="delimiter">&quot;</span><span class="content">fieldFormat</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">STRING</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="references-to-domain-objects"><a class="link" href="#references-to-domain-objects">References to Domain Objects</a></h4>
<div class="paragraph">
<p>Foreign keys within domain objects are stored with their IDs in a column in the database.
The JSON format for these references can use the 'id' format:</p>
</div>
<div class="listingblock">
<div class="title">JSON Foreign Reference by ID</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">orderCode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dbb0c868-3ae5-4fd1-a0a4-e0ddda375e2b</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The internal ID of the customer record.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use the key fields for these foreign references:</p>
</div>
<div class="listingblock">
<div class="title">JSON Foreign Reference by Key Field(s)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">orderCode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BIKE_27</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The primary key of the foreign record to reference.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use the key fields in a simple format using the simplified
<a href="#json-by-key">@JSONByKey</a> format:</p>
</div>
<div class="listingblock">
<div class="title">JSONByKey Foreign Reference by Key Field</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">orderCode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BIKE_27</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The primary key of the foreign record to reference.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You must mark the reference using the &lt;json-by-key,@JSONByKey&gt;&gt; annotation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="custom-fields"><a class="link" href="#custom-fields">Custom Fields</a></h4>
<div class="paragraph">
<p><a href="#field-extensions">Field Extensions</a> and <a href="#configurable-types">Configurable Types</a> are special fields that are added by
your users and sometimes by module programmers.  These are accessed via the JSON like normal
fields.</p>
</div>
<div class="paragraph">
<p>For example, a custom <code>Order</code> with two custom fields ('promiseDate', 'caseColor') would be
accessed like this:</p>
</div>
<div class="listingblock">
<div class="title">JSON Format for Field Extensions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">M10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">12.2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_fields</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">promiseDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2009-02-13T18:31:30.000-05:00</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">caseColor</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BLUE</span><span class="delimiter">&quot;</span></span>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">_config</span><span class="delimiter">&quot;</span></span>: {
      <span class="error">.</span> <span class="error">.</span> <span class="error">.</span>   <i class="conum" data-value="1"></i><b>(1)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The custom field configurations.  This is stored with the field values to allow
the definitions to change without los of data/type information.
See <a href="#custom-field-storage">Custom Field Storage</a> for more details.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These will be stored in the normal storage location for <a href="#field-extensions">Field Extensions</a>.</p>
</div>
<div class="paragraph">
<p>If you use <a href="#configurable-types">Configurable Types</a> for an RMA object, you might have a field that the uses
<a href="#flex-types">Flex Types</a> that lets the customer define their own data fields.  The RMA domain object
might look like this:</p>
</div>
<div class="listingblock">
<div class="title">Example Flex Type Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">RMA</span> {
  <span class="predefined-type">String</span> rma
  <span class="predefined-type">String</span> product
  <span class="predefined-type">BigDecimal</span> qty
  <span class="predefined-type">Date</span> returnDate
  FlexType rmaType  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="annotation">@Nullable</span>
  <span class="annotation">@ExtensibleFieldHolder</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="annotation">@MappedProperty</span>(type = DataType.JSON)
  <span class="predefined-type">String</span> fields

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The field <code>rmaType</code> will hold the reference to the appropriate flex type.  The actual
values will be stored as described in <a href="#custom-field-storage">Custom Field Storage</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines the column that will hold the JSON values of the custom fields.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The API format for this type of data field would be:</p>
</div>
<div class="listingblock">
<div class="title">JSON Format for Configurable Type Fields</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">rma</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">R10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">12.2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_fields</span><span class="delimiter">&quot;</span></span>: {                  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">retailerID</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ACME-101</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">returnCode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DEFECTIVE</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The fields are stored with the <a href="#custom-field-storage">Custom Field Storage</a> location
(<code>fields</code> in this example).</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="#custom-child-list">Custom Child List</a> will use the API format described in
      <a href="#custom-child-list-storage">Custom Child List Storage</a>.  This follows the normal JSON array format, but
      the element is stored at the top-level, under the name of the custom field.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Updates are allowed for the <code>_fields</code> element, but the <code>_config</code> element
(<a href="#custom-field-storage">Custom Field Storage</a>) are ignored.</p>
</div>
<div class="sect4">
<h5 id="custom-fields-provide-type-via-crud-api"><a class="link" href="#custom-fields-provide-type-via-crud-api">Custom Fields - Provide Type via CRUD API</a></h5>
<div class="paragraph">
<p>Creations and updates via the <a href="#rest-api">Rest API</a> can define the field type on creation.
This is normally not needed for the normal JSON field types (string, number, boolean).
For example, if you need to create a custom field that is a DateOnly
type, you can specify the field type in the JSON.  The format is identical to the
<a href="#custom-field-storage">Custom Field Storage</a> format. You can create these types using the JSON below:</p>
</div>
<div class="listingblock">
<div class="title">JSON Format - Types for Custom Fields</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">rma</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">R10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">12.2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_fields</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">dueDate</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2021-01-31</span><span class="delimiter">&quot;</span></span>,   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">_config</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">dueDate</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">D</span><span class="delimiter">&quot;</span></span>,           <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">tracking</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span>        <i class="conum" data-value="3"></i><b>(3)</b>
      }
    },
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The value for the <code>dueDate</code> custom field.  ISO Date formatted string.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The custom field type.  This type is defined as the DB value in <a href="#field-types">Field Types</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The history tracking option.  See <a href="#custom-field-history">Custom Field History</a> for details.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any changes to the type are not allowed on existing fields.
      The update will fail if the type is changed.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="api-actions-non-crud"><a class="link" href="#api-actions-non-crud">API Actions - Non-CRUD</a></h4>
<div class="paragraph">
<p>The framework supports many types of API calls that are not related to Create, Read, Update, Delete
(CRUD) actions. These follow the general REST approach, but primarily use the HTTP <code>POST</code> method.
These APIs also do not use the HTTP URL to identify the objects being processed in most cases.
The HTTP request content is assumed to be JSON and it will contain the objects to be processed.</p>
</div>
<div class="paragraph">
<p>These types of API calls are always implemented as a normal Service that is exposed by a controller.
You must implement a controller associated with the service and provides the REST-style HTTP access.
Internal programs running within the application server should use
the service directly.  The HTTP API is only intended for access from external clients
(GUIs, machines, etc).</p>
</div>
<div class="paragraph">
<p>An example of this service might be an Order <code>charge()</code> method.  This method might charge the
customer&#8217;s credit card for the given order.  The JSON content is a POGO that the controller knows how
to process.</p>
</div>
<div class="paragraph">
<p>To perform this charge, the following request is used:</p>
</div>
<div class="paragraph">
<p><strong>url:</strong> <code>/order/charge</code>  <em>(POST)</em></p>
</div>
<div class="listingblock">
<div class="title">JSON ChargeRequest</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">10102-23</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>: <span class="float">50.00</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">POGO for Request Object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> orders

<span class="predefined-type">Class</span> ChargeRequest {
  Order order  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="predefined-type">BigDecimal</span> total
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A reference to a domain class by key (Order).  See <a href="#references-to-domain-objects">References to Domain Objects</a> for details.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Controller Logic For POGO-Based APIs</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/chargeAPI</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">ChargeController</span> {
  <span class="keyword">def</span> orderService  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="annotation">@Post</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/charge</span><span class="delimiter">&quot;</span></span>)
  ChargeResponse charge(<span class="annotation">@Body</span> ChargeRequest chargeRequest, <span class="annotation">@Nullable</span> <span class="predefined-type">Principal</span> principal) {  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">return</span> orderService.charge(chargeRequest)       <i class="conum" data-value="3"></i><b>(3)</b>
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>OrderService</code> will handle this request.  It is injected by Micronaut here.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The content will be parsed into our POGO <em>ChargeRequest</em> by Micronaut.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>OrderService.charge()</code> method will process the request and return a POGO as the results.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="api-error-handling"><a class="link" href="#api-error-handling">API Error Handling</a></h4>
<div class="paragraph">
<p>Exceptions encountered during these CRUD and other service calls will be returned to the caller.
When the REST-style API is used over HTTP, any exception
will be returned in a standardized JSON an HTTP 'bad' response code (typically 400).
In most cases an error code will also be part of the response.  Below, the code 1001 refers to an
error message in the standard <em>messages.properties</em> file.
An example error response is shown below:</p>
</div>
<div class="listingblock">
<div class="title">JSON Error Response</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:
  {<span class="key"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Order 'M1657334' cannot be worked.  Status='Done'</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1001</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most errors will be triggered as an exception.  The exception&#8217;s <code>toString()</code>
method is typically used to get the displayable error message string.</p>
</div>
<div class="paragraph">
<p>Multiple messages and other levels can be returned by other controller methods as described in
<a href="reference.html#responses">Responses</a>.</p>
</div>
<div class="paragraph">
<p>To return these responses consistently, you can use the
<a href="groovydoc/org/simplemes/eframe/controller/BaseController.html" target="_blank" rel="noopener">BaseController</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.  This base class adds a standard Micronaut <code>error()</code> method
for the controller.</p>
</div>
<div class="listingblock">
<div class="title">Controller Error Handling</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/charge</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">ChargeController</span> <span class="directive">extends</span> BaseController {  <i class="conum" data-value="1"></i><b>(1)</b>
 . . .
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All exceptions will be handled consistently and returned to the caller as an error response.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="archiving"><a class="link" href="#archiving">Archiving</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#archive-overview">Archive Overview</a></span>
<span class="inline-toc"><a href="#archive-configuration">Archive Configuration</a></span>
<span class="inline-toc"><a href="#archive-api">Archive API</a></span>
<span class="inline-toc"><a href="#file-archiver">File Archiver</a></span></p>
</div>
<div class="sect2">
<h3 id="archive-overview"><a class="link" href="#archive-overview">Archive Overview</a></h3>
<div class="paragraph">
<p>In enterprise applications, old data can build up and slow down runtime performance.
To reduce this, the framework provides a simple mechanism for archiving old data from the production
database.  The framework also provides the unarchive mechanism.</p>
</div>
<div class="paragraph">
<p>Multiple types of archive mechanisms are possible.  The framework provides an implementation for JSON
<a href="#file-archiver">File Archiver</a>, but you can provide your own archiver(s).  See the bean
<a href="groovydoc/org/simplemes/eframe/archive/ArchiverFactory.html" target="_blank" rel="noopener">ArchiverFactory</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> for details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When exposed via your controllers, the archive action takes place in a single database transaction.
This means very large archive transactions may happen if you archive a lot of records at one time.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Archive JSON File</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[ <span class="string"><span class="delimiter">&quot;</span><span class="content">org.simplemes.mes.demand.Order</span><span class="delimiter">&quot;</span></span>,   <i class="conum" data-value="1"></i><b>(1)</b>
    {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">SC1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">dateCompleted</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2013-05-11T18:29:50.307Z</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">lsnTrackingOption</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER_ONLY</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">overallStatusId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">qtyToBuild</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0000</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">qtyDone</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0000</span>
    },
    <span class="string"><span class="delimiter">&quot;</span><span class="content">org.simplemes.mes.action.ActionLog</span><span class="delimiter">&quot;</span></span>,
    {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">action</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">RELEASE</span><span class="delimiter">&quot;</span></span>
        <span class="error">.</span> <span class="error">.</span> <span class="error">.</span>
    }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The archive is made up of pairs of entries in an array.  The first part of the pair is the
class name.  The second is the JSON of the object itself.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This format relies on the ability of Jackson to parse in stages. The
<a href="#typeablemapper">TypeableMapper</a> utility bean provides access to the archive by reading the
JSON and then converting the payload(s) to the right type.</p>
</div>
<div class="sect3">
<h4 id="archive-design-decisions"><a class="link" href="#archive-design-decisions">Archive Design Decisions</a></h4>
<div class="paragraph">
<p>Some of the key requirements of archiving are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Handle large number of un-related elements in an archive.</p>
</li>
<li>
<p>Support JSON format of all supported <a href="#field-types">Field Types</a>.</p>
</li>
<li>
<p>Prevent any security holes.</p>
</li>
<li>
<p>Allow extension by customers.</p>
</li>
<li>
<p>Support JSON format for User Preferences in secure way.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These requirements forced us to consider how to configure Jackson to meet these requirements.</p>
</div>
<div class="paragraph">
<p>We investigated Jackson&#8217;s
<a href="https://github.com/FasterXML/jackson-docs/wiki/JacksonPolymorphicDeserialization">Polymorphic Deserialization</a>
capability.  That approach allows the JSON payload to instantiate almost any Java class.
This can be a vector for attacks on your servers.</p>
</div>
<div class="paragraph">
<p>Instead, we chose to use a simple array representation of of the objects being archived.  Then, we have a
white list of allowed classes that can be stored in this JSON.  This list includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All Domain Entities (persistent domain objects).</p>
</li>
<li>
<p>Classes marked with the the special interface
<a href="groovydoc/org/simplemes/eframe/json/TypeableJSONInterface.html" target="_blank" rel="noopener">TypeableJSONInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is done because we never want to allow any client to create an arbitrary class via a REST API.
To help reduce this risk, we also only allow the Typeable logic for archive files and for
User Preferences.</p>
</div>
</div>
<div class="sect3">
<h4 id="archive-references"><a class="link" href="#archive-references">Archive References</a></h4>
<div class="paragraph">
<p>The archive process returns a string reference that can later be used to unarchive the object(s).  With File archives,
this is a relative path name for the archive file itself.   You can use this reference as you need.</p>
</div>
</div>
<div class="sect3">
<h4 id="archiving-related-records"><a class="link" href="#archiving-related-records">Archiving Related Records</a></h4>
<div class="paragraph">
<p>The framework archive mechanisms will archive the top-level object and any direct children.  It does
not archive foreign objects that your classes refer to.  For example, an order will be archived
with its order line items.  The <em>Product</em> the order refers to will not be automatically archived.
This is because the <em>Product</em> will probably be re-used for other orders.</p>
</div>
<div class="paragraph">
<p>You can change this default behavior. Usually, when you archive a top-level domain object, there are other,
related records that you want to archive with it.
To support this, the framework looks at your top-level domain class and looks for the <code>findRelatedRecords()</code> method.
If the method exists, it will be called and those returned objects will be archived along with your domain object.</p>
</div>
<div class="paragraph">
<p>This clean up of related records is critical for keeping your database size manageable.
An example <code>findRelatedRecords()</code> is shown below:</p>
</div>
<div class="listingblock">
<div class="title">Domain Class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; findRelatedRecords() {
  <span class="keyword">return</span> ActionLog.findAllByOrder(order)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This finds all <em>ActionLog</em> records related to the order being archived and returns them for archiving.
You do not need to include child records for your domain object.  Just the objects that are related but are not true
children.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When this <code>findRelatedRecords()</code> method is called, the record(s) in your top-level domain class have
      not been deleted. All deletes take place after the archive has been successfully written to the file.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="archive-configuration"><a class="link" href="#archive-configuration">Archive Configuration</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#periodic-archive-tasks">Periodic Archive Tasks</a></span></p>
</div>
<div class="paragraph">
<p><span class="inline-toc-header">application.yml Options</span>
<span class="inline-toc"><a href="#automatic-verification-of-json">Automatic Verification of JSON</a></span>
<span class="inline-toc"><a href="#archive-logging">Archive Logging</a></span>
<span class="inline-toc"><a href="#archiver-to-use">Archiver to Use</a></span>
<span class="inline-toc"><a href="#file-archiver-options">File Archiver Options</a></span></p>
</div>
<div class="paragraph">
<p>Archiving needs some basic configuration to perform your archive tasks periodically.
You can also use the programmatic API to trigger the archive/unarchive under other conditions.</p>
</div>
<div class="sect3">
<h4 id="periodic-archive-tasks"><a class="link" href="#periodic-archive-tasks">Periodic Archive Tasks</a></h4>
<div class="paragraph">
<p>TBD</p>
</div>
<div class="paragraph">
<p>Most archiving is done automatically when records reach a specific age.  For example,
the <a href="../mes-core/guide.html" target="_blank" rel="noopener">MES Core</a> <span class="icon link-blue"><i class="fa fa-share-square"></i></span>
Production Log records are archived after they reach a user-configurable age.</p>
</div>
<div class="paragraph">
<p>The MES Core module configures a background task record, which the user can edit to
adjust the archive window and other options.</p>
</div>
<div class="paragraph">
<p>When creating an archive task, you can define what elements are needed to control the archiving.
For example, the MES production log archiving has two main options: age (days) and batch size.
This helps reduce the load on the system when archiving large numbers of records.  The batch size
makes sure that only one JSON file is created for a large number of those small records.</p>
</div>
<div class="paragraph">
<p>Typically, you add records to the default archive task table with an initial data load
domain class in your module:</p>
</div>
<div class="listingblock">
<div class="title">Example Initial Data Load</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">InitialData</span> {

  <span class="directive">static</span> mapWith = <span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span>   <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="directive">static</span> initialDataLoad() {
    <span class="keyword">if</span> (!BackgroundTask.findByTask(<span class="string"><span class="delimiter">'</span><span class="content">PROD_LOG_ARCHIVE</span><span class="delimiter">'</span></span>)) {   <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="keyword">def</span> handler = <span class="keyword">new</span> SampleBackgroundTaskHandler(<span class="key">ageDays</span>: <span class="integer">180</span>, <span class="key">batchSize</span>: <span class="integer">500</span>)   <i class="conum" data-value="3"></i><b>(3)</b> <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="keyword">def</span> task = <span class="keyword">new</span> BackgroundTask(<span class="key">task</span>: <span class="string"><span class="delimiter">'</span><span class="content">PROD_LOG_ARCHIVE</span><span class="delimiter">'</span></span>, <span class="key">backgroundTaskHandler</span>: handler)
      task.backgroundTaskHandlerData = handler.data
      task.runInterval = TimeIntervalEnum.DAYS_1  <i class="conum" data-value="5"></i><b>(5)</b>
      task.save()

      log.warn(<span class="string"><span class="delimiter">&quot;</span><span class="content">Loaded test data BackgroundTask: PROD_LOG_ARCHIVE</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Marks this domain as non-persistent.  It just supports the <code>initialDataLoad()</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checks to see if the task exists already.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Your task should implement the
<a href="groovydoc/org/simplemes/eframe/system/BackgroundTaskInterface.html" target="_blank" rel="noopener">BackgroundTaskInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The defaults are set to archive records after 180 days, with a batch/file size of 500.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This task is run once per day.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The execution run interval is approximate.  It is only checked every 5 minutes, so
      more frequent execution is not supported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="automatic-verification-of-json"><a class="link" href="#automatic-verification-of-json">Automatic Verification of JSON</a></h4>
<div class="paragraph">
<p>The archiver will delete your domain objects after successfully writing the archive.
By default, the file will be verified.  If you wish to turn this off, then set this
<em>application.yml</em> option:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eframe.archive.verify</span>: <span class="string"><span class="content">false </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disables verification of the JSON file.  Enabled by default.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is a simple verification. In the case of JSON file archives, it verifies that the file
contains valid JSON, but it does not actually restore the object(s).  There may be other reasons
that the object(s) can&#8217;t be restored.</p>
</div>
</div>
<div class="sect3">
<h4 id="archive-logging"><a class="link" href="#archive-logging">Archive Logging</a></h4>
<div class="paragraph">
<p>By default, all top-level archived records are logged to the
<a href="groovydoc/org/simplemes/eframe/archive/ArchiveLog.html" target="_blank" rel="noopener">ArchiveLog</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
domain class (database).
This provides a link to the actual archive file for later recovery.  You can disable this logging with the option:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eframe.archive.log</span>: <span class="string"><span class="content">false  </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disables the creation of the ArchiveLog records.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to log to the server logs using the normal Logback logging mechanism using standard <a href="#logging">Logging</a> mechanism
for the class <em>org.simplemes.eframe.archive.FileArchiver</em></p>
</div>
</div>
<div class="sect3">
<h4 id="archiver-to-use"><a class="link" href="#archiver-to-use">Archiver to Use</a></h4>
<div class="paragraph">
<p>The default archiver is the <a href="#file-archiver">File Archiver</a>, which has its own configuration options.</p>
</div>
<div class="paragraph">
<p>You can provide your own archiver(s).
If you wish to use a custom archiver, use this option to point to you custom class:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eframe.archive.archiver</span>: <span class="string"><span class="content">org.sample.custom.Archiver</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="archive-api"><a class="link" href="#archive-api">Archive API</a></h3>
<div class="paragraph">
<p>The Archive API is available for your application&#8217;s use.  You can use is directly through
programmatic calls or via the <a href="#archive-configuration">Archive Configuration</a> options to register your archive logic.
This archiver generally writes simple text (JSON) versions of the objects to a text file for later
un-archiving.</p>
</div>
<div class="sect3">
<h4 id="programmatic-archiving"><a class="link" href="#programmatic-archiving">Programmatic Archiving</a></h4>
<div class="paragraph">
<p>Sometimes, you have scenarios that require specific archive or unarchive actions.
You can use the <a href="groovydoc/org/simplemes/eframe/archive/ArchiverFactory.html" target="_blank" rel="noopener">ArchiverFactory</a>
directly when needed:</p>
</div>
<div class="listingblock">
<div class="title">Archiving on Demand</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.simplemes.eframe.archive.ArchiverFactory</span>

<span class="keyword">def</span> archiver = ArchiverFactory.archiver
archiver.archive(domainObject)           <i class="conum" data-value="1"></i><b>(1)</b>
archiver.archive(relatedObject1)
archiver.archive(relatedObject2)
<span class="keyword">def</span> reference = archiver.close()

 . . .

archiver = ArchiverFactory.archiver  <i class="conum" data-value="2"></i><b>(2)</b>
archiver.unarchive(reference)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Archive a domain object and two related objects.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Later, unarchive the object(s)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This creates an JSON file in a configurable directory and deletes the archived objects.  Later, this example uses the
archive <code>reference</code> to unarchive the domain objects.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="file-archiver"><a class="link" href="#file-archiver">File Archiver</a></h3>
<div class="paragraph">
<p>The <a href="groovydoc/org/simplemes/eframe/archive/FileArchiver.html" target="_blank" rel="noopener">FileArchiver</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>
mechanism built into the framework lets you archive domain objects to an JSON file and
have the objects deleted from the production database.
This is the default archiving mechanism in the framework.</p>
</div>
<div class="sect3">
<h4 id="file-archiver-options"><a class="link" href="#file-archiver-options">File Archiver Options</a></h4>
<div class="paragraph">
<p>This file archiver is fairly flexible in how it names the archive files and where it stores them.
The full capability is covered in the Groovy doc
<a href="groovydoc/org/simplemes/eframe/archive/FileArchiver.html" target="_blank" rel="noopener">FileArchiver</a> <span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These configuration options all support the normal Groovy GString capabilities, but dollar signs ($) are
always expanded in the <em>application.groovy</em> file.  To get around this, the framework uses hash (#) as a temporary
placeholder for dollar sign ($).  The # is replaced with a $ before evaluation of the string at run time.
The $ is supported in the <em>application.yml</em> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The behavior of the file archiver can be tailored to your needs.  For example, the directory(s) the archives are
stored in can be configured in your <em>application.yml</em> file.  The defaults used  by the framework are shown below:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="error">eframe.archive.topFolder = 'archives'</span>
<span class="error">eframe.archive.folderName = '#{year}-#{month}-#{day}'</span>
<span class="error">eframe.archive.fileName = '#{key}'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This makes the archive folder vary over time to avoid filling up a directory with too many files.
This will create a top-level directory <em>archives</em> with a sub-folder for every day:</p>
</div>
<div class="listingblock">
<div class="title">Archive Files</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">archives/<span class="integer">2013</span>-<span class="integer">08</span>-<span class="integer">13</span>/M1012.arc
archives/<span class="integer">2013</span>-<span class="integer">08</span>-<span class="integer">13</span>/M1013.arc
archives/<span class="integer">2013</span>-<span class="integer">08</span>-<span class="integer">13</span>/M1014.arc
archives/<span class="integer">2013</span>-<span class="integer">08</span>-<span class="integer">13</span>/M1015.arc
archives/<span class="integer">2013</span>-<span class="integer">08</span>-<span class="integer">14</span>/M1016.arc</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default file name for the archive is to use the <code>toString()</code> value from the first object
(<em>M1012</em>, etc above) as the basic file name.  This assumes the <code>toString()</code> returns the key
fields for your domain object and the value is
unique.  If the file already exists, then a 'dash' number will be added to the end as needed:</p>
</div>
<div class="listingblock">
<div class="title">Archive Files</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">archives/<span class="integer">2013</span>-<span class="integer">08</span>-<span class="integer">13</span>/M1012.arc
archives/<span class="integer">2013</span>-<span class="integer">08</span>-<span class="integer">13</span>/M1012-<span class="integer">1</span>.arc
archives/<span class="integer">2013</span>-<span class="integer">08</span>-<span class="integer">13</span>/M1012-<span class="integer">2</span>.arc</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="archive-file-name"><a class="link" href="#archive-file-name">Archive File Name</a></h4>
<div class="paragraph">
<p>It is also possible to use other elements from the archived object in the JSON file name/path.  See
<a href="groovydoc/org/simplemes/eframe/archive/FileArchiver.html" target="_blank" rel="noopener">FileArchiver</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> for details on the Config options.
This could be used to create a folder structure with your customer ID in the path and use the order
number in the file name.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># Define file/path for archiving based on customer ID and order number.</span>
<span class="error">eframe.archive.topFolder = '../archives'</span>
<span class="error">eframe.archive.folderName = '#{order.customer}/#{year}'</span>
<span class="error">eframe.archive.fileName = '#{order.orderNumber}'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This makes the archive folder vary over time and uses the customer and order number to
organize your archives:</p>
</div>
<div class="listingblock">
<div class="title">Archive Files</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">..<span class="regexp"><span class="delimiter">/</span><span class="content">archives</span><span class="delimiter">/</span></span>ACME/<span class="integer">2010</span>/<span class="integer">6571012</span>.arc
..<span class="regexp"><span class="delimiter">/</span><span class="content">archives</span><span class="delimiter">/</span></span>ACME/<span class="integer">2010</span>/<span class="integer">6571013</span>.arc
..<span class="regexp"><span class="delimiter">/</span><span class="content">archives</span><span class="delimiter">/</span></span>ACME/<span class="integer">2010</span>/<span class="integer">6571014</span>.arc
..<span class="regexp"><span class="delimiter">/</span><span class="content">archives</span><span class="delimiter">/</span></span>ACME/<span class="integer">2010</span>/<span class="integer">6571015</span>.arc
..<span class="regexp"><span class="delimiter">/</span><span class="content">archives</span><span class="delimiter">/</span></span>ACME/<span class="integer">2011</span>/<span class="integer">6571016</span>.arc</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, the default location for March 2016 is <em>/archives/2016-03</em>.</p>
</div>
<div class="paragraph">
<p>The configurable values that can be used in the <code>folderName</code> option are:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">year</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current year (4 digits).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">month</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current month (2 digits).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current day of the month (2 digits).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hour</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current hour (2 digits, 24 hour notation).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The primary key of the object being archived (e.g. order).  The TypeUtils.toShortString() is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The object being archived (e.g. order).  The object&#8217;s <code>toString()</code> method is used.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a filename already exists, then a sequence number will be added to the end to avoid conflicts.
This means it is possible to have multiple archive files for a given order.  For example, for
order <em>A0001</em>, it is possible to have two archive files such as
<em>A0001.arc</em> and <em>A0001-1.arc</em>.  This is one of the many reasons to avoid duplicate orders.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customizations"><a class="link" href="#customizations">Customizations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc-header">Fields</span>
<span class="inline-toc"><a href="#field-types">Field Types</a></span>
<span class="inline-toc"><a href="#field-extensions">Field Extensions</a></span>
<span class="inline-toc"><a href="#field-extension-gui">Field Extension GUI</a></span>
<span class="inline-toc"><a href="#configurable-types">Configurable Types</a></span>
<span class="inline-toc"><a href="#flex-types">Flex Types</a></span>
<span class="inline-toc"><a href="#extension-points">Extension Points</a></span></p>
</div>
<div class="paragraph">
<p><span class="inline-toc-header">Module Additions</span>
<span class="inline-toc"><a href="#module-additions">Module Additions</a></span></p>
</div>
<div class="sect2">
<h3 id="field-types"><a class="link" href="#field-types">Field Types</a></h3>
<div class="paragraph">
<p>This framework supports a large number of field types (e.g. String, Date, other
domain classes, etc).  The enterprise framework works with a subset of these types to reduce the
boiler-plate code you must write.  Most of the time, these types are used
internally in the framework and you won&#8217;t need to use them directly.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Field Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">DB Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">StringFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer/int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IntegerFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NumberFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DateOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DateOnlyFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DateFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean/boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BooleanFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long/long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LongFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Domain Reference</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DomainReferenceFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>List of Refs</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DomainRefListFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Q</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>List of Children</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ChildListFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>List of Custom Children</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CustomChildListFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">K</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enumeration</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnumFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>EncodedType</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EncodedTypeFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configurable Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConfigurableTypeFieldFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each type is represented by a class in the <em>data.format</em> packages and implements the
<a href="groovydoc/org/simplemes/eframe/data/format/FieldFormatInterface.html" target="_blank" rel="noopener">FieldFormatInterface</a>.
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span></p>
</div>
<div class="paragraph">
<p>The framework automatically maps these type of fields to the correct database type, but sometimes
the domains need a hint.</p>
</div>
</div>
<div class="sect2">
<h3 id="field-extensions"><a class="link" href="#field-extensions">Field Extensions</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#design-decisions">Design Decisions</a></span>
<span class="inline-toc"><a href="#custom-field-design">Custom Field Design</a></span>
<span class="inline-toc"><a href="#custom-field-storage">Custom Field Storage</a></span>
<span class="inline-toc"><a href="#custom-field-usage">Custom Field Usage</a></span>
<span class="inline-toc"><a href="#extensiblefieldholder-annotation">ExtensibleFieldHolder Annotation</a></span>
<span class="inline-toc"><a href="#extension-logging">Extension Logging</a></span>
<span class="inline-toc"><a href="#field-extension-example">Field Extension Example</a></span>
<span class="inline-toc"><a href="#field-types">Field Types</a></span>
<span class="inline-toc"><a href="#single-domain-reference">Single Domain Reference</a></span>
<span class="inline-toc"><a href="#custom-child-list">Custom Child List</a></span>
<span class="inline-toc"><a href="#custom-child-list-integrationgui-testing">Custom Child List - Integration/GUI Testing</a></span></p>
</div>
<div class="paragraph">
<p>The Enterprise Framework module lets the user define custom fields for most domain objects.
These are stored in a single string column in the domain object.  You (as the application
developer) must enable this feature on the domain classes that need this ability.
Once enabled, the end user can add custom fields and adjust the definition GUIs as they like.</p>
</div>
<div class="paragraph">
<p>The <a href="#configurable-types">Configurable Types</a>, <a href="#flex-types">Flex Types</a> and <a href="#module-additions">Module Additions</a> are based on features of
these field extensions. These features share a lot of common code.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is not yet compatible with clustering.  A manual restart of all nodes in the
      cluster is needed when changes are made to this definition.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="design-decisions"><a class="link" href="#design-decisions">Design Decisions</a></h4>
<div class="paragraph">
<p>All of the decisions below are based on a number of assumptions on the use of custom fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Most use cases will need a few custom fields at any given time (5-10).</p>
</li>
<li>
<p>In extreme cases, users may define a large number of custom fields in each domain (100+).</p>
</li>
<li>
<p>Most use cases will likely be reading the value (80% read, 20% write).</p>
</li>
<li>
<p>Users will not be able to restart the server to add a custom field.
Downtime is not allowed.</p>
</li>
<li>
<p>Configuration objects (e.g. Products) and production objects (e.g. Orders) will both
need user-defined fields added.  The configuration objects will use one type of customizations
(<a href="#field-extensions">Field Extensions</a>) and production objects will tend to use another type (<a href="#flex-types">Flex Types</a>).</p>
</li>
<li>
<p>Users may need to collect custom fields without pre-configuration.</p>
</li>
<li>
<p>Users will want to track all changes made to custom values, record who/what/when/where.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When designing the custom field support, we had hoped to store each custom field value in its own
database column. Unfortunately, that was not possible with Micronaut Data.  Micronaut Data requires
that persisted fields be compiled into the domain classes. This would force a recompilation/restart
of the application just to add a custom field. Instead, we chose to store all custom fields into a
single text column.  Each custom field still appears as a dynamic
field in the domain class, but they are all persisted to a single text column.</p>
</div>
<div class="paragraph">
<p>This leads to some limitations.  We feel these limitations are worth the extra flexibility.
Most importantly: The user can change the fields on the fly without restarting the application server.</p>
</div>
<div class="paragraph">
<p>Another key decision was made to use JSON for the encoding of the fields into the database column.
This allows most database engines to extract the values as needed in ad-hoc SQL.  This JSON is a
little more verbose than the absolute minimum, but it
is best for compatibility with the external tools.</p>
</div>
<div class="paragraph">
<p>Another decision was to keep the custom value in the JSON field instead of creating a new field in
the domain class itself.  This avoids double storage.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-field-design"><a class="link" href="#custom-field-design">Custom Field Design</a></h4>
<div class="paragraph">
<p>Custom fields are used by many different parts of the framework to allow customization
of your application.  The features that are associated with custom fields include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configurable-types">Configurable Types</a></p>
</li>
<li>
<p><a href="#flex-types">Flex Types</a></p>
</li>
<li>
<p><a href="#module-additions">Module Additions</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These all use the common
<a href="groovydoc/org/simplemes/eframe/custom/ExtensibleFieldHelper.html" target="_blank" rel="noopener">ExtensibleFieldHelper</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> helper methods to access the field values.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/customFieldDesign.png" alt="customFieldDesign" width="950" height="448">
</div>
<div class="title">Figure 17. Custom Field Design</div>
</div>
<div class="paragraph">
<p>All of these types of custom fields store the values in the JSON column <code>fields</code>
in the domain record.  See &lt;&lt;&gt;&gt;
The FieldExtension (user-defined and additions) are stored with the field name as-is.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-field-internal-design"><a class="link" href="#custom-field-internal-design">Custom Field - Internal Design</a></h4>
<div class="paragraph">
<p>These custom fields are complex.  They can be huge with a large number of fields and
large values.  Customers may log the data to the object without a pre-defined
field definition (e.g. without a <a href="#flex-types">Flex Types</a> or <a href="#configurable-types">Configurable Types</a>).</p>
</div>
<div class="paragraph">
<p>The user requirements are covered above in <a href="#design-decisions">Design Decisions</a>.  These user
requirements force us to use this type of implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Map front-end to hide the JSON text field from the application code.</p>
</li>
<li>
<p>Added getters/setters to synchronize the Map with the text field.</p>
</li>
<li>
<p>Dirty flags to indicate if the values are out of synch.  Reduces the number
of times the JSON os serialized/deserialized.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The implementation uses
<a href="groovydoc/org/simplemes/eframe/custom/FieldHolderMapInterface.html" target="_blank" rel="noopener">FieldHolderMapInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> and its Groovy implementation
<a href="groovydoc/org/simplemes/eframe/custom/FieldHolderMap.html" target="_blank" rel="noopener">FieldHolderMap</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.
This Map works with the
<a href="groovydoc/org/simplemes/eframe/custom/ExtensibleFieldHelper.html" target="_blank" rel="noopener">ExtensibleFieldHelper</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> to synchronize the Map/Text with the database
actions (save/retrieve).</p>
</div>
<div class="paragraph">
<p>To support this, the structure and related methods are shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/customFieldMapDesign.png" alt="customFieldMapDesign" width="990" height="252">
</div>
<div class="title">Figure 18. Custom Field Design</div>
</div>
<div class="paragraph">
<p>The Map is the primary interface used by
<a href="groovydoc/org/simplemes/eframe/custom/ExtensibleFieldHelper.html" target="_blank" rel="noopener">ExtensibleFieldHelper</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> to put/get values from the custom fields.
This Map is synchronized with the JSON text fields using the <code>set/getFields()</code> methods
and with the <code>to/fromJSON()</code> methods.</p>
</div>
<div class="paragraph">
<p>The basic life cycle of these objects is orchestrated by the
<a href="groovydoc/org/simplemes/eframe/custom/ExtensibleFieldHelper.html" target="_blank" rel="noopener">ExtensibleFieldHelper</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> class:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The domain object is created.  All fields are null.</p>
</li>
<li>
<p>A method calls <code>put()</code> to store a custom value into the Map.  The Map is marked as 'dirty'.</p>
</li>
<li>
<p>Some method then calls <code>save()</code> on the domain.</p>
</li>
<li>
<p>The <code>getFields()</code> method is called to get the string value for the database.</p>
</li>
<li>
<p>This calls the <code>toJSON()</code> method.  The record is saved.</p>
</li>
<li>
<p>Later, the record is read from the database.</p>
</li>
<li>
<p>The <code>setFields()</code> method is called.  This sets the Map to null, indicating that
the JSON needs to be deserialized.</p>
</li>
<li>
<p>A method then calls the <code>get()</code> to get the value.  If the Map is null, then
the JSON is deserialized into the Map.  The value is returned.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After this, updates to the Map will force the JSON to be re-created before the next save.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-field-usage"><a class="link" href="#custom-field-usage">Custom Field Usage</a></h4>
<div class="paragraph">
<p>The user can define custom fields on most domain classes that are marked to allow this.  These can
appear in the framework definition tags such as the <a href="#efEdit">[efEdit]</a> tag.  By default, the custom fields
are not shown in the web pages, but the user can configure the pages to show any of the custom fields.</p>
</div>
<div class="paragraph">
<p>The custom fields do not appear to be normal fields on the domain class.  They do NOT have a getters
and setters.  Instead, the framework uses the
<a href="groovydoc/org/simplemes/eframe/data/FieldDefinitionInterface.html" target="_blank" rel="noopener">FieldDefinitionInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> to access the value in the domain.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-field-storage"><a class="link" href="#custom-field-storage">Custom Field Storage</a></h4>
<div class="paragraph">
<p>Custom fields of all types are stored in a text (JSONB) column in the database for supported
domain classes.  These use the <a href="#extensiblefieldholder-annotation">ExtensibleFieldHolder Annotation</a> to mark the field as
the holder for the values. By convention, this field is almost always named <code>fields</code>.</p>
</div>
<div class="paragraph">
<p>This holder field will store these types of fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configurable-types">Configurable Types</a> - Configurable types such as FlexTypes.</p>
</li>
<li>
<p><a href="#field-extensions">Field Extensions</a> - Fields added by the user or by other modules (see <a href="#addition">Addition</a>).</p>
</li>
<li>
<p>Data collected by the Data Entry module (name TBD).</p>
</li>
<li>
<p>Other data added programmatically or via APIs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Custom child lists are handled somewhat differently.  The JSON format of these fields
looks like this:</p>
</div>
<div class="listingblock">
<div class="title">JSON Format for All Data and Values Tracking</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">rma</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">R10102-23</span><span class="delimiter">&quot;</span></span>,          <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">12.2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_fields</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">2.3</span>,             <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">_config</span><span class="delimiter">&quot;</span></span>: {               <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">I</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">tracking</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">history</span><span class="delimiter">&quot;</span></span>: [           <i class="conum" data-value="4"></i><b>(4)</b>
          <span class="error">.</span> <span class="error">.</span> <span class="error">.</span>
        ]
      }
    },
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The normal domain fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The latest value for the <code>weight</code> custom field.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The configuration for the fields.  This is only used when non-standard JSON types are
used (e.g. dates) or if tracking is needed. The type and tracking option is stored
here when needed.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The history for the weight.  See <a href="#custom-field-history">Custom Field History</a> for details.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="custom-field-history"><a class="link" href="#custom-field-history">Custom Field History</a></h5>
<div class="paragraph">
<p>It is possible to collect values for a given field name multiple times.  This means you might
collect the <code>weight</code> 3 times during manufacturing.  To keep all these values, the
Extensible Field support logic can optionally keep the old values.  These old values
are stored in the same JSON field in an history element.</p>
</div>
<div class="paragraph">
<p>This is configured at the <a href="#flex-types">Flex Types</a>, <a href="#field-extensions">Field Extensions</a> and other
configuration levels (e.g. the Data Entry module (name TBD)).
It is off by default.  The tracking options include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Latest Value Only</strong> - Only the latest value is saved (<strong>Default</strong>).</p>
</li>
<li>
<p><strong>All Values</strong> - All values are saved to a history element, but no context info is saved.</p>
</li>
<li>
<p><strong>All Data and Values</strong> - All values are saved to a history element, along with
who/what/when/where (if possible).</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Tracking historical values can produce a lot of data, so only enable this
         tracking when absolutely required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, tracking using the <strong>All Data and Values</strong> option would result in a
<code>fields</code> JSON that might look like this:</p>
</div>
<div class="listingblock">
<div class="title">JSON Format for All Data and Values Tracking</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">rma</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">R10102-23</span><span class="delimiter">&quot;</span></span>,          <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">12.2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_fields</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">2.3</span>,             <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">_config</span><span class="delimiter">&quot;</span></span>: {               <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">I</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">tracking</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALL</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">history</span><span class="delimiter">&quot;</span></span>: [           <i class="conum" data-value="4"></i><b>(4)</b>
          {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">2.3</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PWB</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">dateTime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2009-02-13T18:31:30.000-05:00</span><span class="delimiter">&quot;</span></span>
          },
          {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">2.1</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">RLB</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">dateTime</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2009-02-14T17:23:53.000-05:00</span><span class="delimiter">&quot;</span></span>
          }
        ]
      }
    },
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The normal domain fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The latest value for the <code>weight</code> custom field.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The configuration for the fields.  Set for non-default configuration settings such
as this example.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The history for the weight, if configured to track the history.  Includes values and date/user/etc.
The current value is added here when it is set in the <code>fields</code>.  Only for Tracking
option <strong>All Data and Values</strong>.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="custom-child-list-storage"><a class="link" href="#custom-child-list-storage">Custom Child List Storage</a></h5>
<div class="paragraph">
<p>When the custom field is a  <a href="#custom-child-list">Custom Child List</a> (<em>CustomChildListFieldFormat</em>),
the data is not stored in the holder as JSON.  Instead, it is stored in a custom
database table.  This means the JSON format is different:</p>
</div>
<div class="listingblock">
<div class="title">JSON Format for Custom Child List Storage</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">rma</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">R10102-23</span><span class="delimiter">&quot;</span></span>,         <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">12.2</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">customComponents</span><span class="delimiter">&quot;</span></span>: [       <i class="conum" data-value="2"></i><b>(2)</b>
     { <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BIKE-27</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">1.0</span> },
     { <span class="key"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">WHEEL</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">qty</span><span class="delimiter">&quot;</span></span>: <span class="float">2.0</span> }
    ]
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The normal domain fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The list of custom child records.  Stored in another database table.
In the domain object itself, these custom records are stored in a
special Map.   The values can be accessed with the normal custom field
getters/setters: such as <code>getCustomComponents()</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is a fairly complex feature that is only supported in a limited number of scenarios
as described in <a href="#custom-child-list">Custom Child List</a>.  It is very useful for <a href="#module-additions">Module Additions</a> so
that a module can add a list of custom values for a core domain object.</p>
</div>
<div class="paragraph">
<p>Why put these in another element in the JSON?  Because the Jackson JSON mapper automatically
creates/parses the JSON for the standard <a href="#custom-field-storage">Custom Field Storage</a> mechanism.  To use
the same storage mechanism, we would have to write a lot of complex logic to
extract and insert the custom child lists.</p>
</div>
<div class="paragraph">
<p>This is not ideal, but it is the best compromise.</p>
</div>
</div>
<div class="sect4">
<h5 id="custom-field-name-collisions"><a class="link" href="#custom-field-name-collisions">Custom Field Name Collisions</a></h5>
<div class="paragraph">
<p>These fields are stored in the JSON text as simple name/value pairs.  This means there is a
chance of name collisions.  Since most of these features won&#8217;t be used on the same domain,
the chance is low.  If it is a problem, then we recommend that customers used a field
name prefix to avoid this issue.  For example, use the prefix <em>'rmaType</em>'_ for all
fields collected for an RMA flex type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Preventing name collisions is the responsibility of the system integrator and users.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="extensiblefieldholder-annotation"><a class="link" href="#extensiblefieldholder-annotation">ExtensibleFieldHolder Annotation</a></h5>
<div class="paragraph">
<p>You, as the application developer, must mark your domain classes that you wish to allow custom fields.
A simple domain class might look like this:</p>
</div>
<div class="listingblock">
<div class="title">Extensible Fields Use</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@MappedEntity</span>
<span class="annotation">@DomainEntity</span>
<span class="type">class</span> <span class="class">SampleDomain</span> {
  <span class="predefined-type">String</span> key
  <span class="predefined-type">String</span> name
  . . .

  <span class="annotation">@Nullable</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="annotation">@ExtensibleFieldHolder</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="annotation">@MappedProperty</span>(type = DataType.JSON) <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="predefined-type">String</span> fields  <i class="conum" data-value="4"></i><b>(4)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The field should allow no custom fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The extensible fields requires a place to store the values (in JSON).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The data type is a native JSON type (jsonb in Postgres).  This allows direct queries on
the custom values.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The suggested field name is <code>fields</code>.  This is a short name for use in complex
SQL queries on the custom fields.  Also, this field name will be used for
JSON access to the custom fields (e.g. a sub-object <em>"_fields"</em> will be used).</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should not change the column name for custom fields on a production database.
      There is no automatic database migration to handle a column name change.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will use the field <code>fields</code> in the domain class and save it in the database with
an unlimited <code>jsonb</code> column.
===== Accessing Custom Field Values</p>
</div>
<div class="paragraph">
<p>Now that your domain supports custom fields, how do you access them?
The core framework supports setting/displaying the values via the <a href="#Definition Pages">[Definition Pages]</a>
and the <a href="#rest-api">Rest API</a>.  The fields are configured using the <a href="#field-extension-gui">Field Extension GUI</a>.</p>
</div>
<div class="paragraph">
<p>To access the fields in your code, you can use the convenience method for the custom field
as if it was a property.  For example, if you have the custom field 'caseColor' on the
domain, you can access it using this syntax:</p>
</div>
<div class="listingblock">
<div class="title">Example - Accessing Custom Fields as a Property</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> order = <span class="keyword">new</span> Order(<span class="key">order</span>: <span class="string"><span class="delimiter">'</span><span class="content">M1002</span><span class="delimiter">'</span></span>)

order.caseColor = <span class="string"><span class="delimiter">'</span><span class="content">Red</span><span class="delimiter">'</span></span>   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">def</span> color = order.caseColor = <span class="string"><span class="delimiter">'</span><span class="content">Red</span><span class="delimiter">'</span></span>   <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set a custom field 'caseColor' to 'Red'.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Gets the custom field 'caseColor' from the order.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternately, you can also use the <code>setFieldValue()</code> and <code>getFieldValue()</code>
methods that are added to your domain classes.  This is used in framework code internally.</p>
</div>
<div class="listingblock">
<div class="title">Example - Accessing Custom Fields</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> order = <span class="keyword">new</span> Order(<span class="key">order</span>: <span class="string"><span class="delimiter">'</span><span class="content">M1002</span><span class="delimiter">'</span></span>)

order.setFieldValue(<span class="string"><span class="delimiter">'</span><span class="content">caseColor</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Red</span><span class="delimiter">'</span></span>)   <i class="conum" data-value="1"></i><b>(1)</b>

<span class="predefined-type">Date</span> promiseDate = order.getFieldValue(<span class="string"><span class="delimiter">'</span><span class="content">promiseDate</span><span class="delimiter">'</span></span>) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set a custom field 'caseColor' to 'Red'.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The set and get methods support the field extension data types such as Date and other
supported <a href="#field-types">Field Types</a>.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="deleting-fields"><a class="link" href="#deleting-fields">Deleting Fields</a></h5>
<div class="paragraph">
<p>You can delete the field definition.  Existing records will not have the value removed from the
<code>fields</code> column, but the the support logic won&#8217;t process them for display/editing.</p>
</div>
<div class="paragraph">
<p>Also, the data in the <code>fields</code> column will no longer be validated, but it is part of the
stored values.</p>
</div>
<div class="paragraph">
<p>You can also change the custom field name, but existing values in domain records will not
be changed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="extension-logging"><a class="link" href="#extension-logging">Extension Logging</a></h4>
<div class="paragraph">
<p>You can enabled several levels of logging for the <em>org.simplemes.eframe.custom.FieldExtensionHelper</em>
class to track what field extensions are loaded and how they are performing.  The levels used in the extension process are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Debug</code> - Lists custom fields added to core objects.</p>
</li>
<li>
<p><code>Trace</code> - Logs whenever a value is added/retrieved from the custom field storage.
Also logs when the child records are stored for custom child lists.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="field-extension-example"><a class="link" href="#field-extension-example">Field Extension Example</a></h4>
<div class="paragraph">
<p>A simple example domain class may help you understand how these custom features can be used.
In this example, you, as the application developer, provide an <em>Order</em> domain class.
This class represents a customer order:</p>
</div>
<div class="listingblock">
<div class="title">Example - Extensible Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> {
  <span class="predefined-type">String</span> order             <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="predefined-type">String</span> product
  <span class="predefined-type">BigDecimal</span> quantity
     . . .
  <span class="annotation">@Nullable</span>
  <span class="annotation">@ExtensibleFieldHolder</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="annotation">@MappedProperty</span>(type = DataType.JSON)
  <span class="predefined-type">String</span> fields
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The order name, product and quantity ordered.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines the column that will hold the JSON values of the custom fields.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The end user of your application wants to add some custom fields to help them process orders more
easily. The fields needed are:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Format</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>promiseDate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>caseColor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this example, the user added <code>promiseDate</code> and <code>caseColor</code> fields.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/customFieldAdd.png" alt="Custom Field Add" width="60%">
</div>
</div>
<div class="paragraph">
<p>The user can put these fields anywhere on the core <em>Order</em> displays by moving the fields in the
add/remove panel shown below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/orderCustom.png" alt="Order Custom" width="60%">
</div>
</div>
<div class="paragraph">
<p>See <a href="#field-types">Field Types</a> for the list of supported field types.</p>
</div>
<div class="sect4">
<h5 id="data-type-changes"><a class="link" href="#data-type-changes">Data Type Changes</a></h5>
<div class="paragraph">
<p>The setValue() method will enforce the type, but the type can be changed after data is
created. If the defined type changes and there are existing records with the old type, then the
new data type will be used for the getter. When conversion is not possible, then the string value
will be returned.  Data will normally not be lost, but automatic conversion
to the type may not happen.</p>
</div>
<div class="paragraph">
<p>For example, you store the value 'XYZ' in a String custom field.  If you later change
the field&#8217;s type to Number, then you will not be able to return a BigDecimal form of the number.
Instead, the string 'XYZ' will be returned to avoid data loss.  This may trigger exceptions in
your code, but the framework will allow this.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
One exception is <em>Booleans</em>.  These will return a boolean object, if the string value starts with
      't' (any case). This can result in loss of data.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a custom field is no longer defined for the object, you can still get the value.  You can&#8217;t
set values when the custom field definition for the specific field is deleted.  This <code>setValue()</code>
method will trigger an exception.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="single-domain-reference"><a class="link" href="#single-domain-reference">Single Domain Reference</a></h4>
<div class="paragraph">
<p>You can add a custom field that is a reference to a single foreign domain record.
The reference is stored in the JSON using the record UUID.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The field definition defines a <code>valueClassName</code> that is used to find
      the actual record.  It is important that this <code>valueClassName</code> not be changed if data
      already exists for it. If changed, then the record will not be found.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="custom-child-list"><a class="link" href="#custom-child-list">Custom Child List</a></h4>
<div class="paragraph">
<p>A Custom Child List can be defined as a custom data field in a domain object.  This list of
custom children is stored in its own custom domain object (table), not in the normal JSON storage
field. This allows a large number of custom sub-objects to be defined for a core domain object.</p>
</div>
<div class="paragraph">
<p>How is this implemented?  A custom field <code>_complexCustomFields</code> is added to the domain class to store
the transient list of the records.  The actual custom domain objects are saved like any normal
domain class.  Various portions of the framework support these custom lists of objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JSON Parsing and Formatting.</p>
</li>
<li>
<p>CRUD actions in the controller base classes <a href="#controller-base-classes">Controller Base Classes</a>.</p>
</li>
<li>
<p>The GUI tags <a href="#efDefinitionList">[efDefinitionList]</a>, <a href="#efShow">[efShow]</a> , <a href="#efCreate">[efCreate]</a> and <a href="#efEdit">[efEdit]</a>.</p>
</li>
<li>
<p>Support for save/delete from core <a href="#domain-entities">Domain Entities</a>.</p>
</li>
<li>
<p>Normal custom <code>getFieldValue()</code> and <code>setFieldValue()</code> access.  The <code>getFieldValue()</code> method will
perform a load of the values.</p>
</li>
<li>
<p>The specific get/set method for the custom field (e.g. <code>getComponents()</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This means your core code and custom lists of objects in complex scenarios will work with little or no
coding in your core application.  A common application of this is in <a href="#module-additions">Module Additions</a>.
Sub-modules can add some very complex sub-objects to core domain objects.</p>
</div>
<div class="paragraph">
<p>For example, a core <em>Product</em> object needs a custom list of components that can be assembled into
the product.</p>
</div>
<div class="listingblock">
<div class="title">Example - Custom Child List</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">public</span> <span class="type">class</span> <span class="class">Product</span> {
  <span class="predefined-type">String</span> product
     . . .
  <span class="annotation">@Nullable</span>
  <span class="annotation">@ExtensibleFieldHolder</span>
  <span class="annotation">@MappedProperty</span>(type = DataType.JSON)
  <span class="predefined-type">String</span> fields
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To support this, the <em>@ExtensibleFieldHolder</em> creates a transient Map <code>_complexCustomFields</code> to
hold the list from the database.</p>
</div>
<div class="paragraph">
<p>Then in a module or other extension, you decide you need to add a list of components to the
Product definition:</p>
</div>
<div class="listingblock">
<div class="title">Example - Custom Child Sub-Object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">public</span> <span class="type">class</span> <span class="class">Component</span> {
  <span class="annotation">@ManyToOne</span>
  Product product <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="predefined-type">Long</span> sequence
  <span class="predefined-type">BigDecimal</span> qty

  <span class="directive">static</span> keys = [<span class="string"><span class="delimiter">'</span><span class="content">product</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">sequence</span><span class="delimiter">'</span></span>] <i class="conum" data-value="2"></i><b>(2)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The parent Product reference.  It is a normal ManyToOn reference (much like a foreign
reference).  It is stored as a UUID in the DB.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Your custom child needs to have some keys defined.  This allows the JSON update capability.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The list will contain a list of Component sub-objects.</p>
</div>
<div class="paragraph">
<p>To use this custom child list in a domain, you can define it in <a href="#module-additions">Module Additions</a>:</p>
</div>
<div class="listingblock">
<div class="title">Example - Custom Child Addition</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  AdditionConfiguration addition = Addition.configure {
    field {
      domain Order
      name <span class="string"><span class="delimiter">'</span><span class="content">orderLines</span><span class="delimiter">'</span></span>
      label <span class="string"><span class="delimiter">'</span><span class="content">Line Items</span><span class="delimiter">'</span></span>
      format CustomChildListFieldFormat
      valueClass OrderLine
      fieldOrder {
        name <span class="string"><span class="delimiter">'</span><span class="content">orderLines</span><span class="delimiter">'</span></span>
        after <span class="string"><span class="delimiter">'</span><span class="content">dueDate</span><span class="delimiter">'</span></span>
      }
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This addition will add an inline grid for these child order line items in the standard
Order definition pages.</p>
</div>
<div class="paragraph">
<p>When testing using GUI/GEB testing, remember to delete your custom child classes first.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See <a href="#custom-child-list-storage">Custom Child List Storage</a> for details on how these are stored
      and how the API works.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="custom-child-list-integrationgui-testing"><a class="link" href="#custom-child-list-integrationgui-testing">Custom Child List - Integration/GUI Testing</a></h4>
<div class="paragraph">
<p>Testing lists of child records in Integration/GUI tests is a little more complex than we
would like. The simplest approach for most non-GUI testing is to use the @Rollback notation.</p>
</div>
<div class="paragraph">
<p>For GUI testing and other scenarios, you may need to use explicit transactions in your tests.
For example:</p>
</div>
<div class="listingblock">
<div class="title">Example - Integration Testing of Custom Child List</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test additions to Work Service start action - works in integration</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">An order to start</span><span class="delimiter">&quot;</span></span>
    Order order = <span class="predefined-constant">null</span>
    Order.withTransaction {        <i class="conum" data-value="1"></i><b>(1)</b>
      order = <span class="keyword">new</span> Order(<span class="key">order</span>: <span class="string"><span class="delimiter">'</span><span class="content">M001</span><span class="delimiter">'</span></span>, <span class="key">product</span>: product)
      setFieldValue(<span class="string"><span class="delimiter">'</span><span class="content">components</span><span class="delimiter">'</span></span>,[<span class="keyword">new</span> OrderComponent(<span class="key">product</span>: aProdct, <span class="key">qty</span>: <span class="float">1.0</span>)])  <i class="conum" data-value="2"></i><b>(2)</b>
      order.save()
      <span class="keyword">new</span> OrderService().release(<span class="keyword">new</span> OrderReleaseRequest(order))
    }

  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All database access in the test must be within a transaction.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The custom child list is set using the normal <code>setFieldValue()</code> method.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="field-extension-gui"><a class="link" href="#field-extension-gui">Field Extension GUI</a></h3>
<div class="paragraph">
<p>Once you have a field added to a domain class, you will normally need to display them in a GUI.
This is done with the normal <a href="#gui-configuration">[gui-configuration]</a> icon in a domain definition GUI.  Opening the
configuration editor for a domain GUI shows a dialog like this:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/configurationForDefinition.png" alt="configurationForDefinition" width="75%">
</div>
</div>
<div class="paragraph">
<p>This dialog allows you to add custom fields to the definition GUIs.  It also allows you to move
or remove base fields from the display.</p>
</div>
<div class="sect3">
<h4 id="definition-configuration-dialog"><a class="link" href="#definition-configuration-dialog">Definition Configuration Dialog</a></h4>
<div class="paragraph">
<p>The configuration dialog for definition GUIs (above) allows you to add new custom fields to
a domain object, change existing custom fields or remove them.  This GUI also allows you to
re-order the fields and create tabbed panels for organizing complex definition objects.</p>
</div>
<div class="sect4">
<h5 id="configuration-actions"><a class="link" href="#configuration-actions">Configuration Actions</a></h5>
<div class="paragraph">
<p>The actions allowed are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Custom Field</p>
</li>
<li>
<p>Edit/Delete Custom Field</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="editdelete-custom-field"><a class="link" href="#editdelete-custom-field">Edit/Delete Custom Field</a></h6>
<div class="paragraph">
<p>You can edit the custom field by selecting it in either list and using menu entry 'Edit Custom Field'.
You can also double-click the entry to open the custom field editor dialog.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Changes made in this dialog are immediately saved in the database and affects the current
      domain objects in the system. Deleting a custom field does not remove the field values from
      existing domain objects, but the values are no longer visible in the definition GUIs.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="custom-field-editor-dialog"><a class="link" href="#custom-field-editor-dialog">Custom Field Editor Dialog</a></h6>
<div class="paragraph">
<p>This custom field editor dialog allows you to change the details of this custom field.
You can&#8217;t change the field name since this is a key value for data in the database and
also affects the field order described below.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fieldorder"><a class="link" href="#fieldorder">FieldOrder</a></h4>
<div class="paragraph">
<p>The <a href="#field-ordering">Field Ordering</a> defined for a domain class controls what order fields are shown in the
definition GUIs and lists. You can customize the appearance of a GUI by manipulating this field
order.  The configuration editor makes it easy to manipulate the order and even add new custom
fields to the domain class.</p>
</div>
<div class="paragraph">
<p>The <code>fieldOrder</code> list will look something like this:</p>
</div>
<div class="listingblock">
<div class="title">Example - fieldOrder for User</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">User</span> {
  . . .
  static fieldOrder = [<span class="string"><span class="delimiter">'</span><span class="content">userName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">enabled</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">accountExpired</span><span class="delimiter">'</span></span>,
                       <span class="string"><span class="delimiter">'</span><span class="content">accountLocked</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">passwordExpired</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">email</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">userRoles</span><span class="delimiter">'</span></span>]
  . . .
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example User edit page is shown below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/userEditDef.png" alt="UserEditDef" width="75%">
</div>
</div>
<div class="paragraph">
<p>This gives the default ordering seen above.  You can customize the field ordering using the
configuration dialog.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/configurationForDefinition.png" alt="configurationForDefinition" width="75%">
</div>
</div>
<div class="paragraph">
<p>This shows how someone added a custom field (<code>legacyCode</code>) to the user GUIs. The user wants the
<code>legacyCode</code> field to be added to the FlexType object and be displayed before the <code>title</code>.</p>
</div>
<div class="paragraph">
<p>This is stored in the
<a href="groovydoc/org/simplemes/eframe/custom/domain/FieldGUIExtension.html" target="_blank" rel="noopener">FieldGUIExtension</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> object to
persist this customization for the domain class.  In the FieldGUIExtension object, there is a
list of adjustments made to the field order in a list format. This is portrayed in the
diagram below for the example customizations above:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/fieldOrderCustomization.png" alt="fieldOrderCustomization" width="880" height="280">
</div>
<div class="title">Figure 19. Data Field Layout</div>
</div>
<div class="paragraph">
<p>The FieldGUIExtension is created for the domain class to be customized (User in this case).
Inside of this FieldGUIExtension is an <code>extensionsJSON</code> field that holds the JSON form of the
extensions list. This is a list of
<a href="groovydoc/org/simplemes/eframe/custom/gui/FieldAdjustmentInterface.html" target="_blank" rel="noopener">FieldAdjustmentInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> elements
that define what adjustments are made to the default field order for the domain class.</p>
</div>
<div class="paragraph">
<p>In this case, the <code>legacyCode</code> is inserted before the <code>title</code> field.  The class
relationships are shown below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/FieldGUIExtension.png" alt="FieldGUIExtension" width="649" height="250">
</div>
<div class="title">Figure 20. Class Relationships - FieldGUIExtension</div>
</div>
<div class="paragraph">
<p>Other GUI field placement actions are allowed:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 65%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Adjustment</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert custom field/group after a core field/group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InsertAll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert all custom fields after a core field/group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MoveAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move a core field/group to after another core field/group.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It is possible to add a group (tabbed panel).  If the core GUI doesn&#8217;t use tabbed panels,
then this will create a 'Main' panel for first fields in the <code>fieldOrder</code> list.</p>
</div>
<div class="paragraph">
<p>These adjustments are implemented as action classes that implement the
<a href="groovydoc/org/simplemes/eframe/custom/gui/FieldAdjustmentInterface.html" target="_blank" rel="noopener">FieldAdjustmentInterface</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span>.
These adjustments manipulate the effective field order for the domain class.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="flex-types"><a class="link" href="#flex-types">Flex Types</a></h3>
<div class="paragraph">
<p>A Flex Type is one implementation of the <a href="#configurable-types">Configurable Types</a>.
Flex Types are used to define custom fields needed for specific domain records and
special-purpose POGOs. These allow your users to define a list of data fields to collect for
each object (e.g. Order).  This allows your users to add custom fields in specific scenarios.
Your users can define a different set of custom fields for each record if needed.</p>
</div>
<div class="paragraph">
<p>For example, your application may support multiple order types such as Production or RMA.
The production orders may require a custom field <code>promiseDate</code>.
The RMA order may require different custom data fields such as <code>receivedDate</code> and <code>rmaId</code>.
Flex types allow you to define this order type and make the data fields dependent on the type.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/guis/flexTypeCreate.png" alt="flexTypeCreate" width="75%">
</div>
<div class="title">Figure 21. Flex Type Create</div>
</div>
<div class="sect3">
<h4 id="flex-type-field-names-uppercase-or-lowercase"><a class="link" href="#flex-type-field-names-uppercase-or-lowercase">Flex Type Field Names - Uppercase or Lowercase?</a></h4>
<div class="paragraph">
<p>The <a href="#searching">Search Engine </a> and the Postgres JSON SQL queries use the flex type
field names in case-sensitive queries.  If you define a field name as <em>'LOT'</em> and
then try to query on <em>'lot'</em>, then the values won&#8217;t be found.</p>
</div>
<div class="paragraph">
<p>You should make sure you use a consistent field naming convention.  In particular, make
sure to use the same case for all field names.  Use all upper case, all lower case
or consistent mixed case.</p>
</div>
</div>
<div class="sect3">
<h4 id="flex-types-vs-configurable-types"><a class="link" href="#flex-types-vs-configurable-types">Flex Types vs. Configurable Types</a></h4>
<div class="paragraph">
<p>One question that frequently comes up as developer is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>When do I use Flex Types and when do I use Configurable Types?</pre>
</div>
</div>
<div class="paragraph">
<p>You generally use Flex Types when you want your end-user to create and choose the data
fields to be collected in a specific case. For example, you have an RMA scenario. You want the
user to choose the RMA Type and the user can change the data collected for that type.
You don&#8217;t need to use any logic based on the data.  This is a good fit for
the Flex Types.</p>
</div>
<div class="paragraph">
<p>You will need too look at the flexibility needed by your customer and decided
which approach is easiest that still meets your customer&#8217;s needs.  If you just need to
collect and the data and have no logic to operate on the values, then Flex Types might
be the best approach.</p>
</div>
<div class="paragraph">
<p>The <a href="#configurable-types">Configurable Types</a> usually involve more programming to add new fields or types:
The basic limitations/features of each approach is shown below.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 3. Comparison - Flex Types vs. Configurable Types</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 16.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Feature</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Flex Types</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configurable Types</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Programming Needed for New Fields?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-Defined New Fields?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used Frequently?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#encoded-types">Encoded Types</a> are also a consideration for this discussion. New encoded type values
can be added in <a href="#module-additions">Module Additions</a>.  In terms of flexibility and complexity, they fall
in between the Flex Types and Configurable Types.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="extension-points"><a class="link" href="#extension-points">Extension Points</a></h3>
<div class="paragraph">
<p><span class="inline-toc"><a href="#extension-point-design">Extension Point Design</a></span>
<span class="inline-toc"><a href="#extensionpoint-annotation">ExtensionPoint Annotation</a></span>
<span class="inline-toc"><a href="#extensionpoint-supported-scenarios">ExtensionPoint Supported Scenarios</a></span>
<span class="inline-toc"><a href="#extension-point-documentation">Extension Point Documentation</a></span></p>
</div>
<div class="paragraph">
<p>Frequently, you will need to extend core methods with logic that applies to specific additions
and modules.  The framework provides support for extension points.  These are methods
in the core code that are marked as allowing extension by other modules.  These extension
are discovered as Micronaut beans and support execution before or after the core method.</p>
</div>
<div class="paragraph">
<p>Originally, the flexible Groovy meta-class ability to modify the was used for method extensions.
This was great, but caused issues with many of the annotations used by Micronaut (e.g. @Transactional).</p>
</div>
<div class="sect3">
<h4 id="extension-point-design"><a class="link" href="#extension-point-design">Extension Point Design</a></h4>
<div class="paragraph">
<p>Extension points methods are marked with the <em>@ExtensionPoint</em> annotation.  This inserts code
before the method logic and at return points.  This extra code executes custom methods that
are defined as Micronaut beans. This is handled by the
<a href="groovydoc/org/simplemes/eframe/custom/ExtensionPointHelper.html" target="_blank" rel="noopener">ExtensionPointHelper</a>
<span class="icon link-blue"><i class="fa fa-share-square-o"></i></span> methods to execute any matching beans.</p>
</div>
<div class="paragraph">
<p>A basic example with two custom beans is shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/extensionPointDesign.png" alt="extensionPointDesign" width="890" height="252">
</div>
<div class="title">Figure 22. Custom Field Design</div>
</div>
<div class="paragraph">
<p>The core <code>release()</code> method is marked as an <em>@ExtensionPoint</em>.  There are two additions
that provide <em>Bean1</em> and <em>Bean2</em>.  These beans extend the release method.  <em>Bean1</em> is executed as
a pre method and <em>Bean2</em> is a post method.  The post method may alter the response from the
core method, if needed.</p>
</div>
<div class="sect4">
<h5 id="extensionpoint-annotation"><a class="link" href="#extensionpoint-annotation">ExtensionPoint Annotation</a></h5>
<div class="paragraph">
<p>You, as the application developer, must mark your methods as extension points.
A simple service class might look like this:</p>
</div>
<div class="listingblock">
<div class="title">Example - Extension Point Usage</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">OrderService</span> {

  <span class="annotation">@ExtensionPoint</span>(value=ReleasePoint, comment = <span class="string"><span class="delimiter">&quot;</span><span class="content">The Order release() method</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
  ReleaseResponse release(ReleaseRequest request) {  <i class="conum" data-value="2"></i><b>(2)</b>
    . . .

    return <span class="keyword">new</span> ReleaseResponse(...)   <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The extension point uses a <em>ReleasePoint</em> (interface) to define the pre/post method
signature.  This must match the <code>release()</code> method&#8217;s signature. All beans that implement this
interface will be executed for all calls to the core <code>release()</code> method.
The annotation also includes an optional comment that is used for the <a href="#extension-point-documentation">Extension Point Documentation</a>
file as noted below.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method accepts a POGO argument.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The method returns a POGO.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>ReleasePoint</em> interface is used to flag which beans will be executed for each call to
the core <code>release()</code> method.</p>
</div>
<div class="listingblock">
<div class="title">Example - Extension Point Interface</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> ReleasePoint {
  <span class="type">void</span> preRelease(ReleaseRequest request)  <i class="conum" data-value="1"></i><b>(1)</b>

  ReleaseResponse postRelease(ReleaseResponse response, ReleaseRequest request)  <i class="conum" data-value="2"></i><b>(2)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>preRelease()</code> method is passed the input(s) that are later passed to the core method.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>postRelease()</code> method is passed the response from the core method and can alter the
returned value (if not null).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, other modules can provide beans with these methods to alter the core logic.</p>
</div>
<div class="listingblock">
<div class="title">Example - Extension Point - Custom Methods</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">OrderService</span> <span class="directive">implements</span> ReleasePoint {

  <span class="type">void</span> preRelease(ReleaseRequest request) {  <i class="conum" data-value="1"></i><b>(1)</b>
    request.order.qtyToRelease = <span class="float">1.2</span>
    . . .
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>preRelease()</code> method does some extra processing on each <code>release()</code> method execution.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="extensionpoint-supported-scenarios"><a class="link" href="#extensionpoint-supported-scenarios">ExtensionPoint Supported Scenarios</a></h5>
<div class="paragraph">
<p>Due to the nature of the AST transformation logic, the <em>@ExtensionPoint</em> annotation is
written to handle specific structures in the core methods.  These cases are tested and supported:</p>
</div>
<div class="listingblock">
<div class="title">Example - Extension Point - Supported Scenarios</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@ExtensionPoint</span>(value=ReleasePoint)
ReleaseResponse release1(ReleaseRequest request) {
  . . .
  return <span class="keyword">new</span> ReleaseResponse(...)   <i class="conum" data-value="1"></i><b>(1)</b>
}

<span class="annotation">@ExtensionPoint</span>(value=ReleasePoint)
ReleaseResponse release2(ReleaseRequest request) {
  . . .
  if (...) {  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">return</span> <span class="keyword">new</span> ReleaseResponse(...)
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="keyword">new</span> ReleaseResponse(...)
  }
}

<span class="annotation">@ExtensionPoint</span>(value=ReleasePoint)
ReleaseResponse release2(ReleaseRequest request) {
  . . .
  if (...) {  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">return</span> <span class="keyword">new</span> ReleaseResponse(...)
  } <span class="keyword">else</span> <span class="keyword">if</span> (...) {
    <span class="keyword">return</span> <span class="keyword">new</span> ReleaseResponse(...)
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Simple return at the end of the method.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If/Else with return at the end of each block.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If/ElseIf with return at the end of each block.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Other cases may be supported some day.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A return statement is required in the method marked with <em>@ExtensionPoint</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="extension-point-documentation"><a class="link" href="#extension-point-documentation">Extension Point Documentation</a></h5>
<div class="paragraph">
<p>The modules will each need to document what extension points are available.  To make this easier,
the <a href="#extensionpoint-annotation">ExtensionPoint Annotation</a> creates an <em>.adoc</em> file with all of the extensions listed.
This file is <em>'build/generated/extensions.adoc'</em>.  This file can be included in your
ASCII doctor files like any other include file.  The result will look like this:</p>
</div>
<div class="paragraph">
<p>Unresolved directive in guide/custom/extensionPoints.adoc - include::../../../../../../build/generated/extensions.adoc[]</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong>OrderService</strong> example above is from the extension points in the framework sample code.
      This is not a real extension point.  The other extension point(s) above are real.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This file is generated when the Groovy classes are compiled.  It is also removed by a <em>clean</em>
action.
The <code>comment</code> option on the <em>@ExtensionPoint</em> annotation is used to generate the comment for each
extension point in this file.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="module-additions"><a class="link" href="#module-additions">Module Additions</a></h3>
<div class="paragraph">
<p><span class="inline-toc-header">Overview</span>
<span class="inline-toc"><a href="#when-to-modularize">When to Modularize</a></span>
<span class="inline-toc"><a href="#module-terminology">Module Terminology</a></span>
<span class="inline-toc"><a href="#inheritance">Inheritance?</a></span></p>
</div>
<div class="paragraph">
<p><span class="inline-toc-header">Details</span>
<span class="inline-toc"><a href="#how-to-modularize">How to Modularize</a></span>
<span class="inline-toc"><a href="#addition">Addition</a></span>
<span class="inline-toc"><a href="#example-addition">Example Addition</a></span>
<span class="inline-toc"><a href="#addition-top-level-options">Addition Top-Level Options</a></span>
<span class="inline-toc"><a href="#encoded-types-provided-by-additions">Encoded Types Provided By Additions</a></span>
<span class="inline-toc"><a href="#addition-field-extensions">Addition Field Extensions</a></span>
<span class="inline-toc"><a href="#initial-data-loaders-and-additions">Initial Data Loaders and Additions</a></span>
<span class="inline-toc"><a href="#assets-provided-by-additions">Assets Provided by Additions</a></span>
<span class="inline-toc"><a href="#addition-errors">Addition Errors</a></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This modularization is complex.  Only use it when needed see <a href="#when-to-modularize">When to Modularize</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="overview"><a class="link" href="#overview">Overview</a></h4>
<div class="paragraph">
<p>Module composition allows you to modularize your application into one or more modules that
work together. This can help you provide simplified configurations of your application for
specific customer groups. It also gives your customers flexibility in customization and
deployment of your application.</p>
</div>
<div class="paragraph">
<p>These modules can work with each other and provide new features to your core application.
This provides the ability to add fields to core domain objects, extend the functionality of service
methods, ask questions in core GUIs and to participate in database transactions with core objects.</p>
</div>
<div class="paragraph">
<p>An example set of modules used to create an application might look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/architectureLayersComp.png" alt="architectureLayersComp" width="360" height="294">
</div>
</div>
<div class="paragraph">
<p>This application can be deployed with the optional <em>Online</em> module and/or the
optional <em>Retail</em> module.  This allows your customers to streamline the application to suit
their needs.</p>
</div>
<div class="paragraph">
<p>For example, you could deploy the application without the <em>Retail</em> module for customers
that have only an online business model.</p>
</div>
</div>
<div class="sect3">
<h4 id="when-to-modularize"><a class="link" href="#when-to-modularize">When to Modularize</a></h4>
<div class="paragraph">
<p>This modularization is complex and increases your testing needs.  You need to decide if this
flexibility is worth the cost. Like all features, you need to decide if the flexibility for
your customers is worth the extra effort. Sometimes, a simple toggle such as <code>OrderType</code>
might meet your needs.  Modularization is normally used when the module adds significant
overhead or complexity to your application.</p>
</div>
<div class="paragraph">
<p>Modularization is also useful when a module&#8217;s features are needed by a small subset of your
customers.  This allows you to hide this complexity from most of your customers to simplify
your app.</p>
</div>
</div>
<div class="sect3">
<h4 id="module-terminology"><a class="link" href="#module-terminology">Module Terminology</a></h4>
<div class="paragraph">
<p>In general, a module adds features using <a href="#field-extensions">Field Extensions</a> <a href="#extension-points">Extension Points</a> added to the
core features.</p>
</div>
<div class="paragraph">
<p>The enterprise framework supports a declarative way to define these extensions using
an Addition feature that is discovered at run-time. The framework uses the term 'addition' to avoid
confusion with field and method extensions.  An addition is basically a way for a module to extend
another module with minimal coding.  The additions are beans that are created by the framework
upon startup and a stored as singletons.  The addition can also specify new data types and choices
for many drop-down lists.</p>
</div>
</div>
<div class="sect3">
<h4 id="inheritance"><a class="link" href="#inheritance">Inheritance?</a></h4>
<div class="paragraph">
<p>Why not use inheritance to add features to domains, controllers and services?  The main reason
is that you may need multiple optional modules.  An inheritance hierarchy can&#8217;t be configured
as optional. For this reason, the <a href="#field-extensions">Field Extensions</a> and <a href="#extension-points">Extension Points</a> mechanisms
are used.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-modularize"><a class="link" href="#how-to-modularize">How to Modularize</a></h4>
<div class="paragraph">
<p>So, you have decided to implement a portion of your application in a module.  How do you do this?
The basic steps are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#design-and-name-your-module">Design and Name Your Module</a></p>
</li>
<li>
<p><a href="#create-a-micronaut-module">Create a Micronaut Module</a>.  See the <a href="../mes-core/guide.html">MES Core Module</a> for an example.</p>
</li>
<li>
<p>Create an <a href="#addition">Addition</a>.</p>
</li>
<li>
<p>Add any beans to execute addition code at <a href="#extension-points">Extension Points</a>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="design-and-name-your-module"><a class="link" href="#design-and-name-your-module">Design and Name Your Module</a></h5>
<div class="paragraph">
<p>The module&#8217;s name should be short, simple and descriptive.  This is not always easy.
If needed, use a longer name.  In most IDEs, you won&#8217;t have to type this name too often.</p>
</div>
<div class="paragraph">
<p>The design of your module should follow normal <a href="#guidelines">Guidelines</a> for domains, controllers, etc.
This means a simple package scheme and class naming approach.</p>
</div>
<div class="paragraph">
<p>You will also need to decide how you will extend the core (and other) modules with additional
fields and behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="create-a-micronaut-module"><a class="link" href="#create-a-micronaut-module">Create a Micronaut Module</a></h5>
<div class="paragraph">
<p>Create a new module involves a number of steps.  Some are automatic and others require manual
adjustments to many files.  The basic steps are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the module:</p>
<div class="listingblock">
<div class="content">
<pre>mn create-app module1 -l groovy</pre>
</div>
</div>
<div class="paragraph">
<p>This just creates an empty application, which we will adjust below.  You an include other features,
but the <em>build.gradle</em> will be changed to include the appropriate dependencies.</p>
</div>
</li>
<li>
<p>Create a 'New Project from Existing Sources' in your IDE.</p>
</li>
<li>
<p>Import/Refresh the Gradle settings.</p>
</li>
<li>
<p>Edit <em>build.gradle</em> to match the
<a href="https://github.com/simplemes/simplemes-core/blob/master/mes-core/build.gradle">MES-Core build.gradle</a>.
This includes updating the dependencies as needed:</p>
<div class="listingblock">
<div class="content">
<pre>compile ("org.simplemes:mes-assy:0.5") <i class="conum" data-value="1"></i><b>(1)</b>
mainClassName = "org.whatever.Application"  <i class="conum" data-value="2"></i><b>(2)</b>

jar {
  exclude "logback.xml"
  exclude "application-test.yml"
  exclude "/org/whatever/Application.class" <i class="conum" data-value="2"></i><b>(2)</b>
}</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You will need to include the modules you depend on.  Most of our provided modules depend on
<em>eframe</em> and <em>mes-core</em>, so you don&#8217;t need those modules in your <em>build.gradle</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Your application name.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update
<a href="https://github.com/simplemes/simplemes-core/blob/master/mes-core/src/main/resources/application.yml">application.yml</a>.
as needed.  Create <em>application-test.yml</em> (for test mode).
Create <em>application-dev.yml</em> (for development mode, if needed).</p>
</li>
<li>
<p>For Intellij IDEA, create a 'Run Application' for the <em>Application.class</em> you created.  This will
need an environment variable: <em>MICRONAUT_ENVIRONMENTS=dev</em>.</p>
</li>
<li>
<p>Create a JUnit template in Intellij to make testing easier.  Set the VM Options to:</p>
<div class="listingblock">
<div class="content">
<pre>-Dgeb.env=firefox -Dgeb.lang=en-US -Dnashorn.args="--no-deprecation-warning"</pre>
</div>
</div>
<div class="paragraph">
<p>This makes it easier to quick-run a test using Spock/JUnit (Ctrl+Shift+F10 in Intellij on Windows).</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After creation, you can add logic and tests for your module.  Later, you will need to use the
<em>publishToMavenLocal</em> Gradle target to publish your module for use by an application.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="addition"><a class="link" href="#addition">Addition</a></h4>
<div class="paragraph">
<p>When you create a new module for the framework, you will need to create an <em>Addition</em> class
that describes a few key parts of your module.  This allows for faster startup since
the framework won&#8217;t have to search the class path for all of you modules features.</p>
</div>
<div class="paragraph">
<p>The Addition describes elements including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Where to find your domain classes.</p>
</li>
<li>
<p>Field Extensions</p>
</li>
<li>
<p>Encoded Types</p>
</li>
<li>
<p>Initial Data Loaders</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additions are classes with a simple DLS (Domain Specific Language) to define
these elements.  Not all are required.</p>
</div>
<div class="sect4">
<h5 id="example-addition"><a class="link" href="#example-addition">Example Addition</a></h5>
<div class="paragraph">
<p>Below is a simple addition that adds some fields, domains and other features that an addition
can provide.</p>
</div>
<div class="listingblock">
<div class="title">Addition Example - Simple Addition</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">SimpleAddition</span> <span class="directive">extends</span> BaseAddition <span class="directive">implements</span> AdditionInterface {
  AdditionConfiguration addition = Addition.configure {
    encodedType OrderStatus
    initialDataLoader InitialDataLoadRoles
    field { domain Order; name <span class="string"><span class="delimiter">'</span><span class="content">warehouse</span><span class="delimiter">'</span></span>}  <i class="conum" data-value="2"></i><b>(2)</b>
    field {
      domain Product         <i class="conum" data-value="3"></i><b>(3)</b>
      name <span class="string"><span class="delimiter">'</span><span class="content">productCode</span><span class="delimiter">'</span></span>
      format LongFieldFormat
      fieldOrder { name <span class="string"><span class="delimiter">'</span><span class="content">group:components</span><span class="delimiter">'</span></span> }  <i class="conum" data-value="4"></i><b>(4)</b>
      fieldOrder { name <span class="string"><span class="delimiter">'</span><span class="content">components</span><span class="delimiter">'</span></span>; after <span class="string"><span class="delimiter">'</span><span class="content">group:components</span><span class="delimiter">'</span></span> }
      guiHints <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">label=&quot;Legacy Code&quot; </span><span class="delimiter">&quot;&quot;&quot;</span></span>   <i class="conum" data-value="5"></i><b>(5)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Exposes this addition as standard bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Single-line format for a field definition.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The custom field added to the Product domain.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Adds a new panel in the Product GUI for the components.
This panel added at the end of the field order.
The custom field itself will also be added at the end, so it will appear on the components
panel. Assumes the label
<em>'components.panel.label'</em> exists in the <em>messages.properties</em> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Provides a GUI display hint for the display <a href="#Markers">[Markers]</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example defines the global features such as where to find domains for the
module, any loader additional <a href="#encoded-types">Encoded Types</a> and some custom fields added
to the <em>Order</em> domain.</p>
</div>
</div>
<div class="sect4">
<h5 id="addition-top-level-options"><a class="link" href="#addition-top-level-options">Addition Top-Level Options</a></h5>
<div class="paragraph">
<p>The Addition supports these top-level options:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 4. Addition Options</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the addition (<strong>Default</strong>: The addition class&#8217;s simple name).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a single field added to a domain.  See <a href="#addition-field-extensions">Addition Field Extensions</a> (<strong>Optional</strong>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encodedType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the <a href="#encoded-types-provided-by-additions">Encoded Types Provided By Additions</a> (<strong>Optional</strong>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialDataLoader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An initial data loader class.  See <a href="#initial-data-loaders-and-additions">Initial Data Loaders and Additions</a> (<strong>Optional</strong>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An asset needed for a specific page.  See <a href="#assets-provided-by-additions">Assets Provided by Additions</a> (<strong>Optional</strong>).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="addition-field-extensions"><a class="link" href="#addition-field-extensions">Addition Field Extensions</a></h5>
<div class="paragraph">
<p>One of more important reasons to use additions is to add custom fields to core
domain classes in other modules.  This definition creates normal
<a href="#field-extensions">Field Extensions</a> for the defined fields.  This means your module can add fields
to GUIs in core domains and import/export the values.</p>
</div>
<div class="listingblock">
<div class="title">Addition Example - Field Addition</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">SimpleAddition</span> <span class="directive">extends</span> BaseAddition <span class="directive">implements</span> AdditionInterface {
  AdditionConfiguration addition = Addition.configure {
    field {  <i class="conum" data-value="2"></i><b>(2)</b>
      domain Order
      name <span class="string"><span class="delimiter">'</span><span class="content">priority</span><span class="delimiter">'</span></span>
      format LongFieldFormat
      fieldOrder { name <span class="string"><span class="delimiter">'</span><span class="content">priority</span><span class="delimiter">'</span></span>; after <span class="string"><span class="delimiter">'</span><span class="content">notes</span><span class="delimiter">'</span></span> }
      guiHints <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">label=&quot;Order Priority&quot; </span><span class="delimiter">&quot;&quot;&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Exposes this addition as a standard bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines a single <code>priority</code> field added to the <em>Order</em> class.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These field extensions provide a lot of configuration options:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 5. Addition Field Options</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The domain class (<strong>Required</strong>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the field to add to the domain (<strong>Required</strong>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The label for the field (<strong>Default</strong>: <code>name</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The domain class (<strong>Default</strong>: String - no limit).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The max length of the value (<strong>Optional</strong>).  Only applies to String fields at this time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class for the value (<strong>Optional</strong>).  This is used mainly for DomainReferences,
              Enumeration and EncodedTypes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fieldOrder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a <a href="#field-ordering">Field Ordering</a> entry for the domain (<strong>Optional</strong>).  See below.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">guiHints</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GUI Hints to add to the display of these additions. (<strong>Optional</strong>).  These
            are typically attributes supported by <a href="#Markers">[Markers]</a> such as <a href="#efCreate">[efCreate]</a>.
            These must be in the form of name/value pairs with quotes.  For
            example: <em>name1="value1" name2="value2"</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The options supported by the <code>fieldOrder</code> element above are:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 6. fieldOrder - Options</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">fieldOrder</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The field to add to the field order (<strong>Required</strong>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new field will be added after this field in the display order (<strong>Default</strong>: the end).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="encoded-types-provided-by-additions"><a class="link" href="#encoded-types-provided-by-additions">Encoded Types Provided By Additions</a></h5>
<div class="paragraph">
<p><a href="#encoded-types">Encoded Types</a> are used to store encoded values in a column in the database.  These
encoded values are short strings that are resolved by the base class.
Your addition may provide more encoded types by specifying the <em>encodedType</em> element:</p>
</div>
<div class="listingblock">
<div class="title">Addition Example - Encoded Types Provided by an Addition</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">SimpleAddition</span> <span class="directive">extends</span> BaseAddition <span class="directive">implements</span> AdditionInterface {
  AdditionConfiguration addition = Addition.configure {
    encodedType OrderStatus  <i class="conum" data-value="1"></i><b>(1)</b>
     . . .
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a single base class for a new encoded type.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="initial-data-loaders-and-additions"><a class="link" href="#initial-data-loaders-and-additions">Initial Data Loaders and Additions</a></h5>
<div class="paragraph">
<p>Sometimes, a module will need to add records to a core module&#8217;s database using the framework&#8217;s
<a href="#initial-data-load">Initial Data Load</a> mechanism.  This is common with user <a href="#roles">Roles</a>.  To avoid creating dummy
domain classes, you can specify a list of classes that perform the initial data load like normal
domain classes.</p>
</div>
<div class="listingblock">
<div class="title">Addition Example - Initial Data Loaders Provided By Additions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>                            <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">SimpleAddition</span> <span class="directive">extends</span> BaseAddition <span class="directive">implements</span> AdditionInterface {
  AdditionConfiguration addition = Addition.configure {
    initialDataLoader SetupRoles  <i class="conum" data-value="2"></i><b>(2)</b>
     . . .
  }
}
. . .

class SetupRoles {
  <span class="directive">static</span> initialDataLoad() {  <i class="conum" data-value="3"></i><b>(3)</b>
   . . .
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Registers this addition within the application context for discovery at runtime.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies the initial data loading class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Performs the actual initial data loading.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="assets-provided-by-additions"><a class="link" href="#assets-provided-by-additions">Assets Provided by Additions</a></h5>
<div class="paragraph">
<p>Some modules have specific client assets (Javascript or CSS files) that are needed on specific
core pages.  The addition logic lets you add assets to specific views as needed.  These assets are
added to the page using the <a href="#standard-header">Standard Header</a> include file.</p>
</div>
<div class="listingblock">
<div class="title">Addition Example - Assets Provided by Additions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>                            <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">SimpleAddition</span> <span class="directive">extends</span> BaseAddition <span class="directive">implements</span> AdditionInterface {
  AdditionConfiguration addition = Addition.configure {
    asset {    <i class="conum" data-value="2"></i><b>(2)</b>
      page <span class="string"><span class="delimiter">&quot;</span><span class="content">dashboard/index</span><span class="delimiter">&quot;</span></span>
      script <span class="string"><span class="delimiter">&quot;</span><span class="content">/assets/mes_dashboard.js</span><span class="delimiter">&quot;</span></span>
    }
    asset {    <i class="conum" data-value="3"></i><b>(3)</b>
      page <span class="string"><span class="delimiter">&quot;</span><span class="content">dashboard/index</span><span class="delimiter">&quot;</span></span>
      css <span class="string"><span class="delimiter">&quot;</span><span class="content">/assets/mes_dashboard.css</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Registers this addition within the application context for discovery at runtime.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies the javascript asset (<em>mes_dashboard.js</em>) to add to the page (<em>dashboard/index.ftl</em>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specifies the CSS asset (<em>mes_dashboard.css</em>) to add to the page (<em>dashboard/index.ftl</em>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The supported types include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>script:</em>  - A Javascript file.</p>
</li>
<li>
<p><em>css:</em>  - A CSS file.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The module needs to make sure the asset can be found.  See <a href="#efAsset">[efAsset]</a> for
      examples.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="addition-errors"><a class="link" href="#addition-errors">Addition Errors</a></h5>
<div class="paragraph">
<p>The Addition syntax can be somewhat complex.  Most errors are caught by the framework at
run-time.  This means the first error will usually show up when you deploy your addition with
the application.</p>
</div>
<div class="paragraph">
<p>You will probably need to monitor the log files for any ERROR level messages.
Most errors will be logged, but the application startup will still be attempted.</p>
</div>
<div class="paragraph">
<p>To catch these errors earlier, we suggest that you unit test your addition.  For example:</p>
</div>
<div class="listingblock">
<div class="title">Addition Example Unit Test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">verify that the addition is valid</span><span class="delimiter">&quot;</span></span>() {
  <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">the validation passes</span><span class="delimiter">'</span></span>
  <span class="keyword">new</span> MyAddition().addition.validate()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="link" href="#appendix">Appendix</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="inline-toc"><a href="#troubleshooting">Troubleshooting</a></span>
<span class="inline-toc"><a href="#potholes">Potholes</a></span></p>
</div>
<div class="paragraph">
<p>Appendices for the enterprise framework.  This section contains detailed topics that don&#8217;t fit in
elsewhere in the user guide.</p>
</div>
<div class="sect2">
<h3 id="troubleshooting"><a class="link" href="#troubleshooting">Troubleshooting</a></h3>
<div class="paragraph">
<p><span class="inline-toc-header">Logging</span>
<span class="inline-toc"><a href="#useful-logging-settings">Useful Logging Settings</a></span></p>
</div>
<div class="sect3">
<h4 id="useful-logging-settings"><a class="link" href="#useful-logging-settings">Useful Logging Settings</a></h4>
<div class="paragraph">
<p>Logging is a useful tool for trouble-shooting problems with the application.  Some useful
logging settings include:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 95%;">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Object</th>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>debug</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL statement execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>trace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL statement execution with values used in statement.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>trace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean creation issues.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.simplemes.eframe.application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>debug</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logs all bean names defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.simplemes.eframe.controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>trace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logs all suppressed exceptions (e.g. BusinessException) caught by BaseController sub-classes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.simplemes.eframe.preference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>trace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logs a stack trace to help identify all uses of PreferenceHolder with null <code>element</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">client.to-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>any</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the level for echoing all client-side logging messages to the server log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">client.dashboard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>debug</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging of events send by dashboard.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">client.dashboard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>trace</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verbose logging of definitions used by the client dashboard libraries.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="potholes"><a class="link" href="#potholes">Potholes</a></h3>
<div class="paragraph">
<p>Micronaut and the other tools are great, but they have some pot holes you need to avoid.
These pot holes are not terribly bad problems, but we have lost some time discovering them and
working around them.  This section is meant to help you avoid some of those pot holes.</p>
</div>
<div class="sect3">
<h4 id="groovy-lang-singleton-used"><a class="link" href="#groovy-lang-singleton-used">groovy.lang.Singleton Used</a></h4>
<div class="paragraph">
<p>Groovy provides the <code>groovy.lang.Singleton</code> annotation without an explicit import.
This annotation is not compatible with the one needed by Micronaut (<em>javax.inject.Singleton</em>).
You must explicitly import the correct one:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>import javax.inject.Singleton</pre>
</div>
</div>
<div class="paragraph">
<p>If you use the wrong annotation, then your bean will not be created.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Intellij will not flag the wrong <code>@Singleton</code> annotation.  You will have to manually
      insert the above import statement.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beans-defined-in-java-files"><a class="link" href="#beans-defined-in-java-files">Beans Defined in .java Files</a></h4>
<div class="paragraph">
<p>Micronaut works well with Java or Groovy source trees.  It gets a little confused when you have
beans (e.g. @Singleton or @Controller) in Java and Groovy in the same module.  This causes
Micronaut to create two <em>'META-INF/services/io.micronaut.inject.BeanDefinitionReference'</em> files.
When the module is used, the run-time logic can&#8217;t always find the beans from the Java tree.</p>
</div>
<div class="paragraph">
<p>This usually only affects the contents of the .jar file that your module is distributed as.</p>
</div>
<div class="paragraph">
<p>This means you should never define beans in the Java source tree if you use Groovy for other
beans.</p>
</div>
</div>
<div class="sect3">
<h4 id="sessions-lost-randomly"><a class="link" href="#sessions-lost-randomly">Sessions Lost Randomly</a></h4>
<div class="paragraph">
<p>If you experience logon sessions being lost randomly, then you may have a problem with
your cookie definition.  By default, then path defined for the security session cookie
is the path of the page being displayed.  This means you get a cookie for each page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This does not seem to be a problem for JWT Cookie security that is used by the framework.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you logout and come back in or browse to other pages, you get multiple cookies.
This confuses the authentication logic and it thinks the page needs authentication
again.  This means you will get logon pages after you have logged on.</p>
</div>
<div class="paragraph">
<p>To avoid this, make sure your <em>application.yml</em> sets the cookiePath:</p>
</div>
<div class="listingblock">
<div class="title">application.yml - Avoid Session Loss.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">micronaut</span>:
  <span class="key">application</span>:
    <span class="key">name</span>: <span class="string"><span class="content">eframe</span></span>
  <span class="key">session</span>:
    <span class="key">http</span>:
      <span class="key">cookiePath</span>: <span class="string"><span class="content">/</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transactional-used-in-wrong-class"><a class="link" href="#transactional-used-in-wrong-class">@Transactional Used in Wrong Class</a></h4>
<div class="paragraph">
<p><a href="#micronaut">Micronaut</a> provides support the normal <em>javax.transaction.Transactional</em> annotation.
This works great in bean classes that are processed by Micronaut (e.g. <em>@Singleton,
@Repository or @Replaces</em>).  If <em>@Transactional</em> is used in other places then nothing is
added to the method.</p>
</div>
<div class="paragraph">
<p>To work around this, you can use the withTransaction closure on a domain (see <a href="#transactions">Transactions</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="key-xyzxyz-is-still-referenced-from-table-abc"><a class="link" href="#key-xyzxyz-is-still-referenced-from-table-abc">Key (xyz)=(xyz) is still referenced from table "abc".</a></h4>
<div class="paragraph">
<p>This is a 'chicken or egg' scenario in some tests that triggers the 'still referenced' errors.
See <a href="#multiple-record-references">Multiple Record References</a> for details.</p>
</div>
<div class="listingblock">
<div class="title">Example - Error with Reference Error from Database</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">io.micronaut.data.exceptions.DataAccessException: Error executing SQL UPDATE: ERROR: update or
  delete on table &quot;product&quot; violates foreign key constraint &quot;product_component_component_id_fkey&quot;
  on table &quot;product_component&quot;
    Detail: Key (uuid)=(2e9aecd6-ab7b-4b7b-8281-dd9dec9eae84) is still referenced from table
    &quot;product_component&quot;.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="http-requests-return-forbidden-status"><a class="link" href="#http-requests-return-forbidden-status">HTTP Requests return Forbidden Status</a></h4>
<div class="paragraph">
<p>With the Micronaut security, if a request&#8217;s URI is not valid for any reason, then the server will
typically return the HTTP <em>Forbidden</em> status.  This happens, even  if the user has permissions for the
URI.</p>
</div>
<div class="paragraph">
<p>If this happens in a unit test in your IDE, then try rebuilding the the project and re-running the test.</p>
</div>
</div>
<div class="sect3">
<h4 id="traits-and-ast"><a class="link" href="#traits-and-ast">Traits and AST</a></h4>
<div class="paragraph">
<p>Early attempts to use the really nice Groovy traits instead of base classes failed.   It seems
Groovy does not guarantee the Annotations such as <em>@Secured</em> will work with traits.  This means
we had to place common CRUD/Rest methods in the controller base classes such as
<a href="#basecrudcontroller">BaseCrudController</a>.</p>
</div>
<div class="paragraph">
<p>The symptoms of this problem was inconsistent evaluation of the @<em>Secured</em> annotation in other modules
that resulted in the annoying FORBIDDEN HTTP response.  This seemed to be worse when used in modules that
depended on the framework (e.g. <a href="../mes-core/guide.html">MES-Core Module</a>).
See
<a href="http://docs.groovy-lang.org/next/html/documentation/core-traits.html#_compatibility_with_ast_transformations">Groovy Documents</a>
for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="gebseleniumwebdriver-and-movetoelement-issuesmessages"><a class="link" href="#gebseleniumwebdriver-and-movetoelement-issuesmessages">Geb/Selenium/Webdriver and moveToElement Issues/Messages</a></h4>
<div class="paragraph">
<p>Under Firefox (and maybe others), the <code>moveToElement()</code> method moves relative to the element&#8217;s
center. This is noted in an INFO message logged to stdError, but we suppress this in
the default GebConfig.groovy file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Logger.getLogger("org.openqa.selenium").setLevel(Level.WARNING)</pre>
</div>
</div>
<div class="paragraph">
<p>You can change the logging level as needed.</p>
</div>
<div class="paragraph">
<p>There may also be other info messages from Selenium/Geb world that are suppressed.</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-not-defined-for-gebspock-tests"><a class="link" href="#beans-not-defined-for-gebspock-tests">Beans not defined for GEB/Spock Tests</a></h4>
<div class="paragraph">
<p>When running a GEB/GUI test, the test spec starts an embedded server.  Sometimes, the micronaut
run-time doesn&#8217;t see the controllers and other beans in your application.  If this happens, make
sure your <em>build.gradle</em> has this dependency:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>compileOnly "io.micronaut:micronaut-inject-groovy"</pre>
</div>
</div>
<div class="paragraph">
<p>This is in addition to the standard testCompile entry.  You need both.</p>
</div>
<div class="paragraph">
<p>One other symptom is in GEB tests, the page is not found.</p>
</div>
</div>
<div class="sect3">
<h4 id="dates-with-groovy-month-syntax"><a class="link" href="#dates-with-groovy-month-syntax">Dates with Groovy MONTH Syntax</a></h4>
<div class="paragraph">
<p>Groovy has a nice array-based syntax for dates such as:</p>
</div>
<div class="listingblock">
<div class="title">Groovy MONTH Syntax</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">d[YEAR] = <span class="integer">2010</span>
d[MONTH] = NOVEMBER
d[DATE] = <span class="integer">14</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is simple and easy to use, but the month values is zero-based (January=0) and the dates are 1-based.  This
inconsistency causes problems.  There are also issues with round trip access to the values that causes troubles.
For example, the code below fails unpredictably:</p>
</div>
<div class="listingblock">
<div class="title">Groovy MONTH Syntax - Fails</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">java.util.Calendar.*</span>

<span class="keyword">def</span> d = <span class="keyword">new</span> <span class="predefined-type">Date</span>()
d[YEAR] = <span class="integer">2010</span>
d[MONTH] = NOVEMBER
d[DATE] = <span class="integer">14</span>
d[HOUR_OF_DAY] = <span class="integer">13</span>
d[MINUTE] = <span class="integer">24</span>
d[SECOND] = <span class="integer">56</span>
d[MILLISECOND] = <span class="integer">987</span>

<span class="keyword">assert</span> d[MONTH] == NOVEMBER</code></pre>
</div>
</div>
<div class="paragraph">
<p>The failure of this code is dependent on the date that the test is run.  For this reason, we have chosen to avoid this
convenient approach to dates.</p>
</div>
</div>
<div class="sect3">
<h4 id="constructors-with-more-than-one-optional-argument"><a class="link" href="#constructors-with-more-than-one-optional-argument">Constructors with more than One Optional Argument</a></h4>
<div class="paragraph">
<p>Groovy provide a nice way to define optional arguments.  This is great, but the automatic class reloading
does not seem to work properly when 2 or more arguments are optional on constructors.  Groovy fails to call the
constructor on class recompilation. Also, 2 optional arguments are a
little confusing, so we avoid that scenario.  Traditional Java method overloading is used in those cases.</p>
</div>
<div class="listingblock">
<div class="title">Multiple Optional Arguments</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GridWidget(<span class="predefined-type">Class</span> domainClass, <span class="predefined-type">Collection</span> list, <span class="predefined-type">Map</span> options=<span class="predefined-constant">null</span>, <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; columns=<span class="predefined-constant">null</span>) {</code></pre>
</div>
</div>
<div class="paragraph">
<p>To solve this, we moved the <code>columns</code> list to the <code>options</code> map to eliminate the <code>columns</code> argument.</p>
</div>
</div>
<div class="sect3">
<h4 id="gstringtemplateengine-is-slow"><a class="link" href="#gstringtemplateengine-is-slow">GStringTemplateEngine is Slow</a></h4>
<div class="paragraph">
<p>When you need to evaluate a Groovy String with specific parameters, the standard way is to use the GStringTemplateEngine.
This is needed when you build the Groovy String from other elements or the user can provide their own string format.</p>
</div>
<div class="listingblock">
<div class="title">Slow GString Use</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> parameters = [<span class="key">day</span>: <span class="string"><span class="delimiter">'</span><span class="content">Monday</span><span class="delimiter">'</span></span>, <span class="key">object</span>: ...]
<span class="keyword">def</span> engine = <span class="keyword">new</span> groovy.text.GStringTemplateEngine()
<span class="keyword">def</span> value = engine.createTemplate(<span class="string"><span class="delimiter">'</span><span class="content">${day}</span><span class="delimiter">'</span></span>).make(parameters).toString()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works and handles almost all cases, but it can be quite slow.  20-30 milliseconds per execution.  Even caching the
<code>engine</code> above does not help much.</p>
</div>
<div class="paragraph">
<p>To solve this, the enterprise framework provides a convenience method (<code>evaluateGString</code>) in
<a href="groovydoc/org/simplemes/eframe/misc/TextUtils.html" target="_blank" rel="noopener">TextUtils</a> to speed up the execution when possible:</p>
</div>
<div class="listingblock">
<div class="title">Fast GString Use</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> parameters = [<span class="key">day</span>: <span class="string"><span class="delimiter">'</span><span class="content">Monday</span><span class="delimiter">'</span></span>, <span class="key">object</span>: ...]
<span class="keyword">def</span> value = TextUtils.evaluateGString(<span class="string"><span class="delimiter">'</span><span class="content">${day}</span><span class="delimiter">'</span></span>,parameters)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This supports the normal Groovy String syntax such as <em>"${day} $day ${object.method()}"</em>.  If the method call format is used,
then the <code>evaluateGString()</code> method will use the slower GStringTemplateEngine approach if needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use the simple format such as <em>"$day"</em> for speed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="canonical-and-tupleconstructor-issues"><a class="link" href="#canonical-and-tupleconstructor-issues">@Canonical and @TupleConstructor Issues</a></h4>
<div class="paragraph">
<p>We try to avoid these two.  The tuple constructor will create a constructor that frequently overlays the default value
for fields.  For example:</p>
</div>
<div class="listingblock">
<div class="title">@Canonical Issue</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Canonical</span>
<span class="type">class</span> <span class="class">Preference</span> {
  <span class="predefined-type">String</span> element
  <span class="predefined-type">String</span> name=<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
  <span class="predefined-type">List</span> details = <span class="type">[]</span>
}

<span class="keyword">def</span> preference = <span class="keyword">new</span> Preference(<span class="string"><span class="delimiter">'</span><span class="content">ABC</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create an instance that has <em>null</em> as the name and details element. The framework will avoid this tuple
constructor in most cases.</p>
</div>
</div>
<div class="sect3">
<h4 id="map-class-vs-map-getclass"><a class="link" href="#map-class-vs-map-getclass">Map.class vs. Map.getClass()</a></h4>
<div class="paragraph">
<p>This is a well-known quirk of Groovy.  In general, Groovy allows you to use the shorter <em>variable.class</em> to get the
Class of the variable.  This works for most types of variables, but not for Maps.</p>
</div>
<div class="paragraph">
<p>When you have a map variable, the map.class returns the entry 'class' from the map.  This means you need to use
 <em>variable.getClass()</em> instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="stub-compiler-issues-with-java"><a class="link" href="#stub-compiler-issues-with-java">Stub Compiler issues with .java</a></h4>
<div class="paragraph">
<p><strong>Symptom:</strong></p>
</div>
<div class="paragraph">
<p>C:\Users\mph\.IntelliJIdea2016.1\system\compile-server\eframe_3d005332\groovyStubs\eframe_main\java-production\org\simplemes\eframe\custom\SomeClass.java
Error:(10, 8) java: java.lang.Comparable cannot be inherited with different arguments: &lt;&gt; and
&lt;org.simplemes.eframe.custom.SomeClass&gt;</p>
</div>
<div class="paragraph">
<p>This happens when compiling the Java stubs.  It happens when a true Java class calls
some Groovy code.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Move the Java source files to the Groovy directory.  The groovy compiler can handle them correctly.</p>
</div>
<div class="paragraph">
<p><strong>Alternate Solution</strong></p>
</div>
<div class="paragraph">
<p>Don&#8217;t call Groovy code from Java in application code.</p>
</div>
</div>
<div class="sect3">
<h4 id="stackoverflowexception-and-stackoverflowerror"><a class="link" href="#stackoverflowexception-and-stackoverflowerror">StackOverflowException and <em>StackOverflowError</em></a></h4>
<div class="paragraph">
<p><strong>Symptom:</strong></p>
</div>
<div class="paragraph">
<p>A stack overflow exception is thrown in unit tests and production when validating a
top-level object with a parent reference.  You can also get a <em>StackOverflowError</em> in a unit test
when toString() is used by debugging or other testing mechanisms (e.g. Spock or IDE-based testing).</p>
</div>
<div class="paragraph">
<p>This can happen under these conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Both child and parent have <code>hashCode()</code> or <code>toString()</code> methods.  This can be the <em>@EqualsAndHashCode</em> annotation or a normal method.</p>
</li>
<li>
<p>The child uses the parent reference as part of its hash code.</p>
</li>
<li>
<p>The parent uses the child reference as part of its hash code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This can happen if you use the simple <em>@EqualsAndHashCode</em> or <em>@ToString</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@EqualsAndHashCode</span>
<span class="annotation">@ToString</span>
<span class="type">class</span> <span class="class">Parent</span> {
  <span class="predefined-type">String</span> code
  <span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="content">parent</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">List</span>&lt;Child&gt; children
  . . .
}


<span class="annotation">@EqualsAndHashCode</span>
<span class="annotation">@ToString</span>
<span class="type">class</span> <span class="class">Child</span> {
  <span class="annotation">@ManyToOne</span>
  Parent parent
  . . .
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This triggers a stack overflow in creating the hash codes since one level references the other.
The default behavior of the <em>@EqualsAndHashCode</em> is to include <strong>all</strong> fields in the hash code calculation.
This causes the recursion and the stack overflow.</p>
</div>
<div class="paragraph">
<p>The solution is to make sure the parent hash code does not depend on the child&#8217;s hash code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@EqualsAndHashCode</span>(includes=[<span class="string"><span class="delimiter">'</span><span class="content">code</span><span class="delimiter">'</span></span>])
<span class="annotation">@ToString</span>
<span class="type">class</span> <span class="class">Parent</span> {
  <span class="predefined-type">String</span> code
  <span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="content">parent</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">List</span>&lt;Child&gt; children
  . . .
}

<span class="annotation">@EqualsAndHashCode</span>(includes=[<span class="string"><span class="delimiter">'</span><span class="content">parent</span><span class="delimiter">'</span></span>])  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@ToString</span>(excludes = [<span class="string"><span class="delimiter">'</span><span class="content">parent</span><span class="delimiter">'</span></span>])
<span class="type">class</span> <span class="class">Child</span> {
  <span class="annotation">@ManyToOne</span>
  Parent parent
  . . .
}

. . .</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This needed to make sure no other fields get pulled into the hash code.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This can also happen with <em>@ToString()</em>.  You may need to add the option <em>excludes = ['order']</em>
      to the <em>@ToString()</em> annotation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cannot-set-property-q-of-undefined"><a class="link" href="#cannot-set-property-q-of-undefined">Cannot set property 'Q' of undefined</a></h4>
<div class="paragraph">
<p>When this happens deep in the <a href="#GUI Toolkit">[GUI Toolkit]</a> library, it usually means a syntax error in the Javascript object passed to the toolkit constructor.</p>
</div>
<div class="listingblock">
<div class="title">Example - Undefined message from Toolkit</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">_B.display = {
  <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">form</span><span class="delimiter">'</span></span>, <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">clean</span><span class="delimiter">'</span></span>, <span class="key">margin</span>: <span class="integer">0</span>,
  <span class="key">rows</span>: [
    {<span class="key">height</span>: <span class="integer">10</span>},
    ,                   <i class="conum" data-value="1"></i><b>(1)</b>
    { <span class="key">margin</span>: <span class="integer">8</span>,
      <span class="key">cols</span>: [
        {<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>, <span class="key">id</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">rmaLabel</span><span class="delimiter">&quot;</span></span>, <span class="key">label</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">rma.label</span><span class="delimiter">&quot;</span></span>, <span class="key">width</span>: tk.pw(ef.getPageOption(<span class="string"><span class="delimiter">'</span><span class="content">labelWidth</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">20%</span><span class="delimiter">'</span></span>)) , <span class="key">align</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">right</span><span class="delimiter">&quot;</span></span>},
        {<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>, <span class="key">id</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">rma</span><span class="delimiter">&quot;</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">rma</span><span class="delimiter">&quot;</span></span>, <span class="key">value</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">RMA1001</span><span class="delimiter">&quot;</span></span>  ,<span class="key">inputWidth</span>: tk.pw(<span class="string"><span class="delimiter">&quot;</span><span class="content">22em</span><span class="delimiter">&quot;</span></span>),<span class="key">attributes</span>: {<span class="key">maxlength</span>: <span class="integer">40</span>} }
      ]
    }
  ]
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This extra comma causes problems with the parsing of the object and the toolkit attempts to use an undefined GUI element.
Remove this extra comma to solve the problem.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="nosuchmethodexception-on-repository-method-really-exists"><a class="link" href="#nosuchmethodexception-on-repository-method-really-exists">NoSuchMethodException on Repository - Method Really Exists</a></h4>
<div class="paragraph">
<p>If you use primitive method arguments (e.g. boolean instead of Boolean), you will probably get
a NoSuchMethodException like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NoSuchMethodException: sample.DashboardConfigRepository$Intercepted.findByCategoryAndDefaultConfig(java.lang.String, java.lang.Boolean)</pre>
</div>
</div>
<div class="paragraph">
<p>This happens when you use a primitive type (boolean) as an argument in the repository interface.
If you try to use the domain convenience method (<code>DashboardConfig.findByCategoryAndDefaultConfig()</code>),
you will get the exception.  For example:</p>
</div>
<div class="listingblock">
<div class="title">Example - Primitive Types in Repository Methods</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> DashboardConfigRepository <span class="directive">extends</span> BaseRepository, CrudRepository&lt;DashboardConfig, <span class="predefined-type">UUID</span>&gt; {
  Optional&lt;DashboardConfig&gt; findByCategoryAndDefaultConfig(<span class="predefined-type">String</span> category, <span class="type">boolean</span> defaultConfig) <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A primitive is used.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To fix this, use the object (Boolean) instead of the primitive (boolean).</p>
</div>
<div class="paragraph">
<p>This is caused by logic in the enterprise framework that delegates static method calls on the domain
to the repository.  If you use the repository method directly, then this is not a problem.</p>
</div>
</div>
<div class="sect3">
<h4 id="forbidden-403-response-from-controller"><a class="link" href="#forbidden-403-response-from-controller">Forbidden (403) Response from Controller</a></h4>
<div class="paragraph">
<p>When you make an HTTP request to the controller, it returns 403 (Forbidden).  This can
be caused by many reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No <em>@Secure</em> annotation.</p>
</li>
<li>
<p>User does not have the require Role specific in the <em>@Secured</em> annotation.</p>
</li>
<li>
<p>Method is not correct (Get vs. Post).</p>
</li>
<li>
<p>The controller is not deployed as a bean (e.g. no <em>@Singleton</em> annotation or
wrong import.  Always use: '<em>import javax.inject.Singleton</em>' ).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can turn on TRACE logging for <em>io.micronaut.http</em> or <em>io.micronaut.routing</em> to help
debug this.  You can also turn on TRACE for <em>io.micronaut</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="nashorn"><a class="link" href="#nashorn">Nashorn</a></h4>
<div class="paragraph">
<p>Some tests will use the built-in Javascript engine to validate the generated Javascript.
This results in this warning message every time it is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Warning: Nashorn engine is planned to be removed from a future JDK release</pre>
</div>
</div>
<div class="paragraph">
<p>To avoid this warning, run your tests with this option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-Dnashorn.args="--no-deprecation-warning"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="nosuchbeanexception-synchronoustransactionmanager-bean-cannot-be-created"><a class="link" href="#nosuchbeanexception-synchronoustransactionmanager-bean-cannot-be-created">NoSuchBeanException - SynchronousTransactionManager Bean Cannot be Created</a></h4>
<div class="paragraph">
<p>The exception is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>io.micronaut.context.exceptions.NoSuchBeanException: No bean of type [io.micronaut.transaction.SynchronousTransactionManager] exists. Make sure the bean is not disabled by bean requirements (enable trace logging for 'io.micronaut.context.condition' to check) and if the bean is enabled then ensure the class is declared a bean and annotation processing is enabled (for Java and Kotlin the 'micronaut-inject-java' dependency should be configured as an annotation processor).</pre>
</div>
</div>
<div class="paragraph">
<p>This exception is caused when the datasources section in the <em>application.yml</em> file
is not found.  The SynchronousTransactionManager bean is created for each datasource listed in the
<em>application.yml</em> file.  If there is no section or the fiel can&#8217;t be found, then
the bean won&#8217;t be created.</p>
</div>
<div class="paragraph">
<p>The possible causes include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No <em>application.yml</em> file defined.</p>
</li>
<li>
<p>The resources folder is not on the class path.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If running from IDEA as an application, then the output resources folder must be on the
classpath.  Normally, performing a Gradle resynch in IDEA solves the problem.</p>
</div>
<div class="paragraph">
<p>Sometimes, you will have to manually add the output folder&#8217;s class path
to the dependencies.  This is done in the Modules part of the 'Project Structure' dialog.</p>
</div>
<div class="paragraph">
<p>By default, you would add this folder as a Classes directory:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>simplemes-core\eframe\out\production\resources</pre>
</div>
</div>
<div class="paragraph">
<p>This assumes you have IDEA handling the build (not gradle) and the output path is
<em>simplemes-core\eframe\out</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="vue-invalid-prop-type-check-failed-for-prop"><a class="link" href="#vue-invalid-prop-type-check-failed-for-prop">Vue - Invalid prop: type check failed for prop</a></h4>
<div class="paragraph">
<p>This happens when you pass a string to a property that expects a numeric value.
The javascript console message in the browser is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Invalid prop: type check failed for prop "xyz". Expected Number with value 9999, got String with value "9999".</pre>
</div>
</div>
<div class="paragraph">
<p>When used with a Vue reference like this:</p>
</div>
<div class="listingblock">
<div class="title">Example - Invalid prop: type check failed for prop -</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">  <span class="tag">&lt;Toast</span> <span class="attribute-name">baseZIndex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9999</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>CORRECT</strong> syntax is to bind the value to a JS expression like this:</p>
</div>
<div class="listingblock">
<div class="title">Example - Works</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">  <span class="tag">&lt;Toast</span> <span class="attribute-name">:baseZIndex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9999</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. ASCIIDOCTOR Attributes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asciidoctor-version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0.10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">safe-mode-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsafe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">docdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/home/runner/work/simplemes-core/simplemes-core/eframe/src/main/docs/asciidoc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">docfile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/home/runner/work/simplemes-core/simplemes-core/eframe/src/main/docs/asciidoc/guide.adoc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">doctype</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">book</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagesdir-build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagesdir-src</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagesdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">images</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.5<br>
Last updated 2021-06-27 13:37:23 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>